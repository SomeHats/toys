var fn=t=>{throw TypeError(t)};var vn=(t,e,n)=>e.has(t)||fn("Cannot "+n);var R=(t,e,n)=>(vn(t,e,"read from private field"),n?n.call(t):e.get(t)),Pe=(t,e,n)=>e.has(t)?fn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),we=(t,e,n,r)=>(vn(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n);import{e as W,a as Xe,t as ze,d as On,v as zn,m as dr,A as Ze,y as pr,L as Re,M as hr,N as Gt,k as fr,h as mn,O as vr,z as gn,w as mr,P as gr}from"./chunk_utils.CSiPn6yw.js";/* empty css                       */import{j as h,c as yr}from"./chunk_client.CotzxIPX.js";import{f as et,a as A,b as Ne}from"./chunk_assert.pxkjFBOg.js";import{S as _,V as j,R as jn}from"./chunk_Vector2.BFoa__dl.js";import{u as Je,a as Pr,s as wr}from"./chunk_useResizeObserver.DnDEPOOq.js";import{L as q,r as ct,a as dt,u as he,b as xr,B as fe,P as Sr,c as U,d as rt,e as de,V as br,f as yn,A as Er,g as Pn}from"./chunk_Button.KyMowPGE.js";import{c as Ir,d as Cr,a as kr,b as Tr}from"./chunk_storage.BtxlEzFH.js";import{c as Y}from"./chunk_index.ZX3Pv0I0.js";import{r as d,R as E,a as Mr,b as st}from"./chunk_index.C5eOxiyT.js";import{s as Q,m as $n,n as An,l as ve,e as _n,o as N,t as Nr,D as X,y as J,q as Rn,v as Fn,w as qt,X as Z,d as He,f as Ke,S as ot,x as Yt,u as K,I as Le,O as Ee,i as pe,h as te,r as Jt,N as jt,M as Lr,b as Dr,H as Or,a as zr,T as jr,p as Xt,R as $r,j as Ar,z as Zt,A as Vn,B as Ie,g as _r,C as wn}from"./chunk_iconBase.CJdW0osQ.js";import{a as Ue,d as $t}from"./chunk_debugPropsToString.gwtFh97f.js";import{$ as Rr,_ as Bn}from"./chunk_index.DK7fnwHW.js";import{G as Fr,d as Vr}from"./chunk_useGestureDetector.Drc08ScY.js";import{s as Br,U as Hr,S as Qt,p as tt,A as Kr,a as At}from"./chunk_pathFromCenterPoints.CG76Cl63.js";import{a as $e,m as Ur}from"./chunk_useKeyPress.DXQO3Xkx.js";import{A as Wr}from"./chunk_AABB.CekZtYjv.js";import{I as yt}from"./chunk_Ids.gQRklNmK.js";import{g as Hn,c as Kn,b as _t}from"./chunk_perfectFreehand.CDhhpYQi.js";import{a as xn,D as Gr}from"./chunk_DebugSvg.Bt0G2Qkn.js";import{a as Sn}from"./chunk_theme.DQE7OmCU.js";import{e as qr,f as Yr}from"./chunk_index.esm.BlEnPQD9.js";import"./chunk_ResizeObserver.C8OzoCMD.js";import"./chunk_useMergedRefs.MPIvL6fk.js";import"./chunk_EventEmitter.BsO-_0un.js";import"./chunk__commonjsHelpers.Cpj98o6Y.js";import"./chunk_DebugDraw.CrSpCKoE.js";import"./chunk_svgPathBuilder.tqI_yD_n.js";function at(t,e,n){let r=Q(e);d.useEffect(()=>{function i(o){r.current(o)}return document.addEventListener(t,i,n),()=>document.removeEventListener(t,i,n)},[t,n])}function Un(t,e,n){let r=Q(e);d.useEffect(()=>{function i(o){r.current(o)}return window.addEventListener(t,i,n),()=>window.removeEventListener(t,i,n)},[t,n])}function Jr(t,e,n=!0){let r=d.useRef(!1);d.useEffect(()=>{requestAnimationFrame(()=>{r.current=n})},[n]);function i(s,a){if(!r.current||s.defaultPrevented)return;let l=a(s);if(l===null||!l.getRootNode().contains(l)||!l.isConnected)return;let u=function c(p){return typeof p=="function"?c(p()):Array.isArray(p)||p instanceof Set?p:[p]}(t);for(let c of u){if(c===null)continue;let p=c instanceof HTMLElement?c:c.current;if(p!=null&&p.contains(l)||s.composed&&s.composedPath().includes(p))return}return!$n(l,An.Loose)&&l.tabIndex!==-1&&s.preventDefault(),e(s,l)}let o=d.useRef(null);at("pointerdown",s=>{var a,l;r.current&&(o.current=((l=(a=s.composedPath)==null?void 0:a.call(s))==null?void 0:l[0])||s.target)},!0),at("mousedown",s=>{var a,l;r.current&&(o.current=((l=(a=s.composedPath)==null?void 0:a.call(s))==null?void 0:l[0])||s.target)},!0),at("click",s=>{o.current&&(i(s,()=>o.current),o.current=null)},!0),at("touchend",s=>i(s,()=>s.target instanceof HTMLElement?s.target:null),!0),Un("blur",s=>i(s,()=>window.document.activeElement instanceof HTMLIFrameElement?window.document.activeElement:null),!0)}function bn(t){var e;if(t.type)return t.type;let n=(e=t.as)!=null?e:"button";if(typeof n=="string"&&n.toLowerCase()==="button")return"button"}function Wn(t,e){let[n,r]=d.useState(()=>bn(t));return ve(()=>{r(bn(t))},[t.type,t.as]),ve(()=>{n||e.current&&e.current instanceof HTMLButtonElement&&!e.current.hasAttribute("type")&&r("button")},[n,e]),n}let en=d.createContext(null);en.displayName="OpenClosedContext";var H=(t=>(t[t.Open=1]="Open",t[t.Closed=2]="Closed",t[t.Closing=4]="Closing",t[t.Opening=8]="Opening",t))(H||{});function Pt(){return d.useContext(en)}function Gn({value:t,children:e}){return E.createElement(en.Provider,{value:t},e)}function Ge(...t){return d.useMemo(()=>_n(...t),[...t])}var ne=(t=>(t[t.Forwards=0]="Forwards",t[t.Backwards=1]="Backwards",t))(ne||{});function qn(){let t=d.useRef(0);return Un("keydown",e=>{e.key==="Tab"&&(t.current=e.shiftKey?1:0)},!0),t}function Xr(t,e,n,r){let i=Q(n);d.useEffect(()=>{t=t??window;function o(s){i.current(s)}return t.addEventListener(e,o,r),()=>t.removeEventListener(e,o,r)},[t,e,r])}function Zr(t){let e=N(t),n=d.useRef(!1);d.useEffect(()=>(n.current=!1,()=>{n.current=!0,Nr(()=>{n.current&&e()})}),[e])}let Qr=d.createContext(!1);function eo(){return d.useContext(Qr)}function to(t){let e=eo(),n=d.useContext(Yn),r=Ge(t),[i,o]=d.useState(()=>{if(!e&&n!==null||Fn.isServer)return null;let s=r==null?void 0:r.getElementById("headlessui-portal-root");if(s)return s;if(r===null)return null;let a=r.createElement("div");return a.setAttribute("id","headlessui-portal-root"),r.body.appendChild(a)});return d.useEffect(()=>{i!==null&&(r!=null&&r.body.contains(i)||r==null||r.body.appendChild(i))},[i,r]),d.useEffect(()=>{e||n!==null&&o(n.current)},[n,o,e]),i}let no=d.Fragment;function ro(t,e){let n=t,r=d.useRef(null),i=J(Rn(c=>{r.current=c}),e),o=Ge(r),s=to(r),[a]=d.useState(()=>{var c;return Fn.isServer?null:(c=o==null?void 0:o.createElement("div"))!=null?c:null}),l=d.useContext(Rt),u=qt();return ve(()=>{!s||!a||s.contains(a)||(a.setAttribute("data-headlessui-portal",""),s.appendChild(a))},[s,a]),ve(()=>{if(a&&l)return l.register(a)},[l,a]),Zr(()=>{var c;!s||!a||(a instanceof Node&&s.contains(a)&&s.removeChild(a),s.childNodes.length<=0&&((c=s.parentElement)==null||c.removeChild(s)))}),u?!s||!a?null:Mr.createPortal(Z({ourProps:{ref:i},theirProps:n,defaultTag:no,name:"Portal"}),a):null}let oo=d.Fragment,Yn=d.createContext(null);function io(t,e){let{target:n,...r}=t,i={ref:J(e)};return E.createElement(Yn.Provider,{value:n},Z({ourProps:i,theirProps:r,defaultTag:oo,name:"Popover.Group"}))}let Rt=d.createContext(null);function so(){let t=d.useContext(Rt),e=d.useRef([]),n=N(o=>(e.current.push(o),t&&t.register(o),()=>r(o))),r=N(o=>{let s=e.current.indexOf(o);s!==-1&&e.current.splice(s,1),t&&t.unregister(o)}),i=d.useMemo(()=>({register:n,unregister:r,portals:e}),[n,r,e]);return[e,d.useMemo(()=>function({children:o}){return E.createElement(Rt.Provider,{value:i},o)},[i])]}let ao=X(ro),lo=X(io);Object.assign(ao,{Group:lo});function uo({defaultContainers:t=[],portals:e,mainTreeNodeRef:n}={}){var r;let i=d.useRef((r=n==null?void 0:n.current)!=null?r:null),o=Ge(i),s=N(()=>{var a;let l=[];for(let u of t)u!==null&&(u instanceof HTMLElement?l.push(u):"current"in u&&u.current instanceof HTMLElement&&l.push(u.current));if(e!=null&&e.current)for(let u of e.current)l.push(u);for(let u of(a=o==null?void 0:o.querySelectorAll("html > *, body > *"))!=null?a:[])u!==document.body&&u!==document.head&&u instanceof HTMLElement&&u.id!=="headlessui-portal-root"&&(u.contains(i.current)||l.some(c=>u.contains(c))||l.push(u));return l});return{resolveContainers:s,contains:N(a=>s().some(l=>l.contains(a))),mainTreeNodeRef:i,MainTreeNode:d.useMemo(()=>function(){return n!=null?null:E.createElement(He,{features:Ke.Hidden,ref:i})},[i,n])}}function co(){let t=d.useRef(null);return{mainTreeNodeRef:t,MainTreeNode:d.useMemo(()=>function(){return E.createElement(He,{features:Ke.Hidden,ref:t})},[t])}}var po=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(po||{}),ho=(t=>(t[t.TogglePopover=0]="TogglePopover",t[t.ClosePopover=1]="ClosePopover",t[t.SetButton=2]="SetButton",t[t.SetButtonId=3]="SetButtonId",t[t.SetPanel=4]="SetPanel",t[t.SetPanelId=5]="SetPanelId",t))(ho||{});let fo={0:t=>{let e={...t,popoverState:K(t.popoverState,{0:1,1:0})};return e.popoverState===0&&(e.__demoMode=!1),e},1(t){return t.popoverState===1?t:{...t,popoverState:1}},2(t,e){return t.button===e.button?t:{...t,button:e.button}},3(t,e){return t.buttonId===e.buttonId?t:{...t,buttonId:e.buttonId}},4(t,e){return t.panel===e.panel?t:{...t,panel:e.panel}},5(t,e){return t.panelId===e.panelId?t:{...t,panelId:e.panelId}}},tn=d.createContext(null);tn.displayName="PopoverContext";function wt(t){let e=d.useContext(tn);if(e===null){let n=new Error(`<${t} /> is missing a parent <Popover /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,wt),n}return e}let nn=d.createContext(null);nn.displayName="PopoverAPIContext";function rn(t){let e=d.useContext(nn);if(e===null){let n=new Error(`<${t} /> is missing a parent <Popover /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,rn),n}return e}let on=d.createContext(null);on.displayName="PopoverGroupContext";function Jn(){return d.useContext(on)}let xt=d.createContext(null);xt.displayName="PopoverPanelContext";function vo(){return d.useContext(xt)}function mo(t,e){return K(e.type,fo,t,e)}let go="div";function yo(t,e){var n;let{__demoMode:r=!1,...i}=t,o=d.useRef(null),s=J(e,Rn(D=>{o.current=D})),a=d.useRef([]),l=d.useReducer(mo,{__demoMode:r,popoverState:r?0:1,buttons:a,button:null,buttonId:null,panel:null,panelId:null,beforePanelSentinel:d.createRef(),afterPanelSentinel:d.createRef()}),[{popoverState:u,button:c,buttonId:p,panel:f,panelId:w,beforePanelSentinel:v,afterPanelSentinel:g},m]=l,P=Ge((n=o.current)!=null?n:c),x=d.useMemo(()=>{if(!c||!f)return!1;for(let Oe of document.querySelectorAll("body > *"))if(Number(Oe==null?void 0:Oe.contains(c))^Number(Oe==null?void 0:Oe.contains(f)))return!0;let D=Yt(),F=D.indexOf(c),De=(F+D.length-1)%D.length,ye=(F+1)%D.length,ee=D[De],ie=D[ye];return!f.contains(ee)&&!f.contains(ie)},[c,f]),S=Q(p),b=Q(w),M=d.useMemo(()=>({buttonId:S,panelId:b,close:()=>m({type:1})}),[S,b,m]),T=Jn(),y=T==null?void 0:T.registerPopover,C=N(()=>{var D;return(D=T==null?void 0:T.isFocusWithinPopoverGroup())!=null?D:(P==null?void 0:P.activeElement)&&((c==null?void 0:c.contains(P.activeElement))||(f==null?void 0:f.contains(P.activeElement)))});d.useEffect(()=>y==null?void 0:y(M),[y,M]);let[k,O]=so(),I=uo({mainTreeNodeRef:T==null?void 0:T.mainTreeNodeRef,portals:k,defaultContainers:[c,f]});Xr(P==null?void 0:P.defaultView,"focus",D=>{var F,De,ye,ee;D.target!==window&&D.target instanceof HTMLElement&&u===0&&(C()||c&&f&&(I.contains(D.target)||(De=(F=v.current)==null?void 0:F.contains)!=null&&De.call(F,D.target)||(ee=(ye=g.current)==null?void 0:ye.contains)!=null&&ee.call(ye,D.target)||m({type:1})))},!0),Jr(I.resolveContainers,(D,F)=>{m({type:1}),$n(F,An.Loose)||(D.preventDefault(),c==null||c.focus())},u===0);let L=N(D=>{m({type:1});let F=D?D instanceof HTMLElement?D:"current"in D&&D.current instanceof HTMLElement?D.current:c:c;F==null||F.focus()}),z=d.useMemo(()=>({close:L,isPortalled:x}),[L,x]),B=d.useMemo(()=>({open:u===0,close:L}),[u,L]),ge={ref:s};return E.createElement(xt.Provider,{value:null},E.createElement(tn.Provider,{value:l},E.createElement(nn.Provider,{value:z},E.createElement(Gn,{value:K(u,{0:H.Open,1:H.Closed})},E.createElement(O,null,Z({ourProps:ge,theirProps:i,slot:B,defaultTag:go,name:"Popover"}),E.createElement(I.MainTreeNode,null))))))}let Po="button";function wo(t,e){let n=Le(),{id:r=`headlessui-popover-button-${n}`,...i}=t,[o,s]=wt("Popover.Button"),{isPortalled:a}=rn("Popover.Button"),l=d.useRef(null),u=`headlessui-focus-sentinel-${Le()}`,c=Jn(),p=c==null?void 0:c.closeOthers,f=vo()!==null;d.useEffect(()=>{if(!f)return s({type:3,buttonId:r}),()=>{s({type:3,buttonId:null})}},[f,r,s]);let[w]=d.useState(()=>Symbol()),v=J(l,e,f?null:I=>{if(I)o.buttons.current.push(w);else{let L=o.buttons.current.indexOf(w);L!==-1&&o.buttons.current.splice(L,1)}o.buttons.current.length>1&&console.warn("You are already using a <Popover.Button /> but only 1 <Popover.Button /> is supported."),I&&s({type:2,button:I})}),g=J(l,e),m=Ge(l),P=N(I=>{var L,z,B;if(f){if(o.popoverState===1)return;switch(I.key){case te.Space:case te.Enter:I.preventDefault(),(z=(L=I.target).click)==null||z.call(L),s({type:1}),(B=o.button)==null||B.focus();break}}else switch(I.key){case te.Space:case te.Enter:I.preventDefault(),I.stopPropagation(),o.popoverState===1&&(p==null||p(o.buttonId)),s({type:0});break;case te.Escape:if(o.popoverState!==0)return p==null?void 0:p(o.buttonId);if(!l.current||m!=null&&m.activeElement&&!l.current.contains(m.activeElement))return;I.preventDefault(),I.stopPropagation(),s({type:1});break}}),x=N(I=>{f||I.key===te.Space&&I.preventDefault()}),S=N(I=>{var L,z;Jt(I.currentTarget)||t.disabled||(f?(s({type:1}),(L=o.button)==null||L.focus()):(I.preventDefault(),I.stopPropagation(),o.popoverState===1&&(p==null||p(o.buttonId)),s({type:0}),(z=o.button)==null||z.focus()))}),b=N(I=>{I.preventDefault(),I.stopPropagation()}),M=o.popoverState===0,T=d.useMemo(()=>({open:M}),[M]),y=Wn(t,l),C=f?{ref:g,type:y,onKeyDown:P,onClick:S}:{ref:v,id:o.buttonId,type:y,"aria-expanded":o.popoverState===0,"aria-controls":o.panel?o.panelId:void 0,onKeyDown:P,onKeyUp:x,onClick:S,onMouseDown:b},k=qn(),O=N(()=>{let I=o.panel;if(!I)return;function L(){K(k.current,{[ne.Forwards]:()=>Ee(I,pe.First),[ne.Backwards]:()=>Ee(I,pe.Last)})===jt.Error&&Ee(Yt().filter(z=>z.dataset.headlessuiFocusGuard!=="true"),K(k.current,{[ne.Forwards]:pe.Next,[ne.Backwards]:pe.Previous}),{relativeTo:o.button})}L()});return E.createElement(E.Fragment,null,Z({ourProps:C,theirProps:i,slot:T,defaultTag:Po,name:"Popover.Button"}),M&&!f&&a&&E.createElement(He,{id:u,features:Ke.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:O}))}let xo="div",So=ot.RenderStrategy|ot.Static;function bo(t,e){let n=Le(),{id:r=`headlessui-popover-overlay-${n}`,...i}=t,[{popoverState:o},s]=wt("Popover.Overlay"),a=J(e),l=Pt(),u=l!==null?(l&H.Open)===H.Open:o===0,c=N(f=>{if(Jt(f.currentTarget))return f.preventDefault();s({type:1})}),p=d.useMemo(()=>({open:o===0}),[o]);return Z({ourProps:{ref:a,id:r,"aria-hidden":!0,onClick:c},theirProps:i,slot:p,defaultTag:xo,features:So,visible:u,name:"Popover.Overlay"})}let Eo="div",Io=ot.RenderStrategy|ot.Static;function Co(t,e){let n=Le(),{id:r=`headlessui-popover-panel-${n}`,focus:i=!1,...o}=t,[s,a]=wt("Popover.Panel"),{close:l,isPortalled:u}=rn("Popover.Panel"),c=`headlessui-focus-sentinel-before-${Le()}`,p=`headlessui-focus-sentinel-after-${Le()}`,f=d.useRef(null),w=J(f,e,y=>{a({type:4,panel:y})}),v=Ge(f);ve(()=>(a({type:5,panelId:r}),()=>{a({type:5,panelId:null})}),[r,a]);let g=Pt(),m=g!==null?(g&H.Open)===H.Open:s.popoverState===0,P=N(y=>{var C;switch(y.key){case te.Escape:if(s.popoverState!==0||!f.current||v!=null&&v.activeElement&&!f.current.contains(v.activeElement))return;y.preventDefault(),y.stopPropagation(),a({type:1}),(C=s.button)==null||C.focus();break}});d.useEffect(()=>{var y;t.static||s.popoverState===1&&((y=t.unmount)==null||y)&&a({type:4,panel:null})},[s.popoverState,t.unmount,t.static,a]),d.useEffect(()=>{if(s.__demoMode||!i||s.popoverState!==0||!f.current)return;let y=v==null?void 0:v.activeElement;f.current.contains(y)||Ee(f.current,pe.First)},[s.__demoMode,i,f,s.popoverState]);let x=d.useMemo(()=>({open:s.popoverState===0,close:l}),[s,l]),S={ref:w,id:r,onKeyDown:P,onBlur:i&&s.popoverState===0?y=>{var C,k,O,I,L;let z=y.relatedTarget;z&&f.current&&((C=f.current)!=null&&C.contains(z)||(a({type:1}),((O=(k=s.beforePanelSentinel.current)==null?void 0:k.contains)!=null&&O.call(k,z)||(L=(I=s.afterPanelSentinel.current)==null?void 0:I.contains)!=null&&L.call(I,z))&&z.focus({preventScroll:!0})))}:void 0,tabIndex:-1},b=qn(),M=N(()=>{let y=f.current;if(!y)return;function C(){K(b.current,{[ne.Forwards]:()=>{var k;Ee(y,pe.First)===jt.Error&&((k=s.afterPanelSentinel.current)==null||k.focus())},[ne.Backwards]:()=>{var k;(k=s.button)==null||k.focus({preventScroll:!0})}})}C()}),T=N(()=>{let y=f.current;if(!y)return;function C(){K(b.current,{[ne.Forwards]:()=>{var k;if(!s.button)return;let O=Yt(),I=O.indexOf(s.button),L=O.slice(0,I+1),z=[...O.slice(I+1),...L];for(let B of z.slice())if(B.dataset.headlessuiFocusGuard==="true"||(k=s.panel)!=null&&k.contains(B)){let ge=z.indexOf(B);ge!==-1&&z.splice(ge,1)}Ee(z,pe.First,{sorted:!1})},[ne.Backwards]:()=>{var k;Ee(y,pe.Previous)===jt.Error&&((k=s.button)==null||k.focus())}})}C()});return E.createElement(xt.Provider,{value:r},m&&u&&E.createElement(He,{id:c,ref:s.beforePanelSentinel,features:Ke.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:M}),Z({ourProps:S,theirProps:o,slot:x,defaultTag:Eo,features:Io,visible:m,name:"Popover.Panel"}),m&&u&&E.createElement(He,{id:p,ref:s.afterPanelSentinel,features:Ke.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:T}))}let ko="div";function To(t,e){let n=d.useRef(null),r=J(n,e),[i,o]=d.useState([]),s=co(),a=N(g=>{o(m=>{let P=m.indexOf(g);if(P!==-1){let x=m.slice();return x.splice(P,1),x}return m})}),l=N(g=>(o(m=>[...m,g]),()=>a(g))),u=N(()=>{var g;let m=_n(n);if(!m)return!1;let P=m.activeElement;return(g=n.current)!=null&&g.contains(P)?!0:i.some(x=>{var S,b;return((S=m.getElementById(x.buttonId.current))==null?void 0:S.contains(P))||((b=m.getElementById(x.panelId.current))==null?void 0:b.contains(P))})}),c=N(g=>{for(let m of i)m.buttonId.current!==g&&m.close()}),p=d.useMemo(()=>({registerPopover:l,unregisterPopover:a,isFocusWithinPopoverGroup:u,closeOthers:c,mainTreeNodeRef:s.mainTreeNodeRef}),[l,a,u,c,s.mainTreeNodeRef]),f=d.useMemo(()=>({}),[]),w=t,v={ref:r};return E.createElement(on.Provider,{value:p},Z({ourProps:v,theirProps:w,slot:f,defaultTag:ko,name:"Popover.Group"}),E.createElement(s.MainTreeNode,null))}let Mo=X(yo),No=X(wo),Lo=X(bo),Do=X(Co),Oo=X(To),It=Object.assign(Mo,{Button:No,Overlay:Lo,Panel:Do,Group:Oo}),sn=d.createContext(null);sn.displayName="GroupContext";let zo=d.Fragment;function jo(t){var e;let[n,r]=d.useState(null),[i,o]=Or(),[s,a]=zr(),l=d.useMemo(()=>({switch:n,setSwitch:r,labelledby:i,describedby:s}),[n,r,i,s]),u={},c=t;return E.createElement(a,{name:"Switch.Description"},E.createElement(o,{name:"Switch.Label",props:{htmlFor:(e=l.switch)==null?void 0:e.id,onClick(p){n&&(p.currentTarget.tagName==="LABEL"&&p.preventDefault(),n.click(),n.focus({preventScroll:!0}))}}},E.createElement(sn.Provider,{value:l},Z({ourProps:u,theirProps:c,defaultTag:zo,name:"Switch.Group"}))))}let $o="button";function Ao(t,e){let n=Le(),{id:r=`headlessui-switch-${n}`,checked:i,defaultChecked:o=!1,onChange:s,name:a,value:l,form:u,...c}=t,p=d.useContext(sn),f=d.useRef(null),w=J(f,e,p===null?null:p.setSwitch),[v,g]=jr(i,s,o),m=N(()=>g==null?void 0:g(!v)),P=N(y=>{if(Jt(y.currentTarget))return y.preventDefault();y.preventDefault(),m()}),x=N(y=>{y.key===te.Space?(y.preventDefault(),m()):y.key===te.Enter&&Ar(y.currentTarget)}),S=N(y=>y.preventDefault()),b=d.useMemo(()=>({checked:v}),[v]),M={id:r,ref:w,role:"switch",type:Wn(t,f),tabIndex:0,"aria-checked":v,"aria-labelledby":p==null?void 0:p.labelledby,"aria-describedby":p==null?void 0:p.describedby,onClick:P,onKeyUp:x,onKeyPress:S},T=Xt();return d.useEffect(()=>{var y;let C=(y=f.current)==null?void 0:y.closest("form");C&&o!==void 0&&T.addEventListener(C,"reset",()=>{g(o)})},[f,g]),E.createElement(E.Fragment,null,a!=null&&v&&E.createElement(He,{features:Ke.Hidden,...$r({as:"input",type:"checkbox",hidden:!0,readOnly:!0,form:u,checked:v,name:a,value:l})}),Z({ourProps:M,theirProps:c,slot:b,defaultTag:$o,name:"Switch"}))}let _o=X(Ao),Ro=jo,Fo=Object.assign(_o,{Group:Ro,Label:Lr,Description:Dr});function Vo(t){let e={called:!1};return(...n)=>{if(!e.called)return e.called=!0,t(...n)}}function Ct(t,...e){t&&e.length>0&&t.classList.add(...e)}function kt(t,...e){t&&e.length>0&&t.classList.remove(...e)}function Bo(t,e){let n=Zt();if(!t)return n.dispose;let{transitionDuration:r,transitionDelay:i}=getComputedStyle(t),[o,s]=[r,i].map(l=>{let[u=0]=l.split(",").filter(Boolean).map(c=>c.includes("ms")?parseFloat(c):parseFloat(c)*1e3).sort((c,p)=>p-c);return u}),a=o+s;if(a!==0){n.group(u=>{u.setTimeout(()=>{e(),u.dispose()},a),u.addEventListener(t,"transitionrun",c=>{c.target===c.currentTarget&&u.dispose()})});let l=n.addEventListener(t,"transitionend",u=>{u.target===u.currentTarget&&(e(),l())})}else e();return n.add(()=>e()),n.dispose}function Ho(t,e,n,r){let i=n?"enter":"leave",o=Zt(),s=r!==void 0?Vo(r):()=>{};i==="enter"&&(t.removeAttribute("hidden"),t.style.display="");let a=K(i,{enter:()=>e.enter,leave:()=>e.leave}),l=K(i,{enter:()=>e.enterTo,leave:()=>e.leaveTo}),u=K(i,{enter:()=>e.enterFrom,leave:()=>e.leaveFrom});return kt(t,...e.base,...e.enter,...e.enterTo,...e.enterFrom,...e.leave,...e.leaveFrom,...e.leaveTo,...e.entered),Ct(t,...e.base,...a,...u),o.nextFrame(()=>{kt(t,...e.base,...a,...u),Ct(t,...e.base,...a,...l),Bo(t,()=>(kt(t,...e.base,...a),Ct(t,...e.base,...e.entered),s()))}),o.dispose}function Ko({immediate:t,container:e,direction:n,classes:r,onStart:i,onStop:o}){let s=Vn(),a=Xt(),l=Q(n);ve(()=>{t&&(l.current="enter")},[t]),ve(()=>{let u=Zt();a.add(u.dispose);let c=e.current;if(c&&l.current!=="idle"&&s.current)return u.dispose(),i.current(l.current),u.add(Ho(c,r.current,l.current==="enter",()=>{u.dispose(),o.current(l.current)})),u.dispose},[n])}function ae(t=""){return t.split(" ").filter(e=>e.trim().length>1)}let St=d.createContext(null);St.displayName="TransitionContext";var Uo=(t=>(t.Visible="visible",t.Hidden="hidden",t))(Uo||{});function Wo(){let t=d.useContext(St);if(t===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return t}function Go(){let t=d.useContext(bt);if(t===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return t}let bt=d.createContext(null);bt.displayName="NestingContext";function Et(t){return"children"in t?Et(t.children):t.current.filter(({el:e})=>e.current!==null).filter(({state:e})=>e==="visible").length>0}function Xn(t,e){let n=Q(t),r=d.useRef([]),i=Vn(),o=Xt(),s=N((w,v=Ie.Hidden)=>{let g=r.current.findIndex(({el:m})=>m===w);g!==-1&&(K(v,{[Ie.Unmount](){r.current.splice(g,1)},[Ie.Hidden](){r.current[g].state="hidden"}}),o.microTask(()=>{var m;!Et(r)&&i.current&&((m=n.current)==null||m.call(n))}))}),a=N(w=>{let v=r.current.find(({el:g})=>g===w);return v?v.state!=="visible"&&(v.state="visible"):r.current.push({el:w,state:"visible"}),()=>s(w,Ie.Unmount)}),l=d.useRef([]),u=d.useRef(Promise.resolve()),c=d.useRef({enter:[],leave:[],idle:[]}),p=N((w,v,g)=>{l.current.splice(0),e&&(e.chains.current[v]=e.chains.current[v].filter(([m])=>m!==w)),e==null||e.chains.current[v].push([w,new Promise(m=>{l.current.push(m)})]),e==null||e.chains.current[v].push([w,new Promise(m=>{Promise.all(c.current[v].map(([P,x])=>x)).then(()=>m())})]),v==="enter"?u.current=u.current.then(()=>e==null?void 0:e.wait.current).then(()=>g(v)):g(v)}),f=N((w,v,g)=>{Promise.all(c.current[v].splice(0).map(([m,P])=>P)).then(()=>{var m;(m=l.current.shift())==null||m()}).then(()=>g(v))});return d.useMemo(()=>({children:r,register:a,unregister:s,onStart:p,onStop:f,wait:u,chains:c}),[a,s,r,p,f,c,u])}function qo(){}let Yo=["beforeEnter","afterEnter","beforeLeave","afterLeave"];function En(t){var e;let n={};for(let r of Yo)n[r]=(e=t[r])!=null?e:qo;return n}function Jo(t){let e=d.useRef(En(t));return d.useEffect(()=>{e.current=En(t)},[t]),e}let Xo="div",Zn=ot.RenderStrategy;function Zo(t,e){var n,r;let{beforeEnter:i,afterEnter:o,beforeLeave:s,afterLeave:a,enter:l,enterFrom:u,enterTo:c,entered:p,leave:f,leaveFrom:w,leaveTo:v,...g}=t,m=d.useRef(null),P=J(m,e),x=(n=g.unmount)==null||n?Ie.Unmount:Ie.Hidden,{show:S,appear:b,initial:M}=Wo(),[T,y]=d.useState(S?"visible":"hidden"),C=Go(),{register:k,unregister:O}=C;d.useEffect(()=>k(m),[k,m]),d.useEffect(()=>{if(x===Ie.Hidden&&m.current){if(S&&T!=="visible"){y("visible");return}return K(T,{hidden:()=>O(m),visible:()=>k(m)})}},[T,m,k,O,S,x]);let I=Q({base:ae(g.className),enter:ae(l),enterFrom:ae(u),enterTo:ae(c),entered:ae(p),leave:ae(f),leaveFrom:ae(w),leaveTo:ae(v)}),L=Jo({beforeEnter:i,afterEnter:o,beforeLeave:s,afterLeave:a}),z=qt();d.useEffect(()=>{if(z&&T==="visible"&&m.current===null)throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")},[m,T,z]);let B=M&&!b,ge=b&&S&&M,D=!z||B?"idle":S?"enter":"leave",F=_r(0),De=N(se=>K(se,{enter:()=>{F.addFlag(H.Opening),L.current.beforeEnter()},leave:()=>{F.addFlag(H.Closing),L.current.beforeLeave()},idle:()=>{}})),ye=N(se=>K(se,{enter:()=>{F.removeFlag(H.Opening),L.current.afterEnter()},leave:()=>{F.removeFlag(H.Closing),L.current.afterLeave()},idle:()=>{}})),ee=Xn(()=>{y("hidden"),O(m)},C);Ko({immediate:ge,container:m,classes:I,direction:D,onStart:Q(se=>{ee.onStart(m,se,De)}),onStop:Q(se=>{ee.onStop(m,se,ye),se==="leave"&&!Et(ee)&&(y("hidden"),O(m))})});let ie=g,Oe={ref:P};return ge?ie={...ie,className:wn(g.className,...I.current.enter,...I.current.enterFrom)}:(ie.className=wn(g.className,(r=m.current)==null?void 0:r.className),ie.className===""&&delete ie.className),E.createElement(bt.Provider,{value:ee},E.createElement(Gn,{value:K(T,{visible:H.Open,hidden:H.Closed})|F.flags},Z({ourProps:Oe,theirProps:ie,defaultTag:Xo,features:Zn,visible:T==="visible",name:"Transition.Child"})))}function Qo(t,e){let{show:n,appear:r=!1,unmount:i=!0,...o}=t,s=d.useRef(null),a=J(s,e);qt();let l=Pt();if(n===void 0&&l!==null&&(n=(l&H.Open)===H.Open),![!0,!1].includes(n))throw new Error("A <Transition /> is used but it is missing a `show={true | false}` prop.");let[u,c]=d.useState(n?"visible":"hidden"),p=Xn(()=>{c("hidden")}),[f,w]=d.useState(!0),v=d.useRef([n]);ve(()=>{f!==!1&&v.current[v.current.length-1]!==n&&(v.current.push(n),w(!1))},[v,n]);let g=d.useMemo(()=>({show:n,appear:r,initial:f}),[n,r,f]);d.useEffect(()=>{if(n)c("visible");else if(!Et(p))c("hidden");else{let S=s.current;if(!S)return;let b=S.getBoundingClientRect();b.x===0&&b.y===0&&b.width===0&&b.height===0&&c("hidden")}},[n,p]);let m={unmount:i},P=N(()=>{var S;f&&w(!1),(S=t.beforeEnter)==null||S.call(t)}),x=N(()=>{var S;f&&w(!1),(S=t.beforeLeave)==null||S.call(t)});return E.createElement(bt.Provider,{value:p},E.createElement(St.Provider,{value:g},Z({ourProps:{...m,as:d.Fragment,children:E.createElement(Qn,{ref:a,...m,...o,beforeEnter:P,beforeLeave:x})},theirProps:{},defaultTag:d.Fragment,features:Zn,visible:u==="visible",name:"Transition"})))}function ei(t,e){let n=d.useContext(St)!==null,r=Pt()!==null;return E.createElement(E.Fragment,null,!n&&r?E.createElement(Ft,{ref:e,...t}):E.createElement(Qn,{ref:e,...t}))}let Ft=X(Qo),Qn=X(Zo),ti=X(ei),ni=Object.assign(Ft,{Child:ti,Root:Ft});const er="splatapus.debugSettings",ri=_.object({shouldShowPoints:_.boolean,shouldShowRawPoints:_.boolean,shouldShowSmoothPoints:_.boolean,useSmartNormalization:_.boolean}),oi={shouldShowPoints:!1,shouldShowRawPoints:!1,shouldShowSmoothPoints:!1,useSmartNormalization:!0};function ii(){const t=he(be),[e,n]=d.useState(null),r=xr(e,16);return h.jsxs(It,{className:"pointer-events-auto relative px-3 py-2 opacity-0 hover:opacity-100 ui-open:opacity-100",children:[h.jsx(It.Button,{as:fe,children:"!"}),h.jsx(ni,{className:"absolute bottom-12 right-3 origin-bottom-right",enter:"transition duration-200 ease-out-back",enterFrom:"opacity-0 scale-75",enterTo:"opacity-100",leave:"transition duration-300 ease-in-back",leaveFrom:"opacity-100",leaveTo:"opacity-0 scale-75",children:h.jsxs(It.Panel,{ref:n,className:Y("flex  w-60 flex-col gap-3 bg-stone-100 p-3"),style:{clipPath:r},children:[h.jsx(lt,{label:"Show points",value:t.shouldShowPoints,onChange:i=>be.update({...t,shouldShowPoints:i})}),h.jsx(lt,{label:"Show raw points",value:t.shouldShowRawPoints,onChange:i=>be.update({...t,shouldShowRawPoints:i})}),h.jsx(lt,{label:"Smooth points",value:t.shouldShowSmoothPoints,onChange:i=>be.update({...t,shouldShowSmoothPoints:i})}),h.jsx(lt,{label:"Smart normalization",value:t.useSmartNormalization,onChange:i=>be.update({...t,useSmartNormalization:i})})]})})]})}function lt({label:t,value:e,onChange:n}){return h.jsxs(Fo,{checked:e,onChange:n,as:Sr,className:"justify-between py-1 pl-3 pr-1",children:[h.jsx("span",{children:t}),h.jsx("div",{className:"relative inline-flex h-6 w-10 rounded-full bg-stone-200 transition ui-checked:bg-green-400",children:h.jsx("div",{className:"absolute top-[2px] left-[2px] h-5 w-5 rounded-full bg-white transition ui-checked:translate-x-4"})})]})}function si(){const t=Ir(er);try{return ri.parse(JSON.parse(t)).unwrap()}catch{return oi}}const be=new q(si(),"debugSettings");ct(dt.idle,()=>{Cr(er,JSON.stringify(be.live()))});function Tt(t){return he(be)[t]}const Vt={interpolated:t=>({type:"interpolated",scenePosition:t}),keyPointId:t=>({type:"keyPointId",keyPointId:t}),toDebugString:t=>{switch(t.type){case"interpolated":return Ue(t.type,{_:t.scenePosition.toString(2)});case"keyPointId":return Ue(t.type,{_:t.keyPointId});default:W(t)}}};var $=(t=>(t.Draw="draw",t.Rig="rig",t.Play="play",t))($||{});const ai=_.enum($);function li(t){const e=d.useRef(t);return d.useEffect(()=>{t!=null&&(e.current=t)},[t]),t??e.current}const Ae=d.memo(function({show:e,asChild:n,className:r,appear:i=!1,enter:o,enterFrom:s,enterTo:a,leave:l,leaveFrom:u,leaveTo:c,onBeforeEnter:p,onAfterEnter:f,onBeforeLeave:w,onAfterLeave:v,...g}){const m=n?Rr:"div",[P,x]=d.useState(e?i?"will-enter":"showing":"hidden"),S=Je(w??Xe),b=Je(v??Xe),M=Je(p??Xe),T=Je(f??Xe);d.useLayoutEffect(()=>{if(e)switch(P){case"entering":case"showing":return;case"hidden":case"leaving":case"will-leave":x("will-enter");return;case"will-enter":{const C=requestAnimationFrame(()=>{M(),x("entering")});return()=>cancelAnimationFrame(C)}default:W(P)}else switch(P){case"hidden":case"leaving":return;case"entering":case"showing":case"will-enter":x("will-leave");return;case"will-leave":{const C=requestAnimationFrame(()=>{S(),x("leaving")});return()=>cancelAnimationFrame(C)}default:W(P)}},[M,S,e,P]);const y=Je(C=>{if(C.target===C.currentTarget)switch(P){case"entering":T(),x("showing");break;case"leaving":b(),x("hidden");break}});return P==="hidden"?null:h.jsx(m,{className:Y(r,(P==="will-enter"||P==="entering")&&o,P==="will-enter"&&s,P==="entering"&&a,(P==="will-leave"||P==="leaving")&&l,P==="will-leave"&&u,P==="leaving"&&c),onTransitionEnd:y,...g})});function ui(t,e){switch(e.eventType){case"down":return t.onPointerDown(e);case"move":return t.onPointerMove(e);case"up":return t.onPointerUp(e);case"cancel":return t.onPointerCancel(e);default:W(e.eventType)}}class an{constructor({onTap:e,onDragStart:n}){this.isDragging=new q(!1,"Gesture.isDragging"),this.isDragConfirmed=new q(!1,"Gesture.isDragConfirmed");const r=n??Vr;this.gesture=new Fr({onTap:e,onDragStart:(i,o,...s)=>{const a=r(i,o,...s);return a?(this.isDragging.update(!0),{couldBeTap:a.couldBeTap,pointerCapture:a.pointerCapture,onMove:a.onMove,onEnd:l=>(this.isDragging.update(!1),this.isDragConfirmed.update(!1),a.onEnd(l)),onCancel:l=>(this.isDragging.update(!1),this.isDragConfirmed.update(!1),a.onCancel(l)),onConfirm:l=>{if(this.isDragConfirmed.update(!1),a.onConfirm)return a.onConfirm(l)}}):null}})}onPointerEvent(e,...n){switch(e.eventType){case"down":return this.gesture.onPointerDown(e.event,e.splatapus,...n);case"move":return this.gesture.onPointerMove(e.event);case"up":return this.gesture.onPointerUp(e.event);case"cancel":return this.gesture.onPointerCancel(e.event);default:W(e.eventType)}}end(){this.gesture.end()}cancel(){this.gesture.end()}}class nt{static distance(e,n){let r=0;for(let i=0;i<e.length;i++)r+=Math.pow(e[i]-n[i],2);return Math.sqrt(r)}static kernel(e,n){const r=nt.distance(e,n);return r===0?0:Math.pow(r,2)*Math.log(r)}constructor(e,n){e.length===0&&et("bad centers array :/"),e.every(u=>u.length===e[0].length)||et("centers must have same dimensions :/"),this.centers=e;const r=n.slice(),i=[],o=[];for(let u=0;u<e.length;u++){const c=[],p=[1];for(let f=0;f<e[u].length;f++)p.push(e[u][f]);for(let f=0;f<e.length;f++)c.push(nt.kernel(e[u],e[f]));o.push(p),i.push(c.concat(p))}const a=V.transpose(o).map(u=>{for(let c=u.length;c<i[0].length;c++)u.push(0);return u});for(let u=0;u<a.length;u++)i.push(a[u]),r.push(0);const l=this.solve(r,i);l||et("rbf failed to compile with given centers./nCenters must be unique :/"),this.ws=l}solve(e,n){const r=V.inverse(n);return r?V.multiplyVector(r,e):null}getValue(e){A(this.ws,"Assertion Error: this.ws");let n=0,r=0;for(r=0;r<this.centers.length;r++)n+=Number(this.ws[r])*nt.kernel(e,this.centers[r]);for(n+=Number(this.ws[this.centers.length]),r=0;r<e.length;r++)n+=e[r]*Number(this.ws[this.centers.length+(r+1)]);return n}}const V={create(t){return t.map(e=>e.slice())},fromVector(t){return t.map(e=>[e])},identity(t){return ze(t,e=>ze(t,n=>e===n?1:0))},col(t,e){return t.map(n=>n[e-1])},clone(t){return t.slice()},canMultiplyFromLeft(t,e){return t[0].length===e.length},multiplyMatrix(t,e){if(!V.canMultiplyFromLeft(t,e))return null;const n=t[0].length;return ze(t.length,r=>ze(e[0].length,i=>{let o=0;for(let s=0;s<n;s++)o+=t[r][s]*e[s][i];return o}))},multiplyVector(t,e){return V.multiplyMatrix(t,V.fromVector(e))},transpose(t){return ze(t[0].length,e=>ze(t.length,n=>t[n][e]))},isSquare(t){return t.length===t[0].length},toRightTriangular(t){const e=V.clone(t),n=t.length,r=t[0].length;for(let i=0;i<n;i++){if(e[i][i]===0){for(let o=i+1;o<n;o++)if(e[o][i]!==0){const s=[];for(let a=0;a<r;a++)s.push(e[i][a]+e[o][a]);e[i]=s;break}}if(e[i][i]!==0)for(let o=i+1;o<n;o++){const s=e[o][i]/e[i][i],a=[];for(let l=0;l<r;l++)a.push(l<=i?0:e[o][l]-e[i][l]*s);e[o]=a}}return e},determinant(t){if(!V.isSquare(t))return null;const e=V.toRightTriangular(t);let n=e[0][0];for(let r=1;r<e.length;r++)n=n*e[r][r];return n},isSingular(t){return V.isSquare(t)&&V.determinant(t)===0},augment(t,e){const n=V.clone(t),r=n[0].length;A(n.length===e.length,"Assertion Error: result.length === other.length");for(let i=0;i<n.length;i++)for(let o=0;o<e[0].length;o++)n[i][r+o]=e[i][o];return n},inverse(t){if(!V.isSquare(t)||V.isSingular(t))return null;const e=t.length,n=[],r=V.toRightTriangular(V.augment(t,V.identity(e))),i=r[0].length;let o=t.length;for(;o--;){const s=[];n[o]=[];const a=r[o][o];for(let u=0;u<i;u++){const c=r[o][u]/a;s.push(c),u>=e&&n[o].push(c)}r[o]=s;let l=o;for(;l--;){const u=[];for(let c=0;c<i;c++)u.push(r[l][c]-r[o][c]*r[l][o]);r[l]=u}}return n}};class ci{interpolate(e){et("cannot interpolate none")}}class di{constructor(e){this.value=e}interpolate(e){return this.value}}class pi{constructor(e,n,r,i){this.centerA=e,this.centerB=n,this.valueA=r,this.valueB=i}interpolate(e){const n=this.centerB.sub(this.centerA),i=e.sub(this.centerA).dot(n)/n.dot(n);return On(this.valueA,this.valueB,i)}}class hi extends nt{constructor(e,n){super(e.map(({x:r,y:i})=>[r,i]),n)}interpolate(e){return this.getValue([e.x,e.y])}}class Mt{constructor(e,n){switch(A(e.length===n.length,"Assertion Error: centers.length === values.length"),e.length){case 0:this.interpolator=new ci;break;case 1:this.interpolator=new di(n[0]);break;case 2:this.interpolator=new pi(e[0],e[1],n[0],n[1]);break;default:this.interpolator=new hi(e,n)}}interpolate(e){return this.interpolator.interpolate(e)}}class fi{constructor(){this.cache=new Map}getCenterPointsAtPosition(e,n,r){switch(r.type){case"keyPointId":{const i=e.getShapeVersion(r.keyPointId,n);if(!i){const o=e.keyPoints.get(r.keyPointId);if(!o.position)return null;const s=this.getCenterPointsAtInterpolatedPosition(e,n,o.position);return s?{normalized:s,smoothed:null}:null}return{normalized:e.getNormalizedCenterPointsForShapeVersion(i.id).normalizedCenterPoints,smoothed:e.getNormalizedCenterPointsForShapeVersion(i.id).smoothedCenterPoints}}case"interpolated":{const i=this.getCenterPointsAtInterpolatedPosition(e,n,r.scenePosition);return i?{normalized:i,smoothed:null}:null}default:W(r)}}getCenterPointsAtInterpolatedPosition(e,n,r){const i=e.shapes.get(n),o=new Set(e.iterateShapeVersionsForShape(n));if(!o.size)return null;const s=new Set;for(const u of o)s.add(e.keyPoints.get(u.keyPointId));const a=this.getCacheEntry(i,o,s);let l;return a?l=a.interpolators:(l=this.calculateInterpolators(e,o),this.cache.set(i,{versions:o,keyPoints:s,interpolators:l})),(l==null?void 0:l.map(({x:u,y:c,r:p})=>({center:new j(u.interpolate(r),c.interpolate(r)),radius:p.interpolate(r)})))??null}calculateInterpolators(e,n){console.time("calculatInterpolators");const r=zn(Array.from(n,a=>{const l=e.keyPoints.get(a.keyPointId);return l.position?{normalizedCenterPoints:e.getNormalizedCenterPointsForShapeVersion(a.id).normalizedCenterPoints,version:a,keyPointPosition:l.position}:null}));if(!r.length)return null;const i=r.map(({keyPointPosition:a})=>a),o=Math.min(...r.map(({normalizedCenterPoints:a})=>a.length));console.log({minLength:o,allNormalizedPoints:r});const s=[];for(let a=0;a<o;a++){const l=r.map(({normalizedCenterPoints:p})=>p[a].center.x),u=r.map(({normalizedCenterPoints:p})=>p[a].center.y),c=r.map(({normalizedCenterPoints:p})=>p[a].radius);s.push({x:new Mt(i,l),y:new Mt(i,u),r:new Mt(i,c)})}return console.timeEnd("calculatInterpolators"),s}getCacheEntry(e,n,r){const i=this.cache.get(e);if(!i||n.size!==i.versions.size||r.size!==i.keyPoints.size)return null;for(const o of n)if(!i.versions.has(o))return null;for(const o of r)if(!i.keyPoints.has(o))return null;return i}}const tr=new fi;function In({splatapus:t,keyPointId:e,width:n,height:r,className:i}){const s=U(()=>{const x=t.document.live();return zn(Array.from(x.shapes,S=>{const b=tr.getCenterPointsAtPosition(x,S.id,Vt.keyPointId(e));return b?{centerPoints:b.normalized,svg:Br(b.normalized),shapeId:S.id}:null}))},[t,e]),{minX:a,minY:l,maxX:u,maxY:c}=d.useMemo(()=>{let x=1/0,S=1/0,b=-1/0,M=-1/0;for(const T of s)for(const{center:y,radius:C}of T.centerPoints)x=Math.min(x,y.x-C),b=Math.max(b,y.x+C),S=Math.min(S,y.y-C),M=Math.max(M,y.y+C);return{minX:x,minY:S,maxX:b,maxY:M}},[s]);if(!s.length)return null;const p=u-a,f=c-l,w=n-4*2,v=r-4*2,g=Math.min(w/p,.8),m=Math.min(v/f,.8),P=Math.min(g,m);return h.jsx("svg",{viewBox:`0 0 ${n} ${r}`,style:{width:n,height:r},children:h.jsx("g",{transform:`translate(${4+Math.max(w-p*P,0)/2}, ${4+Math.max(v-f*P,0)/2}) scale(${P}) translate(${-a}, ${-l})`,children:s.map(({svg:x,shapeId:S})=>h.jsx("path",{d:x,className:"fill-stone-800"},S))})})}function ln(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,o;for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function Bt(t,e){return Bt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,i){return r.__proto__=i,r},Bt(t,e)}function un(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Bt(t,e)}function vi(t,e){return t.classList?!!e&&t.classList.contains(e):(" "+(t.className.baseVal||t.className)+" ").indexOf(" "+e+" ")!==-1}function mi(t,e){t.classList?t.classList.add(e):vi(t,e)||(typeof t.className=="string"?t.className=t.className+" "+e:t.setAttribute("class",(t.className&&t.className.baseVal||"")+" "+e))}function Cn(t,e){return t.replace(new RegExp("(^|\\s)"+e+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function gi(t,e){t.classList?t.classList.remove(e):typeof t.className=="string"?t.className=Cn(t.className,e):t.setAttribute("class",Cn(t.className&&t.className.baseVal||"",e))}const kn={disabled:!1},pt=E.createContext(null);var nr=function(e){return e.scrollTop},Qe="unmounted",xe="exited",Se="entering",_e="entered",Ht="exiting",oe=function(t){un(e,t);function e(r,i){var o;o=t.call(this,r,i)||this;var s=i,a=s&&!s.isMounting?r.enter:r.appear,l;return o.appearStatus=null,r.in?a?(l=xe,o.appearStatus=Se):l=_e:r.unmountOnExit||r.mountOnEnter?l=Qe:l=xe,o.state={status:l},o.nextCallback=null,o}e.getDerivedStateFromProps=function(i,o){var s=i.in;return s&&o.status===Qe?{status:xe}:null};var n=e.prototype;return n.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},n.componentDidUpdate=function(i){var o=null;if(i!==this.props){var s=this.state.status;this.props.in?s!==Se&&s!==_e&&(o=Se):(s===Se||s===_e)&&(o=Ht)}this.updateStatus(!1,o)},n.componentWillUnmount=function(){this.cancelNextCallback()},n.getTimeouts=function(){var i=this.props.timeout,o,s,a;return o=s=a=i,i!=null&&typeof i!="number"&&(o=i.exit,s=i.enter,a=i.appear!==void 0?i.appear:s),{exit:o,enter:s,appear:a}},n.updateStatus=function(i,o){if(i===void 0&&(i=!1),o!==null)if(this.cancelNextCallback(),o===Se){if(this.props.unmountOnExit||this.props.mountOnEnter){var s=this.props.nodeRef?this.props.nodeRef.current:st.findDOMNode(this);s&&nr(s)}this.performEnter(i)}else this.performExit();else this.props.unmountOnExit&&this.state.status===xe&&this.setState({status:Qe})},n.performEnter=function(i){var o=this,s=this.props.enter,a=this.context?this.context.isMounting:i,l=this.props.nodeRef?[a]:[st.findDOMNode(this),a],u=l[0],c=l[1],p=this.getTimeouts(),f=a?p.appear:p.enter;if(!i&&!s||kn.disabled){this.safeSetState({status:_e},function(){o.props.onEntered(u)});return}this.props.onEnter(u,c),this.safeSetState({status:Se},function(){o.props.onEntering(u,c),o.onTransitionEnd(f,function(){o.safeSetState({status:_e},function(){o.props.onEntered(u,c)})})})},n.performExit=function(){var i=this,o=this.props.exit,s=this.getTimeouts(),a=this.props.nodeRef?void 0:st.findDOMNode(this);if(!o||kn.disabled){this.safeSetState({status:xe},function(){i.props.onExited(a)});return}this.props.onExit(a),this.safeSetState({status:Ht},function(){i.props.onExiting(a),i.onTransitionEnd(s.exit,function(){i.safeSetState({status:xe},function(){i.props.onExited(a)})})})},n.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},n.safeSetState=function(i,o){o=this.setNextCallback(o),this.setState(i,o)},n.setNextCallback=function(i){var o=this,s=!0;return this.nextCallback=function(a){s&&(s=!1,o.nextCallback=null,i(a))},this.nextCallback.cancel=function(){s=!1},this.nextCallback},n.onTransitionEnd=function(i,o){this.setNextCallback(o);var s=this.props.nodeRef?this.props.nodeRef.current:st.findDOMNode(this),a=i==null&&!this.props.addEndListener;if(!s||a){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var l=this.props.nodeRef?[this.nextCallback]:[s,this.nextCallback],u=l[0],c=l[1];this.props.addEndListener(u,c)}i!=null&&setTimeout(this.nextCallback,i)},n.render=function(){var i=this.state.status;if(i===Qe)return null;var o=this.props,s=o.children;o.in,o.mountOnEnter,o.unmountOnExit,o.appear,o.enter,o.exit,o.timeout,o.addEndListener,o.onEnter,o.onEntering,o.onEntered,o.onExit,o.onExiting,o.onExited,o.nodeRef;var a=ln(o,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return E.createElement(pt.Provider,{value:null},typeof s=="function"?s(i,a):E.cloneElement(E.Children.only(s),a))},e}(E.Component);oe.contextType=pt;oe.propTypes={};function je(){}oe.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:je,onEntering:je,onEntered:je,onExit:je,onExiting:je,onExited:je};oe.UNMOUNTED=Qe;oe.EXITED=xe;oe.ENTERING=Se;oe.ENTERED=_e;oe.EXITING=Ht;var yi=function(e,n){return e&&n&&n.split(" ").forEach(function(r){return mi(e,r)})},Nt=function(e,n){return e&&n&&n.split(" ").forEach(function(r){return gi(e,r)})},cn=function(t){un(e,t);function e(){for(var r,i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return r=t.call.apply(t,[this].concat(o))||this,r.appliedClasses={appear:{},enter:{},exit:{}},r.onEnter=function(a,l){var u=r.resolveArguments(a,l),c=u[0],p=u[1];r.removeClasses(c,"exit"),r.addClass(c,p?"appear":"enter","base"),r.props.onEnter&&r.props.onEnter(a,l)},r.onEntering=function(a,l){var u=r.resolveArguments(a,l),c=u[0],p=u[1],f=p?"appear":"enter";r.addClass(c,f,"active"),r.props.onEntering&&r.props.onEntering(a,l)},r.onEntered=function(a,l){var u=r.resolveArguments(a,l),c=u[0],p=u[1],f=p?"appear":"enter";r.removeClasses(c,f),r.addClass(c,f,"done"),r.props.onEntered&&r.props.onEntered(a,l)},r.onExit=function(a){var l=r.resolveArguments(a),u=l[0];r.removeClasses(u,"appear"),r.removeClasses(u,"enter"),r.addClass(u,"exit","base"),r.props.onExit&&r.props.onExit(a)},r.onExiting=function(a){var l=r.resolveArguments(a),u=l[0];r.addClass(u,"exit","active"),r.props.onExiting&&r.props.onExiting(a)},r.onExited=function(a){var l=r.resolveArguments(a),u=l[0];r.removeClasses(u,"exit"),r.addClass(u,"exit","done"),r.props.onExited&&r.props.onExited(a)},r.resolveArguments=function(a,l){return r.props.nodeRef?[r.props.nodeRef.current,a]:[a,l]},r.getClassNames=function(a){var l=r.props.classNames,u=typeof l=="string",c=u&&l?l+"-":"",p=u?""+c+a:l[a],f=u?p+"-active":l[a+"Active"],w=u?p+"-done":l[a+"Done"];return{baseClassName:p,activeClassName:f,doneClassName:w}},r}var n=e.prototype;return n.addClass=function(i,o,s){var a=this.getClassNames(o)[s+"ClassName"],l=this.getClassNames("enter"),u=l.doneClassName;o==="appear"&&s==="done"&&u&&(a+=" "+u),s==="active"&&i&&nr(i),a&&(this.appliedClasses[o][s]=a,yi(i,a))},n.removeClasses=function(i,o){var s=this.appliedClasses[o],a=s.base,l=s.active,u=s.done;this.appliedClasses[o]={},a&&Nt(i,a),l&&Nt(i,l),u&&Nt(i,u)},n.render=function(){var i=this.props;i.classNames;var o=ln(i,["classNames"]);return E.createElement(oe,Bn({},o,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},e}(E.Component);cn.defaultProps={classNames:""};cn.propTypes={};function Pi(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function dn(t,e){var n=function(o){return e&&d.isValidElement(o)?e(o):o},r=Object.create(null);return t&&d.Children.map(t,function(i){return i}).forEach(function(i){r[i.key]=n(i)}),r}function wi(t,e){t=t||{},e=e||{};function n(c){return c in e?e[c]:t[c]}var r=Object.create(null),i=[];for(var o in t)o in e?i.length&&(r[o]=i,i=[]):i.push(o);var s,a={};for(var l in e){if(r[l])for(s=0;s<r[l].length;s++){var u=r[l][s];a[r[l][s]]=n(u)}a[l]=n(l)}for(s=0;s<i.length;s++)a[i[s]]=n(i[s]);return a}function Ce(t,e,n){return n[e]!=null?n[e]:t.props[e]}function xi(t,e){return dn(t.children,function(n){return d.cloneElement(n,{onExited:e.bind(null,n),in:!0,appear:Ce(n,"appear",t),enter:Ce(n,"enter",t),exit:Ce(n,"exit",t)})})}function Si(t,e,n){var r=dn(t.children),i=wi(e,r);return Object.keys(i).forEach(function(o){var s=i[o];if(d.isValidElement(s)){var a=o in e,l=o in r,u=e[o],c=d.isValidElement(u)&&!u.props.in;l&&(!a||c)?i[o]=d.cloneElement(s,{onExited:n.bind(null,s),in:!0,exit:Ce(s,"exit",t),enter:Ce(s,"enter",t)}):!l&&a&&!c?i[o]=d.cloneElement(s,{in:!1}):l&&a&&d.isValidElement(u)&&(i[o]=d.cloneElement(s,{onExited:n.bind(null,s),in:u.props.in,exit:Ce(s,"exit",t),enter:Ce(s,"enter",t)}))}}),i}var bi=Object.values||function(t){return Object.keys(t).map(function(e){return t[e]})},Ei={component:"div",childFactory:function(e){return e}},pn=function(t){un(e,t);function e(r,i){var o;o=t.call(this,r,i)||this;var s=o.handleExited.bind(Pi(o));return o.state={contextValue:{isMounting:!0},handleExited:s,firstRender:!0},o}var n=e.prototype;return n.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},n.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(i,o){var s=o.children,a=o.handleExited,l=o.firstRender;return{children:l?xi(i,a):Si(i,s,a),firstRender:!1}},n.handleExited=function(i,o){var s=dn(this.props.children);i.key in s||(i.props.onExited&&i.props.onExited(o),this.mounted&&this.setState(function(a){var l=Bn({},a.children);return delete l[i.key],{children:l}}))},n.render=function(){var i=this.props,o=i.component,s=i.childFactory,a=ln(i,["component","childFactory"]),l=this.state.contextValue,u=bi(this.state.children).map(s);return delete a.appear,delete a.enter,delete a.exit,o===null?E.createElement(pt.Provider,{value:l},u):E.createElement(pt.Provider,{value:l},E.createElement(o,a,u))},e}(E.Component);pn.propTypes={};pn.defaultProps=Ei;const Ii=80,Ci=64;function Tn(t,e){return e.y>t.screenSize.live().y-Ii}const Fe=class Fe{constructor(){this.type=$.Rig,this.previewMovement=new q(null,"RigMode.previewMovement"),this.previewPosition=new q(null,"RigMode.previewPosition"),this.gesture=new an({onTap:(e,{location:n},r)=>{r&&n.keyPointId.update(r.id)},onDragStart:(e,{viewport:n,document:r,location:i},o)=>{if(e.preventDefault(),!o)return this.previewPosition.update(n.eventSceneCoords(e)),{couldBeTap:!1,pointerCapture:!0,onMove:l=>this.previewPosition.update(n.eventSceneCoords(l)),onEnd:()=>this.previewPosition.update(null),onCancel:()=>this.previewPosition.update(null)};i.keyPointId.update(o.id);const s=n.eventSceneCoords(e),a=o.initialScenePosition;return{couldBeTap:!0,pointerCapture:!0,onMove:l=>{this.previewMovement.update({keyPointId:o.id,scenePosition:n.eventSceneCoords(l).sub(s).add(a)})},onEnd:l=>{const u=n.eventSceneCoords(l).sub(s).add(a),c=rt(()=>Tn(n,n.sceneToScreenLive(u)));this.previewMovement.update(null),r.update(p=>p.updateKeyPoint(o.id,f=>({...f,position:c?null:u})))},onCancel:l=>{this.previewMovement.update(null)}}}})}isIdleLive(){return!this.gesture.isDragging.live()}toDebugStringLive(){const e=this.previewMovement.live(),n=this.previewPosition.live();return Ue("rig",n?{_:"preview",position:n.toString(2)}:e?{_:"moving",keyPointId:e.keyPointId,delta:e.scenePosition.toString(2)}:{_:"idle"})}onPointerEvent(e){this.gesture.onPointerEvent(e)}getPreviewPositionLive(){return this.previewPosition.live()}renderOverlay(e){return h.jsx(Fe.Overlay,{splatapus:e,mode:this})}};Fe.Overlay=function({splatapus:n,mode:r}){const{points:i,pointsInDock:o,size:s,isAnyDragging:a,maxScreenProgress:l,minScreenProgress:u}=U(()=>{const x=n.viewport.screenSizeWithSidebarOpenLive(),S=r==null?void 0:r.previewMovement.live(),b=n.location.keyPointId.live();let M=0,T=1/0,y=-1/0;return{points:Array.from(n.document.live().keyPoints,(k,O)=>{const I=(S==null?void 0:S.keyPointId)===k.id?n.viewport.sceneToScreenLive(S.scenePosition):null,L=k.position?n.viewport.sceneToScreenLive(k.position):null,z=I?Tn(n.viewport,I):!k.position;let B=null;return L&&(B=L.dot(x)/x.dot(x),T=Math.min(T,B),y=Math.max(y,B)),{dockIndex:z?M++:null,keyPoint:k,overallIndex:O,isSelected:k.id===b,screenPosition:I??L,isDragging:!!I,screenProgress:B}}),pointsInDock:M,size:x,isAnyDragging:!!S,minScreenProgress:T,maxScreenProgress:y}},[n,r]),c=!!r,[p,f]=d.useState(c),w=new j(s.x/2,s.y+50),[v,g]=d.useState(null),m=i.find(x=>x.dockIndex!==null&&x.keyPoint.id===v),P=li(m);return h.jsxs(h.Fragment,{children:[h.jsx(Ae,{show:c,className:"absolute left-0 right-0 bottom-0 z-10 h-24 bg-white/50 backdrop-blur-md ",enter:"transition duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",onBeforeEnter:()=>requestAnimationFrame(()=>f(!0)),onBeforeLeave:()=>f(!1)}),i.map(x=>h.jsx(Fe.KeyPoint,{shouldShow:c,shouldShowDock:p,splatapus:n,mode:r,screenSize:s,pointsInDock:o,exitPosition:w,isAnyDragging:a,minScreenProgress:u,maxScreenProgress:l,onPointerEnter:()=>g(x.keyPoint.id),onPointerLeave:()=>g(null),...x},x.keyPoint.id)),h.jsx(Ae,{show:c&&o>0,className:"duration pointer-events-none absolute bottom-2 z-10 text-center font-semibold text-stone-400",enter:"transition duration-500",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition duration-75",leaveFrom:"opacity-100",leaveTo:"opacity-0",style:{width:s.x,transitionDelay:c?`${o*30+400}ms`:"0ms"},children:"drag each key point into the canvas"}),P&&h.jsx(Ae,{show:!a&&!!m,className:"pointer-events-none absolute bottom-24 z-10 -mt-16 -ml-10 h-16 w-20 origin-bottom overflow-hidden rounded border border-stone-300 bg-stone-50 shadow-md transition",enter:"ease-out",enterFrom:"translate-y-4 opacity-0 scale-75",enterTo:"translate-y-0 opacity-100 scale-100",leave:"ease-in",leaveFrom:"translate-y-0 opacity-100 scale-100",leaveTo:"translate-y-4 opacity-0 scale-75",style:{left:s.x/2,transform:`translateX(${(Ne((m??P).dockIndex,"Assertion Error: (dockedHovered ?? prevDockedHovered).dockIndex")-(o-1)/2)*56}px) translateY(var(--tw-translate-y)) scale(var(--tw-scale-x), var(--tw-scale-y))`},children:h.jsx(pn,{children:h.jsx(cn,{timeout:300,classNames:{enter:"transition-opacity bg-stone-50 absolute",enterActive:"transition-opacity bg-stone-50 absolute",enterDone:"transition-opacity bg-stone-50 absolute",exit:"transition-opacity opacity-0 bg-stone-50 absolute",exitActive:"transition-opacity opacity-0 bg-stone-50 absolute",exitDone:"transition-opacity opacity-0 bg-stone-50 absolute"},children:h.jsx(In,{width:78,height:62,keyPointId:P.keyPoint.id,splatapus:n})},P.keyPoint.id)})})]})},Fe.KeyPoint=function({dockIndex:n,screenPosition:r,shouldShowDock:i,shouldShow:o,screenSize:s,pointsInDock:a,keyPoint:l,exitPosition:u,isDragging:c,mode:p,splatapus:f,isSelected:w,isAnyDragging:v,overallIndex:g,screenProgress:m,minScreenProgress:P,maxScreenProgress:x,onPointerEnter:S,onPointerLeave:b}){const[M,T]=d.useState(!!p),y=n!==null;r||(A(n!==null,"Assertion Error: dockIndex !== null"),r=i?new j(s.x/2+(n-(a-1)/2)*56,s.y-Ci):u);const[C,k]=d.useState(!1);return c&&console.log({dockIndex:n,isDocked:y,isDragging:c,className:c?"z-20":y?"z-10":"z-[5]"}),h.jsxs(h.Fragment,{children:[h.jsx(Ae,{show:o,className:Y("absolute top-0 left-0 flex cursor-move items-center justify-center",y?"-mt-7 -ml-7 h-14 w-14":"-mt-5 -ml-5 h-10 w-10 rounded-full",c?"z-20":y?"z-10":"z-[5]",!c&&(o?n!==null&&"transition duration-300 ease-out-back":n!==null&&"transition duration-200 ease-in")),enter:y?"transition-transform duration-300 ease-out-back":"transition-transform duration-200 ease-out-back",enterFrom:y?"scale-50":"scale-0",enterTo:"scale-100",leave:y?"transition-transform duration-200 ease-in":"transition-transform duration-200 ease-in-back",leaveFrom:"scale-100",leaveTo:y?"scale-50":"scale-0",onAfterEnter:()=>T(!0),onBeforeLeave:()=>T(!1),onPointerEnter:O=>{k(!0),S(O)},onPointerLeave:O=>{k(!1),b(O)},onPointerDown:O=>{p&&p.gesture.onPointerEvent({event:O,eventType:"down",splatapus:f},{id:l.id,initialScenePosition:rt(()=>f.viewport.screenToSceneLive(Ne(r,"Assertion Error: screenPosition")))})},style:{transform:`translate(${r.x}px, ${r.y}px) scale(var(--tw-scale-x), var(--tw-scale-y))`,transitionDelay:v?"0ms":y?`${n*25}ms`:M?"0ms":`${dr(P,x,0,200,Ne(m,"Assertion Error: screenProgress"))}ms`},children:h.jsx("div",{className:Y("flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold shadow-md transition-transform duration-200 ease-out-back-md",y?"scale-150":"scale-100",w?"bg-gradient-to-br from-cyan-400 to-blue-400 text-white":"border border-stone-200 bg-white text-stone-400"),children:g+1})},l.id),h.jsx("div",{className:"pointer-events-none absolute top-0 left-0 z-[4]",style:{transform:`translate(${r.x}px, ${r.y-24}px)`},children:h.jsx(Ae,{show:C&&!y&&!v,className:"-mt-16 -ml-10 h-16 w-20 origin-bottom rounded border border-stone-300 bg-stone-50 shadow-md",enter:"transition ease-out",enterFrom:"translate-y-4 opacity-0 scale-75",enterTo:"translate-y-0 opacity-100 scale-100",leave:"transition ease-in",leaveFrom:"translate-y-0 opacity-100 scale-100",leaveTo:"translate-y-4 opacity-0 scale-75",children:h.jsx(In,{width:78,height:62,keyPointId:l.id,splatapus:f})})})]})};let ht=Fe;class ki{constructor(){this.state={type:"idle"}}onPointerDown(e){const{event:n,splatapus:r}=e;switch(this.state.type){case"idle":return this.state={type:"oneFingerDown",pointerA:{id:n.pointerId,startScreenPosition:j.fromEvent(n),currentScreenPosition:j.fromEvent(n),startEvent:n}},e;case"oneFingerDown":return this.state={type:"bothFingersDown",pointerA:this.state.pointerA,pointerB:{id:n.pointerId,startScreenPosition:j.fromEvent(n),currentScreenPosition:j.fromEvent(n),startEvent:n},initialViewportState:r.viewport.state.getOnce()},{splatapus:r,eventType:"cancel",event:this.state.pointerA.startEvent};case"bothFingersDown":return e;default:return W(this.state)}}onPointerMove(e){const{event:n,splatapus:r}=e;switch(this.state.type){case"idle":return e;case"oneFingerDown":return this.state.pointerA.id===n.pointerId&&(this.state.pointerA.currentScreenPosition=j.fromEvent(n)),e;case"bothFingersDown":if(n.pointerId===this.state.pointerA.id||n.pointerId===this.state.pointerB.id){const i=n.pointerId===this.state.pointerA.id?j.fromEvent(n):this.state.pointerA.currentScreenPosition,o=n.pointerId===this.state.pointerB.id?j.fromEvent(n):this.state.pointerB.currentScreenPosition,s=this.state.pointerA.startScreenPosition.distanceTo(this.state.pointerB.startScreenPosition),l=i.distanceTo(o)/s,u=this.state.pointerA.startScreenPosition.lerp(this.state.pointerB.startScreenPosition,.5),c=i.lerp(o,.5),p=u.add(this.state.initialViewportState.pan).scale(l).sub(c);return r.viewport.state.update({zoom:this.state.initialViewportState.zoom*l,pan:p}),this.state.pointerA.currentScreenPosition=i,this.state.pointerB.currentScreenPosition=o,null}return e;default:return W(this.state)}}onPointerUp(e){const{event:n}=e;switch(this.state.type){case"idle":return e;case"oneFingerDown":return n.pointerId===this.state.pointerA.id&&(this.state={type:"idle"}),e;case"bothFingersDown":return n.pointerId===this.state.pointerA.id||n.pointerId===this.state.pointerB.id?(this.state={type:"idle"},null):e;default:return W(this.state)}}onPointerCancel(e){return this.onPointerUp(e)}}class Ti{constructor(){this.isKeyDown=new q(!1,"QuickPan.isKeyDown"),this.gesture=new an({onDragStart:(e,n)=>{const r=n.viewport.pan.getOnce();let i=j.fromEvent(e);return{couldBeTap:!1,pointerCapture:!0,onMove:o=>{const s=j.fromEvent(o),a=i.sub(s);n.viewport.pan.update(l=>l.add(a)),i=s},onEnd:Xe,onCancel:()=>{n.viewport.pan.update(r)}}}}),this.isDragging=this.gesture.isDragging}onKeyDown({event:e}){return $e(e," ")?(this.isKeyDown.update(!0),!0):!1}onKeyUp({event:e}){return this.isKeyDown.getOnce()&&Ur(e," ")?(this.isKeyDown.update(!1),this.gesture.end(),!0):!1}getCanvasClassNameLive(){if(this.isKeyDown.live()){if(this.isDragging.live())return"cursor-grabbing"}else return null;return"cursor-grab"}onPointerEvent(e){this.gesture.onPointerEvent(e)}toDebugStringLive(){return this.isKeyDown.live()?Ue("quickPan",{dragging:this.isDragging.live()}):null}}const G={initialize:t=>({undoStates:[],redoStates:[],pendingOp:null,current:{...t,options:{}}}),canUndo:t=>t.undoStates.length>0,canRedo:t=>{var e;return(((e=t.redoStates)==null?void 0:e.length)??0)>0},beginOperation:t=>{const e=Math.random();return A(t.pendingOp==null,"pending op already in progress"),{undoStack:{...t,pendingOp:{txId:e,initialDoc:t.current.document,initialOptions:t.current.options},current:{...t.current,options:{}}},txId:e}},updateOperation:(t,e,n)=>{var r;return A(((r=t.pendingOp)==null?void 0:r.txId)===e,"pending op mismatch"),{...t,current:{...t.current,document:Ze(t.current.document,n)}}},revertOperation:(t,e)=>{var n;return A(((n=t.pendingOp)==null?void 0:n.txId)===e,"Pending op mismatch"),{...t,pendingOp:null,current:{document:t.pendingOp.initialDoc,location:t.current.location,options:t.pendingOp.initialOptions}}},commitOperation:(t,e,n={})=>{var o;A(((o=t.pendingOp)==null?void 0:o.txId)===e,"Pending op mismatch");const r=[{document:t.pendingOp.initialDoc,location:t.current.location,options:t.pendingOp.initialOptions},...t.undoStates];for(;r.length>Hr;)r.pop();const i={...t.current,options:n};return n.lockstepLocation&&(i.location=Ze(i.location,n.lockstepLocation)),{...t,current:i,pendingOp:null,undoStates:r,redoStates:null}},updateDocument:(t,e,n)=>{let r;return{undoStack:t,txId:r}=G.beginOperation(t),t=G.updateOperation(t,r,e),G.commitOperation(t,r,n)},undo:(t,e)=>{if(A(t.pendingOp==null,"Pending op in progress"),t.undoStates.length==0)return t;e.triggerAnimation("undo");const[n,...r]=t.undoStates;if(!$t(n.location,t.current.location)&&!t.current.options.lockstepLocation)return{...t,current:{...t.current,location:n.location}};const i=[t.current,...t.redoStates??[]];return{...t,current:n,undoStates:r,redoStates:i}},redo:(t,e)=>{if(A(t.pendingOp==null,"pending op in progress"),!t.redoStates||t.redoStates.length==0)return t;e.triggerAnimation("redo");const[n,...r]=t.redoStates;if(!$t(n.location,t.current.location)&&!n.options.lockstepLocation)return{...t,current:{...t.current,location:n.location}};const i=[t.current,...t.undoStates];return{...t,current:n.options.lockstepLocation?{...n,location:Ze(t.current.location,n.options.lockstepLocation)}:n,undoStates:i,redoStates:r.length===0?null:r}},updateLocation:(t,e)=>({...t,current:{...t.current,location:Ze(t.current.location,e)}})};class Mi{constructor(){this.type=$.Draw,this.previewPoints=new q([],"DrawMode.previewPoints"),this.gesture=new an({onDragStart:(e,{viewport:n,location:r,document:i})=>(e.preventDefault(),this.previewPoints.update([n.eventSceneCoords(e)]),{couldBeTap:!1,pointerCapture:!0,onMove:o=>this.previewPoints.update(s=>[...s,n.eventSceneCoords(o)]),onEnd:o=>{const s=this.previewPoints.getOnce();this.previewPoints.update([]),i.update(a=>a.replacePointsForVersion(r.keyPointId.getOnce(),r.shapeId.getOnce(),s))},onCancel:()=>{this.previewPoints.update([])}})})}isIdleLive(){return!this.gesture.isDragging.live()}toDebugStringLive(){return Ue("draw",this.isIdleLive()?{_:"idle"}:{_:"drawing",points:this.previewPoints.live().length})}onPointerEvent(e){this.gesture.onPointerEvent(e)}getPreviewPositionLive(){return null}renderOverlay(){return null}}class Ni{constructor(){this.type=$.Play,this.previewPosition=new q(null,"PlayMode.previewPosition")}isIdleLive(){return!0}toDebugStringLive(){var e;return Ue("play",{_:((e=this.previewPosition.live())==null?void 0:e.toString(2))??null})}onPointerEvent({event:e,eventType:n,splatapus:r}){switch(n){case"move":case"down":e.isPrimary&&this.previewPosition.update(r.viewport.eventSceneCoords(e));return;case"cancel":case"up":return;default:W(n)}}getPreviewPositionLive(){return this.previewPosition.live()}renderOverlay(){return null}}function Lt(t){switch(t){case $.Draw:return new Mi;case $.Rig:return new ht;case $.Play:return new Ni;default:W(t)}}const Li={[$.Draw]:"d",[$.Rig]:"r",[$.Play]:"p"};class Di{constructor(e){this.multiTouchPan=new ki,this.quickPan=new Ti,this.activeMode=new q(Lt(e),"Interaction.activeMode"),this.activeMode.addBatchInvalidateListener(()=>this.activeMode.getOnce())}toDebugStringLive(){return this.quickPan.toDebugStringLive()??this.activeMode.live().toDebugStringLive()}getCanvasClassNameLive(){return this.quickPan.getCanvasClassNameLive()}getPreviewPositionLive(){return this.activeMode.live().getPreviewPositionLive()}isSidebarOpenLive(){return this.activeMode.live().type!==$.Play}requestSetActiveMode(e){this.quickPan.isKeyDown.getOnce()||this.activeMode.update(n=>rt(()=>!n.isIdleLive())?n:Lt(e))}onKeyDown(e){var r;const n=this.activeMode.getOnce();if(rt(()=>n.isIdleLive())){if(this.quickPan.onKeyDown(e)||this.quickPan.isKeyDown.getOnce())return;for(const[i,o]of pr(Li))if($e(e.event,o)){const s=Lt(i);e.splatapus.vfx.triggerAnimation(i),this.activeMode.update(s);return}if($e(e.event,{key:"z",command:!0})){e.splatapus.undoStack.update(i=>G.undo(i,e.splatapus.vfx));return}if($e(e.event,{key:"z",command:!0,shift:!0})){e.splatapus.undoStack.update(i=>G.redo(i,e.splatapus.vfx));return}}if($e(e.event,{key:"0",command:!0})){e.splatapus.viewport.pan.update(j.ZERO),e.splatapus.viewport.zoom.update(1);return}for(let i=0;i<9;i++)if($e(e.event,`${i+1}`)){const o=(r=[...e.splatapus.document.getOnce().keyPoints][i])==null?void 0:r.id;if(o){e.splatapus.location.keyPointId.update(o);return}}}onKeyUp(e){this.quickPan.onKeyUp(e)}onPointerEvent(e){const n=ui(this.multiTouchPan,e);n&&(this.quickPan.isKeyDown.getOnce()?this.quickPan.onPointerEvent(n):this.activeMode.getOnce().onPointerEvent(n))}}const Oi=_.object({pan:j.schema,zoom:_.number}),rr={initialize:()=>({pan:j.ZERO,zoom:1}),schema:Oi};class zi{constructor(e,n,r){this.screenSize=e,this.isSidebarOpen=n,this.state=r,this.pan=new de(()=>this.state.live().pan,i=>this.state.update(o=>Re(o,"pan",i))),this.zoom=new de(()=>this.state.live().zoom,i=>this.state.update(o=>Re(o,"zoom",i))),this.screenSize=e,this.isSidebarOpen=n}screenSizeWithSidebarOpenLive(){return this.screenSize.live().sub(new j(Qt,0))}canvasScreenSizeLive(){return this.isSidebarOpen.live()?this.screenSizeWithSidebarOpenLive():this.screenSize.live()}handleWheelEvent(e){e.preventDefault(),e.stopImmediatePropagation();const{deltaX:n,deltaY:r,ctrlKey:i}=e;this.state.update(({pan:o,zoom:s})=>{if(i){const a=j.fromEvent(e),l=Math.exp(-r/100)*s;return{pan:a.add(o).scale(l/s).sub(a),zoom:l}}else return{pan:o.add(new j(n,r)),zoom:s}})}originLive(){const{pan:e,zoom:n}=this.state.live();return e.sub(this.canvasScreenSizeLive().scale(.5*n))}visibleSceneBoundsLive(){return new Wr(this.originLive(),this.canvasScreenSizeLive())}screenToSceneLive(e){return e.add(this.originLive()).scale(1/this.state.live().zoom)}sceneToScreenLive(e){return e.scale(this.state.live().zoom).sub(this.originLive())}eventSceneCoords(e){return rt(()=>this.screenToSceneLive(j.fromEvent(e)))}getSceneTransformLive(){const e=this.originLive(),n=this.state.live().zoom;return`translate(${-e.x}px, ${-e.y}px) scale(${n}) `}}const qe=new yt("key"),ji=_.object({id:qe.schema,position:j.schema.nullable()}),Ye=new yt("shp"),$i=_.object({id:Ye.schema}),hn=new yt("shv"),Ai=_.object({id:hn.schema,keyPointId:qe.schema,shapeId:Ye.schema,rawPoints:_.arrayOf(j.schema)}),or=new yt("doc"),_i=_.object({id:or.schema,keyPoints:_.objectMap(qe.schema,ji),shapes:_.objectMap(Ye.schema,$i),shapeVersions:_.objectMap(hn.schema,Ai)});function Ri(){return{id:or.generate(),keyPoints:{},shapes:{},shapeVersions:{}}}const Fi=_.object({keyPointId:qe.schema,shapeId:Ye.schema,viewport:rr.schema,mode:ai}),ir={initialize:(t,e)=>({keyPointId:t,shapeId:e,mode:$.Draw,viewport:rr.initialize()}),schema:Fi};class Vi{constructor(e){this.state=e,this.keyPointId=new de(()=>this.state.live().keyPointId,n=>this.state.update(r=>Re(r,"keyPointId",n))),this.shapeId=new de(()=>this.state.live().shapeId,n=>this.state.update(r=>Re(r,"shapeId",n))),this.mode=new de(()=>this.state.live().mode,n=>this.state.update(r=>Re(r,"mode",n))),this.viewportState=new de(()=>this.state.live().viewport,n=>this.state.update(r=>Re(r,"viewport",n)))}}class Bi{constructor(e,n){this.screenSize=e,this.vfx=new br,this.location=new Vi(new de(()=>this.undoStack.live().current.location,r=>this.undoStack.update(i=>G.updateLocation(i,r)),"location")),this.document=new de(()=>this.undoStack.live().current.document,(r,i)=>this.undoStack.update(o=>G.updateDocument(o,r,i)),"document"),this.viewport=new zi(this.screenSize,new yn(()=>this.interaction.isSidebarOpenLive(),"viewport.isSidebarOpen"),this.location.viewportState),this.onPointerDown=r=>this.onPointerEvent("down",r),this.onPointerMove=r=>this.onPointerEvent("move",r),this.onPointerUp=r=>this.onPointerEvent("up",r),this.onPointerCancel=r=>this.onPointerEvent("cancel",r),this.onWheel=r=>{this.viewport.handleWheelEvent(r)},this.onKeyDown=r=>this.interaction.onKeyDown({event:r,splatapus:this}),this.onKeyUp=r=>this.interaction.onKeyUp({event:r,splatapus:this}),this.previewPosition=new yn(()=>{const r=this.interaction.getPreviewPositionLive();return r?Vt.interpolated(r):Vt.keyPointId(this.location.keyPointId.live())},"previewPosition"),this.undoStack=new q(G.initialize(n),"undoStack"),this.interaction=new Di(n.location.mode),this.keyPointIdHistory=new q(Array.from(this.document.getOnce().keyPoints,r=>r.id),"keyPointIdHistory")}onPointerEvent(e,n){this.interaction.onPointerEvent({event:n,eventType:e,splatapus:this})}}function Hi(t){const e=d.useState(()=>new Bi(new q(j.ZERO,"screenSize"),t()))[0];return d.useEffect(()=>{window.splatapus=e;const n=[ct(dt.eager,()=>{const r=e.interaction.activeMode.live().type;e.location.mode.live()!==r&&e.location.mode.update(r)}),ct(dt.eager,()=>{const r=e.location.keyPointId.live(),i=e.document.live();e.keyPointIdHistory.update(o=>{const s=o.filter(a=>i.keyPoints.has(a)&&a!==r);return s.length===o.length-1&&hr(o)===r?(console.log("update keyPointIdHistory (static)"),o):(console.log("update keyPointIdHistory (changed)"),s.push(r),s)})})];return()=>{for(const r of n)r()}},[e]),e}class re{static fromArray(e){return new re(Gt(e.map(n=>[n.id,n])))}constructor(e){this.data=e}count(){return fr(this.data).length}has(e){return mn(this.data,e)}getIfExists(e){return vr(this.data,e)}get(e){const n=this.getIfExists(e);return A(n!=null,`Item with id ${e} not found`),n}insert(e){return new re({...this.data,[e.id]:e})}update(e,n){const r=this.get(e),i=Ze(r,n);return A(r.id===i.id,"Assertion Error: before.id === after.id"),this.insert(i)}delete(e){const{[e]:n,...r}=this.data;return new re(r)}*[Symbol.iterator](){for(const e in this.data)mn(this.data,e)&&(yield Ne(this.data[e],'Assertion Error: this.data[id as T["id"]]'))}toJSON(){return this.data}}var ce,ke,Ve;const mt=class mt{constructor(e,n,r,i){Pe(this,ce);Pe(this,ke);Pe(this,Ve);this.index=e,we(this,ce,n),we(this,ke,r),we(this,Ve,i)}static build(e,n,r,i){const o=new Map;for(const s of e){const a=n(s);A(!o.has(a),"Assertion Error: !index.has(key)"),o.set(a,r(s))}return new mt(o,n,r,i)}withIndex(e){return new mt(e,R(this,ce),R(this,ke),R(this,Ve))}lookup(e){return this.index.get(R(this,Ve).call(this,e))}insert(e){const n=R(this,ce).call(this,e);A(!this.index.has(n),`key ${n} already exists in index`);const r=new Map(this.index);return r.set(n,R(this,ke).call(this,e)),this.withIndex(r)}remove(e){const n=R(this,ce).call(this,e);A(this.index.has(n),`key ${n} does not exist in index`);const r=new Map(this.index);return r.delete(n),this.withIndex(r)}update(e){const n=R(this,ce).call(this,e);A(this.index.has(n),`key ${n} does not exist in index`);const r=new Map(this.index);return r.set(n,R(this,ke).call(this,e)),this.withIndex(r)}toJSON(){return Gt(this.index)}};ce=new WeakMap,ke=new WeakMap,Ve=new WeakMap;let Kt=mt;const Ki=new Set;var Te,Me,Be;const gt=class gt{constructor(e,n,r,i){Pe(this,Te);Pe(this,Me);Pe(this,Be);this.index=e,we(this,Te,n),we(this,Me,r),we(this,Be,i)}static build(e,n,r,i){const o=new Map;for(const s of e){const a=n(s);let l=o.get(a);l||(l=new Set,o.set(a,l)),l.add(r(s))}return new gt(o,n,r,i)}withIndex(e){return new gt(e,R(this,Te),R(this,Me),R(this,Be))}lookup(e){return this.index.get(R(this,Be).call(this,e))??Ki}insert(e){const n=R(this,Te).call(this,e),r=R(this,Me).call(this,e),i=this.index.get(n);let o;i?(A(!i.has(r),"already exists"),o=new Set(i)):o=new Set,o.add(r);const s=new Map(this.index);return s.set(n,o),this.withIndex(s)}remove(e){const n=R(this,Te).call(this,e),r=R(this,Me).call(this,e),i=this.index.get(n);A(i==null?void 0:i.has(r),"value does not exist"),new Set(i).delete(r);const s=new Map(this.index);return s.delete(n),this.withIndex(s)}update(e,n){return this.remove(e).insert(n)}toJSON(){return Gt(this.index)}};Te=new WeakMap,Me=new WeakMap,Be=new WeakMap;let ft=gt;function sr(t,e){const n=[t[0]];if(t.length===0)return[];let r=e,i=t[0],o=t[0].center;for(let s=1;s<t.length;s++){const a=t[s],l=t[Math.min(s+1,t.length-1)],u=a.center.add(l.center).scale(.5),c=a.center.distanceTo(i.center),p=o,f=a.center,w=u;let v=0;for(;c-v>=r;){const g=(r+v)/c;n.push({center:p.lerp(f,g).lerp(f.lerp(w,g),g),radius:On(i.radius,a.radius,g)}),v+=r,r=e}r-=c-v,i=a,o=u}return n.push(t[t.length-1]),n}function Dt(t){var o;const e=Array.from(t);if(e.length===0)return{versions:new re({})};const n=[];let r=0;for(const s of e){const a=Hn(s.rawPoints),l=((o=a[a.length-1])==null?void 0:o.runningLength)??0;n.push({id:s.id,strokePoints:a,length:l}),l>r&&(r=l)}const i=Math.floor(r/tt.size);return{versions:re.fromArray(n.map(({strokePoints:s,length:a,id:l})=>{const u=Kn(s,tt);return{id:l,length:a,smoothedCenterPoints:u,normalizedCenterPoints:sr(u,a/i)}}))}}function me(){}me.prototype={diff:function(e,n){var r,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=i.callback;typeof i=="function"&&(o=i,i={}),this.options=i;var s=this;function a(b){return o?(setTimeout(function(){o(void 0,b)},0),!0):b}e=this.castInput(e),n=this.castInput(n),e=this.removeEmpty(this.tokenize(e)),n=this.removeEmpty(this.tokenize(n));var l=n.length,u=e.length,c=1,p=l+u;i.maxEditLength&&(p=Math.min(p,i.maxEditLength));var f=(r=i.timeout)!==null&&r!==void 0?r:1/0,w=Date.now()+f,v=[{oldPos:-1,lastComponent:void 0}],g=this.extractCommon(v[0],n,e,0);if(v[0].oldPos+1>=u&&g+1>=l)return a([{value:this.join(n),count:n.length}]);var m=-1/0,P=1/0;function x(){for(var b=Math.max(m,-c);b<=Math.min(P,c);b+=2){var M=void 0,T=v[b-1],y=v[b+1];T&&(v[b-1]=void 0);var C=!1;if(y){var k=y.oldPos-b;C=y&&0<=k&&k<l}var O=T&&T.oldPos+1<u;if(!C&&!O){v[b]=void 0;continue}if(!O||C&&T.oldPos+1<y.oldPos?M=s.addToPath(y,!0,void 0,0):M=s.addToPath(T,void 0,!0,1),g=s.extractCommon(M,n,e,b),M.oldPos+1>=u&&g+1>=l)return a(Ui(s,M.lastComponent,n,e,s.useLongestToken));v[b]=M,M.oldPos+1>=u&&(P=Math.min(P,b-1)),g+1>=l&&(m=Math.max(m,b+1))}c++}if(o)(function b(){setTimeout(function(){if(c>p||Date.now()>w)return o();x()||b()},0)})();else for(;c<=p&&Date.now()<=w;){var S=x();if(S)return S}},addToPath:function(e,n,r,i){var o=e.lastComponent;return o&&o.added===n&&o.removed===r?{oldPos:e.oldPos+i,lastComponent:{count:o.count+1,added:n,removed:r,previousComponent:o.previousComponent}}:{oldPos:e.oldPos+i,lastComponent:{count:1,added:n,removed:r,previousComponent:o}}},extractCommon:function(e,n,r,i){for(var o=n.length,s=r.length,a=e.oldPos,l=a-i,u=0;l+1<o&&a+1<s&&this.equals(n[l+1],r[a+1]);)l++,a++,u++;return u&&(e.lastComponent={count:u,previousComponent:e.lastComponent}),e.oldPos=a,l},equals:function(e,n){return this.options.comparator?this.options.comparator(e,n):e===n||this.options.ignoreCase&&e.toLowerCase()===n.toLowerCase()},removeEmpty:function(e){for(var n=[],r=0;r<e.length;r++)e[r]&&n.push(e[r]);return n},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function Ui(t,e,n,r,i){for(var o=[],s;e;)o.push(e),s=e.previousComponent,delete e.previousComponent,e=s;o.reverse();for(var a=0,l=o.length,u=0,c=0;a<l;a++){var p=o[a];if(p.removed){if(p.value=t.join(r.slice(c,c+p.count)),c+=p.count,a&&o[a-1].added){var w=o[a-1];o[a-1]=o[a],o[a]=w}}else{if(!p.added&&i){var f=n.slice(u,u+p.count);f=f.map(function(g,m){var P=r[c+m];return P.length>g.length?P:g}),p.value=t.join(f)}else p.value=t.join(n.slice(u,u+p.count));u+=p.count,p.added||(c+=p.count)}}var v=o[l-1];return l>1&&typeof v.value=="string"&&(v.added||v.removed)&&t.equals("",v.value)&&(o[l-2].value+=v.value,o.pop()),o}var Mn=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,Nn=/\S/,ar=new me;ar.equals=function(t,e){return this.options.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t===e||this.options.ignoreWhitespace&&!Nn.test(t)&&!Nn.test(e)};ar.tokenize=function(t){for(var e=t.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),n=0;n<e.length-1;n++)!e[n+1]&&e[n+2]&&Mn.test(e[n])&&Mn.test(e[n+2])&&(e[n]+=e[n+2],e.splice(n+1,2),n--);return e};var lr=new me;lr.tokenize=function(t){this.options.stripTrailingCr&&(t=t.replace(/\r\n/g,`
`));var e=[],n=t.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(var r=0;r<n.length;r++){var i=n[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=i:(this.options.ignoreWhitespace&&(i=i.trim()),e.push(i))}return e};var Wi=new me;Wi.tokenize=function(t){return t.split(/(\S.+?[.!?])(?=\s+|$)/)};var Gi=new me;Gi.tokenize=function(t){return t.split(/([{}:;,]|\s+)/)};function ut(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ut=function(e){return typeof e}:ut=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut(t)}var qi=Object.prototype.toString,We=new me;We.useLongestToken=!0;We.tokenize=lr.tokenize;We.castInput=function(t){var e=this.options,n=e.undefinedReplacement,r=e.stringifyReplacer,i=r===void 0?function(o,s){return typeof s>"u"?n:s}:r;return typeof t=="string"?t:JSON.stringify(Ut(t,null,null,i),i,"  ")};We.equals=function(t,e){return me.prototype.equals.call(We,t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function Yi(t,e,n){return We.diff(t,e,n)}function Ut(t,e,n,r,i){e=e||[],n=n||[],r&&(t=r(i,t));var o;for(o=0;o<e.length;o+=1)if(e[o]===t)return n[o];var s;if(qi.call(t)==="[object Array]"){for(e.push(t),s=new Array(t.length),n.push(s),o=0;o<t.length;o+=1)s[o]=Ut(t[o],e,n,r,i);return e.pop(),n.pop(),s}if(t&&t.toJSON&&(t=t.toJSON()),ut(t)==="object"&&t!==null){e.push(t),s={},n.push(s);var a=[],l;for(l in t)t.hasOwnProperty(l)&&a.push(l);for(a.sort(),o=0;o<a.length;o+=1)l=a[o],s[l]=Ut(t[l],e,n,r,l);e.pop(),n.pop()}else s=t;return s}var Wt=new me;Wt.tokenize=function(t){return t.slice()};Wt.join=Wt.removeEmpty=function(t){return t};const ue=class ue{constructor(e,n=0,r=!0){if(this.data=e,this.version=n,!r)return;const i=this.serialize(),o=ue.deserialize(i,this.version);if(!$t(this,o)){console.log({actual:this,expected:o});const s=JSON.stringify(this,null,2),a=JSON.stringify(o,null,2);for(const l of Yi(s,a))console.log("CHANGE",l);et(`Mismatch after update:
Actual:
${JSON.stringify(this,null,2)}

Expected:
${JSON.stringify(o,null,2)}`)}}static create(){return ue.deserialize(Ri())}static deserialize(e,n=0){const r=new re(e.shapeVersions);return new ue({id:e.id,keyPoints:new re(e.keyPoints),shapes:new re(e.shapes),shapeVersions:r,shapeVersionLookup:Kt.build(r,i=>`${i.shapeId}/${i.keyPointId}`,i=>i.id,([i,o])=>`${i}/${o}`),shapeVersionIdsByShape:ft.build(r,i=>i.shapeId,i=>i.id,gn),shapeVersionIdsByKeyPoint:ft.build(r,i=>i.keyPointId,i=>i.id,gn),normalizedShapeVersions:Dt(Array.from(r)).versions},n,!1)}with(e){return new ue({...this.data,...e},this.version+1)}serialize(){return{id:this.data.id,keyPoints:this.data.keyPoints.data,shapes:this.data.shapes.data,shapeVersions:this.data.shapeVersions.data}}get shapes(){return this.data.shapes}get keyPoints(){return this.data.keyPoints}get shapeVersions(){return this.data.shapeVersions}getShapeVersion(e,n){const r=this.data.shapeVersionLookup.lookup([n,e]);return r?this.shapeVersions.get(r):null}getNormalizedCenterPointsForShapeVersion(e){return this.data.normalizedShapeVersions.get(e)}*iterateShapeVersionsForShape(e){for(const n of this.data.shapeVersionIdsByShape.lookup(e))yield this.shapeVersions.get(n)}addShape(e){console.log("doc.addShape",e);const n=this.shapes.insert({id:e});return this.with({shapes:n})}addKeyPoint(e,n){console.log("doc.addKeyPoint",e);const r=this.keyPoints.insert({id:e,position:n});return this.with({keyPoints:r})}updateKeyPoint(e,n){return this.with({keyPoints:this.keyPoints.update(e,n)})}replacePointsForVersion(e,n,r){const i=this.getShapeVersion(e,n);if(i){const a=this.shapeVersions.insert({...i,rawPoints:r});return this.with({shapeVersions:a,normalizedShapeVersions:Dt(a).versions})}const o={id:hn.generate(),keyPointId:e,shapeId:n,rawPoints:r},s=this.shapeVersions.insert(o);return this.with({shapeVersions:s,normalizedShapeVersions:Dt(s).versions,shapeVersionLookup:this.data.shapeVersionLookup.insert(o),shapeVersionIdsByShape:this.data.shapeVersionIdsByShape.insert(o),shapeVersionIdsByKeyPoint:this.data.shapeVersionIdsByKeyPoint.insert(o)})}};ue.schema=_i.transform(e=>jn.ok(ue.deserialize(e)),_.cannotValidate("SplatDocModel"),e=>e.serialize());let vt=ue;const it=_.object({document:vt.schema,location:ir.schema});function Ji(t){const e=kr(`splatapus.${t}`);return e?it.parse(e).mapErr(n=>n.toString()):jn.error("No saved data found")}function Xi(t,e){window.splatSerializedDoc=e,Tr(`splatapus.${t}`,it.serialize(e))}const Zi=mr(Kr,Xi);function Qi(t,e){const n=[...t.keyPoints][0].id,r=[...t.shapes][0].id;return ir.initialize(n,r)}function ur(t){const e=qe.generate(),n=Ye.generate(),r=vt.create().addKeyPoint(e,j.ZERO).addShape(n).replacePointsForVersion(e,n,[]);return{document:r,location:Qi(r)}}function es(t){const e=d.useRef(t);return d.useEffect(()=>{e.current=t},[t]),e.current}const ts=E.memo(function({shapeId:e,splatapus:n}){var c,p,f;const r=Tt("shouldShowPoints"),i=Tt("shouldShowSmoothPoints"),o=Tt("shouldShowRawPoints"),s=U(()=>{if(n.location.shapeId.live()===e){const w=n.interaction.activeMode.live();switch(w.type){case $.Draw:{const v=w.previewPoints.live();if(v.length){const g=Kn(Hn(v,tt),tt);return{normalized:sr(g,tt.size),reduced:Ot(g),smoothed:g,raw:v}}return null}case $.Rig:case $.Play:return null;default:return W(w)}}return null},[n,e]),a=U(()=>{const w=n.document.live(),v=n.previewPosition.live();let g;switch(v.type){case"interpolated":g=[];break;case"keyPointId":{const x=w.getShapeVersion(v.keyPointId,e);g=x?x.rawPoints:[];break}default:W(v)}const m=tr.getCenterPointsAtPosition(w,e,v);if(m)return{normalized:m.normalized,smoothed:m.smoothed,reduced:m.smoothed?Ot(m.smoothed):null,raw:g};const P=n.keyPointIdHistory.live();for(let x=P.length-1;x>=0;x--){const S=w.getShapeVersion(P[x],e);if(S){const{normalizedCenterPoints:b,smoothedCenterPoints:M}=w.getNormalizedCenterPointsForShapeVersion(S.id);return{normalized:b,smoothed:M,reduced:Ot(M),raw:g}}}return{normalized:null,raw:g}},[e,n]),l=U(()=>n.location.shapeId.live()===e,[n,e]),u=s??a;return h.jsxs(h.Fragment,{children:[a.normalized&&h.jsx("path",{d:_t(At(a.normalized)),className:Y(s?"fill-stone-300":l?"fill-stone-800":"fill-stone-600")}),s&&h.jsx("path",{d:_t(At(s.reduced.retainedPoints)),className:Y(l?"fill-stone-800":"fill-stone-600")}),r&&((c=u.normalized)==null?void 0:c.map((w,v)=>h.jsx(xn,{center:w.center,radius:w.radius},v))),o&&((p=u.raw)==null?void 0:p.map((w,v)=>h.jsx(Gr,{position:w,color:"lime"},v))),i&&((f=u.reduced)==null?void 0:f.retainedPoints.map((w,v)=>h.jsx(xn,{center:w.center,radius:w.radius,color:"skyblue"},v)))]})}),ns=10,rs=10;function os(t,e){if(e===0||e===t.length-1)return null;const n=t[e-1],r=t[e],i=t[e+1],o=Math.abs(r.center.sub(n.center).angleBetween(i.center.sub(r.center)))/Math.PI*ns,s=(1-(r.radius<n.radius?r.radius/n.radius:n.radius/r.radius))*rs;return o+s}function Ot(t){const e=[];let n=1,r=0;const i=[t[0]];for(let o=1;o<t.length-1;o++){const s=Ne(os(t,o),"Assertion Error: getCostAtIndex(points, i)");n-=s,r+=s,n<0&&(i.push(t[o]),n=1)}return i.push(t[t.length-1]),{retainedPoints:i,totalCost:r,dbg:e}}const is=E.memo(function({splatapus:e}){const n=U(()=>e.interaction.getCanvasClassNameLive(),[e]),r=he(e.viewport.isSidebarOpen),i=he(e.viewport.screenSize),o=U(()=>e.viewport.getSceneTransformLive(),[e]),s=es(r),[a,l]=d.useState(!1);return d.useLayoutEffect(()=>{l(!0);const u=setTimeout(()=>l(!1),400);return()=>clearTimeout(u)},[r]),h.jsx("svg",{viewBox:`0 0 ${i.x} ${i.y}`,className:Y("absolute top-0 left-0",n),children:h.jsx("g",{style:{transform:o},className:Y((a||r!==s)&&"transition-transform"),children:h.jsx(ss,{splatapus:e})})})}),ss=E.memo(function({splatapus:e}){return h.jsx(h.Fragment,{children:Array.from(U(()=>e.document.live().shapes,[e]),n=>h.jsx(ts,{shapeId:n.id,splatapus:e},n.id))})}),as={id:"doc.0_VcKaG8h9Zf8pyG",keyPoints:{"key.0_a3vKHuIcxpHnVg":{id:"key.0_a3vKHuIcxpHnVg",position:[84.4612113767582,-310.6259226617922]},"key.1_TYmFrn9Wh1QZ3t":{id:"key.1_TYmFrn9Wh1QZ3t",position:[76.77421647506128,82.8797180046771]},"key.2_8mSx0MUXiSEjNK":{id:"key.2_8mSx0MUXiSEjNK",position:[-290.00197453390416,88.34970510918276]},"key.3_RariJQz2eTMOkJ":{id:"key.3_RariJQz2eTMOkJ",position:[466.25676711635367,91.8418718809971]}},shapes:{"shp.0_n9ry1znj34Bp1k":{id:"shp.0_n9ry1znj34Bp1k"},"shp.1_ONCgL3fjUYIryN":{id:"shp.1_ONCgL3fjUYIryN"},"shp.2_Zwa9ObnrYgWogq":{id:"shp.2_Zwa9ObnrYgWogq"},"shp.3_mUCVyzbyAGCuIa":{id:"shp.3_mUCVyzbyAGCuIa"},"shp.4_SMMSTDAbn3tdXv":{id:"shp.4_SMMSTDAbn3tdXv"},"shp.5_pFzZ21ghrzLlt1":{id:"shp.5_pFzZ21ghrzLlt1"}},shapeVersions:{"shv.0_LwpIe0fFofKDNO":{id:"shv.0_LwpIe0fFofKDNO",keyPointId:"key.0_a3vKHuIcxpHnVg",shapeId:"shp.0_n9ry1znj34Bp1k",rawPoints:[[-41,-45],[-47,-41],[-49,-39],[-53,-34],[-57,-30],[-61,-25],[-64,-20],[-66,-16],[-69,-11],[-71,-6],[-73,-1],[-74,5],[-76,11],[-76,16],[-77,22],[-78,28],[-78,35],[-78,42],[-78,49],[-78,56],[-78,62],[-78,68],[-76,74],[-74,80],[-71,86],[-68,91],[-64,96],[-60,102],[-55,107],[-49,112],[-44,118],[-37,123],[-30,128],[-23,132],[-15,137],[-7,140],[2,144],[11,147],[20,150],[30,152],[39,152],[49,153],[59,153],[69,153],[78,153],[89,152],[99,149],[109,147],[120,143],[129,139],[138,134],[148,129],[156,123],[164,117],[172,110],[179,103],[187,96],[193,89],[198,83],[202,76],[206,69],[208,63],[210,58],[211,52],[212,46],[213,38],[213,30],[213,23],[213,17],[213,11],[213,5],[213,-3],[213,-11],[213,-18],[213,-23],[212,-28],[211,-32],[209,-36],[208,-40],[206,-42],[205,-44],[203,-46],[201,-47],[200,-48],[199,-48],[199,-50]]},"shv.1_SWgK9k5Y2kn7dj":{id:"shv.1_SWgK9k5Y2kn7dj",keyPointId:"key.0_a3vKHuIcxpHnVg",shapeId:"shp.1_ONCgL3fjUYIryN",rawPoints:[[-25,-43],[-25,-47],[-25,-49],[-24,-56],[-22,-65],[-19,-77],[-16,-90],[-14,-101],[-10,-113],[-8,-123],[-4,-131],[-2,-139],[1,-145],[3,-149],[4,-152],[6,-154],[7,-154],[8,-154],[10,-153],[12,-151],[15,-147],[18,-142],[21,-135],[24,-127],[27,-118],[29,-108],[30,-98],[30,-88],[31,-79],[32,-72],[32,-67],[33,-64],[33,-62],[34,-62],[34,-61],[34,-60],[35,-59]]},"shv.3_3ILI63YytH2Ite":{id:"shv.3_3ILI63YytH2Ite",keyPointId:"key.0_a3vKHuIcxpHnVg",shapeId:"shp.2_Zwa9ObnrYgWogq",rawPoints:[[126,-69],[127,-75],[130,-84],[136,-96],[142,-108],[148,-118],[154,-128],[161,-137],[169,-145],[177,-152],[183,-158],[188,-162],[191,-164],[192,-164],[193,-164],[193,-163],[194,-158],[194,-152],[196,-144],[196,-135],[197,-125],[197,-114],[197,-103],[197,-92],[196,-83],[195,-74],[194,-67],[193,-62],[192,-60],[192,-58],[192,-57],[192,-55],[192,-50],[192,-48]]},"shv.4_dljDpCZ90LHjbP":{id:"shv.4_dljDpCZ90LHjbP",keyPointId:"key.0_a3vKHuIcxpHnVg",shapeId:"shp.3_mUCVyzbyAGCuIa",rawPoints:[[41,-63],[46,-66],[51,-67],[57,-69],[65,-71],[72,-72],[80,-73],[89,-74],[99,-74],[109,-74],[115,-74],[120,-74],[124,-74],[127,-74],[129,-74],[130,-73],[130,-72]]},"shv.5_g5nKgDG7juS3Au":{id:"shv.5_g5nKgDG7juS3Au",keyPointId:"key.0_a3vKHuIcxpHnVg",shapeId:"shp.4_SMMSTDAbn3tdXv",rawPoints:[[21,-10],[15,-10],[11,-10],[5,-7],[-2,-3],[-8,1],[-14,6],[-18,10],[-22,14],[-25,19],[-27,24],[-29,30],[-30,38],[-30,44],[-30,48],[-29,52],[-26,55],[-22,59],[-17,62],[-10,65],[-3,66],[4,67],[11,67],[17,67],[22,64],[26,59],[29,53],[32,47],[33,44],[33,41],[33,40],[33,39],[33,36],[33,22],[33,16],[33,13],[33,11],[32,10],[31,9],[29,8],[27,8],[25,7],[24,6],[23,6],[22,6],[22,5],[21,4],[20,4],[20,3],[19,3],[18,3],[17,3]]},"shv.6_fOyfl45j6IoVJD":{id:"shv.6_fOyfl45j6IoVJD",keyPointId:"key.0_a3vKHuIcxpHnVg",shapeId:"shp.5_pFzZ21ghrzLlt1",rawPoints:[[151,-26],[145,-27],[138,-26],[127,-21],[116,-14],[106,-6],[98,3],[91,11],[87,20],[84,30],[83,39],[83,47],[86,53],[92,57],[100,59],[110,60],[121,60],[133,59],[144,56],[154,51],[163,45],[172,37],[177,30],[180,24],[182,18],[184,11],[184,4],[184,-6],[180,-13],[176,-19],[171,-23],[166,-25],[161,-27],[155,-27],[148,-27],[141,-27],[135,-26],[129,-23],[123,-18]]},"shv.7_MNXQuLFOxPhQSP":{id:"shv.7_MNXQuLFOxPhQSP",keyPointId:"key.1_TYmFrn9Wh1QZ3t",shapeId:"shp.0_n9ry1znj34Bp1k",rawPoints:[[-35,25],[-41,26],[-44,26],[-48,26],[-53,27],[-57,29],[-62,30],[-67,33],[-72,35],[-77,38],[-83,42],[-88,46],[-92,50],[-97,55],[-101,62],[-105,68],[-108,75],[-111,81],[-113,87],[-114,92],[-114,96],[-114,101],[-114,104],[-113,108],[-111,111],[-108,115],[-105,118],[-101,121],[-98,123],[-94,126],[-90,128],[-85,130],[-80,132],[-74,133],[-69,135],[-62,137],[-56,138],[-49,139],[-43,140],[-36,140],[-30,140],[-24,140],[-18,140],[-12,140],[-7,140],[-1,141],[4,142],[9,142],[14,143],[21,144],[27,145],[33,147],[40,147],[46,148],[52,148],[58,148],[64,148],[70,148],[77,149],[83,149],[89,149],[95,149],[101,149],[107,149],[114,149],[121,149],[128,149],[136,149],[144,148],[151,147],[158,147],[165,145],[172,144],[179,144],[186,143],[193,142],[200,140],[206,139],[213,137],[220,134],[225,132],[231,130],[237,127],[242,123],[249,119],[255,113],[262,108],[266,103],[270,99],[274,95],[276,92],[278,89],[279,86],[280,83],[281,80],[281,77],[281,75],[281,74],[281,72],[280,69],[279,65],[277,60],[275,56],[274,53],[272,50],[270,47],[267,43],[265,39],[262,35],[259,30],[256,27],[252,23],[250,21],[246,18],[242,16],[239,14],[235,11],[230,10],[227,8],[223,8],[221,7],[217,7],[213,6],[210,6],[206,6],[204,6],[202,6],[201,6],[200,6],[200,5]]},"shv.8_dqc9S1VROeclkw":{id:"shv.8_dqc9S1VROeclkw",keyPointId:"key.1_TYmFrn9Wh1QZ3t",shapeId:"shp.1_ONCgL3fjUYIryN",rawPoints:[[-20,20],[-23,16],[-23,13],[-25,10],[-26,7],[-29,4],[-32,1],[-35,-1],[-38,-4],[-39,-5],[-41,-6],[-43,-6],[-46,-8],[-49,-9],[-53,-9],[-56,-10],[-58,-10],[-59,-10],[-61,-11],[-62,-11],[-63,-11],[-64,-11],[-64,-12],[-64,-13],[-64,-14],[-64,-15],[-64,-16],[-63,-17],[-62,-18],[-61,-20],[-59,-22],[-56,-24],[-54,-26],[-52,-28],[-49,-29],[-46,-31],[-43,-32],[-39,-33],[-36,-33],[-32,-33],[-28,-33],[-24,-33],[-19,-33],[-15,-32],[-12,-31],[-9,-29],[-7,-28],[-5,-26],[-3,-24],[-2,-22],[0,-20],[2,-18],[3,-14],[5,-11],[7,-8],[7,-6],[9,-4],[9,-3],[11,-1],[12,0],[14,2],[15,4],[16,6],[16,8],[17,8],[17,9],[18,10],[18,11],[19,11],[19,12],[19,13],[19,14],[19,15],[20,16],[21,17]]},"shv.9_wkf9c4ZDBAwLRf":{id:"shv.9_wkf9c4ZDBAwLRf",keyPointId:"key.1_TYmFrn9Wh1QZ3t",shapeId:"shp.2_Zwa9ObnrYgWogq",rawPoints:[[152,-11],[156,-17],[158,-21],[162,-25],[167,-31],[174,-36],[181,-42],[189,-48],[196,-54],[204,-59],[212,-62],[220,-63],[228,-63],[236,-63],[245,-63],[252,-63],[257,-62],[259,-61],[261,-60],[262,-60],[263,-59],[263,-58],[263,-57],[260,-55],[255,-52],[250,-48],[243,-43],[237,-38],[230,-33],[225,-27],[218,-20],[213,-13],[208,-6],[206,-2],[204,0],[204,1],[204,2]]},"shv.10_QVHVJVxyuxdpD":{id:"shv.10_QVHVJVxyuxdpD",keyPointId:"key.1_TYmFrn9Wh1QZ3t",shapeId:"shp.3_mUCVyzbyAGCuIa",rawPoints:[[31,17],[33,16],[36,16],[47,11],[58,6],[72,1],[84,-1],[99,-4],[113,-6],[124,-6],[134,-7],[141,-8],[147,-8],[152,-8],[154,-8],[155,-7],[155,-6],[155,-4]]},"shv.12_5jxllLtpm93b7":{id:"shv.12_5jxllLtpm93b7",keyPointId:"key.1_TYmFrn9Wh1QZ3t",shapeId:"shp.4_SMMSTDAbn3tdXv",rawPoints:[[19,55],[12,55],[9,55],[4,55],[-1,56],[-6,57],[-10,57],[-15,58],[-20,59],[-26,60],[-32,63],[-37,65],[-43,68],[-47,71],[-52,74],[-54,77],[-57,81],[-59,86],[-61,90],[-62,95],[-62,98],[-62,101],[-62,103],[-61,105],[-56,107],[-51,108],[-44,110],[-37,110],[-30,110],[-24,110],[-17,108],[-9,106],[-3,103],[4,100],[10,97],[16,94],[21,91],[25,88],[30,84],[33,81],[36,77],[37,75],[38,73],[38,72],[38,71],[38,70],[38,69],[37,69],[36,67],[35,66],[34,65],[32,61],[29,54],[26,51],[25,50],[24,50],[23,50],[22,50],[21,50],[20,51],[19,52],[17,54],[14,57],[13,59]]},"shv.14_GWIuG0AcQVcWv":{id:"shv.14_GWIuG0AcQVcWv",keyPointId:"key.1_TYmFrn9Wh1QZ3t",shapeId:"shp.5_pFzZ21ghrzLlt1",rawPoints:[[221,50],[215,47],[211,47],[206,46],[200,46],[195,45],[191,45],[185,45],[179,45],[173,46],[166,50],[160,53],[155,57],[150,60],[148,64],[146,67],[145,71],[144,76],[144,81],[144,86],[144,89],[145,92],[148,94],[152,97],[158,99],[165,100],[173,101],[181,101],[189,101],[197,99],[205,96],[213,93],[221,90],[228,87],[234,84],[238,81],[241,80],[244,78],[247,76],[248,74],[248,73],[248,72],[248,70],[248,69],[248,68],[248,67],[246,66],[243,60],[240,57],[238,55],[237,54],[235,54],[233,53],[229,52],[224,52],[218,52],[214,52],[210,52],[204,52],[197,54]]},"shv.15_IegtY8uWpenHx":{id:"shv.15_IegtY8uWpenHx",keyPointId:"key.2_8mSx0MUXiSEjNK",shapeId:"shp.0_n9ry1znj34Bp1k",rawPoints:[[-137,13],[-143,8],[-144,8],[-146,8],[-148,7],[-150,6],[-152,6],[-155,5],[-158,4],[-161,3],[-165,2],[-169,1],[-173,1],[-176,1],[-180,1],[-183,1],[-186,1],[-189,1],[-192,1],[-195,1],[-196,1],[-198,3],[-200,5],[-202,10],[-204,15],[-206,20],[-207,24],[-208,28],[-209,31],[-209,35],[-209,38],[-209,40],[-209,43],[-209,46],[-207,49],[-205,52],[-204,56],[-202,59],[-200,63],[-199,67],[-197,70],[-195,72],[-194,74],[-193,76],[-190,77],[-188,80],[-186,82],[-183,84],[-179,87],[-175,90],[-171,93],[-166,96],[-160,99],[-155,102],[-149,105],[-143,108],[-137,110],[-131,113],[-125,116],[-119,120],[-112,123],[-106,125],[-100,127],[-94,129],[-88,132],[-82,134],[-76,135],[-70,137],[-64,139],[-58,141],[-52,142],[-45,144],[-38,145],[-31,146],[-23,147],[-16,147],[-8,147],[0,147],[8,147],[17,147],[25,147],[34,147],[42,147],[49,147],[56,146],[63,146],[71,145],[78,144],[85,143],[92,142],[99,142],[106,141],[113,140],[120,139],[127,138],[134,137],[141,137],[149,136],[156,135],[164,134],[172,132],[179,131],[187,130],[194,128],[201,126],[208,123],[214,121],[221,118],[226,114],[230,111],[235,108],[238,104],[241,99],[244,93],[247,89],[250,82],[252,75],[255,65],[257,55],[257,48],[257,45],[257,43],[257,42],[252,36],[249,32],[245,28],[241,26],[239,25],[235,24],[231,21],[225,18],[219,16],[215,13],[211,11],[209,10],[208,8],[208,7],[207,6],[206,6],[205,6],[204,6],[203,6],[202,6],[201,6],[199,6],[198,6],[196,6],[194,6],[191,5],[189,5],[187,4],[184,4],[180,3],[177,3],[172,2],[168,1],[164,1],[160,0],[155,0],[151,0],[147,-1],[143,-1],[139,-1],[136,-1],[132,-1],[128,-1],[123,-1],[119,-1],[114,-1],[110,-1],[106,-1],[102,-1],[99,0],[95,1],[92,1],[90,1],[89,1],[87,2],[86,2],[85,2],[84,2],[84,3],[83,3],[82,3],[82,4],[81,4],[80,4],[79,4],[78,4],[77,4],[77,5],[76,5],[75,5],[74,5],[73,6],[72,6],[70,6],[67,7],[65,7],[63,8],[61,8],[59,8],[57,9],[55,10],[53,10],[52,11],[50,11],[49,11],[48,11],[47,11],[47,12],[47,13]]},"shv.17_JPHh1b7aVM4a5":{id:"shv.17_JPHh1b7aVM4a5",keyPointId:"key.2_8mSx0MUXiSEjNK",shapeId:"shp.1_ONCgL3fjUYIryN",rawPoints:[[-130,1],[-135,-3],[-137,-4],[-140,-8],[-143,-11],[-147,-13],[-151,-15],[-155,-17],[-160,-19],[-165,-21],[-170,-23],[-175,-23],[-179,-23],[-183,-23],[-188,-23],[-191,-23],[-194,-22],[-197,-21],[-200,-20],[-201,-19],[-202,-19],[-203,-19],[-204,-19],[-204,-20],[-204,-21],[-204,-25],[-202,-30],[-198,-35],[-194,-40],[-190,-43],[-185,-46],[-181,-48],[-176,-49],[-171,-50],[-165,-52],[-159,-52],[-154,-54],[-149,-54],[-145,-54],[-139,-54],[-134,-53],[-130,-50],[-127,-48],[-124,-45],[-121,-41],[-119,-37],[-117,-32],[-115,-26],[-113,-19],[-112,-12],[-112,-6],[-112,-2],[-112,0],[-112,1],[-112,2],[-112,3],[-111,3],[-111,4],[-111,5]]},"shv.19_XdsJ3W4A719pc":{id:"shv.19_XdsJ3W4A719pc",keyPointId:"key.2_8mSx0MUXiSEjNK",shapeId:"shp.2_Zwa9ObnrYgWogq",rawPoints:[[-31,2],[-33,-4],[-33,-7],[-34,-11],[-36,-14],[-38,-17],[-40,-22],[-43,-27],[-46,-32],[-48,-35],[-50,-38],[-52,-41],[-55,-44],[-59,-48],[-62,-52],[-66,-56],[-69,-58],[-72,-60],[-76,-61],[-79,-61],[-82,-61],[-85,-61],[-87,-61],[-88,-61],[-89,-61],[-90,-62],[-88,-62],[-87,-63],[-85,-63],[-83,-63],[-80,-63],[-76,-63],[-70,-63],[-64,-63],[-58,-63],[-52,-63],[-47,-62],[-42,-61],[-38,-59],[-34,-56],[-30,-53],[-27,-49],[-24,-45],[-21,-42],[-19,-39],[-17,-35],[-14,-31],[-10,-25],[-7,-19],[-3,-13],[0,-8],[3,-4],[5,-1],[7,2],[9,5],[12,9],[16,13],[19,17],[22,19],[24,21],[26,23],[27,23],[28,24],[28,25],[29,25],[29,26]]},"shv.20_QSK3n1l8MmGEZ":{id:"shv.20_QSK3n1l8MmGEZ",keyPointId:"key.2_8mSx0MUXiSEjNK",shapeId:"shp.3_mUCVyzbyAGCuIa",rawPoints:[[-102,9],[-100,8],[-97,8],[-93,8],[-89,7],[-86,6],[-83,5],[-79,4],[-75,4],[-71,4],[-67,4],[-63,4],[-60,3],[-58,3],[-55,3],[-52,3],[-49,3],[-47,3],[-44,3],[-43,3],[-42,3]]},"shv.22_I2STbWZAXgo1B":{id:"shv.22_I2STbWZAXgo1B",keyPointId:"key.2_8mSx0MUXiSEjNK",shapeId:"shp.4_SMMSTDAbn3tdXv",rawPoints:[[-110,42],[-115,40],[-118,40],[-122,40],[-126,38],[-130,36],[-134,34],[-138,32],[-141,31],[-144,30],[-147,29],[-151,28],[-154,27],[-158,26],[-162,26],[-165,26],[-168,26],[-170,27],[-171,29],[-172,32],[-173,34],[-174,37],[-174,39],[-174,41],[-174,43],[-174,45],[-174,47],[-172,49],[-169,52],[-165,56],[-160,60],[-155,64],[-149,68],[-143,72],[-137,75],[-132,78],[-125,81],[-119,83],[-112,85],[-107,86],[-101,86],[-96,86],[-92,86],[-88,84],[-85,80],[-83,77],[-82,74],[-82,72],[-82,71],[-82,69],[-82,67],[-83,63],[-86,60],[-87,57],[-88,55],[-90,51],[-93,44],[-96,37],[-100,32],[-102,29],[-103,28],[-105,28],[-106,28],[-107,28],[-108,28],[-108,29]]},"shv.23_wW18nQbpEd7gx":{id:"shv.23_wW18nQbpEd7gx",keyPointId:"key.2_8mSx0MUXiSEjNK",shapeId:"shp.5_pFzZ21ghrzLlt1",rawPoints:[[4,40],[-2,38],[-5,38],[-9,38],[-14,37],[-18,37],[-24,37],[-28,37],[-32,37],[-35,38],[-38,39],[-40,41],[-42,43],[-42,45],[-43,46],[-43,47],[-43,50],[-43,54],[-41,59],[-38,64],[-35,68],[-32,72],[-29,74],[-25,77],[-22,79],[-18,79],[-13,80],[-8,80],[-3,80],[3,80],[9,79],[15,75],[21,72],[26,69],[31,66],[34,64],[36,61],[38,59],[38,58],[38,57],[37,56],[36,56],[34,55],[31,52],[26,49],[21,45],[16,42],[12,40],[9,38],[6,36],[3,35],[-1,35],[-4,34],[-7,34],[-10,33],[-12,33],[-13,33],[-21,38]]},"shv.25_bSftSx0IJxw7H":{id:"shv.25_bSftSx0IJxw7H",keyPointId:"key.3_RariJQz2eTMOkJ",shapeId:"shp.0_n9ry1znj34Bp1k",rawPoints:[[110.49240292871617,19.52362771067062],[101.42737067012109,11.753600060446258],[100.13236606175036,11.753600060446258],[96.24735223663818,11.753600060446258],[89.77232919478455,10.458595452075532],[84.59231076130163,9.163590843704805],[75.52727850270655,9.163590843704805],[67.75725085248219,7.868586235334078],[58.6922185938871,7.868586235334078],[50.922190943662734,7.868586235334078],[43.15216329343838,7.868586235334078],[35.38213564321401,7.868586235334078],[27.612107992989653,7.868586235334078],[19.84208034276529,7.868586235334078],[13.367057300911656,7.868586235334078],[6.892034259058021,9.163590843704805],[.4170112172043865,9.163590843704805],[-6.058011824649248,11.753600060446258],[-12.533034866502883,14.343609277187712],[-17.71305329998579,15.63861388555844],[-22.893071733468698,19.52362771067062],[-29.368094775322334,22.113636927412074],[-34.54811320880524,24.703646144153527],[-41.02313625065887,29.883664577636434],[-47.49815929251251,33.76867840274862],[-51.38317311762469,37.653692227860795],[-55.268186942736875,40.24370144460225],[-56.5631915511076,41.53870605297298],[-57.858196159478325,42.83371066134371],[-59.15320076784905,44.128715269714434],[-59.15320076784905,46.71872448645588],[-60.44820537621978,50.603738311568065],[-61.74320998459051,55.78375674505097],[-63.03821459296123,60.96377517853388],[-64.33321920133196,67.43879822038751],[-64.33321920133196,73.91382126224116],[-64.33321920133196,80.38884430409479],[-64.33321920133196,86.86386734594842],[-61.74320998459051,92.04388577943133],[-59.15320076784905,95.92889960454352],[-55.268186942736875,99.81391342965568],[-51.38317311762469,102.40392264639715],[-47.49815929251251,106.28893647150933],[-42.318140859029604,108.87894568825078],[-35.843117817175965,111.46895490499223],[-29.368094775322334,112.76395951336296],[-21.598067125097973,115.35396873010441],[-15.123044083244336,116.64897333847514],[-7.353016433019975,116.64897333847514],[-.8779933911663405,117.94397794684586],[6.892034259058021,119.2389825552166],[15.95706651765311,120.53398716358733],[23.72709416787747,123.12399638032878],[34.08713103484329,123.12399638032878],[41.85715868506765,124.41900098869951],[50.922190943662734,125.71400559707023],[58.6922185938871,128.30401481381168],[67.75725085248219,129.5990194221824],[76.82228311107728,132.18902863892387],[87.1823199780431,133.4840332472946],[96.24735223663818,134.7790378556653],[106.60738910360399,136.07404246403604],[115.67242136219909,137.36904707240677],[124.73745362079417,138.6640516807775],[132.50748127101855,138.6640516807775],[140.27750892124288,139.95905628914824],[149.34254117983798,141.25406089751894],[157.11256883006234,142.54906550588967],[166.17760108865744,143.8440701142604],[175.24263334725254,145.13907472263114],[184.3076656058476,145.13907472263114],[192.07769325607197,146.43407933100187],[201.14272551466706,146.43407933100187],[210.20775777326216,146.43407933100187],[219.27279003185726,146.43407933100187],[228.33782229045232,146.43407933100187],[239.99286376578888,146.43407933100187],[250.35290063275468,143.8440701142604],[263.302946716462,141.25406089751894],[276.25299280016924,137.36904707240677],[289.2030388838765,133.4840332472946],[300.85808035921303,129.5990194221824],[312.51312183454957,125.71400559707023],[322.8731587015154,121.82899177195804],[333.2331955684812,117.94397794684586],[344.88823704381775,111.46895490499223],[355.24827391078355,104.9939318631386],[364.3133061693787,98.51890882128497],[372.083333819603,92.04388577943133],[379.8533614698274,86.86386734594842],[386.328384511681,80.38884430409479],[394.0984121619054,72.61881665387043],[401.86843981212974,66.1437936120168],[408.3434628539834,57.078761353421704],[412.22847667909554,50.603738311568065],[414.818485895837,46.71872448645588],[414.818485895837,44.128715269714434],[414.818485895837,42.83371066134371],[414.818485895837,41.53870605297298],[414.818485895837,40.24370144460225],[413.52348128746627,37.653692227860795],[410.9334720707248,36.35868761949007],[408.3434628539834,33.76867840274862],[405.75345363724193,29.883664577636434],[401.86843981212974,24.703646144153527],[397.98342598701754,19.52362771067062],[392.80340755353467,13.048604668816985],[388.9183937284225,9.163590843704805],[386.328384511681,6.5735816269633505],[382.4433706865688,2.68856780185117],[379.8533614698274,.098558585109716],[375.9683476447152,-2.491450631631738],[372.083333819603,-3.7864552400024647],[368.1983199944908,-6.376464456743919],[364.3133061693787,-7.671469065114645],[360.4282923442665,-8.966473673485373],[357.838283127525,-8.966473673485373],[352.65826469404215,-8.966473673485373],[348.77325086892995,-10.2614782818561],[343.593232435447,-10.2614782818561],[338.4132140019641,-10.2614782818561],[331.9381909601105,-10.2614782818561],[326.75817252662756,-10.2614782818561],[320.28314948477396,-10.2614782818561],[313.8081264429203,-10.2614782818561],[307.3331034010667,-10.2614782818561],[302.15308496758377,-10.2614782818561],[296.97306653410084,-10.2614782818561],[291.79304810061797,-10.2614782818561],[285.3180250587643,-10.2614782818561],[277.54799740853997,-10.2614782818561],[269.7779697583156,-8.966473673485373],[262.00794210809124,-7.671469065114645],[255.53291906623758,-6.376464456743919],[251.64790524112541,-5.081459848373192],[250.35290063275468,-3.7864552400024647],[249.05789602438395,-3.7864552400024647],[250.35290063275468,-2.491450631631738]]},"shv.26_FUFwushsNIoT8":{id:"shv.26_FUFwushsNIoT8",keyPointId:"key.3_RariJQz2eTMOkJ",shapeId:"shp.1_ONCgL3fjUYIryN",rawPoints:[[116.9674259705698,15.63861388555844],[120.85243979568199,6.5735816269633505],[122.14744440405272,2.68856780185117],[124.73745362079417,.098558585109716],[128.62246744590635,-3.7864552400024647],[131.21247666264782,-7.671469065114645],[135.09749048775998,-12.851487498597553],[138.98250431287218,-16.736501323709735],[144.16252274635508,-21.916519757192642],[149.34254117983798,-25.801533582304824],[153.22755500495018,-29.686547407417002],[157.11256883006234,-33.571561232529184],[160.99758265517454,-36.16157044927064],[164.8825964802867,-38.75157966601209],[168.7676103053989,-41.34158888275355],[172.65262413051107,-42.63659349112427],[176.53763795562324,-43.931598099495],[179.1276471723647,-43.931598099495],[181.71765638910617,-43.931598099495],[183.0126609974769,-43.931598099495],[184.3076656058476,-45.22660270786573],[185.60267021421834,-45.22660270786573],[188.1926794309598,-46.521607316236455],[189.48768403933053,-46.521607316236455],[190.78268864770124,-46.521607316236455],[192.07769325607197,-46.521607316236455],[193.3726978644427,-46.521607316236455],[194.66770247281343,-46.521607316236455],[195.96270708118416,-45.22660270786573],[195.96270708118416,-43.931598099495],[195.96270708118416,-42.63659349112427],[195.96270708118416,-40.046584274382816],[195.96270708118416,-37.456575057641366],[194.66770247281343,-32.27655662415846],[193.3726978644427,-28.391542799046277],[189.48768403933053,-21.916519757192642],[185.60267021421834,-15.441496715339007],[181.71765638910617,-8.966473673485373],[177.83264256399397,-3.7864552400024647],[173.9476287388818,1.3935631934804429],[171.35761952214034,5.278577018592624],[170.0626149137696,6.5735816269633505],[168.7676103053989,7.868586235334078],[168.7676103053989,9.163590843704805],[168.7676103053989,10.458595452075532],[168.7676103053989,11.753600060446258],[168.7676103053989,13.048604668816985]]},"shv.28_mqL5cK4iYMnLO":{id:"shv.28_mqL5cK4iYMnLO",keyPointId:"key.3_RariJQz2eTMOkJ",shapeId:"shp.2_Zwa9ObnrYgWogq",rawPoints:[[241.2878683741596,-8.966473673485373],[238.69785915741815,-15.441496715339007],[238.69785915741815,-18.03150593208046],[238.69785915741815,-21.916519757192642],[241.2878683741596,-25.801533582304824],[242.58287298253032,-30.98155201578773],[245.17288219927178,-34.86656584089991],[247.76289141601325,-38.75157966601209],[251.64790524112541,-42.63659349112427],[256.8279236746083,-47.81661192460718],[264.5979513248327,-52.99663035809009],[271.0729743666863,-59.471653399943726],[277.54799740853997,-63.35666722505591],[284.0230204503936,-65.94667644179736],[290.49804349224723,-67.24168105016808],[298.26807114247157,-67.24168105016808],[306.03809879269596,-67.24168105016808],[313.8081264429203,-67.24168105016808],[321.5781540931447,-67.24168105016808],[328.0531771349983,-67.24168105016808],[333.2331955684812,-65.94667644179736],[335.8232047852227,-65.94667644179736],[337.1182093935934,-64.65167183342663],[338.4132140019641,-64.65167183342663],[335.8232047852227,-64.65167183342663],[333.2331955684812,-64.65167183342663],[325.46316791825683,-63.35666722505591],[317.6931402680325,-62.061662616685176],[311.21811722617883,-60.76665800831445],[303.4480895759545,-58.176648791572994],[294.38305731735943,-52.99663035809009],[286.61302966713504,-47.81661192460718],[277.54799740853997,-41.34158888275355],[271.0729743666863,-34.86656584089991],[265.89295593320344,-28.391542799046277],[262.00794210809124,-25.801533582304824],[260.7129374997205,-21.916519757192642],[259.4179328913498,-20.621515148821913],[258.12292828297905,-19.32651054045119],[258.12292828297905,-18.03150593208046],[258.12292828297905,-16.736501323709735],[258.12292828297905,-15.441496715339007],[258.12292828297905,-14.14649210696828],[258.12292828297905,-12.851487498597553],[258.12292828297905,-11.556482890226826],[258.12292828297905,-10.2614782818561],[258.12292828297905,-8.966473673485373],[259.4179328913498,-8.966473673485373],[259.4179328913498,-1.196446023261011]]},"shv.29_7s9cPPIlpJ9Np":{id:"shv.29_7s9cPPIlpJ9Np",keyPointId:"key.3_RariJQz2eTMOkJ",shapeId:"shp.3_mUCVyzbyAGCuIa",rawPoints:[[188.1926794309598,16.933618493929167],[192.07769325607197,10.458595452075532],[195.96270708118416,10.458595452075532],[202.4377301230378,9.163590843704805],[210.20775777326216,9.163590843704805],[217.97778542348652,7.868586235334078],[224.45280846534015,6.5735816269633505],[230.9278315071938,5.278577018592624],[236.1078499406767,2.68856780185117],[239.99286376578888,2.68856780185117],[242.58287298253032,1.3935631934804429],[243.87787759090105,1.3935631934804429],[245.17288219927178,1.3935631934804429],[246.46788680764251,1.3935631934804429]]},"shv.30_gZeoEkcUkLcml":{id:"shv.30_gZeoEkcUkLcml",keyPointId:"key.3_RariJQz2eTMOkJ",shapeId:"shp.4_SMMSTDAbn3tdXv",rawPoints:[[238.69785915741815,38.94869683623153],[232.22283611556452,41.53870605297298],[228.33782229045232,41.53870605297298],[225.7478130737109,45.42371987808516],[220.56779464022796,49.30873370319734],[216.6827808151158,54.48875213668025],[211.5027623816329,59.668770570163154],[206.32274394814996,66.1437936120168],[201.14272551466706,71.3238120454997],[198.5527162979256,76.50383047898261],[195.96270708118416,81.6838489124655],[194.66770247281343,84.27385812920697],[193.3726978644427,88.15887195431915],[193.3726978644427,89.45387656268987],[193.3726978644427,90.7488811710606],[193.3726978644427,93.33889038780205],[194.66770247281343,94.63389499617278],[198.5527162979256,95.92889960454352],[203.73273473140853,97.22390421291423],[208.91275316489143,98.51890882128497],[214.09277159837433,99.81391342965568],[220.56779464022796,99.81391342965568],[228.33782229045232,99.81391342965568],[237.40285454904742,97.22390421291423],[246.46788680764251,93.33889038780205],[256.8279236746083,88.15887195431915],[264.5979513248327,80.38884430409479],[272.36797897505704,72.61881665387043],[278.8430020169107,66.1437936120168],[282.72801584202284,60.96377517853388],[286.61302966713504,54.48875213668025],[287.90803427550577,49.30873370319734],[289.2030388838765,45.42371987808516],[289.2030388838765,44.128715269714434],[287.90803427550577,44.128715269714434],[285.3180250587643,44.128715269714434],[281.4330112336521,42.83371066134371],[276.25299280016924,42.83371066134371],[269.7779697583156,42.83371066134371],[262.00794210809124,42.83371066134371],[252.94290984949615,42.83371066134371],[245.17288219927178,42.83371066134371],[239.99286376578888,42.83371066134371],[237.40285454904742,42.83371066134371],[236.1078499406767,42.83371066134371],[236.1078499406767,44.128715269714434]]},"shv.32_Is4OGgrMoyylx":{id:"shv.32_Is4OGgrMoyylx",keyPointId:"key.3_RariJQz2eTMOkJ",shapeId:"shp.5_pFzZ21ghrzLlt1",rawPoints:[[377.26335225308594,20.81863231904135],[366.90331538612014,19.52362771067062],[364.3133061693787,19.52362771067062],[359.13328773589575,22.113636927412074],[352.65826469404215,27.29365536089498],[344.88823704381775,35.063683011119345],[337.1182093935934,44.128715269714434],[330.64318635173976,51.8987429199388],[326.75817252662756,59.668770570163154],[321.5781540931447,66.1437936120168],[320.28314948477396,72.61881665387043],[317.6931402680325,77.79883508735334],[317.6931402680325,80.38884430409479],[317.6931402680325,82.97885352083624],[318.9881448764032,84.27385812920697],[321.5781540931447,85.56886273757769],[326.75817252662756,85.56886273757769],[331.9381909601105,85.56886273757769],[339.7082186103348,84.27385812920697],[347.4782462605592,80.38884430409479],[355.24827391078355,76.50383047898261],[363.01830156100795,71.3238120454997],[370.7883292112323,67.43879822038751],[375.9683476447152,62.25877978690461],[381.14836607819814,57.078761353421704],[383.73837529493954,51.8987429199388],[387.62338912005174,46.71872448645588],[390.2133983367932,40.24370144460225],[392.80340755353467,35.063683011119345],[392.80340755353467,31.178669186007163],[392.80340755353467,28.58865996926571],[392.80340755353467,27.29365536089498],[390.2133983367932,27.29365536089498],[388.9183937284225,27.29365536089498],[387.62338912005174,27.29365536089498],[386.328384511681,27.29365536089498],[386.328384511681,28.58865996926571],[386.328384511681,31.178669186007163]]}}},ls={keyPointId:"key.0_a3vKHuIcxpHnVg",shapeId:"shp.0_n9ry1znj34Bp1k",viewport:{pan:[120,-2],zoom:1},mode:"draw"},us={document:as,location:ls};function cs({splatapus:t}){return h.jsxs(h.Fragment,{children:[h.jsx(ps,{splatapus:t}),h.jsx(ds,{splatapus:t}),h.jsx(fs,{splatapus:t}),h.jsx(hs,{splatapus:t})]})}function ds({splatapus:t}){return h.jsx(fe,{onClick:()=>{const e=encodeURIComponent(JSON.stringify(it.serialize({document:t.document.getOnce(),location:t.location.state.getOnce()}))),n=window.document.createElement("a");n.setAttribute("href",`data:text/json;charset=utf-8,${e}`),n.setAttribute("download","splatapus.json"),n.click()},children:"export"})}function ps({splatapus:t}){return h.jsx(fe,{onClick:()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.addEventListener("change",n=>{var o;const r=(o=e.files)==null?void 0:o.item(0);if(!r)return;const i=new FileReader;i.addEventListener("load",()=>{const s=i.result;if(!s){alert("could not read file :(");return}A(typeof s=="string",'Assertion Error: typeof result === "string"');try{const a=it.parse(JSON.parse(s));if(!a.ok){alert(`cannot read splat doc: ${a.error.message}`);return}const l=a.value;t.document.update(()=>l.document,{lockstepLocation:u=>l.location})}catch(a){alert(`could not parse json: ${gr(a)}`)}}),i.readAsText(r)}),e.click()},children:"import"})}function hs({splatapus:t}){return h.jsx(fe,{onClick:()=>{const{document:e,location:n}=ur(j.UNIT);t.document.update(()=>e,{lockstepLocation:n})},children:"reset"})}function fs({splatapus:t}){return h.jsx(fe,{onClick:()=>{const e=it.parse(us).unwrap();t.document.update(()=>e.document,{lockstepLocation:e.location})},children:"example"})}const cr={[$.Draw]:{gradient500:"from-fuchsia-500 to-violet-500",border500:"border-purple-500",ring500:"ring-purple-500"},[$.Rig]:{gradient500:"from-cyan-500 to-blue-500",border500:"border-sky-500",ring500:"ring-sky-500"},[$.Play]:{gradient500:"from-lime-500 to-emerald-500",border500:"border-green-500",ring500:"ring-green-500"}};function vs(t){const e=U(()=>t.interaction.activeMode.live().type,[t]);return cr[e]}const ms=E.memo(function({splatapus:e}){return h.jsxs(h.Fragment,{children:[h.jsx(zt,{modeType:$.Draw,splatapus:e,children:"draw"}),h.jsx(zt,{modeType:$.Rig,splatapus:e,children:"rig"}),h.jsx(zt,{modeType:$.Play,splatapus:e,children:"play"})]})}),zt=function({modeType:e,splatapus:n,children:r}){const o=U(()=>n.interaction.activeMode.live().type,[n.interaction])===e;return h.jsx(Er,{actionName:e,vfx:n.vfx,onClick:()=>{n.vfx.triggerAnimation(e),n.interaction.requestSetActiveMode(e)},className:Y(o&&`pointer-events-none bg-gradient-to-br ${cr[e].gradient500} !text-white`),disabled:o,children:r})},gs=E.memo(function({width:e,height:n,shapeId:r,keyPointId:i,splatapus:o}){const a=U(()=>{const S=o.document.live(),b=S.getShapeVersion(i,r);return b?S.getNormalizedCenterPointsForShapeVersion(b.id).normalizedCenterPoints:null},[i,r,o.document]);if(!a||a.length<2)return null;let l=1/0,u=1/0,c=-1/0,p=-1/0;for(const{center:S,radius:b}of a)l=Math.min(l,S.x-b),c=Math.max(c,S.x+b),u=Math.min(u,S.y-b),p=Math.max(p,S.y+b);const f=c-l,w=p-u,v=e-4*2,g=n-4*2,m=Math.min(v/f,.8),P=Math.min(g/w,.8),x=Math.min(m,P);return h.jsx("svg",{viewBox:`0 0 ${e} ${n}`,style:{width:e,height:n},children:h.jsx("g",{transform:`translate(${4+Math.max(v-f*x,0)/2}, ${4+Math.max(g-w*x,0)/2}) scale(${x}) translate(${-l}, ${-u})`,children:h.jsx("path",{d:_t(At(a)),className:"fill-stone-800"})})})}),Ln=84,Dn=80;function ys({splatapus:t}){const e=he(t.location.keyPointId),n=he(t.location.shapeId),r=Array.from(U(()=>t.document.live().keyPoints,[t])),i=Array.from(U(()=>t.document.live().shapes,[t])),o=Array.from(r).findIndex(l=>e===l.id),s=Array.from(i).findIndex(l=>n===l.id),a=vs(t);return h.jsxs("div",{className:"relative flex h-0 flex-auto flex-col gap-4 overflow-auto p-5 [-webkit-overflow-scrolling:touch]",children:[h.jsx("div",{className:"absolute top-5 left-5 z-0 w-20 rounded bg-stone-200 ring-2 ring-stone-200 transition-transform",style:{height:-16+Dn*i.length,transform:`translateX(${o*Ln}px)`}}),h.jsx("div",{className:"absolute top-5 z-0 h-16 rounded bg-stone-200 ring-2 ring-stone-200 transition-transform",style:{width:-4+Ln*(r.length+1),transform:`translateY(${s*Dn}px)`}}),i.map((l,u)=>h.jsx("div",{className:"relative flex w-max flex-col gap-2",children:h.jsxs("div",{className:"flex gap-1",children:[r.map(c=>h.jsx("button",{className:Y("overflow-none h-16 w-20 flex-none rounded border",l.id===n&&c.id===e?`${a.border500} ring-1 ${a.ring500} bg-white`:"border-stone-300 bg-white/25 hover:bg-white/50"),onClick:()=>{t.location.shapeId.update(l.id),t.location.keyPointId.update(c.id)},children:h.jsx(gs,{width:78,height:62,keyPointId:c.id,shapeId:l.id,splatapus:t})},c.id)),h.jsx("button",{className:"h-16 w-20 flex-none rounded border border-stone-300 text-xl text-stone-400 hover:bg-white/50",onClick:()=>{const c=qe.generate();t.document.update(p=>p.addKeyPoint(c,null),{lockstepLocation:p=>({...p,keyPointId:c,shapeId:l.id})})},children:"+"})]})},l.id)),h.jsx(fe,{className:"sticky left-0",onClick:()=>{const l=Ye.generate();t.document.update(u=>u.addShape(l),{lockstepLocation:u=>({...u,shapeId:l})})},children:"+ shape"})]})}const Ps={width:Qt},le=20,ws=h.jsx("svg",{viewBox:`0 0 ${le} ${le}`,className:"flex-none",style:{width:le,height:le},children:h.jsx("path",{className:"fill-stone-100",d:["M 0,0",`L ${le},0`,`L ${le},${le}`,`Q ${le},0 0,0`,"Z"].join(" ")})});function xs({topBarRight:t,topBarLeft:e,rightBar:n,bottomBarLeft:r,bottomBarRight:i,splatapus:o}){const s=he(o.viewport.isSidebarOpen);return h.jsxs("div",{className:"pointer-events-none absolute inset-0 z-20 flex flex-col items-stretch",children:[h.jsxs("div",{className:"pointer-events-auto flex flex-none items-center justify-between gap-3 bg-stone-100 px-3 py-2",children:[h.jsx("h1",{className:"order-1 flex-1 font-bold tracking-wide text-stone-600",children:"splatapus"}),h.jsx("div",{className:"order-2 flex flex-1 items-center justify-center gap-2",children:e}),h.jsx("div",{className:"order-3 flex flex-1 items-center justify-end gap-2",children:t})]}),h.jsxs(Ae,{className:"flex flex-auto items-start justify-end",show:s,enter:"transition",enterFrom:"translate-x-80",enterTo:"translate-x-0",leave:"transition",leaveFrom:"translate-0",leaveTo:"translate-x-80",children:[ws,h.jsx("div",{className:"pointer-events-auto flex h-full flex-col bg-stone-100",style:Ps,children:n})]}),h.jsx("div",{className:"absolute bottom-0 left-0",children:r}),h.jsx("div",{className:"absolute bottom-0 right-0 transition-transform",style:{transform:`translateX(${-Qt}px)`},children:i})]})}function Ss({splatapus:t}){const e=U(()=>G.canUndo(t.undoStack.live()),[t]),n=U(()=>G.canRedo(t.undoStack.live()),[t]),r=Pn(t.vfx,"undo",()=>({keyFrames:{transform:["rotate(0)","rotate(-360deg)"]},duration:300,easing:Sn.DEFAULT})),i=Pn(t.vfx,"redo",()=>({keyFrames:{transform:["rotate(0)","rotate(360deg)"]},duration:300,easing:Sn.DEFAULT}));return h.jsxs("div",{className:"pointer-events-auto pb-2 pl-3",children:[h.jsx(fe,{disabled:!e,className:Y("transition-all duration-300",e?"pointer-events-auto ease-out-back":n?"pointer-events-none opacity-50":"pointer-events-none scale-0 opacity-0 ease-in-back"),onClick:()=>t.undoStack.update(o=>G.undo(o,t.vfx)),iconLeft:h.jsx("div",{className:"mt-[2px] h-3 w-3 transition-transform duration-300 ease-in-out",ref:r,children:h.jsx(qr,{size:12})}),children:"undo"}),h.jsx(fe,{disabled:!n,className:Y("transition-all duration-300",n?"pointer-events-auto ease-out-back-md":"scale-0 opacity-0 ease-in-back-md"),onClick:()=>t.undoStack.update(o=>G.redo(o,t.vfx)),iconRight:h.jsx("div",{className:"mt-[2px] h-3 w-3 transition-transform duration-300 ease-in-out",ref:i,children:h.jsx(Yr,{size:12})}),children:"redo"})]})}function bs(){j.UNIT;{const t=Ji("autosave");if(t.ok)return t.value;console.error(`Error loading autosave: ${t.error}`)}return ur()}function Es(){const[t,e]=d.useState(null),n=Hi(bs),r=Pr(t,i=>{const o=wr(i);return n.screenSize.update(o),o});return h.jsx("div",{ref:e,className:"absolute inset-0 touch-none overflow-hidden",children:r&&h.jsx(Is,{splatapus:n})})}function Is({splatapus:t}){const e=d.useRef(null);d.useEffect(()=>{const r=Ne(e.current,"Assertion Error: canvasRef.current");return r.addEventListener("wheel",t.onWheel,{passive:!1}),window.addEventListener("keydown",t.onKeyDown),window.addEventListener("keyup",t.onKeyUp),()=>{r.removeEventListener("wheel",t.onWheel),window.removeEventListener("keydown",t.onKeyDown),window.removeEventListener("keyup",t.onKeyUp)}},[t]),d.useEffect(()=>ct(dt.idle,()=>{Zi("autosave",{document:t.document.live(),location:t.location.state.live()})}),[t]);const n=he(t.interaction.activeMode);return h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"absolute inset-0",ref:e,onPointerDown:t.onPointerDown,onPointerMove:t.onPointerMove,onPointerUp:t.onPointerUp,onPointerCancel:t.onPointerCancel,children:[h.jsx(is,{splatapus:t}),h.jsx(ht.Overlay,{splatapus:t,mode:n.type===$.Rig?n:null})]}),h.jsx(xs,{topBarLeft:h.jsx(ms,{splatapus:t}),topBarRight:h.jsx(cs,{splatapus:t}),rightBar:h.jsx(ys,{splatapus:t}),bottomBarLeft:h.jsx(Ss,{splatapus:t}),bottomBarRight:h.jsx(ii,{}),splatapus:t}),!1]})}const Cs=Ne(document.getElementById("root"),'Assertion Error: document.getElementById("root")');yr(Cs).render(h.jsx(E.StrictMode,{children:h.jsx(Es,{})}));
