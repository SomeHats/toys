var ct=Object.getPrototypeOf;var lt=Reflect.get;var F=(r,t,e)=>lt(ct(r),e,t);import{y as ut,k as $,Z as q,Y as H}from"./chunk_utils.CSiPn6yw.js";/* empty css                       */import{j as v,c as dt}from"./chunk_client.CotzxIPX.js";import{b as X}from"./chunk_assert.pxkjFBOg.js";import{S as B,V as E,R as tt}from"./chunk_Vector2.BFoa__dl.js";import{u as K}from"./chunk_useGestureDetector.Drc08ScY.js";import{g as ht,s as ft}from"./chunk_storage.BtxlEzFH.js";import{S as Y}from"./chunk_svgPathBuilder.tqI_yD_n.js";import{B as pt}from"./chunk_Button.KyMowPGE.js";import{L as W}from"./chunk_Line2.BnGSeyu4.js";import{I as mt}from"./chunk_Ids.gQRklNmK.js";import{a as Z,c as gt,r as vt,t as et}from"./chunk_index.BVMwOSmr.js";import{r as yt,R as Pt}from"./chunk_index.C5eOxiyT.js";import"./chunk_useResizeObserver.DnDEPOOq.js";import"./chunk_ResizeObserver.C8OzoCMD.js";import"./chunk_useMergedRefs.MPIvL6fk.js";import"./chunk_theme.DQE7OmCU.js";import"./chunk_EventEmitter.BsO-_0un.js";import"./chunk_index.ZX3Pv0I0.js";import"./chunk__commonjsHelpers.Cpj98o6Y.js";function wt(){function r(c,i){return function(d){(function(f,n){if(f.v)throw Error("attempted to call addInitializer after decoration was finished")})(i),u(d,"An initializer"),c.push(d)}}function t(c,i){if(!c(i))throw new TypeError("Attempted to access private element on non-instance")}function e(c,i,d,f,n,A,p,x,I){var s;switch(n){case 1:s="accessor";break;case 2:s="method";break;case 3:s="getter";break;case 4:s="setter";break;default:s="field"}var a,m,o={kind:s,name:p?"#"+i:bt(i),static:A,private:p},b={v:!1};if(n!==0&&(o.addInitializer=r(f,b)),p||n!==0&&n!==2)if(n===2)a=function(l){return t(I,l),d.value};else{var h=n===0||n===1;(h||n===3)&&(a=p?function(l){return t(I,l),d.get.call(l)}:function(l){return d.get.call(l)}),(h||n===4)&&(m=p?function(l,k){t(I,l),d.set.call(l,k)}:function(l,k){d.set.call(l,k)})}else a=function(l){return l[i]},n===0&&(m=function(l,k){l[i]=k});var j=p?I.bind():function(l){return i in l};o.access=a&&m?{get:a,set:m,has:j}:a?{get:a,has:j}:{set:m,has:j};try{return c(x,o)}finally{b.v=!0}}function u(c,i){if(typeof c!="function")throw new TypeError(i+" must be a function")}function y(c,i){var d=typeof i;if(c===1){if(d!=="object"||i===null)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");i.get!==void 0&&u(i.get,"accessor.get"),i.set!==void 0&&u(i.set,"accessor.set"),i.init!==void 0&&u(i.init,"accessor.init")}else if(d!=="function")throw new TypeError((c===0?"field":c===10?"class":"method")+" decorators must return a function or void 0")}function P(c){return function(i){c(this,i)}}function w(c,i,d,f,n,A,p,x,I){var s,a,m,o,b,h,j,l,k=d[0];if(p?(n===0||n===1?(s={get:(b=d[3],function(){return b(this)}),set:P(d[4])},m="get"):n===3?(s={get:d[3]},m="get"):n===4?(s={set:d[3]},m="set"):s={value:d[3]},n!==0&&(n===1&&_(s.set,"#"+f,"set"),_(s[m||"value"],"#"+f,m))):n!==0&&(s=Object.getOwnPropertyDescriptor(i,f)),n===1?o={get:s.get,set:s.set}:n===2?o=s.value:n===3?o=s.get:n===4&&(o=s.set),typeof k=="function")(h=e(k,f,s,x,n,A,p,o,I))!==void 0&&(y(n,h),n===0?a=h:n===1?(a=h.init,j=h.get||o.get,l=h.set||o.set,o={get:j,set:l}):o=h);else for(var M=k.length-1;M>=0;M--){var S;(h=e(k[M],f,s,x,n,A,p,o,I))!==void 0&&(y(n,h),n===0?S=h:n===1?(S=h.init,j=h.get||o.get,l=h.set||o.set,o={get:j,set:l}):o=h,S!==void 0&&(a===void 0?a=S:typeof a=="function"?a=[a,S]:a.push(S)))}if(n===0||n===1){if(a===void 0)a=function(D,T){return T};else if(typeof a!="function"){var O=a;a=function(D,T){for(var G=T,V=0;V<O.length;V++)G=O[V].call(D,G);return G}}else{var at=a;a=function(D,T){return at.call(D,T)}}c.push(a)}n!==0&&(n===1?(s.get=o.get,s.set=o.set):n===2?s.value=o:n===3?s.get=o:n===4&&(s.set=o),p?n===1?(c.push(function(D,T){return o.get.call(D,T)}),c.push(function(D,T){return o.set.call(D,T)})):n===2?c.push(o):c.push(function(D,T){return o.call(D,T)}):Object.defineProperty(i,f,s))}function g(c,i,d){for(var f,n,A,p=[],x=new Map,I=new Map,s=0;s<i.length;s++){var a=i[s];if(Array.isArray(a)){var m,o,b=a[1],h=a[2],j=a.length>3,l=b>=5,k=d;if(l?(m=c,(b-=5)!=0&&(o=n=n||[]),j&&!A&&(A=function(O){return kt(O)===c}),k=A):(m=c.prototype,b!==0&&(o=f=f||[])),b!==0&&!j){var M=l?I:x,S=M.get(h)||0;if(S===!0||S===3&&b!==4||S===4&&b!==3)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+h);!S&&b>2?M.set(h,b):M.set(h,!0)}w(p,m,a,h,b,l,j,o,k)}}return C(p,f),C(p,n),p}function C(c,i){i&&c.push(function(d){for(var f=0;f<i.length;f++)i[f].call(d);return d})}return function(c,i,d,f){return{e:g(c,i,f),get c(){return function(n,A){if(A.length>0){for(var p=[],x=n,I=n.name,s=A.length-1;s>=0;s--){var a={v:!1};try{var m=A[s](x,{kind:"class",name:I,addInitializer:r(p,a)})}finally{a.v=!0}m!==void 0&&(y(10,m),x=m)}return[x,function(){for(var o=0;o<p.length;o++)p[o].call(x)}]}}(c,d)}}}}function nt(r,t,e,u){return(nt=wt())(r,t,e,u)}function bt(r){var t=Et(r,"string");return typeof t=="symbol"?t:t+""}function Et(r,t){if(typeof r!="object"||!r)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var u=e.call(r,t);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function _(r,t,e){typeof t=="symbol"&&(t=(t=t.description)?"["+t+"]":"");try{Object.defineProperty(r,"name",{configurable:!0,value:e?e+" "+t:t})}catch{}return r}function kt(r){if(Object(r)!==r)throw TypeError("right-hand side of 'in' should be an object, got "+(r!==null?typeof r:"null"));return r}function At(r,t){const e=new WeakMap;return t.addInitializer(function(){console.log("createComputed",{this:this,compute:r,context:t}),e.set(this,gt(String(t.name),()=>r.call(this)))}),function(){return X(e.get(this),"Assertion Error: computeds.get(this)").get()}}function rt(r){let t;const u=class u{constructor(P){this.atoms=void t(this);const w={};for(const[g,C]of ut(P))w[g]=Z(g,C);this.atoms=w}get serialized(){const P={};for(const w of $(r)){const g=this.atoms[w].get();if(g.serialized){P[w]=g.serialized();continue}P[w]=g}return P}};[t]=nt(u,[[At,3,"serialized"]],[]).e;let e=u;for(const y of $(r))Object.defineProperty(e.prototype,y,{get(){return this.atoms[y].value},set(P){this.atoms[y].set(P)}});return e.modelSchema=B.object(r),e}class jt{constructor(){this.pointer=Z("Inputs.pointer",E.ZERO),this.events={onPointerMove:t=>{t.isPrimary&&this.pointer.set(E.fromEvent(t))},onPointerDown:t=>{t.isPrimary&&this.pointer.set(E.fromEvent(t))},onPointerUp:t=>{t.isPrimary&&this.pointer.set(E.fromEvent(t))}}}}class st{constructor(t,e){this.parent=t,this.app=e,this._child=Z("State.child",null)}clear(){this._child.set(null)}enter(t,...e){const u=new t(this,...e);return this._child.set(u),u}get state(){return this._child.get()}get path(){return this.state?`${this.name}.${this.state.path}`:this.name}onPointerDown(t){var e;(e=this.state)==null||e.onPointerDown(t)}onPointerMove(t){var e;(e=this.state)==null||e.onPointerMove(t)}onPointerUp(t){var e;(e=this.state)==null||e.onPointerUp(t)}onPointerCancel(t){var e;(e=this.state)==null||e.onPointerCancel(t)}}class ot extends st{constructor(t){super(t,t.app)}transitionTo(t,...e){return this.parent.enter(t,...e)}exit(){this.parent.clear()}}class xt extends st{constructor(t){super(null,t),this.name="root",this.enter(J)}clear(){this.enter(J)}}class J extends ot{constructor(){super(...arguments),this.name="idle"}onPointerDown(t){const e=this.app.createWire(E.fromEvent(t));this.transitionTo(It,"end",e)}}class It extends ot{constructor(t,e,u){super(t),this.handle=e,this.wire=u,this.name="DraggingHandle"}onPointerMove(t){this.wire.end=E.fromEvent(t)}onPointerUp(t){this.exit()}}const Q=H(60),it=new mt("wire"),z=class z extends rt({id:it.schema,start:E.schema,end:E.schema}){get startAngle(){const t=this.start.angleTo(this.end);return Math.round(t/Q)*Q}get segments(){const t=this.start.lerp(this.end,.5),e=this.start.angleTo(t)-this.startAngle;console.log({angle:q(this.start.angleTo(this.end)),angleToCenter:q(e),startAngle:q(this.startAngle)});const u=W.fromAngleAndPoint(this.startAngle,this.start),y=W.fromAngleAndPoint(this.startAngle+H(60),t),P=W.fromAngleAndPoint(this.startAngle-H(60),t),w=y.pointAtIntersectionWith(u),g=P.pointAtIntersectionWith(u),C=this.start.distanceTo(w)<this.start.distanceTo(g)?y:P,c=W.fromAngleAndPoint(this.startAngle,this.end);return[this.start,u.pointAtIntersectionWith(C),C.pointAtIntersectionWith(c),this.end]}};z.schema=F(z,z,"modelSchema").transform(t=>tt.ok(new z(t)),B.cannotValidate("Wire"),t=>t.serialized);let U=z;const L=class L extends rt({wires:B.arrayOf(U.schema)}){constructor(){super(...arguments),this.inputs=new jt,this.state=new xt(this),this.events={onPointerDown:t=>{this.inputs.events.onPointerDown(t),this.state.onPointerDown(t)},onPointerMove:t=>{this.inputs.events.onPointerMove(t),this.state.onPointerMove(t)},onPointerUp:t=>{this.inputs.events.onPointerUp(t),this.state.onPointerUp(t)},onPointerCancel:t=>{this.state.onPointerCancel(t)}}}static createEmpty(){return new L({wires:[]})}reset(){this.wires=[]}createWire(t){const e=new U({id:it.generate(),start:t,end:t});return this.wires=[...this.wires,e],e}removeWire(t){this.wires=this.wires.filter(e=>e!==t)}};L.schema=F(L,L,"modelSchema").transform(t=>tt.ok(new L(t)),B.cannotValidate("WiresApp"),t=>t.serialized);let N=L;const St="action-gradient",R=ht("wiresApp",N.schema,N.createEmpty);vt("save",()=>{ft("wiresApp",N.schema,R)},{scheduleEffect(r){window.requestIdleCallback?window.requestIdleCallback(()=>{console.log("idle"),r()}):window.requestAnimationFrame(r)}});const Tt=et(function(){return yt.useEffect(()=>{window.app=R,window.reset=()=>{R.wires=[]}}),v.jsxs(v.Fragment,{children:[v.jsxs("svg",{className:"absolute inset-0 isolate h-full w-full bg-white",...R.events,children:[v.jsx("radialGradient",{id:St}),R.wires.map(t=>v.jsx(Dt,{wire:t},t.id))]}),v.jsx("div",{className:"pointer-events-none absolute inset-0 bg-stone-50 mix-blend-darken"}),v.jsxs("div",{className:"pointer-events-none absolute inset-0 p-3",children:[v.jsx(pt,{onClick:()=>R.reset(),className:"pointer-events-auto",children:"reset"}),v.jsx("div",{children:R.state.path})]})]})}),Dt=et(function({wire:t}){const e=K({onDragStart:y=>{y.stopPropagation();const P=t.start,w=E.fromEvent(y).sub(t.start);return{couldBeTap:!1,pointerCapture:!0,onMove:g=>{t.start=E.fromEvent(g).sub(w)},onEnd:g=>{t.start=E.fromEvent(g).sub(w)},onCancel:()=>{t.start=P}}}}),u=K({onDragStart:y=>{y.stopPropagation();const P=t.end,w=E.fromEvent(y).sub(t.end);return{couldBeTap:!1,pointerCapture:!0,onMove:g=>{t.end=E.fromEvent(g).sub(w)},onEnd:g=>{t.end=E.fromEvent(g).sub(w)},onCancel:()=>{t.end=P}}}});return v.jsxs(v.Fragment,{children:[v.jsx("path",{d:Y.straightThroughPoints(t.segments).toString(),className:"fill-none stroke-slate-800 opacity-30 mix-blend-color-burn",strokeWidth:20,strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("path",{d:Y.straightThroughPoints(t.segments).toString(),className:"fill-none stroke-fuchsia-400",strokeWidth:8,strokeLinecap:"round",strokeLinejoin:"round"}),v.jsx("circle",{...e.events,cx:t.start.x,cy:t.start.y,r:8,className:"fill-transparent stroke-transparent stroke-1 hover:stroke-blue-500"}),v.jsx("circle",{...u.events,cx:t.end.x,cy:t.end.y,r:8,className:"fill-transparent stroke-transparent stroke-1 hover:stroke-blue-500"})]})}),Ct=X(document.getElementById("root"),'Assertion Error: document.getElementById("root")');dt(Ct).render(v.jsx(Pt.StrictMode,{children:v.jsx(Tt,{})}));
