!function(){function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},i={},r=t.parcelRequire0561;null==r&&((r=function(e){if(e in n)return n[e].exports;if(e in i){var t=i[e];delete i[e];var r={id:e,exports:{}};return n[e]=r,t.call(r.exports,r,r.exports),r.exports}var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){i[e]=t},t.parcelRequire0561=r);var o=r("diH60"),s=r("i9QUB"),a=r("eUMMJ"),u=(o=r("diH60"),r("bApi3")),c=r("a5M8K"),l=r("ao5QL"),h=(a=r("eUMMJ"),r("8pNpe")),d=function(){"use strict";function e(t,n,i,r){a.classCallCheck(this,e);var o=3*t,s=3*(i-t)-o,u=3*n,c=3*(r-n)-u;this.ax=1-o-s,this.bx=s,this.cx=o,this.ay=1-u-c,this.by=c,this.cy=u}return a.createClass(e,[{key:"sampleCurveX",value:function(e){return((this.ax*e+this.bx)*e+this.cx)*e}},{key:"sampleCurveY",value:function(e){return((this.ay*e+this.by)*e+this.cy)*e}},{key:"sampleCurveDerivativeX",value:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx}},{key:"solveCurveX",value:function(t,n){for(var i=t,r=0;r<e.NEWTON_METHOD_ITERATIONS;r++){var o=this.sampleCurveX(i);if(h.approxEq(o,t,n))return i;var s=this.sampleCurveDerivativeX(i);if(h.approxEq(s,0,1e-6))break;i-=(o-t)/s}var a=0,u=1;if((i=t)<a)return a;if(i>u)return u;for(;a<u;){o=this.sampleCurveX(i);if(h.approxEq(o,t,n))return i;t>o?a=i:u=i,i=(u-a)/2+a}return i}},{key:"solve",value:function(t,n){var i=void 0===n?e.DEFAULT_EPSILON:n;return this.sampleCurveY(this.solveCurveX(t,i))}}]),e}();d.NEWTON_METHOD_ITERATIONS=8,d.DEFAULT_EPSILON=1e-6;var f,g,_=function(e){return e},v=function(e){return Math.sin(e/1*(.5*Math.PI))},p=function(e){var t=void 0===e?1.70158:e;return function(e){return 1*e*e*((t+1)*e-t)}},m=(h=r("8pNpe"),a=r("eUMMJ"),u=r("bApi3"),l=r("ao5QL"),c=r("a5M8K"),h=r("8pNpe"),function(e){"use strict";function t(e){var n,i=e.x,r=e.y,o=e.startRadius,s=e.endRadius,u=e.duration,l=e.color,h=e.easeRadius,d=void 0===h?_:h,f=e.easeOpacity,g=void 0===f?_:f,v=e.removeOnComplete,p=void 0!==v&&v;return a.classCallCheck(this,t),(n=a.possibleConstructorReturn(this,a.getPrototypeOf(t).call(this)))._circle=new c.default(i,r,o),n._startRadius=o,n._endRadius=s,n._duration=u,n._color=l,n._progress=0,n._easeRadius=d,n._easeOpacity=g,n._removeOnComplete=p,n}return a.inherits(t,e),a.createClass(t,[{key:"update",value:function(e){var t=e/this._duration;this._progress=Math.min(1,this._progress+t),this._circle=this._circle.withRadius(h.lerp(this._startRadius,this._endRadius,this._easeRadius(this._progress))),1===this._progress&&this._removeOnComplete&&this.getScene().removeChild(this)}},{key:"draw",value:function(e){e.beginPath();var t=this._easeOpacity(this._progress);e.fillStyle=this._color.fade(t).toString(),l.circle(e,this._circle.center.x,this._circle.center.y,this._circle.radius),e.fill()}}]),t}(u.default)),y=r("aG1uz"),C=(new(e(y))("#F8FFE5"),new(e(y))("#06D6A0")),R=(new(e(y))("#1B9AAA"),new(e(y))("#EF476F")),T=new(e(y))("#FFC43D");a=r("eUMMJ"),h=r("8pNpe");(g=f||(f={})).IN="in",g.OUT="out";var k=f,S=function(){"use strict";function e(){a.classCallCheck(this,e),this.incoming=[],this.outgoing=[]}return a.createClass(e,[{key:"add",value:function(e,t){switch(t){case k.IN:this.addIncoming(e);break;case k.OUT:this.addOutgoing(e);break;default:throw new Error("unknow connection direction ".concat(t))}}},{key:"addIncoming",value:function(e){this.incoming.push(e)}},{key:"addOutgoing",value:function(e){this.outgoing.push(e)}},{key:"sampleIncoming",value:function(){return h.sample(this.incoming)}},{key:"sampleOutgoing",value:function(){return h.sample(this.outgoing)}}]),e}(),A=R.lighten(.2).desaturate(.5),P=R.darken(.2),w=R.lighten(.2).fade(.4),O=function(e){"use strict";function t(e,n,i){var r,o=void 0===i?1e3:i;return a.classCallCheck(this,t),(r=a.possibleConstructorReturn(this,a.getPrototypeOf(t).call(this))).isDestination=!0,r._timer=0,r._connectionSet=new S,r._circle=new c.default(e,n,20),r._visualConnectionCircle=new c.default(e,n,30),r._cooldown=o,r}return a.inherits(t,e),a.createClass(t,[{key:"position",get:function(){return this._circle.center}},{key:"canConsumeTraveller",get:function(){return this._timer>=this._cooldown}},{key:"incomingConnections",get:function(){return this._connectionSet.incoming}},{key:"outgoingConnections",get:function(){return this._connectionSet.outgoing}},{key:"getVisualConnectionPointAtAngle",value:function(e){return this._visualConnectionCircle.pointOnCircumference(e)}},{key:"getAllReachableNodes",value:function(e){return(void 0===e?new Set:e).add(this),[this]}},{key:"connectTo",value:function(e,t){this._connectionSet.add(e,t)}},{key:"consumeTraveller",value:function(){o.assert(this.canConsumeTraveller,"must be ready to consumer traveller"),this._resetTimer(),this._pulse()}},{key:"update",value:function(e){this._timer=h.constrain(0,this._cooldown,this._timer+e)}},{key:"draw",value:function(e){var t=this._timer/this._cooldown,n=h.constrain(0,1,h.mapRange(0,150,1,0,this._timer)),i=A.mix(P,n);e.beginPath(),e.fillStyle=i.toString(),l.circle(e,this._circle.center.x,this._circle.center.y,this._circle.radius),e.fill(),e.beginPath(),e.fillStyle=P.toString(),e.moveTo(this._circle.center.x,this._circle.center.y),l.circle(e,this._circle.center.x,this._circle.center.y,this._circle.radius*t),e.fill()}},{key:"_resetTimer",value:function(){this._timer=0}},{key:"_pulse",value:function(){var e;this.getScene().addChildBefore(this,new m({x:this._circle.center.x,y:this._circle.center.y,endRadius:20,startRadius:25,duration:500,color:w,easeRadius:p(4),easeOpacity:(e=_,function(t){return e(1-t)}),removeOnComplete:!0}))}}]),t}(u.default),b=(a=r("eUMMJ"),u=r("bApi3"),c=r("a5M8K"),l=r("ao5QL"),h=r("8pNpe"),a=r("eUMMJ"),o=r("diH60"),u=r("bApi3"),c=r("a5M8K"),r("54lVR")),E=(h=r("8pNpe"),a=r("eUMMJ"),a=r("eUMMJ"),o=r("diH60"),"$$AbstractSceneSystem$$"),x=function(){"use strict";function e(){a.classCallCheck(this,e),this.scene=null,o.assert(this.constructor!==e,"SceneSystem is an abstract class that must be extended"),o.assert(this.constructor.systemName!==E,"classes extending SceneSystem must override SceneSystem.systemName")}return a.createClass(e,[{key:"getScene",value:function(){return o.assert(this.scene,"scene is required"),this.scene}},{key:"afterAddToScene",value:function(e){this.scene=e}},{key:"beforeRemoveFromScene",value:function(e){this.scene=null}},{key:"beforeUpdate",value:function(e){}},{key:"afterUpdate",value:function(e){}},{key:"beforeDraw",value:function(e,t){}},{key:"afterDraw",value:function(e,t){}}]),e}();x.systemName=E;var F=r("REUuP"),I=r("7B1qO"),N=function(e){"use strict";function t(){return a.classCallCheck(this,t),a.possibleConstructorReturn(this,a.getPrototypeOf(t).apply(this,arguments))}return a.inherits(t,e),a.createClass(t,[{key:"removeTraveller",value:function(e){this._quadTree.remove(e)}},{key:"afterAddToScene",value:function(e){a.get(a.getPrototypeOf(t.prototype),"afterAddToScene",this).call(this,e),this._quadTree=new F.default(I.default.fromLeftTopRightBottom(0,0,e.width,e.height),(function(e){return e.position}))}},{key:"beforeUpdate",value:function(){var e=this.getScene();this._quadTree.clear(),e.children.forEach(function(e){e instanceof $&&this._quadTree.insert(e)}.bind(this))}},{key:"findTravellersInCircle",value:function(e){return this._quadTree.findItemsInCircle(e)}}]),t}(x);N.systemName="TravellerFinder";a=r("eUMMJ"),o=r("diH60"),b=r("54lVR"),h=r("8pNpe"),o=r("diH60");var D={getNextRoad:function(e,t){var n=new Set(e.getAllReachableNodes());n.add(e),o.assert(n.has(t),"destination must be reachable");var i=new Map,r=new Map;for(i.set(e,0);n.size;){var s=D._nodeWithShortestDistance(n,i),a=s.node,u=s.cost;if(n.delete(a),a===t)return D._nextRoadFromRoute(r,e,t);D._updateNeighbours(a,i,u,r)}throw new Error("unreachable i hope")},_nodeWithShortestDistance:function(e,t){var n=1/0,i=null;return e.forEach((function(e){var r=t.get(e);null!=r&&r<=n&&(n=r,i=e)})),o.assert(i,"node must be found"),{node:i,cost:n}},_updateNeighbours:function(e,t,n,i){e.outgoingConnections.forEach((function(e){var r=e.to,o=t.get(r),s=n+e.expectedTimeFromStartToEnd;(null==o||s<=o)&&(t.set(r,s),i.set(r,e))}))},_nextRoadFromRoute:function(e,t,n){for(var i=n;e.has(i);){var r=e.get(i);if(o.assert(r,"road must exist"),(i=r.from)===t)return r}throw new Error("prev road must be found")}},M=D,L=function(){"use strict";function e(t,n){a.classCallCheck(this,e),this.isDestination=!1,this._connectionSet=new S,this.position=new b.default(t,n)}return a.createClass(e,[{key:"incomingConnections",get:function(){return this._connectionSet.incoming}},{key:"outgoingConnections",get:function(){return this._connectionSet.outgoing}},{key:"canConsumeTraveller",get:function(){return!0}},{key:"consumeTraveller",value:function(e){var t=e.destination;o.assert(t,"traveller must have destination");var n=M.getNextRoad(this,t);o.assert(this.outgoingConnections.includes(n),"nextRoad must be from this intersection"),e.removeFromCurrentRoad(),n.addTravellerAtStart(e)}},{key:"getAllReachableNodes",value:function(e){var t=void 0===e?new Set:e;return t.add(this),h.uniq(h.flatten(this._connectionSet.outgoing.map((function(e){return e.getAllReachableNodes(t)}))))}},{key:"getVisualConnectionPointAtAngle",value:function(){return this.position}},{key:"getClosestOutgoingTraveller",value:function(){var e=null,t=1/0;return this.outgoingConnections.forEach((function(n){var i=n.getTravellerAfterPosition(-1);i&&i.positionOnCurrentRoad<t&&(e=i,t=i.positionOnCurrentRoad)})),e}},{key:"getClosestIncomingTraveller",value:function(){var e=null,t=1/0;return this.incomingConnections.forEach((function(n){var i=n.getTravellerBeforePosition(n.length);i&&i.distanceToEndOfCurrentRoad<t&&(e=i,t=i.distanceToEndOfCurrentRoad)})),e}},{key:"connectTo",value:function(e,t){this._connectionSet.add(e,t)}}]),e}(),U=r("ej7qu"),B=r("6zCnW"),q=r("ecJps"),J=r("cw897"),V=r("9hDxd"),X=r("27vvT");B=r("6zCnW");var H,z,W,K,Q=-200,Y=(z=void 0===(H=3)?1.70158:H,function(e){return 1*((e-=1)*e*((z+1)*e+z)+1)}),j=p(3);(K=W||(W={})).STOPPED_FOR_DESTINATION="STOPPED_FOR_DESTINATION",K.STOPPED_FOR_TRAFFIC_IN_FRONT="STOPPED_FOR_TRAFFIC_IN_FRONT",K.STOPPED_FOR_TRAFFIC_NEARBY="STOPPED_FOR_TRAFFIC_NEARBY";var $=function(e){"use strict";function t(){var e;return a.classCallCheck(this,t),(e=a.possibleConstructorReturn(this,a.getPrototypeOf(t).apply(this,arguments))).comfortableRadius=h.random(60,60),e.safeRadius=h.random(30,30),e._currentRoad=null,e._destination=null,e._positionOnCurrentRoad=0,e._speed=5,e._age=0,e._exitStartedAt=null,e._stoppedTime=0,e._forceAccelerateTimer=0,e._stopReason=null,e._stoppedFor=[],e._pal=null,e}return a.inherits(t,e),a.createClass(t,[{key:"currentRoad",get:function(){return this._currentRoad}},{key:"position",get:function(){return o.assert(this._currentRoad,"currentRoad must be defined"),this._currentRoad.getPointAtPosition(this._positionOnCurrentRoad)}},{key:"predictedStopPoint",get:function(){var e=this._currentRoad;o.assert(e,"currentRoad must be defined");var t=this._getPredictedStopPositionIfDecelerating();return this._getPredictedPointForPosition(e,t)}},{key:"predictedStopArea",get:function(){var e=this.predictedStopPoint;return new c.default(e.x,e.y,this.safeRadius)}},{key:"potentialNextPredictedStopPoint",get:function(){var e=this._currentRoad;o.assert(e,"currentRoad must be defined");var t=this._getPredictedStopPositionIfDecelerating();return this._getPredictedPointForPosition(e,t+1)}},{key:"positionOnCurrentRoad",get:function(){return this._positionOnCurrentRoad}},{key:"distanceToEndOfCurrentRoad",get:function(){return o.assert(this._currentRoad,"traveller is not on a road"),this._currentRoad.length-this._positionOnCurrentRoad}},{key:"destination",get:function(){return this._destination}},{key:"speed",get:function(){return this._speed}},{key:"isStopped",get:function(){return 0===this.speed}},{key:"stoppedTime",get:function(){return this._stoppedTime}},{key:"stopReason",get:function(){return this._stopReason}},{key:"isStoppedFor",value:function(e){return this._stoppedFor.includes(e)}},{key:"onAddedToRoad",value:function(e){this._currentRoad=e,this._positionOnCurrentRoad=0,this._destination||this._pickDestination()}},{key:"onRemovedFromRoad",value:function(){this.getScene().getSystem(N).removeTraveller(this),this._currentRoad=null}},{key:"onRemovedFromScene",value:function(){this.removeFromCurrentRoad()}},{key:"removeFromCurrentRoad",value:function(){this._currentRoad&&this._currentRoad.removeTraveller(this)}},{key:"update",value:function(e){this._age+=e,this._stopReason=null,this._stoppedFor=[];var t=this._currentRoad;o.assert(t,"current road must be defined"),this._move(e,t);var n=this._getPal();n.getComponent(B.PalAbsoluteController).setPosition(this.position,t.getAngleAtPosition(this._positionOnCurrentRoad),e/1e3),n.update(e),this._getEnterTransitionScale(),this._checkAtEndOfRoad(t),this._checkExit()}},{key:"draw",value:function(e,t){var n=this._currentRoad;o.assert(n,"current road must be defined"),this._getPal().draw(e,t)}},{key:"getSortOrder",value:function(){return this.position.y}},{key:"_isExiting",get:function(){return null!==this._exitStartedAt}},{key:"_getPal",value:function(){return this._pal||(this._pal=function(e){var t=new U.default;t.addComponent(B.PalAbsoluteController,e);var n=q.generateRandomPalConfig();return t.addComponent(J.default,n).setAnimationController(new V.default(n)),t.addComponent(X.default,n),t}(this.position)),this._pal}},{key:"_getEnterTransitionScale",value:function(){return Y(h.constrain(0,1,h.mapRange(0,400,0,1,this._age)))}},{key:"_getExitTransitionScale",value:function(){return null===this._exitStartedAt?1:1-j(h.constrain(0,1,h.mapRange(this._exitStartedAt,this._exitStartedAt+400,0,1,this._age)))}},{key:"_getPredictedStopPositionIfDecelerating",value:function(){var e=-this._speed/Q;return this._positionOnCurrentRoad+this._speed*e+-100*e*e}},{key:"_getPredictedPointForPosition",value:function(e,t){if(t<=e.length)return e.getPointAtPosition(t);var n=t-e.length,i=e.getAngleAtPosition(e.length);return b.default.fromPolar(i,n).add(e.end)}},{key:"_pickDestination",value:function(){if(this._currentRoad){var e=this._currentRoad.getAllReachableNodes().filter((function(e){return e.isDestination})),t=h.sample(e);this._destination=t}}},{key:"_move",value:function(e,t){var n=e/1e3;this._forceAccelerateTimer=h.constrain(0,100,this._forceAccelerateTimer-e),this._forceAccelerateTimer<=0&&this._shouldDecelerate(t)?this._accelerate(Q,n,t):this._accelerate(200,n,t),0===this._speed?this._stoppedTime+=e:this._stoppedTime=0}},{key:"_shouldDecelerate",value:function(e){var t=this._getPredictedStopPositionIfDecelerating();if(e.to===this._destination&&e.length+0<t)return this._stopReason=W.STOPPED_FOR_DESTINATION,!0;var n=e.getTravellerAfterPosition(this._positionOnCurrentRoad),i=t+this.comfortableRadius;if(n&&n.positionOnCurrentRoad<i)return this._stopReason=W.STOPPED_FOR_TRAFFIC_IN_FRONT,this._stoppedFor.push(n),!0;if(e.to instanceof L){var r=e.to,o=r.getClosestOutgoingTraveller();if(o)if(e.length+o.positionOnCurrentRoad<i)return this._stopReason=W.STOPPED_FOR_TRAFFIC_IN_FRONT,this._stoppedFor.push(o),!0;var s=r.getClosestIncomingTraveller();if(s&&s!==this)if(e.length-s.distanceToEndOfCurrentRoad<i)return this._stopReason=W.STOPPED_FOR_TRAFFIC_IN_FRONT,this._stoppedFor.push(s),!0}return!!this._shouldDecelerateForNearbyTravellers(e)&&(this._stopReason=W.STOPPED_FOR_TRAFFIC_NEARBY,!0)}},{key:"_shouldDecelerateForNearbyTravellers",value:function(e){var t=this.getScene().getSystem(N),n=this.predictedStopArea,i=n.center,r=this.potentialNextPredictedStopPoint,o=n.withRadius(200),s=t.findTravellersInCircle(o),a=!0,u=!1,c=void 0;try{for(var l,h=s[Symbol.iterator]();!(a=(l=h.next()).done);a=!0){var d=l.value;if(d!==this){var f=d.predictedStopArea,g=f.center;if(n.intersectsCircle(f)){var _=d.potentialNextPredictedStopPoint,v=i.distanceTo(f.center);if(!(r.distanceTo(_)>v)){var p=i.distanceTo(_),m=g.distanceTo(r);if(!(p<m||p-m<.15)){if(p===m)return Math.random()<.5;if(this._stoppedTime>1500&&!d.isStopped)return this._forceAcceleration(),!1;d.isStoppedFor(this)||this._stoppedFor.push(d)}}}}}}catch(e){u=!0,c=e}finally{try{a||null==h.return||h.return()}finally{if(u)throw c}}return!!this._stoppedFor.length}},{key:"_forceAcceleration",value:function(){this._forceAccelerateTimer=100}},{key:"_accelerate",value:function(e,t,n){var i=this._speed;this._speed=h.constrain(0,80,this._speed+e*t);var r=(i+this._speed)/2;this._positionOnCurrentRoad=h.constrain(0,n.length,this._positionOnCurrentRoad+r*t)}},{key:"_checkAtEndOfRoad",value:function(e){if(this._positionOnCurrentRoad===e.length){if(this._isExiting)return;this._onReachEndOfCurrentRoad(e)}}},{key:"_checkExit",value:function(){this._isExiting&&(o.assert(this._exitStartedAt),this._age>=this._exitStartedAt+400&&this._onExit())}},{key:"_onReachEndOfCurrentRoad",value:function(e){var t=e.to,n=this._destination;t.canConsumeTraveller&&(t.consumeTraveller(this),t===n&&this._onReachDestination())}},{key:"_onReachDestination",value:function(){this._exit()}},{key:"_onExit",value:function(){this.getScene().removeChild(this)}},{key:"_exit",value:function(){this._exitStartedAt=this._age}}]),t}(u.default);$.MAX_SPEED=80,$.StopReason=W;a=r("eUMMJ"),u=r("bApi3"),a=r("eUMMJ"),o=r("diH60"),h=r("8pNpe"),c=r("a5M8K");var G,Z=r("laB6d"),ee=r("bJddX"),te=r("7RPk8"),ne=function(){"use strict";function e(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];a.classCallCheck(this,e),this.segments=[],this.addSegments.apply(this,a.toConsumableArray(n))}return a.createClass(e,[{key:"getStart",value:function(){return this.segments[0].getStart()}},{key:"getEnd",value:function(){return this.segments[this.segments.length-1].getEnd()}},{key:"getLength",value:function(){return this.segments.reduce((function(e,t){return e+t.getLength()}),0)}},{key:"getPointAtPosition",value:function(e){var t=h.constrain(0,this.getLength(),e),n=0,i=!0,r=!1,o=void 0;try{for(var s,a=this.segments[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var u=s.value;if(t<=n+u.getLength())return u.getPointAtPosition(t-n);n+=u.getLength()}}catch(e){r=!0,o=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}throw new Error("this is supposed to be unreachable oops")}},{key:"getAngleAtPosition",value:function(e){var t=h.constrain(0,this.getLength(),e),n=0,i=!0,r=!1,o=void 0;try{for(var s,a=this.segments[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var u=s.value;if(t<=n+u.getLength())return u.getAngleAtPosition(t-n);n+=u.getLength()}}catch(e){r=!0,o=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}throw new Error("this is supposed to be unreachable oops")}},{key:"addSegment",value:function(e){var t=this.segments[this.segments.length-1];return t&&o.assert(t.getEnd().equals(e.getStart()),"segments must neatly join together - ".concat(t.getEnd().toString()," !== ").concat(e.getStart().toString())),this.segments.push(e),this}},{key:"addSegments",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.forEach(function(e){return this.addSegment(e)}.bind(this)),this}},{key:"autoRound",value:function(t){var n=this.segments.map(function(n,i){var r=0===i?null:this.segments[i-1];if(!r)return n instanceof Z.default?null:n;if(!(n instanceof Z.default))return n;if(!(r instanceof Z.default))return null;o.assert(r.getEnd().equals(n.getStart()),"segments must join");var s=r.angle,a=n.angle,u=Math.min(t,r.getLength()/2,n.getLength()/2),l=new c.default(n.getStart().x,n.getStart().y,u);return e.segmentAcrossCircle(l,s,a)}.bind(this)),i=h.compact(n),r=this.getStart(),s=this.getEnd(),a=r;return this.segments=[],i.forEach(function(e){e.getStart().equals(a)||this.addSegment(new Z.default(a,e.getStart())),this.addSegment(e),a=e.getEnd()}.bind(this)),a.equals(s)||this.addSegment(new Z.default(a,s)),this}}],[{key:"straightThroughPoints",value:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=a.toArray(n),o=r[0],s=r.slice(1),u=new e,c=!0,l=!1,h=void 0;try{for(var d,f=s[Symbol.iterator]();!(c=(d=f.next()).done);c=!0){var g=d.value;u.addSegment(new Z.default(o,g)),o=g}}catch(e){l=!0,h=e}finally{try{c||null==f.return||f.return()}finally{if(l)throw h}}return u}},{key:"segmentAcrossCircle",value:function(e,t,n){t+=Math.PI;var i=e.pointOnCircumference(t),r=e.pointOnCircumference(n),o=new te.default(e.center,i).perpendicularLineThroughPoint(i),s=new te.default(e.center,r).perpendicularLineThroughPoint(r);if(o.isParallelTo(s))return new Z.default(i,r);var a=o.pointAtIntersectionWith(s),u=i.distanceTo(a);return new ee.default(a,u,i.sub(a).angle,r.sub(a).angle)}}]),e}(),ie=(Z=r("laB6d"),l=r("ao5QL"),a=r("eUMMJ"),h=r("8pNpe"),u=r("bApi3"),c=r("a5M8K"),function(e){"use strict";function t(e,n,i){var r;return a.classCallCheck(this,t),(r=a.possibleConstructorReturn(this,a.getPrototypeOf(t).call(this)))._intersectionsByAngle={},r._incomingIntersections=new Set,r._outgoingIntersections=new Set,r._roads=[],r._circle=new c.default(e,n,i),r}return a.inherits(t,e),a.createClass(t,[{key:"position",get:function(){return this._circle.center}},{key:"onAddedToScene",value:function(e){a.get(a.getPrototypeOf(t.prototype),"onAddedToScene",this).call(this,e),this._roads.forEach((function(t){return e.addChild(t)}))}},{key:"getVisualConnectionPointAtAngle",value:function(e){return this._circle.pointOnCircumference(e)}},{key:"connectToRoadAtAngle",value:function(e,t,n){var i=this._intersectionAtAngle(t);i.connectTo(e,n);var r=n===k.IN||this._incomingIntersections.has(i),o=n===k.OUT||this._outgoingIntersections.has(i);return r&&this._incomingIntersections.add(i),o&&this._outgoingIntersections.add(i),this._intersections.forEach(function(e){if(e!==i){if(r&&this._outgoingIntersections.has(e)){var t=new ne(ne.segmentAcrossCircle(this._circle,this._circle.center.sub(i.position).angle,e.position.sub(this._circle.center).angle));this._addRoad(new ae(i,e,{path:t}))}if(o&&this._incomingIntersections.has(e)){t=new ne(ne.segmentAcrossCircle(this._circle,this._circle.center.sub(e.position).angle,i.position.sub(this._circle.center).angle));this._addRoad(new ae(e,i,{path:t}))}}}.bind(this)),i}},{key:"_intersectionAtAngle",value:function(e){var t=e.toString();if(this._intersectionsByAngle[t])return this._intersectionsByAngle[t];var n=this._createIntersectionAtAngle(e);return this._intersectionsByAngle[t]=n,n}},{key:"_createIntersectionAtAngle",value:function(e){var t=this.getVisualConnectionPointAtAngle(e);return new L(t.x,t.y)}},{key:"_intersections",get:function(){return h.compact(Object.keys(this._intersectionsByAngle).map(function(e){return this._intersectionsByAngle[e]}.bind(this)))}},{key:"_addRoad",value:function(e){this._roads.push(e),this.hasScene()&&this.getScene().addChild(e)}}]),t}(u.default)),re=T.darken(.2),oe=[5,10],se=oe.reduce((function(e,t){return e+t}),0),ae=function(e){"use strict";function t(e,n,i){var r,o=void 0===i?{}:i,s=o.points,u=o.autoRound,c=o.path;a.classCallCheck(this,t),(r=a.possibleConstructorReturn(this,a.getPrototypeOf(t).call(this))).isNode=!1,r._currentTravellers=[];var l=s?e.position.angleTo(s[0]):e.position.angleTo(n.position),h=s?n.position.angleTo(s[s.length-1]):n.position.angleTo(e.position);return r._path=c||(s?(G=ne).straightThroughPoints.apply(G,[e.getVisualConnectionPointAtAngle(l)].concat(a.toConsumableArray(s),[n.getVisualConnectionPointAtAngle(h)])):(new ne).addSegment(new Z.default(e.getVisualConnectionPointAtAngle(l),n.getVisualConnectionPointAtAngle(h)))),null!=u&&r._path.autoRound(u),e instanceof ie?r.from=e.connectToRoadAtAngle(a.assertThisInitialized(r),l,k.OUT):(r.from=e,e.connectTo(a.assertThisInitialized(r),k.OUT)),n instanceof ie?r.to=n.connectToRoadAtAngle(a.assertThisInitialized(r),h,k.IN):(r.to=n,n.connectTo(a.assertThisInitialized(r),k.IN)),r}return a.inherits(t,e),a.createClass(t,[{key:"length",get:function(){return this._path.getLength()}},{key:"start",get:function(){return this._path.getStart()}},{key:"end",get:function(){return this._path.getEnd()}},{key:"expectedTimeFromStartToEnd",get:function(){if(this._currentTravellers.length){var e=this._currentTravellers.reduce((function(e,t){return e+t.speed}),0)/this._currentTravellers.length;return this.length/e}return this.length/(.7*$.MAX_SPEED)}},{key:"canAddTravellerAtStart",value:function(){var e=this.getTravellerAfterPosition(0);return!e||e.positionOnCurrentRoad>e.comfortableRadius}},{key:"addTravellerAtStart",value:function(e){this._currentTravellers.push(e),e.onAddedToRoad(this)}},{key:"removeTraveller",value:function(e){var t=this._currentTravellers.indexOf(e);return-1!==t&&(this.removeTravellerAtIndex(t),!0)}},{key:"removeTravellerAtIndex",value:function(e){var t=this._currentTravellers[e];return this._currentTravellers.splice(e,1),t.onRemovedFromRoad(),t}},{key:"getAllReachableNodes",value:function(e){var t=void 0===e?new Set:e;return t.has(this.to)?[]:a.toConsumableArray(this.to.getAllReachableNodes(t)).concat([this.to])}},{key:"getPointAtPosition",value:function(e){return this._path.getPointAtPosition(e)}},{key:"getAngleAtPosition",value:function(e){return this._path.getAngleAtPosition(e)}},{key:"getTravellerAfterPosition",value:function(e){var t=null,n=1/0;return this._currentTravellers.forEach((function(i){var r=i.positionOnCurrentRoad-e;r<=0||r<n&&(n=r,t=i)})),t}},{key:"getTravellerBeforePosition",value:function(e){var t=null,n=1/0;return this._currentTravellers.forEach((function(i){var r=e-i.positionOnCurrentRoad;r<=0||r<n&&(n=r,t=i)})),t}},{key:"draw",value:function(e,t){e.beginPath(),e.lineCap="round",e.lineJoin="round",l.path(e,this._path);var n=this._getLineDashScale(),i=se*n;e.setLineDash(oe.map((function(e){return e*n}))),e.strokeStyle=re.toString(),e.lineDashOffset=.05*-t*n%i,e.lineWidth=3,e.stroke()}},{key:"_getLineDashScale",value:function(){var e=Math.floor(this.length/se)*se;return this.length-e<e+se-this.length?this.length/e:this.length/(e+se)}}]),t}(u.default),ue=C.lighten(.1),ce=C.darken(.1),le=C.lighten(.2).fade(.1),he=function(e){"use strict";function t(e,n,i){var r,o=void 0===i?500:i;return a.classCallCheck(this,t),(r=a.possibleConstructorReturn(this,a.getPrototypeOf(t).call(this))).isDestination=!1,r.canConsumeTraveller=!1,r._connectionSet=new S,r._circle=new c.default(e,n,20),r._visualConnectionCircle=new c.default(e,n,30),r._cooldown=o,r._timer=o,r}return a.inherits(t,e),a.createClass(t,[{key:"position",get:function(){return this._circle.center}},{key:"incomingConnections",get:function(){return this._connectionSet.incoming}},{key:"outgoingConnections",get:function(){return this._connectionSet.outgoing}},{key:"getAllReachableNodes",value:function(e){var t=void 0===e?new Set:e;return t.add(this),h.uniq(h.flatten(this._connectionSet.outgoing.map((function(e){return e.getAllReachableNodes(t)}))))}},{key:"getVisualConnectionPointAtAngle",value:function(e){return this._visualConnectionCircle.pointOnCircumference(e)}},{key:"consumeTraveller",value:function(){throw new Error("producer cannot consume traveller")}},{key:"connectTo",value:function(e,t){this._connectionSet.add(e,t)}},{key:"update",value:function(e){this._timer=h.constrain(0,this._cooldown,this._timer+e),this._timer>=this._cooldown&&this._onTimerEnd()}},{key:"draw",value:function(e){var t=this._timer/this._cooldown,n=h.constrain(0,1,h.mapRange(0,150,1,0,this._timer)),i=ue.mix(ce,n);e.beginPath(),e.fillStyle=i.toString(),l.circle(e,this._circle.center.x,this._circle.center.y,this._circle.radius),e.fill(),e.beginPath(),e.fillStyle=ce.toString(),e.moveTo(this._circle.center.x,this._circle.center.y),e.arc(this._circle.center.x,this._circle.center.y,this._circle.radius,-Math.PI/2,2*t*Math.PI-Math.PI/2,!1),e.fill(),e.beginPath(),e.fillStyle=ue.toString(),l.circle(e,this._circle.center.x,this._circle.center.y,14),e.fill()}},{key:"_resetTimer",value:function(){this._timer=0}},{key:"_onTimerEnd",value:function(){this._attemptEmitTraveller()&&(this._pulse(),this._resetTimer())}},{key:"_pulse",value:function(){this.getScene().addChildBefore(this,new m({x:this._circle.center.x,y:this._circle.center.y,startRadius:20,endRadius:35,duration:500,color:le,easeRadius:v,removeOnComplete:!0}))}},{key:"_attemptEmitTraveller",value:function(){var e=this._connectionSet.sampleOutgoing();if(!(e instanceof ae))return!1;if(e.canAddTravellerAtStart()){var t=new $;return e.addTravellerAtStart(t),this.getScene().addChild(t),!0}return!1}}]),t}(u.default),de=(b=r("54lVR"),50),fe=new s.default(800,600,window.devicePixelRatio),ge=document.getElementById("root");o.assert(ge,"#root must be present"),fe.appendTo(ge),fe.addSystem(new N),function(){var e=new O(300,550,1500),t=new O(100,450,1500),n=new O(100,250,1500),i=new he(600,150,500),r=new he(100,100,500);fe.addChild(e),fe.addChild(t),fe.addChild(n),fe.addChild(i),fe.addChild(r);var o=new ie(300,150,de),s=new ie(500,370,de),a=new ie(330,400,de);fe.addChild(o),fe.addChild(s),fe.addChild(a),fe.addChild(new ae(r,o)),fe.addChild(new ae(i,s)),fe.addChild(new ae(s,a)),fe.addChild(new ae(s,o,{points:[new b.default(400,300),new b.default(500,50)],autoRound:de})),fe.addChild(new ae(o,a)),fe.addChild(new ae(a,e)),fe.addChild(new ae(o,t)),fe.addChild(new ae(o,n))}(),fe.start()}();
//# sourceMappingURL=index.49192d35.js.map
