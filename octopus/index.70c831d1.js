!function(){function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},r={},i=t.parcelRequire0561;null==i&&((i=function(e){if(e in n)return n[e].exports;if(e in r){var t=r[e];delete r[e];var i={id:e,exports:{}};return n[e]=i,t.call(i.exports,i,i.exports),i.exports}var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){r[e]=t},t.parcelRequire0561=i);var a=i("8TSCy"),o=i("exYeM"),s=i("8qLe2");function u(e,t){e||function(e){throw new Error(e)}(t||"Assertion Error")}var c=i("aCcLp"),l=i("39Hjj"),h=(o=i("exYeM"),{});!function(){var e={}.hasOwnProperty;function t(){for(var n=[],r=0;r<arguments.length;r++){var i=arguments[r];if(i){var a=typeof i;if("string"===a||"number"===a)n.push(i);else if(Array.isArray(i)){if(i.length){var o=t.apply(null,i);o&&n.push(o)}}else if("object"===a)if(i.toString===Object.prototype.toString)for(var s in i)e.call(i,s)&&i[s]&&n.push(s);else n.push(i.toString())}}return n.join(" ")}h?(t.default=t,h=t):"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],(function(){return t})):window.classNames=t}();s=i("8qLe2");var d=o.memo((function(t){var n=t.offset,r=t.isAccidental,i=t.styles,a=t.isNoteDown,s=t.note,u=t.setRefForKey,c=r?{left:n-i.accidentalWidth/2,width:i.accidentalWidth,height:i.accidentalHeight,position:"absolute",zIndex:1,borderWidth:1.5*i.scale}:{left:n,width:i.standardWidth,height:i.standardHeight,position:"absolute",borderWidth:1.5*i.scale};return o.createElement("div",{ref:function(e){return u(e,s)},style:c,className:e(h)("border-gray-600",{"bg-black hover:bg-blue-900":r,"bg-white hover:bg-blue-200":!r,"bg-purple-800":r&&a,"bg-purple-300":!r&&a})})}));function f(e){var t=e.lowestNote,n=e.highestNote,r=e.scale,i=e.top,a=e.left,u=e.notesDown,c=e.setRefForKey,l=o.useMemo((function(){var e=45*r,i=.6*e;return{standardWidth:e,accidentalWidth:i,standardHeight:6*e,accidentalHeight:6*i,scale:r,totalWidth:7/12*(n-t)*e}}),[t,n,r]),h=l.totalWidth+16*r,f=l.standardHeight+16*r,p=0;return o.createElement("div",{className:"absolute border-gray-600 bg-gray-600",style:{width:h,height:f,borderWidth:8*r,borderRadius:8*r,top:i-f/2,left:a-h/2}},s.times(n-t,(function(e){var n=t+e,r=function(e){var t=e%12;return 1===t||3===t||6===t||8===t||10===t}(n),i=o.createElement(d,{key:n,note:n,offset:p,isAccidental:r,styles:l,isNoteDown:u.includes(n),setRefForKey:c});return p+=r?0:l.standardWidth,i})))}var p=o.memo(f),m=(o=i("exYeM"),i("d2lNW")),v=(a=i("8TSCy"),i("2TvXO")),g={};!function(e){function t(){if(t.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");(t.prototype._singleton=this)._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._nrpnBuffer=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],this._nrpnEventsEnabled=!0,this._nrpnTypes=["entry","increment","decrement"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,nrpn:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_NRPN_MESSAGES:{value:{entrymsb:6,entrylsb:38,increment:96,decrement:97,paramlsb:98,parammsb:99,nullactiveparameter:127},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1},octaveOffset:{value:0,writable:!0,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return void 0!==this.interface}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this.interface||!this.interface.sysexEnabled)}.bind(this)},nrpnEventsEnabled:{enumerable:!0,get:function(){return!!this._nrpnEventsEnabled}.bind(this),set:function(e){return this._nrpnEventsEnabled=e,this._nrpnEventsEnabled}},nrpnTypes:{enumerable:!0,get:function(){return this._nrpnTypes}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}var n=new t;function r(e){var t=this;this._userHandlers={channel:{},system:{}},this._midiInput=e,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return t._midiInput.connection}},id:{enumerable:!0,get:function(){return t._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return t._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return t._midiInput.name}},state:{enumerable:!0,get:function(){return t._midiInput.state}},type:{enumerable:!0,get:function(){return t._midiInput.type}}}),this._initializeUserHandlers(),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}function i(e){var t=this;this._midiOutput=e,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return t._midiOutput.connection}},id:{enumerable:!0,get:function(){return t._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return t._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return t._midiOutput.name}},state:{enumerable:!0,get:function(){return t._midiOutput.state}},type:{enumerable:!0,get:function(){return t._midiOutput.type}}})}t.prototype.enable=function(e,t){this.enabled||(this.supported?navigator.requestMIDIAccess({sysex:t}).then(function(t){var n,r=[],i=[];this.interface=t,this._resetInterfaceUserHandlers(),this.interface.onstatechange=function(e){r.push(e)};for(var a=t.inputs.values(),o=a.next();o&&!o.done;o=a.next())i.push(o.value.open());for(var s=t.outputs.values(),u=s.next();u&&!u.done;u=s.next())i.push(u.value.open());function c(){clearTimeout(n),this._updateInputsAndOutputs(),this.interface.onstatechange=this._onInterfaceStateChange.bind(this),"function"==typeof e&&e.call(this),r.forEach(function(e){this._onInterfaceStateChange(e)}.bind(this))}n=setTimeout(c.bind(this),200),Promise&&Promise.all(i).catch((function(e){})).then(c.bind(this))}.bind(this),function(t){"function"==typeof e&&e.call(this,t)}.bind(this)):"function"==typeof e&&e(new Error("The Web MIDI API is not supported by your browser.")))},t.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this.enabled&&(this.removeListener(),this.inputs.forEach((function(e){e.removeListener()}))),this.interface&&(this.interface.onstatechange=void 0),this.interface=void 0,this._inputs=[],this._outputs=[],this._nrpnEventsEnabled=!0,this._resetInterfaceUserHandlers()},t.prototype.addListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if("function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(e)))throw new TypeError("The specified event type is not supported.");return this._userHandlers[e].push(t),this},t.prototype.hasListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if("function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(e)))throw new TypeError("The specified event type is not supported.");for(var n=0;n<this._userHandlers[e].length;n++)if(this._userHandlers[e][n]===t)return!0;return!1},t.prototype.removeListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(void 0!==t&&"function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(0<=this._midiInterfaceEvents.indexOf(e))if(t)for(var n=0;n<this._userHandlers[e].length;n++)this._userHandlers[e][n]===t&&this._userHandlers[e].splice(n,1);else this._userHandlers[e]=[];else{if(void 0!==e)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},t.prototype.toMIDIChannels=function(e){var t;if("all"===e||void 0===e)t=["all"];else{if("none"===e)return[];t=Array.isArray(e)?e:[e]}return-1<t.indexOf("all")&&(t=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),t.map((function(e){return parseInt(e)})).filter((function(e){return 1<=e&&e<=16}))},t.prototype.getInputById=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");e=String(e);for(var t=0;t<this.inputs.length;t++)if(this.inputs[t].id===e)return this.inputs[t];return!1},t.prototype.getOutputById=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");e=String(e);for(var t=0;t<this.outputs.length;t++)if(this.outputs[t].id===e)return this.outputs[t];return!1},t.prototype.getInputByName=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.inputs.length;t++)if(~this.inputs[t].name.indexOf(e))return this.inputs[t];return!1},t.prototype.getOctave=function(e){if(null!=e&&0<=e&&e<=127)return Math.floor(Math.floor(e)/12-1)+Math.floor(n.octaveOffset)},t.prototype.getOutputByName=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.outputs.length;t++)if(~this.outputs[t].name.indexOf(e))return this.outputs[t];return!1},t.prototype.guessNoteNumber=function(e){var t=!1;if(e&&e.toFixed&&0<=e&&e<=127?t=Math.round(e):0<=parseInt(e)&&parseInt(e)<=127?t=parseInt(e):("string"==typeof e||e instanceof String)&&(t=this.noteNameToNumber(e)),!1===t)throw new Error("Invalid input value ("+e+").");return t},t.prototype.noteNameToNumber=function(e){"string"!=typeof e&&(e="");var t=e.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!t)throw new RangeError("Invalid note name.");var r=n._semitones[t[1].toUpperCase()],i=12*(parseInt(t[3])+1-Math.floor(n.octaveOffset))+r;if(-1<t[2].toLowerCase().indexOf("b")?i-=t[2].length:-1<t[2].toLowerCase().indexOf("#")&&(i+=t[2].length),i<0||127<i)throw new RangeError("Invalid note name or note outside valid range.");return i},t.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},t.prototype._updateInputs=function(){for(var e=0;e<this._inputs.length;e++){for(var t=!0,n=this.interface.inputs.values(),i=n.next();i&&!i.done;i=n.next())if(this._inputs[e]._midiInput===i.value){t=!1;break}t&&this._inputs.splice(e,1)}this.interface&&this.interface.inputs.forEach(function(e){for(var t=!0,n=0;n<this._inputs.length;n++)this._inputs[n]._midiInput===e&&(t=!1);t&&this._inputs.push(new r(e))}.bind(this))},t.prototype._updateOutputs=function(){for(var e=0;e<this._outputs.length;e++){for(var t=!0,n=this.interface.outputs.values(),r=n.next();r&&!r.done;r=n.next())if(this._outputs[e]._midiOutput===r.value){t=!1;break}t&&this._outputs.splice(e,1)}this.interface&&this.interface.outputs.forEach(function(e){for(var t=!0,n=0;n<this._outputs.length;n++)this._outputs[n]._midiOutput===e&&(t=!1);t&&this._outputs.push(new i(e))}.bind(this))},t.prototype._onInterfaceStateChange=function(e){this._updateInputsAndOutputs();var t={timestamp:e.timeStamp,type:e.port.state};this.interface&&"connected"===e.port.state?"output"===e.port.type?t.port=this.getOutputById(e.port.id):"input"===e.port.type&&(t.port=this.getInputById(e.port.id)):t.port={connection:"closed",id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this._userHandlers[e.port.state].forEach((function(e){e(t)}))},t.prototype._resetInterfaceUserHandlers=function(){for(var e=0;e<this._midiInterfaceEvents.length;e++)this._userHandlers[this._midiInterfaceEvents[e]]=[]},r.prototype.on=r.prototype.addListener=function(e,t,r){var i=this;if(void 0===t&&(t="all"),Array.isArray(t)||(t=[t]),t.forEach((function(e){if("all"!==e&&!(1<=e&&e<=16))throw new RangeError("The 'channel' parameter is invalid.")})),"function"!=typeof r)throw new TypeError("The 'listener' parameter must be a function.");if(void 0!==n.MIDI_SYSTEM_MESSAGES[e])this._userHandlers.system[e]||(this._userHandlers.system[e]=[]),this._userHandlers.system[e].push(r);else{if(void 0===n.MIDI_CHANNEL_MESSAGES[e])throw new TypeError("The specified event type is not supported.");if(-1<t.indexOf("all")){t=[];for(var a=1;a<=16;a++)t.push(a)}this._userHandlers.channel[e]||(this._userHandlers.channel[e]=[]),t.forEach((function(t){i._userHandlers.channel[e][t]||(i._userHandlers.channel[e][t]=[]),i._userHandlers.channel[e][t].push(r)}))}return this},r.prototype.hasListener=function(e,t,r){var i=this;if("function"!=typeof r)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===t&&(t="all"),t.constructor!==Array&&(t=[t]),void 0!==n.MIDI_SYSTEM_MESSAGES[e]){for(var a=0;a<this._userHandlers.system[e].length;a++)if(this._userHandlers.system[e][a]===r)return!0}else if(void 0!==n.MIDI_CHANNEL_MESSAGES[e]){if(-1<t.indexOf("all")){t=[];for(var o=1;o<=16;o++)t.push(o)}return!!this._userHandlers.channel[e]&&t.every((function(t){var n=i._userHandlers.channel[e][t];return n&&-1<n.indexOf(r)}))}return!1},r.prototype.removeListener=function(e,t,r){var i=this;if(void 0!==r&&"function"!=typeof r)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===t&&(t="all"),t.constructor!==Array&&(t=[t]),void 0!==n.MIDI_SYSTEM_MESSAGES[e])if(void 0===r)this._userHandlers.system[e]=[];else for(var a=0;a<this._userHandlers.system[e].length;a++)this._userHandlers.system[e][a]===r&&this._userHandlers.system[e].splice(a,1);else if(void 0!==n.MIDI_CHANNEL_MESSAGES[e]){if(-1<t.indexOf("all")){t=[];for(var o=1;o<=16;o++)t.push(o)}if(!this._userHandlers.channel[e])return this;t.forEach((function(t){var n=i._userHandlers.channel[e][t];if(n)if(void 0===r)i._userHandlers.channel[e][t]=[];else for(var a=0;a<n.length;a++)n[a]===r&&n.splice(a,1)}))}else{if(void 0!==e)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},r.prototype._initializeUserHandlers=function(){for(var e in n.MIDI_CHANNEL_MESSAGES)Object.prototype.hasOwnProperty.call(n.MIDI_CHANNEL_MESSAGES,e)&&(this._userHandlers.channel[e]={});for(var t in n.MIDI_SYSTEM_MESSAGES)Object.prototype.hasOwnProperty.call(n.MIDI_SYSTEM_MESSAGES,t)&&(this._userHandlers.system[t]=[])},r.prototype._onMidiMessage=function(e){if(0<this._userHandlers.system.midimessage.length){var t={target:this,data:e.data,timestamp:e.timeStamp,type:"midimessage"};this._userHandlers.system.midimessage.forEach((function(e){e(t)}))}e.data[0]<240?(this._parseChannelEvent(e),this._parseNrpnEvent(e)):e.data[0]<=255&&this._parseSystemEvent(e)},r.prototype._parseNrpnEvent=function(e){var t,r,i=e.data[0]>>4,a=15&e.data[0],o=1+a;if(1<e.data.length&&(t=e.data[1],r=2<e.data.length?e.data[2]:void 0),n.nrpnEventsEnabled&&i===n.MIDI_CHANNEL_MESSAGES.controlchange&&(t>=n.MIDI_NRPN_MESSAGES.increment&&t<=n.MIDI_NRPN_MESSAGES.parammsb||t===n.MIDI_NRPN_MESSAGES.entrymsb||t===n.MIDI_NRPN_MESSAGES.entrylsb)){var s={target:this,type:"controlchange",data:e.data,timestamp:e.timeStamp,channel:o,controller:{number:t,name:this.getCcNameByNumber(t)},value:r};if(s.controller.number===n.MIDI_NRPN_MESSAGES.parammsb&&s.value!=n.MIDI_NRPN_MESSAGES.nullactiveparameter)n._nrpnBuffer[a]=[],n._nrpnBuffer[a][0]=s;else if(1===n._nrpnBuffer[a].length&&s.controller.number===n.MIDI_NRPN_MESSAGES.paramlsb)n._nrpnBuffer[a].push(s);else if(2!==n._nrpnBuffer[a].length||s.controller.number!==n.MIDI_NRPN_MESSAGES.increment&&s.controller.number!==n.MIDI_NRPN_MESSAGES.decrement&&s.controller.number!==n.MIDI_NRPN_MESSAGES.entrymsb)if(3===n._nrpnBuffer[a].length&&n._nrpnBuffer[a][2].number===n.MIDI_NRPN_MESSAGES.entrymsb&&s.controller.number===n.MIDI_NRPN_MESSAGES.entrylsb)n._nrpnBuffer[a].push(s);else if(3<=n._nrpnBuffer[a].length&&n._nrpnBuffer[a].length<=4&&s.controller.number===n.MIDI_NRPN_MESSAGES.parammsb&&s.value===n.MIDI_NRPN_MESSAGES.nullactiveparameter)n._nrpnBuffer[a].push(s);else if(4<=n._nrpnBuffer[a].length&&n._nrpnBuffer[a].length<=5&&s.controller.number===n.MIDI_NRPN_MESSAGES.paramlsb&&s.value===n.MIDI_NRPN_MESSAGES.nullactiveparameter){n._nrpnBuffer[a].push(s);var u=[];n._nrpnBuffer[a].forEach((function(e){u.push(e.data)}));var c=n._nrpnBuffer[a][0].value<<7|n._nrpnBuffer[a][1].value,l=n._nrpnBuffer[a][2].value;6===n._nrpnBuffer[a].length&&(l=n._nrpnBuffer[a][2].value<<7|n._nrpnBuffer[a][3].value);var h="";switch(n._nrpnBuffer[a][2].controller.number){case n.MIDI_NRPN_MESSAGES.entrymsb:h=n._nrpnTypes[0];break;case n.MIDI_NRPN_MESSAGES.increment:h=n._nrpnTypes[1];break;case n.MIDI_NRPN_MESSAGES.decrement:h=n._nrpnTypes[2];break;default:throw new Error("The NPRN type was unidentifiable.")}var d={timestamp:s.timestamp,channel:s.channel,type:"nrpn",data:u,controller:{number:c,type:h,name:"Non-Registered Parameter "+c},value:l};n._nrpnBuffer[a]=[],this._userHandlers.channel[d.type]&&this._userHandlers.channel[d.type][d.channel]&&this._userHandlers.channel[d.type][d.channel].forEach((function(e){e(d)}))}else n._nrpnBuffer[a]=[];else n._nrpnBuffer[a].push(s)}},r.prototype._parseChannelEvent=function(e){var t,r,i=e.data[0]>>4,a=1+(15&e.data[0]);1<e.data.length&&(t=e.data[1],r=2<e.data.length?e.data[2]:void 0);var o={target:this,data:e.data,timestamp:e.timeStamp,channel:a};i===n.MIDI_CHANNEL_MESSAGES.noteoff||i===n.MIDI_CHANNEL_MESSAGES.noteon&&0===r?(o.type="noteoff",o.note={number:t,name:n._notes[t%12],octave:n.getOctave(t)},o.velocity=r/127,o.rawVelocity=r):i===n.MIDI_CHANNEL_MESSAGES.noteon?(o.type="noteon",o.note={number:t,name:n._notes[t%12],octave:n.getOctave(t)},o.velocity=r/127,o.rawVelocity=r):i===n.MIDI_CHANNEL_MESSAGES.keyaftertouch?(o.type="keyaftertouch",o.note={number:t,name:n._notes[t%12],octave:n.getOctave(t)},o.value=r/127):i===n.MIDI_CHANNEL_MESSAGES.controlchange&&0<=t&&t<=119?(o.type="controlchange",o.controller={number:t,name:this.getCcNameByNumber(t)},o.value=r):i===n.MIDI_CHANNEL_MESSAGES.channelmode&&120<=t&&t<=127?(o.type="channelmode",o.controller={number:t,name:this.getChannelModeByNumber(t)},o.value=r):i===n.MIDI_CHANNEL_MESSAGES.programchange?(o.type="programchange",o.value=t):i===n.MIDI_CHANNEL_MESSAGES.channelaftertouch?(o.type="channelaftertouch",o.value=t/127):i===n.MIDI_CHANNEL_MESSAGES.pitchbend?(o.type="pitchbend",o.value=((r<<7)+t-8192)/8192):o.type="unknownchannelmessage",this._userHandlers.channel[o.type]&&this._userHandlers.channel[o.type][a]&&this._userHandlers.channel[o.type][a].forEach((function(e){e(o)}))},r.prototype.getCcNameByNumber=function(e){if(!(0<=(e=Math.floor(e))&&e<=119))throw new RangeError("The control change number must be between 0 and 119.");for(var t in n.MIDI_CONTROL_CHANGE_MESSAGES)if(Object.prototype.hasOwnProperty.call(n.MIDI_CONTROL_CHANGE_MESSAGES,t)&&e===n.MIDI_CONTROL_CHANGE_MESSAGES[t])return t},r.prototype.getChannelModeByNumber=function(e){if(!(120<=(e=Math.floor(e))&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var t in n.MIDI_CHANNEL_MODE_MESSAGES)if(Object.prototype.hasOwnProperty.call(n.MIDI_CHANNEL_MODE_MESSAGES,t)&&e===n.MIDI_CHANNEL_MODE_MESSAGES[t])return t},r.prototype._parseSystemEvent=function(e){var t=e.data[0],r={target:this,data:e.data,timestamp:e.timeStamp};t===n.MIDI_SYSTEM_MESSAGES.sysex?r.type="sysex":t===n.MIDI_SYSTEM_MESSAGES.timecode?r.type="timecode":t===n.MIDI_SYSTEM_MESSAGES.songposition?r.type="songposition":t===n.MIDI_SYSTEM_MESSAGES.songselect?(r.type="songselect",r.song=e.data[1]):t===n.MIDI_SYSTEM_MESSAGES.tuningrequest?r.type="tuningrequest":t===n.MIDI_SYSTEM_MESSAGES.clock?r.type="clock":t===n.MIDI_SYSTEM_MESSAGES.start?r.type="start":t===n.MIDI_SYSTEM_MESSAGES.continue?r.type="continue":t===n.MIDI_SYSTEM_MESSAGES.stop?r.type="stop":t===n.MIDI_SYSTEM_MESSAGES.activesensing?r.type="activesensing":t===n.MIDI_SYSTEM_MESSAGES.reset?r.type="reset":r.type="unknownsystemmessage",this._userHandlers.system[r.type]&&this._userHandlers.system[r.type].forEach((function(e){e(r)}))},i.prototype.send=function(e,t,n){if(!(128<=e&&e<=255))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");void 0===t&&(t=[]),Array.isArray(t)||(t=[t]);var r=[];return t.forEach((function(e){var t=Math.floor(e);if(!(0<=t&&t<=255))throw new RangeError("Data bytes must be integers between 0 (0x00) and 255 (0xFF).");r.push(t)})),this._midiOutput.send([e].concat(r),parseFloat(n)||0),this},i.prototype.sendSysex=function(e,t,r){if(!n.sysexEnabled)throw new Error("Sysex message support must first be activated.");return r=r||{},e=[].concat(e),t.forEach((function(e){if(e<0||127<e)throw new RangeError("The data bytes of a sysex message must be integers between 0 (0x00) and 127 (0x7F).")})),t=e.concat(t,n.MIDI_SYSTEM_MESSAGES.sysexend),this.send(n.MIDI_SYSTEM_MESSAGES.sysex,t,this._parseTimeParameter(r.time)),this},i.prototype.sendTimecodeQuarterFrame=function(e,t){return t=t||{},this.send(n.MIDI_SYSTEM_MESSAGES.timecode,e,this._parseTimeParameter(t.time)),this},i.prototype.sendSongPosition=function(e,t){t=t||{};var r=(e=Math.floor(e)||0)>>7&127,i=127&e;return this.send(n.MIDI_SYSTEM_MESSAGES.songposition,[r,i],this._parseTimeParameter(t.time)),this},i.prototype.sendSongSelect=function(e,t){if(t=t||{},!(0<=(e=Math.floor(e))&&e<=127))throw new RangeError("The song number must be between 0 and 127.");return this.send(n.MIDI_SYSTEM_MESSAGES.songselect,[e],this._parseTimeParameter(t.time)),this},i.prototype.sendTuningRequest=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendClock=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendStart=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendContinue=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.continue,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendStop=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendActiveSensing=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.activesensing,[],this._parseTimeParameter(e.time)),this},i.prototype.sendReset=function(e){return e=e||{},this.send(n.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(e.time)),this},i.prototype.stopNote=function(e,t,r){if("all"===e)return this.sendChannelMode("allnotesoff",0,t,r);var i=64;return(r=r||{}).rawVelocity?!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=127&&(i=r.velocity):!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=1&&(i=127*r.velocity),this._convertNoteToArray(e).forEach(function(e){n.toMIDIChannels(t).forEach(function(t){this.send((n.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(t-1),[e,Math.round(i)],this._parseTimeParameter(r.time))}.bind(this))}.bind(this)),this},i.prototype.playNote=function(e,t,r){var i,a=64;if((r=r||{}).rawVelocity?!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=127&&(a=r.velocity):!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=1&&(a=127*r.velocity),i=this._parseTimeParameter(r.time),this._convertNoteToArray(e).forEach(function(e){n.toMIDIChannels(t).forEach(function(t){this.send((n.MIDI_CHANNEL_MESSAGES.noteon<<4)+(t-1),[e,Math.round(a)],i)}.bind(this))}.bind(this)),!isNaN(r.duration)){r.duration<=0&&(r.duration=0);var o=64;r.rawVelocity?!isNaN(r.release)&&0<=r.release&&r.release<=127&&(o=r.release):!isNaN(r.release)&&0<=r.release&&r.release<=1&&(o=127*r.release),this._convertNoteToArray(e).forEach(function(e){n.toMIDIChannels(t).forEach(function(t){this.send((n.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(t-1),[e,Math.round(o)],(i||n.time)+r.duration)}.bind(this))}.bind(this))}return this},i.prototype.sendKeyAftertouch=function(e,t,r,i){var a=this;if(i=i||{},t<1||16<t)throw new RangeError("The channel must be between 1 and 16.");(isNaN(r)||r<0||1<r)&&(r=.5);var o=Math.round(127*r);return this._convertNoteToArray(e).forEach((function(e){n.toMIDIChannels(t).forEach((function(t){a.send((n.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(t-1),[e,o],a._parseTimeParameter(i.time))}))})),this},i.prototype.sendControlChange=function(e,t,r,i){if(i=i||{},"string"==typeof e){if(void 0===(e=n.MIDI_CONTROL_CHANGE_MESSAGES[e]))throw new TypeError("Invalid controller name.")}else if(!(0<=(e=Math.floor(e))&&e<=119))throw new RangeError("Controller numbers must be between 0 and 119.");if(!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("Controller value must be between 0 and 127.");return n.toMIDIChannels(r).forEach(function(r){this.send((n.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(r-1),[e,t],this._parseTimeParameter(i.time))}.bind(this)),this},i.prototype._selectRegisteredParameter=function(e,t,r){var i=this;if(e[0]=Math.floor(e[0]),!(0<=e[0]&&e[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(e[1]=Math.floor(e[1]),!(0<=e[1]&&e[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return n.toMIDIChannels(t).forEach((function(){i.sendControlChange(101,e[0],t,{time:r}),i.sendControlChange(100,e[1],t,{time:r})})),this},i.prototype._selectNonRegisteredParameter=function(e,t,r){var i=this;if(e[0]=Math.floor(e[0]),!(0<=e[0]&&e[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(e[1]=Math.floor(e[1]),!(0<=e[1]&&e[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return n.toMIDIChannels(t).forEach((function(){i.sendControlChange(99,e[0],t,{time:r}),i.sendControlChange(98,e[1],t,{time:r})})),this},i.prototype._setCurrentRegisteredParameter=function(e,t,r){var i=this;if((e=[].concat(e))[0]=Math.floor(e[0]),!(0<=e[0]&&e[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return n.toMIDIChannels(t).forEach((function(){i.sendControlChange(6,e[0],t,{time:r})})),e[1]=Math.floor(e[1]),0<=e[1]&&e[1]<=127&&n.toMIDIChannels(t).forEach((function(){i.sendControlChange(38,e[1],t,{time:r})})),this},i.prototype._deselectRegisteredParameter=function(e,t){var r=this;return n.toMIDIChannels(e).forEach((function(){r.sendControlChange(101,127,e,{time:t}),r.sendControlChange(100,127,e,{time:t})})),this},i.prototype.setRegisteredParameter=function(e,t,r,i){var a=this;if(i=i||{},!Array.isArray(e)){if(!n.MIDI_REGISTERED_PARAMETER[e])throw new Error("The specified parameter is not available.");e=n.MIDI_REGISTERED_PARAMETER[e]}return n.toMIDIChannels(r).forEach((function(){a._selectRegisteredParameter(e,r,i.time),a._setCurrentRegisteredParameter(t,r,i.time),a._deselectRegisteredParameter(r,i.time)})),this},i.prototype.setNonRegisteredParameter=function(e,t,r,i){var a=this;if(i=i||{},!(0<=e[0]&&e[0]<=127&&0<=e[1]&&e[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return t=[].concat(t),n.toMIDIChannels(r).forEach((function(){a._selectNonRegisteredParameter(e,r,i.time),a._setCurrentRegisteredParameter(t,r,i.time),a._deselectRegisteredParameter(r,i.time)})),this},i.prototype.incrementRegisteredParameter=function(e,t,r){var i=this;if(r=r||{},!Array.isArray(e)){if(!n.MIDI_REGISTERED_PARAMETER[e])throw new Error("The specified parameter is not available.");e=n.MIDI_REGISTERED_PARAMETER[e]}return n.toMIDIChannels(t).forEach((function(){i._selectRegisteredParameter(e,t,r.time),i.sendControlChange(96,0,t,{time:r.time}),i._deselectRegisteredParameter(t,r.time)})),this},i.prototype.decrementRegisteredParameter=function(e,t,r){if(r=r||{},!Array.isArray(e)){if(!n.MIDI_REGISTERED_PARAMETER[e])throw new TypeError("The specified parameter is not available.");e=n.MIDI_REGISTERED_PARAMETER[e]}return n.toMIDIChannels(t).forEach(function(){this._selectRegisteredParameter(e,t,r.time),this.sendControlChange(97,0,t,{time:r.time}),this._deselectRegisteredParameter(t,r.time)}.bind(this)),this},i.prototype.setPitchBendRange=function(e,t,r,i){var a=this;if(i=i||{},!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The cents value must be between 0 and 127");return n.toMIDIChannels(r).forEach((function(){a.setRegisteredParameter("pitchbendrange",[e,t],r,{time:i.time})})),this},i.prototype.setModulationRange=function(e,t,r,i){var a=this;if(i=i||{},!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The cents value must be between 0 and 127");return n.toMIDIChannels(r).forEach((function(){a.setRegisteredParameter("modulationrange",[e,t],r,{time:i.time})})),this},i.prototype.setMasterTuning=function(e,t,r){var i=this;if(r=r||{},(e=parseFloat(e)||0)<=-65||64<=e)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var a=Math.floor(e)+64,o=e-Math.floor(e),s=(o=Math.round((o+1)/2*16383))>>7&127,u=127&o;return n.toMIDIChannels(t).forEach((function(){i.setRegisteredParameter("channelcoarsetuning",a,t,{time:r.time}),i.setRegisteredParameter("channelfinetuning",[s,u],t,{time:r.time})})),this},i.prototype.setTuningProgram=function(e,t,r){var i=this;if(r=r||{},!(0<=(e=Math.floor(e))&&e<=127))throw new RangeError("The program value must be between 0 and 127");return n.toMIDIChannels(t).forEach((function(){i.setRegisteredParameter("tuningprogram",e,t,{time:r.time})})),this},i.prototype.setTuningBank=function(e,t,r){var i=this;if(r=r||{},!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("The bank value must be between 0 and 127");return n.toMIDIChannels(t).forEach((function(){i.setRegisteredParameter("tuningbank",e,t,{time:r.time})})),this},i.prototype.sendChannelMode=function(e,t,r,i){if(i=i||{},"string"==typeof e){if(!(e=n.MIDI_CHANNEL_MODE_MESSAGES[e]))throw new TypeError("Invalid channel mode message name.")}else if(!(120<=(e=Math.floor(e))&&e<=127))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if((t=Math.floor(t)||0)<0||127<t)throw new RangeError("Value must be an integer between 0 and 127.");return n.toMIDIChannels(r).forEach(function(r){this.send((n.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(r-1),[e,t],this._parseTimeParameter(i.time))}.bind(this)),this},i.prototype.sendProgramChange=function(e,t,r){var i=this;if(r=r||{},e=Math.floor(e),isNaN(e)||e<0||127<e)throw new RangeError("Program numbers must be between 0 and 127.");return n.toMIDIChannels(t).forEach((function(t){i.send((n.MIDI_CHANNEL_MESSAGES.programchange<<4)+(t-1),[e],i._parseTimeParameter(r.time))})),this},i.prototype.sendChannelAftertouch=function(e,t,r){var i=this;r=r||{},e=parseFloat(e),(isNaN(e)||e<0||1<e)&&(e=.5);var a=Math.round(127*e);return n.toMIDIChannels(t).forEach((function(e){i.send((n.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(e-1),[a],i._parseTimeParameter(r.time))})),this},i.prototype.sendPitchBend=function(e,t,r){var i=this;if(r=r||{},isNaN(e)||e<-1||1<e)throw new RangeError("Pitch bend value must be between -1 and 1.");var a=Math.round((e+1)/2*16383),o=a>>7&127,s=127&a;return n.toMIDIChannels(t).forEach((function(e){i.send((n.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(e-1),[s,o],i._parseTimeParameter(r.time))})),this},i.prototype._parseTimeParameter=function(e){var t,r=parseFloat(e);return"string"==typeof e&&"+"===e.substring(0,1)?r&&0<r&&(t=n.time+r):r>n.time&&(t=r),t},i.prototype._convertNoteToArray=function(e){var t=[];return Array.isArray(e)||(e=[e]),e.forEach((function(e){t.push(n.guessNoteNumber(e))})),t},"function"==typeof define&&"object"==typeof define.amd?define([],(function(){return n})):g?g=n:e.WebMidi||(e.WebMidi=n)}(g);var y=i("9gByv");s=i("8qLe2");function b(){return new Promise((function(t,n){e(g).enable((function(r){r?n(r):t(e(g))}))}))}function E(){return(E=a.asyncToGenerator(e(v).mark((function t(){var n,r,i,a,o,u,c;return e(v).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,b();case 3:t.next=9;break;case 5:return t.prev=5,t.t0=t.catch(0),console.log(t.t0),t.abrupt("return",(function(){return function(){}}));case 9:for(console.log(e(g)),n=new y.default,r=!0,i=!1,a=void 0,t.prev=12,o=e(g).inputs[Symbol.iterator]();!(r=(u=o.next()).done);r=!0)(c=u.value).addListener("controlchange","all",(function(e){n.emit({id:"".concat(c.id,".").concat(e.type,".").concat(e.controller.number),value:s.mapRange(0,127,0,1,e.value)})})),c.addListener("pitchbend","all",(function(e){n.emit({id:"".concat(c.id,".").concat(e.type,".").concat(e.channel),value:s.mapRange(-1,1,0,1,e.value)})})),c.addListener("noteon","all",(function(e){n.emit({id:"".concat(c.id,".note.").concat(e.note.number),value:e.velocity})})),c.addListener("noteoff","all",(function(e){n.emit({id:"".concat(c.id,".note.").concat(e.note.number),value:0})}));t.next=20;break;case 16:t.prev=16,t.t1=t.catch(12),i=!0,a=t.t1;case 20:t.prev=20,t.prev=21,r||null==o.return||o.return();case 23:if(t.prev=23,!i){t.next=26;break}throw a;case 26:return t.finish(23);case 27:return t.finish(20);case 28:return t.abrupt("return",(function(e){return n.listen(e)}));case 29:case"end":return t.stop()}}),t,null,[[0,5],[12,16,20,28],[21,,23,27]])})))).apply(this,arguments)}a=i("8TSCy"),y=i("9gByv"),s=i("8qLe2"),a=i("8TSCy"),s=i("8qLe2");var _=function(){"use strict";function e(t){var n=void 0===t?32:t;a.classCallCheck(this,e),this.start=0,this.end=0,this.buffer=s.times(Math.max(n,1),(function(){return null}))}return a.createClass(e,[{key:"resize",value:function(e){var t=this,n=this.length;this.buffer=s.times(e,(function(e){return e<n?t.get(e):null})),this.start=0,this.end=n}},{key:"growForInsertIfNeeded",value:function(){this.length>=this.capacity-1&&this.resize(2*this.capacity)}},{key:"length",get:function(){return this.start<=this.end?this.end-this.start:this.end+this.buffer.length-this.start}},{key:"capacity",get:function(){return this.buffer.length}},{key:"get",value:function(e){return this.buffer[(this.start+e)%this.capacity]}},{key:"push",value:function(e){this.growForInsertIfNeeded(),this.buffer[this.end]=e,this.end=(this.end+1)%this.capacity}},{key:"pop",value:function(){if(this.end===this.start)return null;0===this.end?this.end=this.capacity-1:this.end=this.end-1;var e=this.buffer[this.end];return this.buffer[this.end]=null,e}},{key:"unshift",value:function(e){this.growForInsertIfNeeded(),0===this.start?this.start=this.capacity-1:this.start=this.start-1,this.buffer[this.start]=e}},{key:"shift",value:function(){if(this.end===this.start)return null;var e=this.buffer[this.start];return this.buffer[this.start]=null,this.start=(this.start+1)%this.capacity,e}},{key:"first",value:function(){return this.get(0)}},{key:"last",value:function(){return this.get(this.length-1)}}]),e}(),S=function(){"use strict";function e(t){a.classCallCheck(this,e),this.manager=t,this.currentValue=null}return a.createClass(e,[{key:"debug",value:function(e){return null!==e&&this.manager.debug(e,this),this}},{key:"clear",value:function(){this.currentValue=null}},{key:"read",value:function(){return null===this.currentValue&&(this.currentValue=this.update()),this.currentValue}}]),e}(),M=function(e){"use strict";function t(e,n){var r;return a.classCallCheck(this,t),(r=a.possibleConstructorReturn(this,a.getPrototypeOf(t).call(this,e))).value=n,r}return a.inherits(t,e),a.createClass(t,[{key:"update",value:function(){return this.value}},{key:"set",value:function(e){this.value=e}}]),t}(S);function w(e,t){return t?s.clamp(t[0],t[1],e):e}var I=function(e){"use strict";function t(e,n,r,i){var o;return a.classCallCheck(this,t),(o=a.possibleConstructorReturn(this,a.getPrototypeOf(t).call(this,e,w(s.getLocalStorageItem("signalSetting.".concat(n),r),i)))).key=n,o.saveDebounced=s.debounce(200,(function(e){return s.setLocalStorageItem("signalSetting.".concat(o.key),e)})),o.range=i||null,o}return a.inherits(t,e),a.createClass(t,[{key:"set",value:function(e){e=w(e,this.range),a.get(a.getPrototypeOf(t.prototype),"set",this).call(this,e),this.saveDebounced(e)}}]),t}(M),A=function(e){"use strict";function t(e,n){var r;return a.classCallCheck(this,t),(r=a.possibleConstructorReturn(this,a.getPrototypeOf(t).call(this,e))).compute=n,r}return a.inherits(t,e),a.createClass(t,[{key:"update",value:function(){return this.compute()}}]),t}(S),T=function(){"use strict";function e(){a.classCallCheck(this,e),this.debugSignalsByName={},this.debugSignalsChangeEvent=new y.default,this.updateEvent=new y.default,this.signals=new Set,this.driver=this.controlled(0).debug("internal.driver")}return a.createClass(e,[{key:"onDebugSignalsChange",value:function(e){return this.debugSignalsChangeEvent.listen(e)}},{key:"onUpdate",value:function(e){return this.updateEvent.listen(e)}},{key:"update",value:function(e){this.driver.set(Math.min(e,.03));var t=!0,n=!1,r=void 0;try{for(var i,a=this.signals[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){i.value.clear()}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}var o=!0,s=!1,u=void 0;try{for(var c,l=this.signals[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){c.value.read()}}catch(e){s=!0,u=e}finally{try{o||null==l.return||l.return()}finally{if(s)throw u}}this.updateEvent.emit()}},{key:"controlled",value:function(e){return this.addSignal(new M(this,e))}},{key:"computed",value:function(e){return this.addSignal(new A(this,e))}},{key:"input",value:function(e,t,n){return this.addSignal(new I(this,e,t,n)).debug(e)}},{key:"sin",value:function(e){var t=void 0===e?{}:e,n=t.min,r=void 0===n?0:n,i=t.max,a=void 0===i?1:i,o=t.frequency,u=void 0===o?1:o,c=t.driver,l=void 0===c?this.driver:c,h=t.offset,d=void 0===h?0:h,f=this.toSignal(r),p=this.toSignal(a),m=this.toSignal(u),v=this.toSignal(d),g=0;return this.computed((function(){var e=m.read();return g+=l.read()*e,s.mapRange(-1,1,f.read(),p.read(),Math.cos((v.read()+g)*Math.PI*2))}))}},{key:"spring",value:function(e){var t,n,r,i=e.target,a=null!==(t=e.driver)&&void 0!==t?t:this.driver,o=this.toSignal(null!==(n=e.tension)&&void 0!==n?n:230),s=this.toSignal(null!==(r=e.friction)&&void 0!==r?r:22),u=i.read(),c=0;return this.computed((function(){var e=i.read(),t=a.read(),n=o.read(),r=s.read(),l=u,h=c,d=c,f=n*(e-l)-r*c,p=h=c+f*t*.5,m=n*(e-(l=u+d*t*.5))-r*h,v=h=c+m*t*.5,g=n*(e-(l=u+p*t*.5))-r*h;return c+=1/6*(f+2*(m+g)+(n*(e-(l=u+v*t))-r*(h=c+g*t)))*t,u+=1/6*(d+2*(p+v)+h)*t}))}},{key:"add",value:function(e,t){var n=this.toSignal(e),r=this.toSignal(t);return this.computed((function(){return n.read()+r.read()}))}},{key:"subtract",value:function(e,t){var n=this.toSignal(e),r=this.toSignal(t);return this.computed((function(){return n.read()-r.read()}))}},{key:"multiply",value:function(e,t){var n=this.toSignal(e),r=this.toSignal(t);return this.computed((function(){return n.read()*r.read()}))}},{key:"divide",value:function(e,t){var n=this.toSignal(e),r=this.toSignal(t);return this.computed((function(){return n.read()/r.read()}))}},{key:"switch",value:function(e,t,n){var r=this.toSignal(e),i=this.toSignal(t),a=this.toSignal(n);return this.computed((function(){return r.read()?i.read():a.read()}))}},{key:"adsr",value:function(e){var t,n,r=e.target,i=e.attack,a=void 0===i?0:i,o=e.delay,u=void 0===o?0:o,c=e.sustain,l=void 0===c?1:c,h=e.release,d=void 0===h?0:h,f=e.driver,p=void 0===f?this.driver:f,m=this.toSignal(a),v=this.toSignal(u),g=this.toSignal(l),y=this.toSignal(d);(n=t||(t={}))[n.Off=0]="Off",n[n.Attacking=1]="Attacking",n[n.Holding=2]="Holding",n[n.Releasing=3]="Releasing";var b=t.Off,E=0,_=0;return this.computed((function(){var e=r.read();if(0!==e){if(b!==t.Off&&b!==t.Releasing||(b=0===m.read()?t.Holding:t.Attacking),b===t.Attacking&&(E+=e/m.read()*p.read())>=e&&(b=t.Holding),b===t.Holding){var n=e*g.read();E=0===v.read()?n:s.clamp(n,e,E+(n-e)/v.read()*p.read())}}else b!==t.Attacking&&b!==t.Holding||(0===E?b=t.Off:(_=E,b=t.Releasing)),b===t.Releasing&&(E-=_/y.read()*p.read())<=0&&(E=0,b=t.Off),b===t.Off&&(E=0);return E}))}},{key:"easeExponential",value:function(e){var t=e.target,n=e.rate,r=void 0===n?.1:n,i=this.toSignal(r),a=t.read();return this.computed((function(){var e=t.read()-a;return a+=e*i.read()}))}},{key:"lerp",value:function(e,t,n){var r=this.toSignal(e),i=this.toSignal(t),a=this.toSignal(n);return this.computed((function(){return s.lerp(r.read(),i.read(),a.read())}))}},{key:"delay",value:function(e){var t=e.target,n=e.amount,r=void 0===n?0:n,i=e.driver,a=void 0===i?this.driver:i,o=this.toSignal(r);console.log(o.read());var s=new _(1.2*o.read()/(1/60)),u=0,c=t.read();return this.computed((function(){u+=a.read();var e=o.read();s.push({time:u,value:t.read()});for(var n=null;(n=s.first())&&n.time+e<=u;)c=n.value,s.shift();return c}))}},{key:"debug",value:function(e,t){u(this.signals.has(t),"signal called ".concat(e," does not belong to this signal manager"));var n=s.has(this.debugSignalsByName,e)?a.toConsumableArray(this.debugSignalsByName[e]).concat([t]):[t];this.debugSignalsByName=a.objectSpread({},this.debugSignalsByName,a.defineProperty({},e,n)),this.debugSignalsChangeEvent.emit()}},{key:"addSignal",value:function(e){return this.signals.add(e),e}},{key:"toSignal",value:function(e){return"number"==typeof e?this.controlled(e):e}}]),e}(),N=(a=i("8TSCy"),o=i("exYeM"),a=i("8TSCy"),o=i("exYeM"),{});i.register("27OKH",(function(e,t){var n,r,a,o,s;n=e.exports,r="useSubscription",a=function(){return s},o=function(e){return s=e},Object.defineProperty(n,r,{get:a,set:o,enumerable:!0,configurable:!0});var u=i("j8GnD"),c=i("exYeM");s=function(e){var t=e.getCurrentValue,n=e.subscribe,r=c.useState((function(){return{getCurrentValue:t,subscribe:n,value:t()}}));e=r[0];var i=r[1];return r=e.value,e.getCurrentValue===t&&e.subscribe===n||(r=t(),i({getCurrentValue:t,subscribe:n,value:r})),c.useDebugValue(r),c.useEffect((function(){function e(){if(!r){var e=t();i((function(r){return r.getCurrentValue!==t||r.subscribe!==n||r.value===e?r:u({},r,{value:e})}))}}var r=!1,a=n(e);return e(),function(){r=!0,a()}}),[t,n]),r}})),N=i("27OKH");s=i("8qLe2"),a=i("8TSCy"),o=i("exYeM"),s=i("8qLe2");function D(e,t){var n=a.slicedToArray(o.useState((function(){return s.getLocalStorageItem(e,t)})),2),r=n[0],i=n[1];return[r,function(t){try{var n=t instanceof Function?t(r):t;i(n),s.setLocalStorageItem(e,n)}catch(e){console.log(e)}}]}a=i("8TSCy");var C={position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:"100000",touchAction:"none"},R=function(){"use strict";function e(t){var n=t.down,r=t.move,i=t.up,o=t.debug,s=t.cursor;a.classCallCheck(this,e),this.attachedTo=null,this.onDown=n,this.onMove=r,this.onUp=i;var u=document.createElement("div");u.setAttribute("touch-action","none"),Object.assign(u.style,C),o&&(u.style.background="rgba(0, 255, 0, 0.3)"),s&&(u.style.cursor=s),this.cover=u}return a.createClass(e,[{key:"attach",value:function(){var e=document.body;!this.attachedTo&&e&&(this.attachedTo=e,this.attachedTo.appendChild(this.cover),this.attachEvents())}},{key:"remove",value:function(){this.attachedTo&&(this.attachedTo.removeChild(this.cover),this.attachedTo=null,this.removeEvents())}},{key:"attachEvents",value:function(){this.onDown&&window.addEventListener("mousedown",this.onDown,!1),this.onMove&&window.addEventListener("mousemove",this.onMove,!1),this.onUp&&window.addEventListener("mouseup",this.onUp,!1)}},{key:"removeEvents",value:function(){this.onDown&&window.removeEventListener("mousedown",this.onDown),this.onMove&&window.removeEventListener("mousemove",this.onMove),this.onUp&&window.removeEventListener("mouseup",this.onUp)}}]),e}();o=i("exYeM");function x(e){return N.useSubscription(o.useMemo((function(){return{getCurrentValue:function(){return e.read()},subscribe:function(t){return e.manager.onUpdate(t)}}}),[e]))}var O=function(e,t){var n=e.toString().split(".");if(1===n.length)return n[0];if(2===n.length){if(n[0].length>=t)return n[0];var r=t-n[0].length;return"".concat(n[0],".").concat(n[1].slice(0,r))}throw new Error("unexpected number of value parts: ".concat(n.length))},P=o.memo((function(t){var n=t.signal,r=t.className,i=x(n);return o.createElement("div",{className:e(h)("text-gray-400",r)},O(i,5))})),k=o.memo((function(e){var t=e.signals,n=e.width,r=a.slicedToArray(o.useState((function(){var e,n,r=t.map((function(e){return e.read()}));return{lines:r.map((function(e){return[e]})),min:(e=Math).min.apply(e,a.toConsumableArray(r)),max:(n=Math).max.apply(n,a.toConsumableArray(r))}})),2),i=r[0],u=i.lines,c=i.min,l=i.max,h=r[1];o.useEffect((function(){return t[0].manager.onUpdate((function(){var e,r,i=t.map((function(e){return e.read()}));h((function(t){return{lines:t.lines.map((function(e,t){return[i[t]].concat(a.toConsumableArray(e.slice(0,n-1)))})),min:(e=Math).min.apply(e,[t.min].concat(a.toConsumableArray(i))),max:(r=Math).max.apply(r,[t.max].concat(a.toConsumableArray(i)))}}))}))}),[t]);var d=Math.round(n/2);return c===l&&(c-=.1,l+=.1),o.createElement("svg",{width:n,height:d},o.createElement("text",{x:n-8,y:16,fill:"#cbd5e0",fontSize:8,textAnchor:"end"},O(l,5)),o.createElement("text",{x:n-8,y:d-8,fill:"#cbd5e0",fontSize:8,textAnchor:"end"},O(c,5)),u.map((function(e,t){for(var r=[],i=0;i<e.length;i++){var a=0===i?"M":"L";r.push("".concat(a," ").concat(n-i," ").concat(s.mapRange(c,l,d-8,8,e[i]).toFixed(1)))}return o.createElement("path",{key:t,d:r.join(" "),stroke:"#cbd5e0",strokeWidth:1,fill:"none"})})))}));function G(t){var n=t.name,r=t.signal,i=t.listenToMidi,u=a.slicedToArray(o.useState(!1),2),c=u[0],l=u[1],d=a.slicedToArray(D("midiControlForSignal.".concat(n),null),2),f=d[0],p=d[1];return o.useEffect((function(){return i((function(e){var t=e.id,n=e.value;r.range&&(c?(p(t),l(!1),r.set(s.mapRange(0,1,r.range[0],r.range[1],n))):t===f&&r.set(s.mapRange(0,1,r.range[0],r.range[1],n)))}))}),[i,r,c,f]),o.createElement(o.Fragment,null,r.range&&o.createElement("div",{className:e(h)("cursor-pointer px-1 py-1",c?"text-gray-100":null!==f?"text-gray-300":"text-gray-500 hover:text-gray-300"),onClick:function(e){e.stopPropagation(),null===f?l(!c):p(null)}},c?"◎":null!==f?"◉":"○"),o.createElement("div",{className:"cursor-move pr-2 pl-1 py-1",style:{cursor:"ns-resize"},onMouseDown:function(e){e.preventDefault();var t=e.screenY,n=r.read(),i=r.range?Math.abs(r.range[1]-r.range[0])/250:Math.abs(0===n?.1:.01*n),a=function(e){var a=(t-e)*i;r.set(n+a)},o=new R({move:function(e){a(e.screenY)},up:function(e){a(e.screenY),o.remove()},cursor:"ns-resize"});o.attach()}},"↕",o.createElement(P,{signal:r,className:"inline-block pl-1"})))}var H=o.memo((function(e){var t=e.signals,n=e.name,r=e.displayName,i=void 0===r?n:r,s=e.width,u=e.listenToMidi,c=a.slicedToArray(D("signal.".concat(n),!1),2),l=c[0],h=c[1],d=t.filter((function(e){return e instanceof I}));return o.createElement("div",{className:"text-xs border-t border-gray-700"},o.createElement("div",{className:"flex hover:bg-gray-800 cursor-pointer",onClick:function(){return h(!l)}},o.createElement("div",{className:"flex-auto whitespace-pre px-2 py-1"},i),d.length?o.createElement(G,{name:n,signal:d[0],listenToMidi:u}):o.createElement(P,{signal:t[0],className:"px-2 py-1"})),l&&o.createElement(k,{signals:t,width:s}))}));function L(e){var t=e.groupName,n=e.signalNamePairs,r=e.width,i=e.listenToMidi,s=a.slicedToArray(D("group.".concat(t),!1),2),u=s[0],c=s[1];return o.createElement("div",{className:"text-xs border-t border-gray-700"},o.createElement("div",{className:"flex hover:bg-gray-800 cursor-pointer px-2 py-1",onClick:function(){return c(!u)}},o.createElement("div",{className:"flex-auto"},t),o.createElement("div",{className:"text-gray-600"},u?"▽":"▷")),u&&o.createElement(o.Fragment,null,n.map((function(e){var n=a.slicedToArray(e,2),s=n[0],u=n[1];return o.createElement(H,{key:s,name:s,displayName:"  ".concat(s.slice(t.length+1)),signals:u,width:r,listenToMidi:i})}))))}var B=o.memo((function(e){var t=e.signalManager,n=e.width,r=e.listenToMidi,i=N.useSubscription(o.useMemo((function(){return{getCurrentValue:function(){return t.debugSignalsByName},subscribe:function(e){return t.onDebugSignalsChange(e)}}}),[t])),c=s.sortBy(Object.entries(i).filter((function(e){return!a.slicedToArray(e,1)[0].startsWith("_")})),(function(e){return e[0]})),l=a.slicedToArray(s.partition(c,(function(e){return a.slicedToArray(e,1)[0].includes(".")})),2),h=l[0],d=l[1],f=s.groupBy(h,(function(e){var t=a.slicedToArray(e,1)[0],n=t.indexOf(".");return u(-1!==n),t.slice(0,n)}));return o.createElement("div",{className:"absolute right-0 top-0 bottom-0 border-l border-gray-600 text-sm h-full overflow-auto",style:{width:n}},o.createElement("div",{className:"py-1 px-2"},"signals"),Array.from(f).map((function(e){var t=a.slicedToArray(e,2),i=t[0],s=t[1];return o.createElement(L,{key:i,groupName:i,signalNamePairs:s,width:n-1,listenToMidi:r})})),d.map((function(e){var t=a.slicedToArray(e,2),i=t[0],s=t[1];return o.createElement(H,{key:i,name:i,signals:s,width:n-1,listenToMidi:r})})))})),F=(s=i("8qLe2"),function(){if("undefined"!=typeof Map)return Map;function e(e,t){var n=-1;return e.some((function(e,r){return e[0]===t&&(n=r,!0)})),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var n=e(this.__entries__,t),r=this.__entries__[n];return r&&r[1]},t.prototype.set=function(t,n){var r=e(this.__entries__,t);~r?this.__entries__[r][1]=n:this.__entries__.push([t,n])},t.prototype.delete=function(t){var n=this.__entries__,r=e(n,t);~r&&n.splice(r,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,r=this.__entries__;n<r.length;n++){var i=r[n];e.call(t,i[1],i[0])}},t}()}()),Y="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,W=void 0!==t&&t.Math===Math?t:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),q="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(W):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var j=["top","right","bottom","left","width","height","size","weight"],K="undefined"!=typeof MutationObserver,z=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var n=!1,r=!1,i=0;function a(){n&&(n=!1,e()),r&&s()}function o(){q(a)}function s(){var e=Date.now();if(n){if(e-i<2)return;r=!0}else n=!0,r=!1,setTimeout(o,t);i=e}return s}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){Y&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),K?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){Y&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t;j.some((function(e){return!!~n.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),V=function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];Object.defineProperty(e,i,{value:t[i],enumerable:!1,writable:!1,configurable:!0})}return e},U=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||W},X=te(0,0,0,0);function Q(e){return parseFloat(e)||0}function J(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce((function(t,n){return t+Q(e["border-"+n+"-width"])}),0)}function Z(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return X;var r=U(e).getComputedStyle(e),i=function(e){for(var t={},n=0,r=["top","right","bottom","left"];n<r.length;n++){var i=r[n],a=e["padding-"+i];t[i]=Q(a)}return t}(r),a=i.left+i.right,o=i.top+i.bottom,s=Q(r.width),u=Q(r.height);if("border-box"===r.boxSizing&&(Math.round(s+a)!==t&&(s-=J(r,"left","right")+a),Math.round(u+o)!==n&&(u-=J(r,"top","bottom")+o)),!function(e){return e===U(e).document.documentElement}(e)){var c=Math.round(s+a)-t,l=Math.round(u+o)-n;1!==Math.abs(c)&&(s-=c),1!==Math.abs(l)&&(u-=l)}return te(i.left,i.top,s,u)}var $="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof U(e).SVGGraphicsElement}:function(e){return e instanceof U(e).SVGElement&&"function"==typeof e.getBBox};function ee(e){return Y?$(e)?function(e){var t=e.getBBox();return te(0,0,t.width,t.height)}(e):Z(e):X}function te(e,t,n,r){return{x:e,y:t,width:n,height:r}}var ne=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=te(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=ee(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),re=function(e,t){var n,r,i,a,o,s,u,c=(r=(n=t).x,i=n.y,a=n.width,o=n.height,s="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,u=Object.create(s.prototype),V(u,{x:r,y:i,width:a,height:o,top:i,right:r+a,bottom:o+i,left:r}),u);V(this,{target:e,contentRect:c})},ie=function(){function e(e,t,n){if(this.activeObservations_=[],this.observations_=new F,"function"!=typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=n}return e.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof U(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new ne(e)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof U(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},e.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new re(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),ae="undefined"!=typeof WeakMap?new WeakMap:new F,oe=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=z.getInstance(),r=new ie(t,n,this);ae.set(this,r)};["observe","unobserve","disconnect"].forEach((function(e){oe.prototype[e]=function(){var t;return(t=ae.get(this))[e].apply(t,arguments)}}));var se=void 0!==W.ResizeObserver?W.ResizeObserver:oe;function ue(e){var t=e.debuggerEnabled,n=e.signalManager,r=e.listenToMidi,i=e.scene,c=a.slicedToArray(o.useState(null),2),l=c[0],h=c[1],d=o.useRef(null),f=o.useRef(null),p=a.slicedToArray(o.useState({width:100,height:100,devicePixelRatio:1}),2),m=p[0],v=p[1];return o.useEffect((function(){var e=!1;u(f.current&&d.current);var t=f.current,r=d.current;v({width:t.clientWidth,height:t.clientHeight,devicePixelRatio:window.devicePixelRatio});var a={width:n.controlled(t.clientWidth).debug("canvas.width"),height:n.controlled(t.clientHeight).debug("canvas.height"),devicePixelRatio:n.controlled(window.devicePixelRatio).debug("canvas.devicePixelRatio"),mouseX:n.controlled(0).debug("canvas.mouseX"),mouseY:n.controlled(0).debug("canvas.mouseY"),mouseDown:n.controlled(0).debug("canvas.mouseDown")},o=new se((function(){var e=t.clientWidth,n=t.clientHeight,r=window.devicePixelRatio;a.width.set(e),a.height.set(n),a.devicePixelRatio.set(r),v((function(t){return t.width!==e||t.height!==n||t.devicePixelRatio!==r?{width:e,height:n,devicePixelRatio:r}:t}))}));o.observe(t),window.addEventListener("mousemove",(function(e){a.mouseX.set(e.clientX),a.mouseY.set(e.clientY)})),r.addEventListener("mousedown",(function(){a.mouseDown.set(1);var e=new R({up:function(){a.mouseDown.set(0),e.remove()}});e.attach()}));var c=Date.now(),l=i(n,t,a);console.log("get frame loop",Date.now()-c,n.debugSignalsByName.size);var p=0;return s.frameLoop((function(t,r){if(e)r();else{var i=t-p;p=t,n.update(i/1e3),l.update&&l.update(),l.draw()}})),h(l.children),function(){e=!0,o.disconnect()}}),[i,n]),o.createElement("div",{style:{position:"absolute",top:0,left:0,bottom:0,right:0}},o.createElement("div",{ref:d,style:{position:"absolute",top:0,left:0,bottom:0,right:t?300:0}},o.createElement("canvas",{ref:f,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:10,pointerEvents:"none"},width:m.width*m.devicePixelRatio,height:m.height*m.devicePixelRatio}),l),t&&o.createElement(B,{signalManager:n,listenToMidi:r,width:300}))}var ce=o.memo(ue);var le=1300,he=1300,de=46,fe={KeyA:33,KeyS:34,KeyD:35,KeyF:36,KeyG:37,KeyH:38,KeyJ:39,KeyK:40,KeyL:41,Semicolon:42,Quote:43,Backslash:44,KeyQ:45,KeyW:46,KeyE:47,KeyR:48,KeyT:49,KeyY:50,KeyU:51,KeyI:52,KeyO:53,KeyP:54,BracketLeft:55,BracketRight:56,Digit1:57,Digit2:58,Digit3:59,Digit4:60,Digit5:61,Digit6:62,Digit7:63,Digit8:64,Digit9:65,Digit0:66,Minus:67,Equal:68};function pe(e,t,n){return(e-t)/n}function me(e,t,n){return e*n+t}function ve(e,t,n,r,i){e.strokeStyle=n;for(var a=0;a<t.points.length-i;a++){var o=t.points[a],s=o.start,u=o.end;e.beginPath(),e.moveTo(s[0].read(),s[1].read()),e.lineTo(u[0].read(),u[1].read()),e.lineWidth=r-a,e.stroke()}}function ge(e){var t=e.canvasScaleSignal,n=e.canvasTranslateXSignal,r=e.canvasTranslateYSignal,i=e.onNoteDown,u=e.onNoteUp,c=o.useRef(new Map),l=x(t),h=x(n),d=x(r),f=a.slicedToArray(o.useState([]),2),m=f[0],v=f[1];console.log(m);var g=o.useCallback((function(e,t){e?c.current.set(t,e):c.current.delete(t)}),[]),y=o.useCallback((function(e){v((function(o){if(o.includes(e))return o;var u=c.current.get(e);if(u){var l=u.getBoundingClientRect();i(e,pe(l.x+l.width/2,n.read(),t.read()),pe(l.y+.8*l.height,r.read(),t.read()))}return s.uniq(a.toConsumableArray(o).concat([e]))}))}),[]),b=o.useCallback((function(e){v((function(t){return t.includes(e)?(u(e),t.filter((function(t){return t!==e}))):t}))}),[]);return o.useEffect((function(){var e=function(e){var t=fe[e.code];void 0!==t&&y(t)},t=function(e){var t=fe[e.code];void 0!==t&&b(t)};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),function(){window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}}),[]),o.createElement(o.Fragment,null,o.createElement("div",{style:{background:"#7F95D1"},className:"absolute top-0 left-0 w-full h-full"}),o.createElement(p,{lowestNote:33,highestNote:72,scale:l,top:me(1100,d,l),left:me(650,h,l),notesDown:m,setRefForKey:g}))}!async function(e,t){var n=await function(){return E.apply(this,arguments)}(),r=new T,i=document.getElementById("root");u(i),m.render(o.createElement(ce,{debuggerEnabled:t,signalManager:r,listenToMidi:n,scene:e}),i)}((function(e,t,n){var r=n.mouseX,i=n.mouseY,h=(n.mouseDown,n.width),d=n.height,f=n.devicePixelRatio,p=t.getContext("2d");u(p);var m=new c.DebugDraw(p),v=e.computed((function(){return Math.min(h.read()/le,d.read()/he)})),g=e.computed((function(){return(h.read()-v.read()*le)/2})),y=e.computed((function(){return(d.read()-v.read()*he)/2})),b=(e.computed((function(){return pe(r.read(),g.read(),v.read())})),e.computed((function(){return pe(i.read(),y.read(),v.read())})),30),E=e.input("spring.activeFriction",35,[1,40]),_=e.input("spring.activeTension",1e3,[1,1e3]),S=e.input("spring.idleFriction",25,[1,40]),M=e.input("spring.idleTension",180,[1,1e3]),w=e.controlled(650),I=e.controlled(250),A=e.spring({target:w}),T=e.spring({target:I}),N=A,D=e.subtract(T,70),C=s.times(8,(function(t){var n=e.controlled(0),r=e.controlled(0),i=e.controlled(0),a=e.computed((function(){return A.read()+65*(t-3.5)})),o=e.computed((function(){return T.read()+120*Math.sin(t/7*Math.PI)})),u=a,c=o,l=e.controlled(Math.PI/2-(t-4)/7.2),h=e.subtract(r,a),d=e.subtract(i,o),f=e.computed((function(){return Math.atan2(d.read(),h.read())})),p=e.sin({min:s.varyAbsolute(-1,.75),max:s.varyAbsolute(1,.75),frequency:s.varyAbsolute(.5,.4),offset:Math.random()}),m=s.varyAbsolute(2,1.5)*Math.sign(s.varyAbsolute(0,1)),v=e.sin({min:m-2,max:m+2,frequency:s.varyAbsolute(.5,.4),offset:Math.random()});return{points:s.times(b,(function(t){var r=b-(t+1),i=e.adsr({target:n,attack:.05*r,release:2}),s=e.adsr({target:n,attack:.05*r}),m=e.lerp(S,E,i),g=e.lerp(M,_,i),y=e.sin({min:-.3,max:.3,frequency:.2*Math.pow(1.1,t/2),offset:Math.random()}),w=e.add(y,l),I=24*Math.pow(.95,t/2),A=e.add(u,e.computed((function(){return Math.cos(w.read())*I}))),T=e.add(c,e.computed((function(){return Math.sin(w.read())*I}))),N=(t+1)/b,D=20*Math.sin(N*Math.PI),C=e.sin({min:-D,max:D,offset:e.computed((function(){return t/b*v.read()})),frequency:p}),R=e.computed((function(){return a.read()+h.read()*N+Math.sin(-f.read())*C.read()})),x=e.computed((function(){return o.read()+d.read()*N+Math.cos(f.read())*C.read()})),O=e.spring({target:e.lerp(A,R,s),friction:m,tension:g}).debug(29===t?"tentacle.endX":null),P=e.spring({target:e.lerp(T,x,s),friction:m,tension:g}),k=e.subtract(O,u),G=e.subtract(P,c),H=e.computed((function(){return Math.sqrt(k.read()*k.read()+G.read()*G.read())})),L={start:[u,c],end:[O,P],leftInner:[e.computed((function(){return O.read()-G.read()/H.read()*(17-t+1)})),e.computed((function(){return P.read()+k.read()/H.read()*(17-t+1)}))],rightInner:[e.computed((function(){return O.read()+G.read()/H.read()*(17-t+1)})),e.computed((function(){return P.read()-k.read()/H.read()*(17-t+1)}))],leftOuter:[e.computed((function(){return O.read()-G.read()/H.read()*(23-t+1)})),e.computed((function(){return P.read()+k.read()/H.read()*(23-t+1)}))],rightOuter:[e.computed((function(){return O.read()+G.read()/H.read()*(23-t+1)})),e.computed((function(){return P.read()-k.read()/H.read()*(23-t+1)}))]};return u=O,c=P,l=w,L})),isActive:n,activeTargetX:r,activeTargetY:i}})),R=new Map,x=e.computed((function(){for(var e=0,t=0;t<8;t++)e+=C[t].points[29].end[0].read();return e/8})),O=e.computed((function(){for(var e=0,t=0;t<8;t++)e+=C[t].points[29].end[1].read();return e/8})),P=s.shuffle(C);return{update:function(){var e=new l.default(x.read()-650,O.read()-400-250),t=e.withMagnitude(Math.pow(e.magnitude,.9));w.set(650+t.x),I.set(250+t.y)},draw:function(){var e=new l.default(N.read(),D.read());p.resetTransform(),p.scale(f.read(),f.read()),p.fillStyle="#7F95D1",p.clearRect(0,0,h.read(),d.read()),p.translate(g.read(),y.read()),p.scale(v.read(),v.read()),m.ellipse(e,250,200,{stroke:"#FF709D",strokeWidth:12}),p.lineCap="round",p.lineJoin="round",p.beginPath(),p.moveTo(C[0].points[0].start[0].read(),C[0].points[0].start[1].read());for(var t=1;t<C.length;t++){var n=C[t-1],r=C[t];p.lineTo(n.points[3].rightOuter[0].read(),n.points[3].rightOuter[1].read()),p.bezierCurveTo(n.points[1].rightOuter[0].read(),n.points[1].rightOuter[1].read(),r.points[1].leftOuter[0].read(),r.points[1].leftOuter[1].read(),r.points[3].leftOuter[0].read(),r.points[3].leftOuter[1].read())}p.lineTo(C[C.length-1].points[0].start[0].read(),C[C.length-1].points[0].start[1].read()),p.fillStyle="#FF709D",p.fill();for(var i=0;i<P.length;i++)ve(p,P[i],"#FF709D",de,0),ve(p,P[i],"#FF4782",34,3);m.ellipse(e,250,200,{fill:"#FF4782"}),p.beginPath(),p.moveTo(C[0].points[0].start[0].read(),C[0].points[0].start[1].read());for(var a=1;a<C.length;a++){var o=C[a-1],s=C[a];p.lineTo(o.points[1].rightInner[0].read(),o.points[1].rightInner[1].read()),p.bezierCurveTo(o.points[0].rightInner[0].read(),o.points[0].rightInner[1].read(),s.points[0].leftInner[0].read(),s.points[0].leftInner[1].read(),s.points[1].leftInner[0].read(),s.points[1].leftInner[1].read())}p.lineTo(C[C.length-1].points[0].start[0].read(),C[C.length-1].points[0].start[1].read()),p.fillStyle="#FF4782",p.fill(),m.debugPointX(new l.default(x.read(),O.read()),{label:"avg end"})},children:o.createElement(ge,{canvasScaleSignal:v,canvasTranslateXSignal:g,canvasTranslateYSignal:y,onNoteDown:function(e,t,n){var r,i=null!==(r=s.sample(C.filter((function(e){return!R.has(e)}))))&&void 0!==r?r:s.sample(C);R.set(i,e),i.isActive.set(1),i.activeTargetX.set(t),i.activeTargetY.set(n)},onNoteUp:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=R.entries()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=a.slicedToArray(i.value,2),u=s[0];s[1]===e&&(R.delete(u),u.isActive.set(0))}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}})}}),!0)}();
//# sourceMappingURL=index.70c831d1.js.map
