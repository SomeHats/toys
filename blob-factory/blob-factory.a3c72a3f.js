import{b as A,f as re,a as L,g as de,c as C,d as P,t as Q,s as M,r as x,i as he}from"../chunks/chunk_assert.67ae27bf.js";/* empty css                               */import{u as U,e as k,m as ge,d as I,c as fe,a as pe,s as me}from"../chunks/chunk_debugPropsToString.8c4221d5.js";import{r as b}from"../chunks/chunk_index.0b2a17fa.js";import{V as w}from"../chunks/chunk_Vector2.60c0b602.js";import{D as be}from"../chunks/chunk_DebugDraw.e943e3cf.js";import{j as l,F as oe,a as E,c as Re}from"../chunks/chunk_jsx-runtime.3f231529.js";import"../chunks/chunk__commonjsHelpers.fbcca4d8.js";function v(e){return WebGL2RenderingContext[e]}var F=(e=>(e.Fragment="FRAGMENT_SHADER",e.Vertex="VERTEX_SHADER",e))(F||{}),se=(e=>(e.StaticDraw="STATIC_DRAW",e.DynamicDraw="DYNAMIC_DRAW",e.StreamDraw="STREAM_DRAW",e.StaticRead="STATIC_READ",e.DynamicRead="DYNAMIC_READ",e.StreamRead="STREAM_READ",e.StaticCopy="STATIC_COPY",e.DynamicCopy="DYNAMIC_COPY",e.StreamCopy="STREAM_COPY",e))(se||{}),ne=(e=>(e.Byte="BYTE",e.UnsignedByte="UNSIGNED_BYTE",e.Short="SHORT",e.UnsignedShort="UNSIGNED_SHORT",e.Float="FLOAT",e.HalfFloat="HALF_FLOAT",e))(ne||{}),ie=(e=>(e.Rgb="RGB",e.Rgba="RGBA",e.LuminanceAlpha="LUMINANCE_ALPHA",e.Luminance="LUMINANCE",e.Alpha="ALPHA",e.Red="RED",e.RedInteger="RED_INTEGER",e.Rg="RG",e.RgInteger="RG_INTEGER",e.RgbInteger="RGB_INTEGER",e.RgbaInteger="RGBA_INTEGER",e))(ie||{}),ae=(e=>(e.UnsignedByte="UNSIGNED_BYTE",e.UnsignedShort565="UNSIGNED_SHORT_5_6_5",e.UnsignedShort4444="UNSIGNED_SHORT_4_4_4_4",e.UnsignedShort5551="UNSIGNED_SHORT_5_5_5_1",e.HalfFloat="HALF_FLOAT",e.Float="FLOAT",e.UnsignedInt10f11f11fRev="UNSIGNED_INT_10F_11F_11F_REV",e.UnsignedInt2101010Rev="UNSIGNED_INT_2_10_10_10_REV",e))(ae||{}),ce=(e=>(e.Rgb="RGB",e.Rgba="RGBA",e.LuminanceAlpha="LUMINANCE_ALPHA",e.Luminance="LUMINANCE",e.Alpha="ALPHA",e.R8="R8",e.R16f="R16F",e.R32f="R32F",e.R8ui="R8UI",e.Rg8="RG8",e.Rg16f="RG16F",e.Rg32f="RG32F",e.Rg8ui="RG8UI",e.Rgb8="RGB8",e.Srgb8="SRGB8",e.Rgb565="RGB565",e.R11fG11fB10f="R11F_G11F_B10F",e.Rgb9E5="RGB9_E5",e.Rgb16f="RGB16F",e.Rgb32f="RGB32F",e.Rgb8ui="RGB8UI",e.Rgba8="RGBA8",e.Srgb8Alpha8="SRGB8_ALPHA8",e.Rgb5A1="RGB5_A1",e.Rgb10A2="RGB10_A2",e.Rgba4="RGBA4",e.Rgba16f="RGBA16F",e.Rgba32f="RGBA32F",e.Rgba8ui="RGBA8UI",e))(ce||{}),V=(e=>(e.Linear="LINEAR",e.Nearest="NEAREST",e.NearestMipmapNearest="NEAREST_MIPMAP_NEAREST",e.LinearMipmapNearest="LINEAR_MIPMAP_NEAREST",e.NearestMipmapLinear="NEAREST_MIPMAP_LINEAR",e.LinearMipmapLinear="LINEAR_MIPMAP_LINEAR",e))(V||{}),H=(e=>(e.Repeat="REPEAT",e.ClampToEdge="CLAMP_TO_EDGE",e.MirroredRepeat="MIRRORED_REPEAT",e))(H||{});class B{constructor(r,t,s,o){this.gl=r,this.name=t,this.location=s,this.value=o}}class ve extends B{apply(){this.gl.gl.uniform2f(this.location,this.value.x,this.value.y)}}class ye extends B{apply(){this.gl.gl.uniform1f(this.location,this.value)}}class Ee extends B{apply(){this.gl.gl.uniform1ui(this.location,this.value?1:0)}}class _e extends B{apply(){this.gl.gl.uniform1i(this.location,this.value.textureUnit)}}class Ae extends B{apply(){this.gl.gl.uniform1i(this.location,this.value)}}class xe{constructor(r,t,s){this.gl=r,this.vertexArray=t,this.buffer=s}bufferData(r,t){const{gl:s}=this.gl;s.bindBuffer(s.ARRAY_BUFFER,this.buffer),s.bufferData(s.ARRAY_BUFFER,r,v(t))}bindVao(){const{gl:r}=this.gl;r.bindVertexArray(this.vertexArray)}}class Se{constructor(r,t,s){this.vertexShader=t,this.fragmentShader=s,this.uniforms=[],this.gl=r;const{gl:o}=r,n=A(o.createProgram());if(o.attachShader(n,t.shader),o.attachShader(n,s.shader),o.linkProgram(n),!o.getProgramParameter(n,o.LINK_STATUS)){const u=`Failed to link shaders: ${o.getProgramInfoLog(n)}`;o.deleteProgram(n),re(u)}this.program=n}createAndBindVertexArray({name:r,size:t,type:s,normalize:o=!1,stride:n=0,offset:f=0}){const{gl:u}=this.gl,p=this.gl.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,p);const d=this.gl.createVertexArray();u.bindVertexArray(d);const a=u.getAttribLocation(this.program,r);return u.enableVertexAttribArray(a),u.vertexAttribPointer(a,t,v(s),o,n,f),new xe(this.gl,d,p)}getUniformLocation(r){return A(this.gl.gl.getUniformLocation(this.program,r),`uniform ${r} does not exist`)}addUniform(r,t,s){const o=new r(this.gl,t,this.getUniformLocation(t),s);return this.uniforms.push(o),o}uniformVector2(r,t){return this.addUniform(ve,r,t)}uniformFloat(r,t){return this.addUniform(ye,r,t)}uniformBool(r,t){return this.addUniform(Ee,r,t)}uniformTexture2d(r,t){return this.addUniform(_e,r,t)}uniformEnum(r,t){return this.addUniform(Ae,r,t)}use(){this.gl.gl.useProgram(this.program);for(const r of this.uniforms)r.apply()}}class we{constructor(r,t,s){this.type=t,this.gl=r;const{gl:o}=r,n=A(o.createShader(v(t)));if(o.shaderSource(n,s),o.compileShader(n),!o.getShaderParameter(n,o.COMPILE_STATUS)){const u=`Failed to compile shader: ${o.getShaderInfoLog(n)}`;o.deleteShader(n),re(u)}this.shader=n}}class Ne{constructor(r,t,s,o){this.gl=r,this.textureUnit=t,this.format=s,this.data=null,this.level=o!=null?o:0,this.texture=A(r.gl.createTexture())}set(r){this.data=r}bind(){const{gl:r}=this.gl;r.activeTexture(r.TEXTURE0+this.textureUnit),r.bindTexture(r.TEXTURE_2D,this.texture)}configure(r){const{gl:t}=this.gl;this.bind(),r.magFilter&&t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,v(r.magFilter)),r.minFilter&&t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,v(r.minFilter)),r.wrapS&&t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,v(r.wrapS)),r.wrapT&&t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,v(r.wrapT))}configureForData(){this.configure({magFilter:V.Nearest,minFilter:V.Nearest,wrapS:H.ClampToEdge,wrapT:H.ClampToEdge})}upload(){L(this.data,"data must be set on texture to upload"),this.bind(),this.gl.gl.texImage2D(WebGL2RenderingContext.TEXTURE_2D,this.level,v(this.format.internalFormat),this.data.width,this.data.height,0,v(this.format.pixelFormat),v(this.format.pixelType),this.data.data)}update(r){this.set(r),this.upload()}}class Ce{constructor(r){this.canvas=r,this.shaders=new T((s,o)=>new we(this,s,o),s=>this.gl.deleteShader(s.shader)),this.programs=new T((s,o)=>new Se(this,s,o),s=>this.gl.deleteProgram(s.program)),this.buffers=new T(()=>A(this.gl.createBuffer()),s=>this.gl.deleteBuffer(s)),this.vertexArrays=new T(()=>A(this.gl.createVertexArray()),s=>this.gl.deleteVertexArray(s)),this.textures=new T((s,o,n)=>new Ne(this,s,o,n),s=>this.gl.deleteTexture(s.texture));const t=r.getContext("webgl2");L(t,"browser does not support webgl2"),this.gl=t}destory(){this.shaders.destroyAll(),this.programs.destroyAll(),this.buffers.destroyAll(),this.vertexArrays.destroyAll(),this.textures.destroyAll()}createShader(r,t){return this.shaders.create(r,t)}createProgram(r,t){return this.programs.create(r,t)}createBuffer(){return this.buffers.create()}createVertexArray(){return this.vertexArrays.create()}createTexture(r,t,s){return this.textures.create(r,t,s)}setDefaultViewport(){this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}clear(){const{gl:r}=this;r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT)}enumToString(r){const t=[];for(const s in this.gl)de(this.gl,s)===r&&t.push(s);return t.length?t.join(" | "):`0x${r.toString(16)}`}}class T{constructor(r,t){this.initializeResource=r,this.deleteResource=t,this.resources=[]}create(...r){const t=this.initializeResource(...r);return this.resources.push(t),t}destroyAll(){for(const r of this.resources)this.deleteResource(r);this.resources=[]}}var De=`#version 300 es
#define MAX_BLOBS 32
#define ENTRIES_PER_BLOB 2
#define MODE_BLUR 0
#define MODE_INSIDE 1
#define MODE_OUTSIDE 2
#define MODE_FILL 3
precision highp float;uniform sampler2D u_blobs;uniform float u_smoothness;uniform float u_blurSize;uniform float u_blurSpread;uniform int u_mode;in vec2 screenPosition;out vec4 outColor;float map(float value,float min1,float max1,float min2,float max2){return min2+(value-min1)*(max2-min2)/(max1-min1);}float sdfCircle(vec2 center,float radius){return length(center-screenPosition)-radius;}float opSmoothUnion(float d1,float d2,float k){float h=clamp(0.5+0.5*(d2-d1)/k,0.0,1.0);return mix(d2,d1,h)-k*h*(1.0-h);}float xyzF(float t){return mix(pow(t,1./3.),7.787037*t+0.139731,step(t,0.00885645));}float xyzR(float t){return mix(t*t*t,0.1284185*(t-0.139731),step(t,0.20689655));}vec3 rgb2lch(in vec3 c){vec3 wref=vec3(1.0,1.0,1.0);c*=mat3(0.4124,0.3576,0.1805,0.2126,0.7152,0.0722,0.0193,0.1192,0.9505);c.x=xyzF(c.x/wref.x);c.y=xyzF(c.y/wref.y);c.z=xyzF(c.z/wref.z);vec3 lab=vec3(max(0.,116.0*c.y-16.0),500.0*(c.x-c.y),200.0*(c.y-c.z));return vec3(lab.x,length(vec2(lab.y,lab.z)),atan(lab.z,lab.y));}vec3 lch2rgb(in vec3 c){vec3 wref=vec3(1.0,1.0,1.0);c=vec3(c.x,cos(c.z)*c.y,sin(c.z)*c.y);float lg=1./116.*(c.x+16.);vec3 xyz=vec3(wref.x*xyzR(lg+0.002*c.y),wref.y*xyzR(lg),wref.z*xyzR(lg-0.005*c.z));vec3 rgb=xyz*mat3(3.2406,-1.5372,-0.4986,-0.9689,1.8758,0.0415,0.0557,-0.2040,1.0570);return rgb;}float easeInOutCubic(in float t){return t<0.5 ? 4.*t*t*t:(t-1.)*(2.*t-2.)*(2.*t-2.)+1.;}float expDropOff(in float t,in float k){return 1./((t/k)+1.);}void main(){int blobCount=min(textureSize(u_blobs,0).x/ENTRIES_PER_BLOB,MAX_BLOBS);float totalStrength=0.;vec3 totalColor=vec3(0);float dist=99999.0;for(int i=0;i<blobCount;i++){vec4 d1=texelFetch(u_blobs,ivec2(i*ENTRIES_PER_BLOB,0),0);vec2 center=d1.xy;float radius=d1.z;vec3 blobColor=rgb2lch(texelFetch(u_blobs,ivec2((i*ENTRIES_PER_BLOB)+1,0),0).rgb);float sd=sdfCircle(center,radius);float strength=mix(smoothstep(1.0,0.0,sd/(u_blurSize*2.)),expDropOff(sd,u_blurSize),smoothstep(0.,1.,sd/u_blurSize));strength=pow(strength,5.0);totalStrength+=strength;totalColor+=blobColor*strength;dist=opSmoothUnion(sd,dist,u_smoothness);}float cutoff=smoothstep(0.0,1.0,-dist);if(u_mode==MODE_BLUR){outColor=vec4(mix(vec3(0),lch2rgb(totalColor/totalStrength),clamp(pow(totalStrength,1.-u_blurSpread),0.,1.)),1);}else if(u_mode==MODE_INSIDE){outColor=vec4(mix(vec3(0,0,0),lch2rgb(totalColor/totalStrength),cutoff),1);}else if(u_mode==MODE_OUTSIDE){outColor=vec4(mix(lch2rgb(totalColor/totalStrength),vec3(0,0,0),cutoff),1);}else if(u_mode==MODE_FILL){outColor=vec4(lch2rgb(totalColor/totalStrength),1);}}`,Ue=`#version 300 es
in vec2 a_position;uniform vec2 u_resolution;out vec2 screenPosition;void main(){screenPosition=a_position;vec2 zeroToOne=a_position/u_resolution;vec2 zeroToTwo=zeroToOne*2.0;vec2 clipSpace=zeroToTwo-1.0;gl_Position=vec4(clipSpace*vec2(1,-1),0,1);}`;function Te(){const[e,r]=b.exports.useState([]),t=b.exports.useRef([]),s=U((p,d,a)=>{var g,h;return t.current.push({type:"range",label:p,value:d,oldValue:d,...a}),(h=(g=e.find(m=>m.type==="range"&&m.label===p&&m.oldValue===d))==null?void 0:g.value)!=null?h:d}),o=U(function(d,a,g){var h,m;return t.current.push({type:"colorPicker",label:d,value:a,options:g,oldValue:a}),(m=(h=e.find(R=>R.type==="colorPicker"&&R.label===d&&k(R.oldValue,a)))==null?void 0:h.value)!=null?m:a}),n=U(function(d,a,g){var h,m;return t.current.push({type:"segmentedControl",label:d,value:a,options:g,oldValue:a}),(m=(h=e.find(R=>R.type==="segmentedControl"&&R.label===d&&k(R.oldValue,a)))==null?void 0:h.value)!=null?m:a}),f=U((p,d)=>{var a,g;return t.current.push({type:"checkbox",label:p,value:d,oldValue:d}),(g=(a=e.find(h=>h.type==="checkbox"&&h.label===p&&h.oldValue===d))==null?void 0:a.value)!=null?g:d}),u=U(()=>{k(e,t.current)||r(t.current),t.current=[]});return{render:()=>l(Le,{state:e,onChange:r}),ui:b.exports.useMemo(()=>({checkbox:f,range:s,flush:u,colorPicker:o,segmentedControl:n}),[f,o,u,s,n])}}function Le({state:e,onChange:r}){return l(oe,{children:e.map((t,s)=>{switch(t.type){case"checkbox":return l(Be,{label:t.label,value:t.value,onChange:o=>r(P(e,s,{...t,value:o}))},s);case"range":return l(ke,{label:t.label,value:t.value,onChange:o=>r(P(e,s,{...t,value:o})),min:t.min,max:t.max,step:t.step},s);case"colorPicker":return l(Pe,{label:t.label,value:t.value,options:t.options,onChange:o=>r(P(e,s,{...t,value:o}))},s);case"segmentedControl":return l(Ie,{label:t.label,value:t.value,options:t.options,onChange:o=>r(P(e,s,{...t,value:o}))},s);default:C(t)}})})}function ke({label:e,value:r,onChange:t,min:s,max:o,step:n}){const f=b.exports.useId();return E("div",{className:"flex flex-col gap-2 p-3",children:[l("label",{htmlFor:f,children:e}),E("div",{className:"flex items-center justify-between gap-3",children:[l("input",{id:f,className:"w-2/3 flex-auto",type:"range",value:r,min:s,max:o,step:n,onChange:u=>t(u.currentTarget.valueAsNumber)}),l("span",{className:"w-1/3 flex-none text-right",children:r.toPrecision(3)})]})]})}function Be({label:e,value:r,onChange:t}){const s=b.exports.useId();return E("div",{className:"flex gap-3 p-3",children:[l("input",{id:s,type:"checkbox",onChange:o=>t(o.currentTarget.checked),checked:r}),l("label",{htmlFor:s,children:e})]})}function Pe({label:e,value:r,onChange:t,options:s}){return E("div",{className:"flex-col gap-3 p-3",children:[e,l("div",{className:"flex gap-1",children:s.map((o,n)=>l("div",{style:{background:o.color},className:"flex h-6 flex-1 cursor-pointer items-center justify-center",onClick:()=>t(o.value),children:k(o.value,r)&&l("div",{className:"h-3 w-3 rounded-full border-2 border-black bg-white"})},n))})]})}function Ie({label:e,value:r,onChange:t,options:s}){return E("div",{className:"flex-col gap-3 p-3",children:[e,l("div",{className:"flex gap-2",children:s.map((o,n)=>l("button",{className:Re("flex h-6 flex-auto items-center justify-center rounded text-sm",k(o.value,r)?"bg-gray-600":"hover:bg-gray-800"),onClick:()=>t(o.value),children:o.label},n))})]})}const ze={"grey-0":[251,251,252],"grey-5":[237,238,242],"grey-10":[214,215,219],"grey-20":[191,192,196],"grey-30":[169,170,174],"grey-40":[146,147,151],"grey-50":[123,124,128],"grey-60":[102,103,106],"grey-70":[81,82,85],"grey-80":[60,60,63],"grey-90":[39,39,42],"grey-100":[18,18,20],"red-5":[250,241,233],"red-10":[248,213,197],"red-20":[238,178,163],"red-30":[229,144,129],"red-40":[222,110,96],"red-50":[214,78,65],"red-60":[172,61,57],"red-70":[128,44,50],"red-80":[85,27,42],"red-90":[42,10,36],"orange-5":[254,248,226],"orange-10":[252,238,205],"orange-20":[246,215,163],"orange-30":[240,191,122],"orange-40":[240,191,122],"orange-50":[229,146,57],"orange-60":[187,112,44],"orange-70":[145,78,31],"orange-80":[104,43,19],"orange-90":[63,11,8],"yellow-5":[250,252,236],"yellow-10":[247,245,209],"yellow-20":[243,234,171],"yellow-30":[239,224,135],"yellow-40":[236,214,102],"yellow-50":[232,203,77],"yellow-60":[194,159,60],"yellow-70":[155,115,43],"yellow-80":[118,72,26],"yellow-90":[80,30,8],"green-5":[249,252,234],"green-10":[238,246,203],"green-20":[204,233,168],"green-30":[170,220,133],"green-40":[139,208,101],"green-50":[111,195,73],"green-60":[87,156,64],"green-70":[63,117,58],"green-80":[38,78,52],"green-90":[13,38,50],"cyan-5":[242,252,248],"cyan-10":[224,249,238],"cyan-20":[190,231,230],"cyan-30":[157,214,223],"cyan-40":[126,197,215],"cyan-50":[98,180,208],"cyan-60":[76,143,173],"cyan-70":[54,106,138],"cyan-80":[32,70,102],"cyan-90":[32,70,102],"indigo-5":[227,249,254],"indigo-10":[204,239,253],"indigo-20":[165,209,245],"indigo-30":[125,178,237],"indigo-40":[87,149,229],"indigo-50":[54,120,222],"indigo-60":[42,95,181],"indigo-70":[30,69,137],"indigo-80":[18,44,95],"indigo-90":[6,20,54],"purple-5":[246,240,254],"purple-10":[236,223,253],"purple-20":[198,184,245],"purple-30":[162,146,238],"purple-40":[124,108,232],"purple-50":[87,71,226],"purple-60":[72,57,184],"purple-70":[56,43,141],"purple-80":[41,29,99],"purple-90":[26,15,57],"pink-5":[250,240,241],"pink-10":[251,231,236],"pink-20":[243,197,223],"pink-30":[236,163,211],"pink-40":[229,129,199],"pink-50":[224,98,188],"pink-60":[181,80,159],"pink-70":[140,61,129],"pink-80":[98,43,101],"pink-90":[55,25,71]};function _(e){const r=ze[e];return[O(r[0]/255),O(r[1]/255),O(r[2]/255)]}function Me(e){const r=e[0]*255,t=e[1]*255,s=e[2]*255;return"#"+((1<<24)+((r|0)<<16)+((t|0)<<8)+(s|0)).toString(16).slice(1)}const G=new Float32Array(1);function O(e){return G[0]=e,G[0]}const ee=Math.floor(x(5,10)),X=[_("red-50"),_("orange-50"),_("yellow-50"),_("green-50"),_("cyan-50"),_("indigo-50"),_("purple-50"),_("pink-50")],Oe=X.map(e=>({value:e,color:Me(e)}));function Fe({size:e}){const r=b.exports.useRef(null),t=b.exports.useRef(null),s=b.exports.useRef(),o=Te();return b.exports.useEffect(()=>(L(r.current&&t.current),s.current=Ve(r.current,t.current,o.ui),()=>{L(s.current),s.current.destroy(),s.current=void 0}),[o.ui]),b.exports.useEffect(()=>{L(s.current),s.current.setSize(e)},[e]),E(oe,{children:[E("div",{className:"absolute inset-0",onPointerMove:n=>{s.current&&s.current.onPointerMove(w.fromEvent(n))},onPointerDown:n=>{s.current&&s.current.onPointerDown(w.fromEvent(n))},onPointerUp:n=>{s.current&&s.current.onPointerUp(w.fromEvent(n))},children:[l("canvas",{ref:r,width:e.x*window.devicePixelRatio,height:e.y*window.devicePixelRatio,className:"absolute inset-0 h-full w-full"}),l("canvas",{ref:t,width:e.x*window.devicePixelRatio,height:e.y*window.devicePixelRatio,className:"absolute inset-0 h-full w-full"})]}),E("div",{className:"absolute right-0 top-0 h-full w-72 bg-gray-900",children:[E("ul",{className:"list-disc py-3 px-5 text-xs",children:[l("li",{children:"drag circles to move them"}),l("li",{children:"drag an edge to resize"}),l("li",{children:"drag in empty space for a new one"}),l("li",{children:"backspace to delete"}),l("li",{children:"refresh for something new"})]}),o.render()]})]})}const te=[{label:"blur",value:0},{label:"fill",value:3},{label:"inside",value:1},{label:"outside",value:2}];function Ve(e,r,t){let s=w.ZERO,o={type:"idle"};const n=A(r.getContext("2d")),f=new be(n),u=new Ce(e),p=u.createShader(F.Fragment,De),d=u.createShader(F.Vertex,Ue),a=u.createProgram(d,p),g={current:new Float32Array(S.size*ee)},h=Q(ee,c=>{const i=new S(g,c);return i.color=M(X),i.x=x(200,600),i.y=x(200,600),i.radius=x(30,100),i}),m=a.uniformVector2("u_resolution",new w(100,100)),R=a.uniformFloat("u_smoothness",x(50,100)),W=a.uniformFloat("u_blurSize",x(70,150)),j=a.uniformFloat("u_blurSpread",x(.1,.7)),D=a.uniformEnum("u_mode",M(te).value),$=a.createAndBindVertexArray({name:"a_position",size:2,type:ne.Float}),z=u.createTexture(0,{internalFormat:ce.Rgba32f,pixelType:ae.Float,pixelFormat:ie.Rgba});z.configureForData(),a.uniformTexture2d("u_blobs",z);const le=c=>{m.value=c,u.setDefaultViewport();const i=[0,0,c.x,c.y,0,c.y,0,0,c.x,0,c.x,c.y];$.bufferData(new Float32Array(i),se.StaticDraw),J()},K=()=>{switch(o.type){case"idle":case"unconfirmedCreate":case"selected":{let c=1/0,i=null;for(const N of h){const y=N.center.distanceTo(s);y<N.radius+5&&y<c&&(c=y,i=N)}return i}case"moving":case"resizing":return o.blob;default:C(o)}},ue=()=>{switch(o.type){case"idle":case"unconfirmedCreate":return null;case"moving":case"selected":case"resizing":return o.blob;default:C(o)}},J=()=>{D.value=t.segmentedControl("mode",D.value,te),(D.value===1||D.value===2)&&(R.value=t.range("smoothness",R.value,{min:0,max:100,step:.1})),W.value=t.range("blur size",W.value,{min:0,max:150,step:.1}),D.value===0&&(j.value=t.range("blur spread",j.value,{min:.01,max:.99,step:.01})),u.clear(),z.update({width:h.length*2,height:1,data:g.current}),a.use(),$.bindVao(),u.gl.drawArrays(WebGL2RenderingContext.TRIANGLES,0,6),f.clear(),f.ctx.resetTransform(),f.ctx.scale(window.devicePixelRatio,window.devicePixelRatio);const c=K(),i=ue();c&&c!==i&&f.circle(c.center,c.radius,{stroke:"cyan",strokeWidth:1}),i&&(f.circle(i.center,i.radius,{stroke:"cyan",strokeWidth:2}),i.color=t.colorPicker("color",i.color,Oe)),f.fillText(He(o),new w(30,40),{fill:"white"}),t.flush()};let Z=!1;he((c,i)=>{if(Z){i();return}J()});const q=c=>{if(o.type==="selected"&&ge(c,"backspace")){const i=[...g.current];i.splice(o.blob.index*S.size,S.size),g.current=new Float32Array(i),h.pop(),o={type:"idle"}}};return window.addEventListener("keydown",q),{setSize:le,destroy:()=>{u.destory(),window.removeEventListener("keydown",q),Z=!0},onPointerMove:c=>{switch(s=c,o.type){case"idle":case"selected":break;case"moving":o.blob.center=s.add(o.offset);break;case"resizing":o.blob.radius=s.distanceTo(o.blob.center);break;case"unconfirmedCreate":{const i=o.center.distanceTo(s);if(i>5){const N=[...g.current,...Q(S.size,()=>0)];g.current=new Float32Array(N);const y=new S(g,h.length);y.color=M(X),y.center=o.center,y.radius=i,h.push(y),o={type:"resizing",blob:y}}break}default:C(o)}},onPointerDown:c=>{s=c;const i=K();switch(o.type){case"idle":case"selected":{i?Math.abs(i.center.distanceTo(s)-i.radius)<5?o={type:"resizing",blob:i}:o={type:"moving",offset:i.center.sub(s),blob:i}:o={type:"unconfirmedCreate",center:s};break}case"moving":case"unconfirmedCreate":case"resizing":break;default:C(o)}},onPointerUp:c=>{switch(s=c,o.type){case"idle":case"selected":break;case"moving":case"resizing":o={type:"selected",blob:o.blob};break;case"unconfirmedCreate":o={type:"idle"};break;default:C(o)}}}}const Y=class{constructor(e,r){this.backingStore=e,this.index=r}getAt(e){return this.backingStore.current[this.index*Y.size+e]}setAt(e,r){this.backingStore.current[this.index*Y.size+e]=r}get x(){return this.getAt(0)}set x(e){this.setAt(0,e)}get y(){return this.getAt(1)}set y(e){this.setAt(1,e)}get radius(){return this.getAt(2)}set radius(e){this.setAt(2,e)}get center(){return new w(this.x,this.y)}set center(e){this.x=e.x,this.y=e.y}get red(){return this.getAt(4)}set red(e){this.setAt(4,e)}get green(){return this.getAt(5)}set green(e){this.setAt(5,e)}get blue(){return this.getAt(6)}set blue(e){this.setAt(6,e)}get color(){return[this.red,this.green,this.blue]}set color(e){this.red=e[0],this.green=e[1],this.blue=e[2]}toJSON(){return{center:this.center,radius:this.radius}}};let S=Y;S.size=8;function He(e){switch(e.type){case"idle":return I(e.type);case"resizing":case"selected":return I(e.type,{blob:e.blob.index});case"moving":return I(e.type,{offset:e.offset.toString(2),blob:e.blob.index});case"unconfirmedCreate":return I(e.type,{center:e.center.toString(2)})}}fe(A(document.getElementById("root"))).render(l(Xe,{}));function Xe(){const[e,r]=b.exports.useState(null),t=pe(e,me);return l("div",{ref:r,className:"absolute inset-0 touch-none",children:t&&l(Fe,{size:t})})}
