var ht=(d,o,f)=>{if(!o.has(d))throw TypeError("Cannot "+f)};var N=(d,o,f)=>(ht(d,o,"read from private field"),f?f.call(d):o.get(d)),F=(d,o,f)=>{if(o.has(d))throw TypeError("Cannot add the same private member more than once");o instanceof WeakSet?o.add(d):o.set(d,f)},_=(d,o,f,p)=>(ht(d,o,"write to private field"),p?p.call(d,f):o.set(d,f),f);import{a as Pt,S as Tt,q as Mt,b as $,u as Rt,g as Ot}from"./chunk_utils.H-tu124z.js";/* empty css                       */import{j,c as $t}from"./chunk_client.5RwYu7VI.js";import{b as Kt}from"./chunk_DebugSvg.LLK8tK4e.js";import{a as _t,s as Ct}from"./chunk_useResizeObserver.o4ZmQAol.js";import{g as Ut,s as Lt}from"./chunk_storage.jZ4mp_DT.js";import{V as K,S as T,R as ft,a as Nt}from"./chunk_Vector2.KSidYDSo.js";import{r as Z,c as G,S as Ft,a as qt,m as C}from"./chunk_StoreSchema.IwebE68C.js";import{I as Bt}from"./chunk_Ids.UJ8Xuu1j.js";import{b as Qt,t as J}from"./chunk_track.c7N0SHA_.js";import{r as U}from"./chunk_index.Tw3qZeYI.js";import"./chunk_DebugDraw.Y1jwDDI1.js";import"./chunk_svgPathBuilder.fvxo4HjO.js";import"./chunk_ResizeObserver.-NVrOerG.js";import"./chunk__commonjsHelpers.5-cIlDoe.js";var pt,dt;function Zt(){function d(s,r){return function(u){(function(l,t){if(l.v)throw new Error("attempted to call "+t+" after decoration was finished")})(r,"addInitializer"),p(u,"An initializer"),s.push(u)}}function o(s,r){if(!s(r))throw new TypeError("Attempted to access private element on non-instance")}function f(s,r,u,l,t,y,h,b,I){var i;switch(t){case 1:i="accessor";break;case 2:i="method";break;case 3:i="getter";break;case 4:i="setter";break;default:i="field"}var n,e,g={kind:i,name:h?"#"+r:r,static:y,private:h},a={v:!1};if(t!==0&&(g.addInitializer=d(l,a)),h||t!==0&&t!==2)if(t===2)n=function(c){return o(I,c),u.value};else{var v=t===0||t===1;(v||t===3)&&(n=h?function(c){return o(I,c),u.get.call(c)}:function(c){return u.get.call(c)}),(v||t===4)&&(e=h?function(c,w){o(I,c),u.set.call(c,w)}:function(c,w){u.set.call(c,w)})}else n=function(c){return c[r]},t===0&&(e=function(c,w){c[r]=w});var m=h?I.bind():function(c){return r in c};g.access=n&&e?{get:n,set:e,has:m}:n?{get:n,has:m}:{set:e,has:m};try{return s(b,g)}finally{a.v=!0}}function p(s,r){if(typeof s!="function")throw new TypeError(r+" must be a function")}function k(s,r){var u=typeof r;if(s===1){if(u!=="object"||r===null)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");r.get!==void 0&&p(r.get,"accessor.get"),r.set!==void 0&&p(r.set,"accessor.set"),r.init!==void 0&&p(r.init,"accessor.init")}else if(u!=="function"){var l;throw l=s===0?"field":s===10?"class":"method",new TypeError(l+" decorators must return a function or void 0")}}function x(s){return function(r){s(this,r)}}function R(s,r,u,l,t,y,h,b,I){var i,n,e,g,a,v,m,c=u[0];if(h?i=t===0||t===1?{get:(g=u[3],function(){return g(this)}),set:x(u[4])}:t===3?{get:u[3]}:t===4?{set:u[3]}:{value:u[3]}:t!==0&&(i=Object.getOwnPropertyDescriptor(r,l)),t===1?e={get:i.get,set:i.set}:t===2?e=i.value:t===3?e=i.get:t===4&&(e=i.set),typeof c=="function")(a=f(c,l,i,b,t,y,h,e,I))!==void 0&&(k(t,a),t===0?n=a:t===1?(n=a.init,v=a.get||e.get,m=a.set||e.set,e={get:v,set:m}):e=a);else for(var w=c.length-1;w>=0;w--){var S;(a=f(c[w],l,i,b,t,y,h,e,I))!==void 0&&(k(t,a),t===0?S=a:t===1?(S=a.init,v=a.get||e.get,m=a.set||e.set,e={get:v,set:m}):e=a,S!==void 0&&(n===void 0?n=S:typeof n=="function"?n=[n,S]:n.push(S)))}if(t===0||t===1){if(n===void 0)n=function(E,P){return P};else if(typeof n!="function"){var A=n;n=function(E,P){for(var z=P,V=0;V<A.length;V++)z=A[V].call(E,z);return z}}else{var D=n;n=function(E,P){return D.call(E,P)}}s.push(n)}t!==0&&(t===1?(i.get=e.get,i.set=e.set):t===2?i.value=e:t===3?i.get=e:t===4&&(i.set=e),h?t===1?(s.push(function(E,P){return e.get.call(E,P)}),s.push(function(E,P){return e.set.call(E,P)})):t===2?s.push(e):s.push(function(E,P){return e.call(E,P)}):Object.defineProperty(r,l,i))}function O(s,r,u){for(var l,t,y,h=[],b=new Map,I=new Map,i=0;i<r.length;i++){var n=r[i];if(Array.isArray(n)){var e,g,a=n[1],v=n[2],m=n.length>3,c=a>=5,w=u;if(c?(e=s,(a-=5)!==0&&(g=t=t||[]),m&&!y&&(y=function(D){return Ht(D)===s}),w=y):(e=s.prototype,a!==0&&(g=l=l||[])),a!==0&&!m){var S=c?I:b,A=S.get(v)||0;if(A===!0||A===3&&a!==4||A===4&&a!==3)throw new Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+v);!A&&a>2?S.set(v,a):S.set(v,!0)}R(h,e,n,v,a,c,m,g,w)}}return M(h,l),M(h,t),h}function M(s,r){r&&s.push(function(u){for(var l=0;l<r.length;l++)r[l].call(u);return u})}return function(s,r,u,l){return{e:O(s,r,l),get c(){return function(t,y){if(y.length>0){for(var h=[],b=t,I=t.name,i=y.length-1;i>=0;i--){var n={v:!1};try{var e=y[i](b,{kind:"class",name:I,addInitializer:d(h,n)})}finally{n.v=!0}e!==void 0&&(k(10,e),b=e)}return[b,function(){for(var g=0;g<h.length;g++)h[g].call(b)}]}}(s,u)}}}}function St(d,o,f,p){return(St=Zt())(d,o,f,p)}function Ht(d){if(Object(d)!==d)throw TypeError("right-hand side of 'in' should be an object, got "+(d!==null?typeof d:"null"));return d}var q;const at=class at{constructor(o){F(this,q,(dt(this),pt(this,K.ZERO)));this.splat=o}get screenSize(){return N(this,q)}set screenSize(o){_(this,q,o)}get pan(){return this.splat.location.position}set pan(o){this.splat.updateLocation({position:o})}get zoom(){return this.splat.location.zoom}set zoom(o){this.splat.updateLocation({zoom:o})}};q=new WeakMap,[pt,dt]=St(at,[[Z,1,"screenSize"]],[]).e;let tt=at;var gt,vt;function Gt(){function d(s,r){return function(u){(function(l,t){if(l.v)throw new Error("attempted to call "+t+" after decoration was finished")})(r,"addInitializer"),p(u,"An initializer"),s.push(u)}}function o(s,r){if(!s(r))throw new TypeError("Attempted to access private element on non-instance")}function f(s,r,u,l,t,y,h,b,I){var i;switch(t){case 1:i="accessor";break;case 2:i="method";break;case 3:i="getter";break;case 4:i="setter";break;default:i="field"}var n,e,g={kind:i,name:h?"#"+r:r,static:y,private:h},a={v:!1};if(t!==0&&(g.addInitializer=d(l,a)),h||t!==0&&t!==2)if(t===2)n=function(c){return o(I,c),u.value};else{var v=t===0||t===1;(v||t===3)&&(n=h?function(c){return o(I,c),u.get.call(c)}:function(c){return u.get.call(c)}),(v||t===4)&&(e=h?function(c,w){o(I,c),u.set.call(c,w)}:function(c,w){u.set.call(c,w)})}else n=function(c){return c[r]},t===0&&(e=function(c,w){c[r]=w});var m=h?I.bind():function(c){return r in c};g.access=n&&e?{get:n,set:e,has:m}:n?{get:n,has:m}:{set:e,has:m};try{return s(b,g)}finally{a.v=!0}}function p(s,r){if(typeof s!="function")throw new TypeError(r+" must be a function")}function k(s,r){var u=typeof r;if(s===1){if(u!=="object"||r===null)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");r.get!==void 0&&p(r.get,"accessor.get"),r.set!==void 0&&p(r.set,"accessor.set"),r.init!==void 0&&p(r.init,"accessor.init")}else if(u!=="function"){var l;throw l=s===0?"field":s===10?"class":"method",new TypeError(l+" decorators must return a function or void 0")}}function x(s){return function(r){s(this,r)}}function R(s,r,u,l,t,y,h,b,I){var i,n,e,g,a,v,m,c=u[0];if(h?i=t===0||t===1?{get:(g=u[3],function(){return g(this)}),set:x(u[4])}:t===3?{get:u[3]}:t===4?{set:u[3]}:{value:u[3]}:t!==0&&(i=Object.getOwnPropertyDescriptor(r,l)),t===1?e={get:i.get,set:i.set}:t===2?e=i.value:t===3?e=i.get:t===4&&(e=i.set),typeof c=="function")(a=f(c,l,i,b,t,y,h,e,I))!==void 0&&(k(t,a),t===0?n=a:t===1?(n=a.init,v=a.get||e.get,m=a.set||e.set,e={get:v,set:m}):e=a);else for(var w=c.length-1;w>=0;w--){var S;(a=f(c[w],l,i,b,t,y,h,e,I))!==void 0&&(k(t,a),t===0?S=a:t===1?(S=a.init,v=a.get||e.get,m=a.set||e.set,e={get:v,set:m}):e=a,S!==void 0&&(n===void 0?n=S:typeof n=="function"?n=[n,S]:n.push(S)))}if(t===0||t===1){if(n===void 0)n=function(E,P){return P};else if(typeof n!="function"){var A=n;n=function(E,P){for(var z=P,V=0;V<A.length;V++)z=A[V].call(E,z);return z}}else{var D=n;n=function(E,P){return D.call(E,P)}}s.push(n)}t!==0&&(t===1?(i.get=e.get,i.set=e.set):t===2?i.value=e:t===3?i.get=e:t===4&&(i.set=e),h?t===1?(s.push(function(E,P){return e.get.call(E,P)}),s.push(function(E,P){return e.set.call(E,P)})):t===2?s.push(e):s.push(function(E,P){return e.call(E,P)}):Object.defineProperty(r,l,i))}function O(s,r,u){for(var l,t,y,h=[],b=new Map,I=new Map,i=0;i<r.length;i++){var n=r[i];if(Array.isArray(n)){var e,g,a=n[1],v=n[2],m=n.length>3,c=a>=5,w=u;if(c?(e=s,(a-=5)!==0&&(g=t=t||[]),m&&!y&&(y=function(D){return Jt(D)===s}),w=y):(e=s.prototype,a!==0&&(g=l=l||[])),a!==0&&!m){var S=c?I:b,A=S.get(v)||0;if(A===!0||A===3&&a!==4||A===4&&a!==3)throw new Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+v);!A&&a>2?S.set(v,a):S.set(v,!0)}R(h,e,n,v,a,c,m,g,w)}}return M(h,l),M(h,t),h}function M(s,r){r&&s.push(function(u){for(var l=0;l<r.length;l++)r[l].call(u);return u})}return function(s,r,u,l){return{e:O(s,r,l),get c(){return function(t,y){if(y.length>0){for(var h=[],b=t,I=t.name,i=y.length-1;i>=0;i--){var n={v:!1};try{var e=y[i](b,{kind:"class",name:I,addInitializer:d(h,n)})}finally{n.v=!0}e!==void 0&&(k(10,e),b=e)}return[b,function(){for(var g=0;g<h.length;g++)h[g].call(b)}]}}(s,u)}}}}function Et(d,o,f,p){return(Et=Gt())(d,o,f,p)}function Jt(d){if(Object(d)!==d)throw TypeError("right-hand side of 'in' should be an object, got "+(d!==null?typeof d:"null"));return d}class kt{constructor(o){this.parent=o,this.splat=o.splat}toDebugString(){return this.child?`${this.name}.${this.child.toDebugString()}`:this.name}}var L;const ct=class ct{constructor(o){F(this,L,void 0);this.splat=o,_(this,L,(vt(this),gt(this,new At(this)))),this.onPointerDown=f=>{var p,k;(k=(p=this.child).onPointerDown)==null||k.call(p,f)},this.onPointerMove=f=>{var p,k;(k=(p=this.child).onPointerMove)==null||k.call(p,f)},this.onPointerUp=f=>{var p,k;(k=(p=this.child).onPointerUp)==null||k.call(p,f)},this.onPointerCancel=f=>{var p,k;(k=(p=this.child).onPointerCancel)==null||k.call(p,f)}}get child(){return N(this,L)}set child(o){_(this,L,o)}toDebugString(){return`root.${this.child.toDebugString()}`}};L=new WeakMap,[gt,vt]=Et(ct,[[Z,1,"child"]],[]).e;let et=ct;class At extends kt{constructor(){super(...arguments),this.name="idle"}onPointerDown(o){const{activeKeyPoint:f,firstShape:p}=this.splat,k=this.splat.getShapeVersion(p.id,f.id),x=this.splat.history.mark();this.splat.update({...k,rawPoints:[K.fromEvent(o)]}),this.parent.child=new Wt(this.parent,k.id,x)}}class Wt extends kt{constructor(o,f,p){super(o),this.shapeVersionId=f,this.mark=p,this.name="draw"}onPointerMove(o){console.log("onPointerMove",K.fromEvent(o).toString()),this.splat.updateById(this.shapeVersionId,f=>({...f,rawPoints:[...f.rawPoints,K.fromEvent(o)]}))}onPointerUp(o){this.parent.child=new At(this.parent)}onPointerCancel(o){this.splat.history.bailToMark(this.mark)}}var yt,mt,wt;function Xt(){function d(s,r){return function(u){(function(l,t){if(l.v)throw new Error("attempted to call "+t+" after decoration was finished")})(r,"addInitializer"),p(u,"An initializer"),s.push(u)}}function o(s,r){if(!s(r))throw new TypeError("Attempted to access private element on non-instance")}function f(s,r,u,l,t,y,h,b,I){var i;switch(t){case 1:i="accessor";break;case 2:i="method";break;case 3:i="getter";break;case 4:i="setter";break;default:i="field"}var n,e,g={kind:i,name:h?"#"+r:r,static:y,private:h},a={v:!1};if(t!==0&&(g.addInitializer=d(l,a)),h||t!==0&&t!==2)if(t===2)n=function(c){return o(I,c),u.value};else{var v=t===0||t===1;(v||t===3)&&(n=h?function(c){return o(I,c),u.get.call(c)}:function(c){return u.get.call(c)}),(v||t===4)&&(e=h?function(c,w){o(I,c),u.set.call(c,w)}:function(c,w){u.set.call(c,w)})}else n=function(c){return c[r]},t===0&&(e=function(c,w){c[r]=w});var m=h?I.bind():function(c){return r in c};g.access=n&&e?{get:n,set:e,has:m}:n?{get:n,has:m}:{set:e,has:m};try{return s(b,g)}finally{a.v=!0}}function p(s,r){if(typeof s!="function")throw new TypeError(r+" must be a function")}function k(s,r){var u=typeof r;if(s===1){if(u!=="object"||r===null)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");r.get!==void 0&&p(r.get,"accessor.get"),r.set!==void 0&&p(r.set,"accessor.set"),r.init!==void 0&&p(r.init,"accessor.init")}else if(u!=="function"){var l;throw l=s===0?"field":s===10?"class":"method",new TypeError(l+" decorators must return a function or void 0")}}function x(s){return function(r){s(this,r)}}function R(s,r,u,l,t,y,h,b,I){var i,n,e,g,a,v,m,c=u[0];if(h?i=t===0||t===1?{get:(g=u[3],function(){return g(this)}),set:x(u[4])}:t===3?{get:u[3]}:t===4?{set:u[3]}:{value:u[3]}:t!==0&&(i=Object.getOwnPropertyDescriptor(r,l)),t===1?e={get:i.get,set:i.set}:t===2?e=i.value:t===3?e=i.get:t===4&&(e=i.set),typeof c=="function")(a=f(c,l,i,b,t,y,h,e,I))!==void 0&&(k(t,a),t===0?n=a:t===1?(n=a.init,v=a.get||e.get,m=a.set||e.set,e={get:v,set:m}):e=a);else for(var w=c.length-1;w>=0;w--){var S;(a=f(c[w],l,i,b,t,y,h,e,I))!==void 0&&(k(t,a),t===0?S=a:t===1?(S=a.init,v=a.get||e.get,m=a.set||e.set,e={get:v,set:m}):e=a,S!==void 0&&(n===void 0?n=S:typeof n=="function"?n=[n,S]:n.push(S)))}if(t===0||t===1){if(n===void 0)n=function(E,P){return P};else if(typeof n!="function"){var A=n;n=function(E,P){for(var z=P,V=0;V<A.length;V++)z=A[V].call(E,z);return z}}else{var D=n;n=function(E,P){return D.call(E,P)}}s.push(n)}t!==0&&(t===1?(i.get=e.get,i.set=e.set):t===2?i.value=e:t===3?i.get=e:t===4&&(i.set=e),h?t===1?(s.push(function(E,P){return e.get.call(E,P)}),s.push(function(E,P){return e.set.call(E,P)})):t===2?s.push(e):s.push(function(E,P){return e.call(E,P)}):Object.defineProperty(r,l,i))}function O(s,r,u){for(var l,t,y,h=[],b=new Map,I=new Map,i=0;i<r.length;i++){var n=r[i];if(Array.isArray(n)){var e,g,a=n[1],v=n[2],m=n.length>3,c=a>=5,w=u;if(c?(e=s,(a-=5)!==0&&(g=t=t||[]),m&&!y&&(y=function(D){return Yt(D)===s}),w=y):(e=s.prototype,a!==0&&(g=l=l||[])),a!==0&&!m){var S=c?I:b,A=S.get(v)||0;if(A===!0||A===3&&a!==4||A===4&&a!==3)throw new Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+v);!A&&a>2?S.set(v,a):S.set(v,!0)}R(h,e,n,v,a,c,m,g,w)}}return M(h,l),M(h,t),h}function M(s,r){r&&s.push(function(u){for(var l=0;l<r.length;l++)r[l].call(u);return u})}return function(s,r,u,l){return{e:O(s,r,l),get c(){return function(t,y){if(y.length>0){for(var h=[],b=t,I=t.name,i=y.length-1;i>=0;i--){var n={v:!1};try{var e=y[i](b,{kind:"class",name:I,addInitializer:d(h,n)})}finally{n.v=!0}e!==void 0&&(k(10,e),b=e)}return[b,function(){for(var g=0;g<h.length;g++)h[g].call(b)}]}}(s,u)}}}}function jt(d,o,f,p){return(jt=Xt())(d,o,f,p)}function Yt(d){if(Object(d)!==d)throw TypeError("right-hand side of 'in' should be an object, got "+(d!==null?typeof d:"null"));return d}const te=new Bt("undo");var B,Q;const ut=class ut{constructor(o){F(this,B,(wt(this),yt(this,[])));F(this,Q,mt(this,[]));this.splat=o}get undos(){return N(this,B)}set undos(o){_(this,B,o)}get redos(){return N(this,Q)}set redos(o){_(this,Q,o)}get canUndo(){return this.undos.length>0}get canRedo(){return this.redos.length>0}restore(o){Qt(()=>{this.splat.store.clear(),this.splat.store.put(Tt(o.store)),this.splat.ensureStoreIsUsable()})}mark(){const o={id:te.generate(),store:this.splat.store.serialize()};return this.undos=[o,...this.undos],this.redos=[],o.id}undo(){if(this.canUndo){const[o,...f]=this.undos;this.undos=f,this.redos=[o,...this.redos],this.restore(o)}}redo(){if(this.canRedo){const[o,...f]=this.redos;this.redos=f,this.undos=[o,...this.undos],this.restore(o)}}bailToMark(o){const f=this.undos[0];Pt(f.id===o,"Assertion Error: lastUndo.id === mark"),this.undos=this.undos.slice(0,-1),this.restore(f)}};B=new WeakMap,Q=new WeakMap,[yt,mt,wt]=jt(ut,[[Z,1,"undos"],[Z,1,"redos"]],[]).e;let rt=ut;function W(d){const o=new RegExp(`^${d}\\:([a-zA-Z0-9_]+)$`),f=p=>o.test(p)?ft.ok(p):ft.error(new Nt(`Expected ${d}.*, got ${p}`,[]));return T.string.transform(f,f,Mt)}const X=T.object({typeName:T.value("keyPoint"),id:W("keyPoint"),position:K.schema.nullable()}),nt=G("keyPoint",{scope:"document",validator:X.asValidator()}),ot=T.object({typeName:T.value("shape"),id:W("shape")}),it=G("shape",{scope:"document",validator:ot.asValidator()}),Dt=T.object({typeName:T.value("shapeVersion"),id:W("shapeVersion"),keyPointId:X.config.id,shapeId:ot.config.id,rawPoints:T.arrayOf(K.schema)}),zt=G("shapeVersion",{scope:"document",validator:Dt.asValidator()}),Vt=T.object({typeName:T.value("location"),id:W("location"),position:K.schema,zoom:T.number,activeKeyPointId:X.config.id}),st=G("location",{scope:"session",validator:Vt.asValidator()}),Y=st.createId("location"),ee=T.union("typeName",{keyPoint:X,shape:ot,shapeVersion:Dt,location:Vt}),re=qt.create({keyPoint:nt,shape:it,shapeVersion:zt,location:st}),bt=T.objectMap(T.string,ee);class ne extends Ft{constructor(o){super({schema:re,props:{},initialData:o})}}var It;function ie(){function d(s,r){return function(u){(function(l,t){if(l.v)throw new Error("attempted to call "+t+" after decoration was finished")})(r,"addInitializer"),p(u,"An initializer"),s.push(u)}}function o(s,r){if(!s(r))throw new TypeError("Attempted to access private element on non-instance")}function f(s,r,u,l,t,y,h,b,I){var i;switch(t){case 1:i="accessor";break;case 2:i="method";break;case 3:i="getter";break;case 4:i="setter";break;default:i="field"}var n,e,g={kind:i,name:h?"#"+r:r,static:y,private:h},a={v:!1};if(t!==0&&(g.addInitializer=d(l,a)),h||t!==0&&t!==2)if(t===2)n=function(c){return o(I,c),u.value};else{var v=t===0||t===1;(v||t===3)&&(n=h?function(c){return o(I,c),u.get.call(c)}:function(c){return u.get.call(c)}),(v||t===4)&&(e=h?function(c,w){o(I,c),u.set.call(c,w)}:function(c,w){u.set.call(c,w)})}else n=function(c){return c[r]},t===0&&(e=function(c,w){c[r]=w});var m=h?I.bind():function(c){return r in c};g.access=n&&e?{get:n,set:e,has:m}:n?{get:n,has:m}:{set:e,has:m};try{return s(b,g)}finally{a.v=!0}}function p(s,r){if(typeof s!="function")throw new TypeError(r+" must be a function")}function k(s,r){var u=typeof r;if(s===1){if(u!=="object"||r===null)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");r.get!==void 0&&p(r.get,"accessor.get"),r.set!==void 0&&p(r.set,"accessor.set"),r.init!==void 0&&p(r.init,"accessor.init")}else if(u!=="function"){var l;throw l=s===0?"field":s===10?"class":"method",new TypeError(l+" decorators must return a function or void 0")}}function x(s){return function(r){s(this,r)}}function R(s,r,u,l,t,y,h,b,I){var i,n,e,g,a,v,m,c=u[0];if(h?i=t===0||t===1?{get:(g=u[3],function(){return g(this)}),set:x(u[4])}:t===3?{get:u[3]}:t===4?{set:u[3]}:{value:u[3]}:t!==0&&(i=Object.getOwnPropertyDescriptor(r,l)),t===1?e={get:i.get,set:i.set}:t===2?e=i.value:t===3?e=i.get:t===4&&(e=i.set),typeof c=="function")(a=f(c,l,i,b,t,y,h,e,I))!==void 0&&(k(t,a),t===0?n=a:t===1?(n=a.init,v=a.get||e.get,m=a.set||e.set,e={get:v,set:m}):e=a);else for(var w=c.length-1;w>=0;w--){var S;(a=f(c[w],l,i,b,t,y,h,e,I))!==void 0&&(k(t,a),t===0?S=a:t===1?(S=a.init,v=a.get||e.get,m=a.set||e.set,e={get:v,set:m}):e=a,S!==void 0&&(n===void 0?n=S:typeof n=="function"?n=[n,S]:n.push(S)))}if(t===0||t===1){if(n===void 0)n=function(E,P){return P};else if(typeof n!="function"){var A=n;n=function(E,P){for(var z=P,V=0;V<A.length;V++)z=A[V].call(E,z);return z}}else{var D=n;n=function(E,P){return D.call(E,P)}}s.push(n)}t!==0&&(t===1?(i.get=e.get,i.set=e.set):t===2?i.value=e:t===3?i.get=e:t===4&&(i.set=e),h?t===1?(s.push(function(E,P){return e.get.call(E,P)}),s.push(function(E,P){return e.set.call(E,P)})):t===2?s.push(e):s.push(function(E,P){return e.call(E,P)}):Object.defineProperty(r,l,i))}function O(s,r,u){for(var l,t,y,h=[],b=new Map,I=new Map,i=0;i<r.length;i++){var n=r[i];if(Array.isArray(n)){var e,g,a=n[1],v=n[2],m=n.length>3,c=a>=5,w=u;if(c?(e=s,(a-=5)!==0&&(g=t=t||[]),m&&!y&&(y=function(D){return oe(D)===s}),w=y):(e=s.prototype,a!==0&&(g=l=l||[])),a!==0&&!m){var S=c?I:b,A=S.get(v)||0;if(A===!0||A===3&&a!==4||A===4&&a!==3)throw new Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+v);!A&&a>2?S.set(v,a):S.set(v,!0)}R(h,e,n,v,a,c,m,g,w)}}return M(h,l),M(h,t),h}function M(s,r){r&&s.push(function(u){for(var l=0;l<r.length;l++)r[l].call(u);return u})}return function(s,r,u,l){return{e:O(s,r,l),get c(){return function(t,y){if(y.length>0){for(var h=[],b=t,I=t.name,i=y.length-1;i>=0;i--){var n={v:!1};try{var e=y[i](b,{kind:"class",name:I,addInitializer:d(h,n)})}finally{n.v=!0}e!==void 0&&(k(10,e),b=e)}return[b,function(){for(var g=0;g<h.length;g++)h[g].call(b)}]}}(s,u)}}}}function xt(d,o,f,p){return(xt=ie())(d,o,f,p)}function oe(d){if(Object(d)!==d)throw TypeError("right-hand side of 'in' should be an object, got "+(d!==null?typeof d:"null"));return d}const lt=class lt{constructor(o){this.store=o,this.history=new rt(this),this.interaction=new et(this),this.viewport=new tt(this),It(this),this.ensureStoreIsUsable()}ensureStoreIsUsable(){const{allKeyPointIds:o,allShapeIds:f}=this;let p,k;o.length?p=o[0]:(p=nt.createId(),this.insert(nt.create({id:p,position:K.ZERO}))),f.length?k=f[0]:(k=it.createId(),this.insert(it.create({id:k}))),this.getShapeVersionIfExists(k,p)||this.insert(zt.create({keyPointId:p,shapeId:k,rawPoints:[]})),this.get(Y)||this.insert(st.create({id:Y,position:K.ZERO,zoom:1,activeKeyPointId:p}))}get location(){return $(this.store.get(Y),"Assertion Error: this.store.get(LOCATION_ID)")}updateLocation(o){this.store.put([{...this.location,...o}])}get(o){return this.store.get(o)}update(o){const f=$(this.store.get(o.id),"Assertion Error: this.store.get(record.id)");this.store.put([{...f,...o}])}updateById(o,f){const p=$(this.get(o),"Assertion Error: this.get(id)");this.store.put([Rt(p,f)])}insert(o){Pt(!this.get(o.id),"Assertion Error: !this.get(record.id)"),this.store.put([o])}get allKeyPointIdsQuery(){return this.store.query.ids("keyPoint")}get allKeyPointIds(){return Array.from(this.allKeyPointIdsQuery.value).sort()}get activeKeyPoint(){return this.get(this.location.activeKeyPointId)??$(this.get($(this.allKeyPointIds[0],"Assertion Error: this.allKeyPointIds[0]")),"Assertion Error: this.get(assertExists(this.allKeyPointIds[0]))")}get allShapeIdsQuery(){return this.store.query.ids("shape")}get allShapeIds(){return Array.from(this.allShapeIdsQuery.value).sort()}get firstShape(){return $(this.get($(this.allShapeIds[0],"Assertion Error: this.allShapeIds[0]")),"Assertion Error: this.get(assertExists(this.allShapeIds[0]))")}getShapeVersionIfExists(o,f){return this.store.query.record("shapeVersion",()=>({shapeId:{eq:o},keyPointId:{eq:f}})).value}getShapeVersion(o,f){return $(this.getShapeVersionIfExists(o,f),"Assertion Error: this.getShapeVersionIfExists(shapeId, keyPointId)")}};[It]=xt(lt,[[C,3,"allKeyPointIdsQuery"],[C,3,"allKeyPointIds"],[C,3,"activeKeyPoint"],[C,3,"allShapeIdsQuery"],[C,3,"allShapeIds"],[C,3,"firstShape"]],[]).e;let H=lt;function se(){const[d,o]=U.useState(null),f=_t(d,Ct),[p,k]=U.useState(null);return U.useEffect(()=>{const x=Ut("splatapus3.doc",bt,()=>({})),R=new ne(x);k(R);const O=Ot(1e3,()=>{Lt("splatapus3.doc",bt,R.serialize("all"))}),M=R.listen(()=>{O()});return()=>{M(),O.cancel()}},[]),j.jsx("div",{ref:o,className:"absolute inset-0 touch-none select-none overflow-hidden",children:f&&p&&j.jsx(ae,{size:f,store:p})})}const ae=J(function({size:o,store:f}){const[p,k]=U.useState(()=>new H(f));p.store!==f&&k(new H(f));const x=U.useRef(null);return U.useLayoutEffect(()=>{p.viewport.screenSize=o},[p,o]),j.jsx(j.Fragment,{children:j.jsxs("div",{ref:x,className:"absolute inset-0",onPointerDown:p.interaction.onPointerDown,onPointerMove:p.interaction.onPointerMove,onPointerUp:p.interaction.onPointerUp,onPointerCancel:p.interaction.onPointerCancel,children:[p.interaction.toDebugString(),j.jsx(ce,{splat:p})]})})}),ce=J(function({splat:o}){const{screenSize:f}=o.viewport;return j.jsx("svg",{viewBox:`0 0 ${f.x} ${f.y}`,className:"absolute left-0 top-0",children:j.jsx("g",{children:j.jsx(ue,{splat:o})})})}),ue=J(function({splat:o}){const{allShapeIds:f}=o;return j.jsx(j.Fragment,{children:f.map(p=>j.jsx(le,{shapeId:p,splat:o},p))})}),le=J(function({shapeId:o,splat:f}){const p=f.getShapeVersion(o,f.activeKeyPoint.id);return j.jsx(j.Fragment,{children:j.jsx(Kt,{points:p.rawPoints})})}),he=$(document.getElementById("root"),'Assertion Error: document.getElementById("root")');$t(he).render(j.jsx(se,{}));
