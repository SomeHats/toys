import{T as G,c as X,a as $,U as O,b as K}from"./chunk_utils.H-tu124z.js";/* empty css                       */import{j as e,c as Y}from"./chunk_client.5RwYu7VI.js";import{A as R}from"./chunk_AABB.ZrI-bpu8.js";import{S as z,V as S,R as Z}from"./chunk_Vector2.KSidYDSo.js";import{a as _,b as J,u as H}from"./chunk_useResizeObserver.o4ZmQAol.js";import{u as Q}from"./chunk_useGestureDetector.yKk2dzEl.js";import{u as tt,A as et}from"./chunk_useKeyPress.O945nJHs.js";import{b as ot}from"./chunk_useStoredState.8OuyN3-h.js";import{B as nt}from"./chunk_Button.3zUKvJkI.js";import{S as L}from"./chunk_svgPathBuilder.fvxo4HjO.js";import{a as st,r as b,R as rt}from"./chunk_index.Tw3qZeYI.js";import{C as it}from"./chunk_Circle.2fYfv-yd.js";import{C as at}from"./chunk_StraightPathSegment.CtcZZfXK.js";import{P as ct}from"./chunk_Path._w4PcqLy.js";import{c as lt}from"./chunk_index.f10NbkGF.js";import"./chunk_ResizeObserver.-NVrOerG.js";import"./chunk_storage.jZ4mp_DT.js";import"./chunk_theme.6peXtGe0.js";import"./chunk_EventEmitter.lFuS8-S7.js";import"./chunk__commonjsHelpers.5-cIlDoe.js";import"./chunk_Line2.VgGGsI--.js";const M=class M{constructor(o){this.points=o}insertPointAtIndex(o,s){return new M(G(this.points,o,s))}updatePointAtIndex(o,s){return new M(X(this.points,o,s))}getClosestPointTo(o){if(this.points.length===0)return null;let s=0,n=this.points[0].distanceTo(o);for(let r=1;r<this.points.length;r++){const u=this.points[r].distanceTo(o);u<n&&(s=r,n=u)}return{index:s,point:this.points[s],distance:n}}getClosestPointIndexWithinRadius(o,s){const n=this.getClosestPointTo(o);return n&&n.distance<=s?n.index:null}};M.schema=z.arrayOf(S.schema).transform(o=>Z.ok(new M(o)),z.cannotValidate("SplineTimeLine"),o=>o.points);let N=M;const q=8;function V({control:t,target:o}){return e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:o.x,y1:o.y,x2:t.x,y2:t.y,className:"stroke-purple-400",fill:"none",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:t.x,cy:t.y,r:4,strokeWidth:2,className:"fill-white stroke-purple-400"})]})}function D({path:t}){return e.jsx("path",{d:t,className:"stroke-fuchsia-500",fill:"none",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"})}function B({from:t,to:o}){const s=t.distanceTo(o);let r=Math.ceil(s/5);r%2===1&&(r+=1);const a=s/r;return e.jsx("line",{x1:t.x,y1:t.y,x2:o.x,y2:o.y,className:"stroke-purple-300",fill:"none",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:`0 ${a}`})}function W({from:t,to:o,progress:s}){const n=o.sub(t).normalize().perpendicular(),r=t.lerp(o,s),a=r.add(n.scale(q/2)),u=r.add(n.scale(-q/2));return e.jsx("line",{x1:a.x,y1:a.y,x2:u.x,y2:u.y,className:"stroke-purple-500",fill:"none",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"})}function F({label:t,uiTarget:o,children:s}){return st.createPortal(e.jsxs("div",{className:"flex items-baseline justify-between gap-3",onPointerDown:n=>n.stopPropagation(),onPointerMove:n=>n.stopPropagation(),onPointerUp:n=>n.stopPropagation(),onPointerCancel:n=>n.stopPropagation(),children:[e.jsx("div",{className:"flex-auto p-3 font-semibold text-stone-500",children:t}),e.jsx("div",{className:"flex flex-none items-center justify-center gap-3 p-3",children:s})]}),o)}function pt(t){return e.jsx(dt,{...t})}function dt({line:t,showExtras:o,uiTarget:s}){const[n,r]=b.useState(.333),a=[],u=[],i=new L;switch(t.points.length){case 0:case 1:return null;case 2:i.moveTo(t.points[0]),i.lineTo(t.points[1]);break;default:{i.moveTo(t.points[0]);let x=null;for(let l=0;l<t.points.length-1;l++){const c=t.points[l],p=t.points[l+1],d=t.points[l+2],m=c.distanceTo(p);let f;if(x&&(f=c.add(x.scale(m*n)),a.push({target:c,control:f})),d){const j=p.distanceTo(d),w=m+j,h=c.lerp(d,m/w),g=(d.x-c.x)*(p.y-c.y)-(d.y-c.y)*(p.x-c.x)>0;u.push(e.jsx(B,{from:c,to:d})),u.push(e.jsx(B,{from:h,to:p}));let P=p.sub(h).normalize().perpendicular();g||(P=P.scale(-1));const T=p.sub(P.scale(m*n));a.push({target:p,control:T}),f?i.bezierCurveTo(f,T,p):i.quadraticCurveTo(T,p),x=P}else $(f,"Assertion Error: controlPointBefore"),i.quadraticCurveTo(f,p)}}}return e.jsxs(e.Fragment,{children:[o&&a.map(({target:x,control:l},c)=>e.jsx(V,{target:x,control:l},c)),o&&u.map((x,l)=>e.jsx(b.Fragment,{children:x},l)),e.jsx(D,{path:i.toString()}),e.jsxs(F,{label:"alex mode",uiTarget:s,children:["slop:",e.jsx("input",{type:"range",value:n,onChange:x=>r(x.currentTarget.valueAsNumber),min:0,max:1,step:.001}),e.jsx("span",{className:"tabular-nums",children:n.toFixed(2)})]})]})}function ut({line:t,uiTarget:o,showExtras:s}){const n=[],r=new L;switch(t.points.length){case 0:case 1:return null;case 2:{r.moveTo(t.points[0]),r.lineTo(t.points[1]);break}default:{r.moveTo(t.points[0]);let a=t.points[0].lerp(t.points[1],.5);r.lineTo(a);for(let u=1;u<t.points.length-1;u++){const i=t.points[u],x=t.points[u+1],l=i.lerp(x,.5),c=a.distanceTo(i),p=l.distanceTo(i),d=Math.min(c,p),m=i.lerp(a,d/c),f=i.lerp(l,d/p);n.push(e.jsx(W,{from:i,to:a,progress:d/c})),n.push(e.jsx(W,{from:i,to:l,progress:d/p})),r.lineTo(m);const j=ct.segmentAcrossCircle(new it(i,d),m.angleTo(i),i.angleTo(f));j instanceof at?(r.lineTo(m),r.arcTo(j.circle.radius,j.circle.radius,0,0,j.isAnticlockwise?0:1,f)):r.lineTo(f),a=l}r.lineTo(t.points[t.points.length-1])}}return e.jsxs(e.Fragment,{children:[s&&n.map((a,u)=>e.jsx(b.Fragment,{children:a},u)),e.jsx(D,{path:r.toString()}),e.jsx(F,{uiTarget:o,label:"arcs"})]})}function xt(t){return e.jsx(ht,{...t})}function ht({line:t,showExtras:o,uiTarget:s}){const[n,r]=b.useState(.5);if(t.points.length<2)return null;const a=[],u=new L;u.moveTo(t.points[0]);for(let i=0;i<t.points.length-1;i++){const x=i==0?t.points[0]:t.points[i-1],l=t.points[i],c=t.points[i+1],p=i+2<t.points.length?t.points[i+2]:c,d=Math.sqrt(Math.pow(x.x-l.x,2)+Math.pow(x.y-l.y,2)),m=Math.sqrt(Math.pow(l.x-c.x,2)+Math.pow(l.y-c.y,2)),f=Math.sqrt(Math.pow(c.x-p.x,2)+Math.pow(c.y-p.y,2)),j=Math.pow(f,n),w=Math.pow(f,2*n),h=Math.pow(m,n),g=Math.pow(m,2*n),P=Math.pow(d,n),T=Math.pow(d,2*n),v=2*T+3*P*h+g,k=2*w+3*j*h+g;let y=3*P*(P+h);y>0&&(y=1/y);let A=3*j*(j+h);A>0&&(A=1/A);let I=new S((-g*x.x+v*l.x+T*c.x)*y,(-g*x.y+v*l.y+T*c.y)*y),C=new S((w*l.x+k*c.x-g*p.x)*A,(w*l.y+k*c.y-g*p.y)*A);I.x==0&&I.y==0&&(I=l),C.x==0&&C.y==0&&(C=c),a.push({target:l,control:I}),a.push({target:c,control:C}),u.bezierCurveTo(I,C,c)}return e.jsxs(e.Fragment,{children:[o&&a.map(({target:i,control:x},l)=>e.jsx(V,{target:i,control:x},l)),e.jsx(D,{path:u.toString()}),e.jsxs(F,{label:"catmull-rom",uiTarget:s,children:["alpha:",e.jsx("input",{type:"range",value:n,onChange:i=>r(i.currentTarget.valueAsNumber),min:.001,max:1,step:.001}),e.jsx("span",{className:"tabular-nums",children:n.toFixed(2)})]})]})}function mt({line:t,uiTarget:o}){const s=new L;switch(t.points.length){case 0:case 1:return null;case 2:{s.moveTo(t.points[0]),s.lineTo(t.points[1]);break}default:s.moveTo(t.points[0]),s.lineTo(t.points[0].lerp(t.points[1],.5));for(let n=1;n<t.points.length-1;n++)s.quadraticCurveTo(t.points[n],t.points[n].lerp(t.points[n+1],.5));s.lineTo(t.points[t.points.length-1])}return e.jsxs(e.Fragment,{children:[e.jsx(D,{path:s.toString()}),e.jsx(F,{uiTarget:o,label:"midpoint quadratic"})]})}function ft({line:t,showExtras:o}){if(!o)return null;const s=O(t.points,2).map(([n,r],a)=>e.jsx(W,{from:n,to:r,progress:.5},a));return e.jsx(e.Fragment,{children:s})}function U({style:t}){return t==="final"?({line:o})=>{if(!o.points.length)return null;const s=new L;s.moveTo(o.points[0]);for(let n=1;n<o.points.length;n++)s.lineTo(o.points[n]);return e.jsx(D,{path:s.toString()})}:({line:o})=>{const s=O(o.points,2).map(([n,r],a)=>e.jsx(B,{from:n,to:r},a));return e.jsx(e.Fragment,{children:s})}}const gt=20,Pt=[[-150,75],[0,-50],[0,50],[150,-75]].map(([t,o])=>new S(t,o));function jt(){const[t,o]=b.useState(null),s=_(t,J),[n,r]=ot("splineTime.line",N.schema,()=>new N(Pt));return e.jsxs("div",{className:"absolute inset-0 flex flex-col bg-stone-100",children:[e.jsxs("div",{className:"flex flex-none items-center justify-between gap-3 bg-stone-100 px-4 py-3",children:[e.jsx("h1",{className:"flex-none font-bold tracking-wide text-stone-600",children:"spline time"}),e.jsx("div",{className:"text-stone-500",children:"click/drag to create/move points. hold shift to hide annotations."}),e.jsx(nt,{onClick:()=>r(new N([])),children:"reset"})]}),e.jsx("div",{className:"relative flex-auto touch-none",ref:o,children:s&&e.jsx(yt,{size:s,line:n,setLine:r})})]})}function yt({size:t,line:o,setLine:s}){const r=(t.x-48)/2,a=(t.y-16*2)/2,u=!tt({key:"Shift",shift:et}),i=H(h=>{const g=h.currentTarget.getBoundingClientRect();return new S(h.clientX-g.left-r/2,h.clientY-g.top-a/2)}),x=H(h=>o.getClosestPointIndexWithinRadius(i(h),gt)),[l,c]=b.useState(null),{events:p,isGestureInProgress:d}=Q({onDragStart:h=>{h.preventDefault();const g=i(h),{pointIndex:P,offset:T}=(()=>{const v=x(h);if(v!==null)return{pointIndex:v,offset:o.points[v].sub(g)};const k=o.points.length;return s(y=>y.insertPointAtIndex(k,g)),{pointIndex:k,offset:S.ZERO}})();return c(P),{couldBeTap:!1,pointerCapture:!0,onMove:v=>{const k=i(v);s(y=>y.updatePointAtIndex(P,k.add(T)))},onEnd:v=>{const k=i(v);s(y=>y.updatePointAtIndex(P,k.add(T))),c(null)},onCancel:()=>{c(null)}}}}),[m,f]=b.useState(null),w={line:o,hoveredPointIdx:d?null:m,activePointIdx:l,showExtras:u,onPointerDown:p.onPointerDown,onPointerMove:h=>{d||f(x(h)),p.onPointerMove(h)},onPointerUp:p.onPointerUp,onPointerCancel:p.onPointerCancel};return e.jsxs(e.Fragment,{children:[e.jsx(E,{...w,layers:[u&&U({style:"dotted"}),ut],location:R.fromLeftTopWidthHeight(16,0,r,a)}),e.jsx(E,{...w,layers:[u&&U({style:"dotted"}),mt,ft],location:R.fromLeftTopWidthHeight(r+16*2,0,r,a)}),e.jsx(E,{...w,layers:[xt],location:R.fromLeftTopWidthHeight(16,a+16,r,a)}),e.jsx(E,{...w,layers:[pt],location:R.fromLeftTopWidthHeight(r+16*2,a+16,r,a)})]})}function E({location:t,line:o,hoveredPointIdx:s,activePointIdx:n,layers:r=[],showExtras:a,onPointerDown:u,onPointerMove:i,onPointerUp:x,onPointerCancel:l}){const[c,p]=b.useState(null);return e.jsxs("div",{className:"absolute overflow-hidden rounded-lg bg-white",style:{left:t.left,top:t.top,width:t.width,height:t.height},children:[e.jsx("div",{className:"absolute inset-0 ",onPointerDown:d=>{console.log("a",d.currentTarget),u(d)},onPointerMove:i,onPointerUp:x,onPointerCancel:l,children:e.jsx("svg",{className:"absolute inset-0 h-full w-full",children:e.jsxs("g",{transform:`translate(${t.width/2}, ${t.height/2})`,children:[r.map((d,m)=>d&&c&&e.jsx(b.Fragment,{children:d({line:o,showExtras:a,uiTarget:c})},m)),a&&o.points.map((d,m)=>e.jsx("circle",{cx:d.x,cy:d.y,r:6,strokeWidth:2,className:lt("stroke-blue-600",m===n?"fill-blue-600":m===s?"fill-blue-300":"fill-white")},m))]})})}),e.jsx("div",{className:"pointer-events-auto absolute z-10 w-full",ref:p})]})}const wt=K(document.getElementById("root"),'Assertion Error: document.getElementById("root")');Y(wt).render(e.jsx(rt.StrictMode,{children:e.jsx(jt,{})}));
