function t(t,e,i,n){Object.defineProperty(t,e,{get:i,set:n,enumerable:!0,configurable:!0})}function e(t){return t&&t.__esModule?t.default:t}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},o={},s=i.parcelRequire0561;null==s&&((s=function(t){if(t in n)return n[t].exports;if(t in o){var e=o[t];delete o[t];var i={id:t,exports:{}};return n[t]=i,e.call(i.exports,i,i.exports),i.exports}var s=new Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(t,e){o[t]=e},i.parcelRequire0561=s),s.register("19ECN",(function(e,i){t(e.exports,"PalControlData",(function(){return a})),t(e.exports,"PalTargetController",(function(){return g})),t(e.exports,"PalAbsoluteController",(function(){return l}));var n=s("7ic2V"),o=s("96RKe"),r=s("6i1fg");class a extends n.default{getVelocity(){return this.getHeadingVec().scale(this.speed)}getHeadingVec(){return r.default.fromPolar(this.heading,1)}constructor(t,e){super(t),this.speed=0,this.heading=0,this.headingVelocity=0,this.position=e}}class g extends n.default{setTarget(t){this.target=t}update(t){const e=t/1e3,i=this.data.position.angleTo(this.target),n=this.target.distanceTo(this.data.position);if(n>15?this.accelerate(200,e):this.accelerate(-200,e),n>10){const t=o.normalizeAngle(i-this.data.heading),n=this.data.heading;this.data.heading+=t/10,this.data.headingVelocity=o.normalizeAngle(this.data.heading-n)/e}else this.data.headingVelocity=0}accelerate(t,e){const i=this.data.speed;this.data.speed=o.constrain(0,80,this.data.speed+t*e);const n=(i+this.data.speed)/2;this.data.position=this.data.position.add(r.default.fromPolar(this.data.heading,n*e))}constructor(t,e){super(t),this.target=e,this.data=t.addComponent(a,e)}}class l extends n.default{setPosition(t,e,i){const n=this.data.position,s=this.data.heading;this.data.heading=e,this.data.headingVelocity=o.normalizeAngle(this.data.heading-s)/i,this.data.speed=n.distanceTo(t)/i,this.data.position=t}constructor(t,e){super(t),this.data=t.addComponent(a,e)}}})),s.register("7ic2V",(function(e,i){t(e.exports,"default",(function(){return n}));class n{onRemove(){}onAddedToScene(t){}onRemovedFromScene(t){}beforeUpdate(t){}update(t){}afterUpdate(t){}beforeDraw(t,e){}draw(t,e){}afterDraw(t,e){}getScene(){return this.entity.getScene()}constructor(t){this.entity=t}}})),s.register("2dNNZ",(function(e,i){t(e.exports,"default",(function(){return c}));var n=s("7ic2V"),o=s("4TER2"),r=s("19ECN"),a=s("96RKe"),g=s("hPLAZ"),l=s("87DYR");const h=Math.PI/2;class c extends n.default{setAnimationController(t){this.animationController=t}update(t){if(this.animationController){const e=this.animationController.update(t,this.controlData,this.legs);this.bobAmount=e.bobAmount,l.assert(e.legs.length===this.legs.length),this.legs.forEach(((t,i)=>t.update(e.legs[i])))}}getBod(){const t=this.config.bodBob*this.bobAmount;return o.default.create(this.controlData.position.x,this.controlData.position.y-this.config.bodHeight-t,this.config.radius)}constructor(t,e){super(t),this.config=e,this.animationController=null,this.bobAmount=0,this.controlData=t.getComponent(r.PalControlData),this.legs=a.shuffle(a.flatten(a.times(e.legPairs,(t=>{const i=(t+1)/(e.legPairs+1);return[new g.default(this.controlData,this,e,a.lerp(h-1,h+1,i)),new g.default(this.controlData,this,e,a.lerp(1-h,-h-1,i))]}))))}}})),s.register("hPLAZ",(function(e,i){t(e.exports,"default",(function(){return a}));var n=s("6i1fg"),o=s("96RKe");const r=({radius:t,hipHeight:e,legWidth:i})=>Math.sqrt(t*t-(t-e)*(t-e))-i;class a{update(t){this.footXY=t.footXY,this.footOrigin=t.footProjectionOrigin,this.liftAmount=t.liftAmount}getIdealFootRestingXY(){return n.default.fromPolar(this.palData.heading+this.angleOffset,this.floorRadius).add(this.palData.position)}getFootXY(){return this.footXY}getFootZ(){return o.lerp(0,this.getHipZ()*this.config.legMaxLift,this.liftAmount)}getFootOrigin(){return this.footOrigin}getKneeXY(){return this.palData.position.add(n.default.fromPolar(this.palData.heading+this.angleOffset,this.kneeRadius)).add(n.default.fromPolar(this.palData.heading,this.liftAmount*this.config.kneeMaxOut))}getKneeZ(){return(this.getFootZ()+this.getHipZ())/2}getKneeOrigin(){return this.getHipOrigin().lerp(this.getFootOrigin(),.5)}getHipXY(){return this.palData.position.add(n.default.fromPolar(this.palData.heading+this.angleOffset,this.hipRadius))}getHipZ(){const t=this.palGeom.getBod();return this.palData.position.y-t.center.y-(t.radius-this.config.hipHeight)}getHipOrigin(){return this.palData.position}constructor(t,e,i,n){this.palData=t,this.palGeom=e,this.config=i,this.angleOffset=n,this.liftAmount=0,this.hipRadius=r(i),this.kneeRadius=r(i)*i.kneeScale,this.floorRadius=r(i),this.footXY=this.getIdealFootRestingXY(),this.footOrigin=this.getIdealFootRestingXY()}}})),s.register("exw1r",(function(e,i){t(e.exports,"default",(function(){return c}));var n=s("7ic2V"),o=s("19ECN"),r=s("2dNNZ"),a=s("yW6N3"),g=s("96RKe"),l=s("6i1fg");const h=Math.PI/2;class c extends n.default{draw(t){const e=g.normalizeAngle(this.data.heading);t.setLineDash([]),t.beginPath();const i=this.geom.getBod();t.ellipse(this.data.position.x,this.data.position.y,.8*i.radius,.24*i.radius,0,0,2*Math.PI),t.fillStyle="rgba(0, 0, 0, 0.2)",t.fill(),this.geom.legs.filter((t=>g.normalizeAngle(t.angleOffset+e)<0)).forEach((e=>this.drawLeg(t,e))),this.geom.legs.filter((t=>g.normalizeAngle(t.angleOffset+e)>=0)).forEach((e=>this.drawLeg(t,e))),this.drawBod(t,i)}drawLeg(t,e){t.beginPath();const i=this.data.heading+e.angleOffset,n=g.constrain(0,1,Math.abs(g.normalizeAngle(-h-i)/h)),o=this.config.color.darken(.2*(1-n*n)),s=this.projectZ(e.getHipXY(),e.getHipZ(),e.getHipOrigin()),r=this.projectZ(e.getKneeXY(),e.getKneeZ(),e.getKneeOrigin()),a=this.projectZ(e.getFootXY(),e.getFootZ(),e.getFootOrigin());t.moveTo(s.x,s.y),t.quadraticCurveTo(r.x,r.y,a.x,a.y),t.lineCap="round",t.strokeStyle=o.toString(),t.lineWidth=this.config.legWidth,t.stroke()}drawBod(t,e){t.save(),t.beginPath(),a.circle(t,e.center.x,e.center.y,this.config.radius),t.fillStyle=this.config.color.toString(),t.fill(),t.clip();const i=g.normalizeAngle(h-this.data.heading)/h*this.config.radius;t.beginPath(),a.circle(t,i+e.center.x+this.config.eyeX,e.center.y-this.config.eyeY,this.config.eyeRadius),a.circle(t,i+e.center.x-this.config.eyeX,e.center.y-this.config.eyeY,this.config.eyeRadius),t.fillStyle=this.config.color.darken(.5).toString(),t.fill(),t.beginPath(),t.moveTo(i+e.center.x-this.config.mouthWidth,e.center.y-this.config.mouthY),t.quadraticCurveTo(i+e.center.x,e.center.y-this.config.mouthY+this.config.mouthSmile,i+e.center.x+this.config.mouthWidth,e.center.y-this.config.mouthY),t.lineWidth=this.config.mouthThickness,t.strokeStyle=this.config.color.darken(.5).toString(),t.stroke(),t.beginPath(),this.makeButtLine(t,e,i+2*this.config.radius),this.makeButtLine(t,e,i-2*this.config.radius),t.lineWidth=this.config.buttThickness,t.strokeStyle=this.config.color.darken(.3).toString(),t.stroke(),t.restore()}makeButtLine(t,e,i){t.moveTo(1.6*i+e.center.x,e.center.y+this.config.buttTop),t.quadraticCurveTo(1.7*i+e.center.x,e.center.y+.65*(this.config.buttTop+this.config.buttBottom),i+e.center.x,e.center.y+this.config.buttBottom)}projectZ(t,e,i){return new l.default(t.x,i.y-e+.3*(t.y-i.y))}constructor(t,e){super(t),this.config=e,this.data=t.getComponent(o.PalControlData),this.geom=t.getComponent(r.default)}}})),s.register("yW6N3",(function(e,i){t(e.exports,"circle",(function(){return r})),t(e.exports,"path",(function(){return a}));var n=s("b2Aev"),o=s("hKbPz");function r(t,e,i,n){t.arc(e,i,n,0,2*Math.PI,!1)}function a(t,e){e.segments.length&&t.moveTo(e.segments[0].getStart().x,e.segments[0].getStart().y);for(const i of e.segments)if(i instanceof n.default)t.lineTo(i.getEnd().x,i.getEnd().y);else{if(!(i instanceof o.default))throw new Error(`Unknown path segment type: ${i.toString()}`);t.arc(i.circle.center.x,i.circle.center.y,i.circle.radius,i.startAngle,i.endAngle,i.isAnticlockwise)}}})),s.register("b2Aev",(function(e,i){t(e.exports,"default",(function(){return r}));var n=s("96RKe"),o=s("6Cnop");class r{getStart(){return this.line.start}getEnd(){return this.line.end}getDelta(){return this.delta}getLength(){return this.delta.magnitude}get angle(){return this.delta.angle}getPointAtPosition(t){const e=n.constrain(0,this.getLength(),t);return this.delta.withMagnitude(e).add(this.line.start)}getAngleAtPosition(){return this.delta.angle}constructor(t,e){this.line=new o.default(t,e),this.delta=this.line.getDelta(),Object.freeze(this)}}})),s.register("hKbPz",(function(e,i){t(e.exports,"default",(function(){return r}));var n=s("96RKe"),o=s("4TER2");class r{getStart(){return this.circle.pointOnCircumference(this.startAngle)}getEnd(){return this.circle.pointOnCircumference(this.endAngle)}get angleDifference(){return Math.atan2(Math.sin(this.endAngle-this.startAngle),Math.cos(this.endAngle-this.startAngle))}getLength(){const t=Math.abs(this.angleDifference)/(2*Math.PI);return this.circle.circumference*t}get isAnticlockwise(){return this.angleDifference<0}getPointAtPosition(t){const e=n.mapRange(0,this.getLength(),this.startAngle,this.startAngle+this.angleDifference,n.constrain(0,this.getLength(),t));return this.circle.pointOnCircumference(e)}getAngleAtPosition(t){return this.isAnticlockwise?n.mapRange(0,this.getLength(),this.startAngle,this.startAngle+this.angleDifference,n.constrain(0,this.getLength(),t))-Math.PI/2:n.mapRange(0,this.getLength(),this.startAngle,this.startAngle+this.angleDifference,n.constrain(0,this.getLength(),t))+Math.PI/2}constructor(t,e,i,n){this.circle=o.default.create(t.x,t.y,e),this.startAngle=i,this.endAngle=n,Object.freeze(this)}}})),s.register("k9rmw",(function(e,i){t(e.exports,"default",(function(){return g}));var n=s("6i1fg"),o=s("96RKe"),r=s("87DYR");function a({stepProgress:t}){return t>0}class g{update(t,e,i){const n=t/1e3;for(const t of i)this.updateLegState(n,e,i,t);const o=i.map((t=>this.getLegUpdate(e,t)));return{bobAmount:o.reduce(((t,e)=>t+e.liftAmount),0)/i.length,legs:o}}canLiftLeg(t,e,i){r.assert(e.includes(i),"whos leg even is this");const n=e.filter((e=>e!==i&&!a(this.getLegState(t,i)))).length>Math.floor(Math.log(e.length)),o=e.some((i=>{const n=this.getLegState(t,i);return n.stepProgress>0&&n.stepProgress<1/(e.length/2)}));return n&&!o}updateLegState(t,e,i,n){const s=this.getLegState(e,n);if(s.restTimer=o.constrain(0,this.config.stepRestDuration,s.restTimer-t),!function({restTimer:t}){return t>0}(s))if(a(s))s.stepProgress=o.constrain(0,1,s.stepProgress+t/this.config.stepDuration),1===s.stepProgress&&(s.lastFootOnFloorXY=this.getFootXY(e,n,s),s.lastFootOnFloorPalPosition=e.position,s.stepProgress=0,s.restTimer=this.config.stepDuration);else{const r=n.getFootXY().distanceTo(n.getIdealFootRestingXY());r>this.config.stepThreshold&&this.canLiftLeg(e,i,n)&&(s.currentStepMaxLift=o.constrain(0,1,o.mapRange(this.config.stepThreshold,this.config.fullStepDistance,.1,1,r)),s.stepProgress=o.constrain(0,1,s.stepProgress+t/this.config.stepDuration))}}getInitialLegState(t,e){return{lastFootOnFloorXY:e.getIdealFootRestingXY(),lastFootOnFloorPalPosition:t.position,stepProgress:0,restTimer:0,currentStepMaxLift:1}}getLegState(t,e){const i=this.legStates.get(e);if(i)return i;const n=this.getInitialLegState(t,e);return this.legStates.set(e,n),n}getLegUpdate(t,e){const i=this.getLegState(t,e);return{footXY:this.getFootXY(t,e,i),footProjectionOrigin:this.getFootOrigin(t,e,i),liftAmount:this.getLegLiftAmount(i)}}getFootXY(t,e,i){if(a(i)){const n=i.lastFootOnFloorXY,o=this.getPredictedIdealFootXYAtEndOfOfStep(t,e,i);return n.lerp(o,i.stepProgress)}return i.lastFootOnFloorXY}getFootOrigin(t,e,i){return a(i)?i.lastFootOnFloorPalPosition.lerp(t.position,i.stepProgress):i.lastFootOnFloorPalPosition}getPredictedIdealFootXYAtEndOfOfStep(t,e,i){const o=(1.4-i.stepProgress)*this.config.stepDuration,s=t.getVelocity().scale(o).add(t.position),r=t.heading+t.headingVelocity*o;return n.default.fromPolar(r+e.angleOffset,e.floorRadius).add(s)}getLegLiftAmount({stepProgress:t,currentStepMaxLift:e}){return Math.sin(t*Math.PI)*e}constructor(t){this.config=t,this.legStates=new Map}}})),s.register("h8N2y",(function(e,i){t(e.exports,"generateRandomPalConfig",(function(){return r}));var n=s("96RKe"),o=s("c9KGA");o.BLUE.lighten(.2);const r=()=>{const t=n.varyRelative(14,.2),e=n.varyRelative(.7*t,.3),i=n.varyRelative(2*t,.3),s=i-(t-e);return{radius:t,bodHeight:i,bodBob:n.varyRelative(t,.2),eyeY:n.varyRelative(.5*t,.2),eyeX:n.varyRelative(.4*t,.3),eyeRadius:n.varyRelative(.15*t,.4),mouthThickness:n.varyRelative(.15*t,.4),mouthY:n.varyAbsolute(0,.2*t),mouthWidth:n.varyRelative(.5*t,.3),mouthSmile:n.varyRelative(.3*t,.3),buttTop:n.varyRelative(.4*t,.2),buttBottom:n.varyRelative(.85*t,.15),buttThickness:n.varyRelative(.1*t,.5),color:o.BLUE.lighten(n.random(-.2,.2)).saturate(n.random(-.2,.2)).rotate(n.random(-10,10)),hipHeight:e,kneeScale:n.varyAbsolute(1.3,.3),legMaxLift:n.random(.2,.5),kneeMaxOut:n.varyRelative(.6*s,.4),stepDuration:n.varyRelative(.01*s,.4),stepRestDuration:n.varyRelative(.0083*s,.4),stepThreshold:n.varyRelative(.01*s,.4),fullStepDistance:n.varyRelative(.7*s,.4),legWidth:n.varyRelative(.3*t,.4),legPairs:n.randomInt(1,4)}}})),s.register("c9KGA",(function(i,n){t(i.exports,"BLUE",(function(){return r}));var o=s("0FWmF");new(e(o))("#F8FFE5"),new(e(o))("#06D6A0");const r=new(e(o))("#1B9AAA");new(e(o))("#EF476F"),new(e(o))("#FFC43D")}));
//# sourceMappingURL=index.5347e177.js.map
