import{v as M,c as W,W as x,n as D,b as S,Z as R,S as I}from"./chunk_assert.0ed02936.js";/* empty css                       */import{r as f,R as B}from"./chunk_index.9ef61b8f.js";import{a as k,b as z,c as L}from"./chunk_client.eaa7f0af.js";import{S as s,V as l}from"./chunk_Vector2.5cb4ef59.js";import{u as T}from"./chunk_useGestureDetector.d67667c7.js";import{P as y}from"./chunk_Path.6a94b7de.js";import{a as A}from"./chunk_useStoredState.008f527c.js";import{I as P}from"./chunk_Ids.9ef389ee.js";import{j as a,a as C}from"./chunk_jsx-runtime.faf32752.js";import"./chunk__commonjsHelpers.e5e952e9.js";import"./chunk_Circle.e4377e7a.js";import"./chunk_AABB.f2958295.js";import"./chunk_CirclePathSegment.d32e85d1.js";import"./chunk_svgPathBuilder.0ac8eb16.js";import"./chunk_storage.b7e3575d.js";const g=new P("node"),F=s.object({type:s.value("out"),id:g.schema,position:l.schema}),G=s.object({type:s.value("in"),id:g.schema,position:l.schema}),O=s.object({type:s.value("join"),id:g.schema,position:l.schema}),V=s.union("type",{out:F,in:G,join:O}),j=new P("wire"),J=s.object({id:j.schema,startNodeId:g.schema,endNodeId:g.schema,midPoints:s.arrayOf(l.schema)}),Z=s.object({nodes:s.objectMap(g.schema,V),wires:s.objectMap(j.schema,J)});function q(){const[e,c]=f.exports.useState(null),o=k(e,z),[n,m]=A("wires.model",Z,()=>({nodes:{},wires:{}}));return a("div",{ref:c,className:"absolute inset-0",children:o&&a(K,{size:o,doc:n,setDoc:m})})}const H=[0,x(60),x(120)].flatMap(e=>[e,e+x(180)]).map(e=>D(e));function K({size:e,doc:c,setDoc:o}){const[n,m]=f.exports.useState([]),[p,r]=f.exports.useState(null),[i,h]=f.exports.useState([]),u=T({onDragStart:t=>{const d=[l.fromEvent(t)];return{couldBeTap:!1,pointerCapture:!0,onMove:w=>{d.push(l.fromEvent(w)),r(v(d))},onEnd:w=>{const N=v(d);h(E=>[...E,N]),r(null)},onCancel:w=>{m([]),r(null)}}}});return C("svg",{className:"absolute inset-0 h-full w-full",...u.events,children:[n.map((t,d)=>a(f.exports.Fragment,{children:t},d)),M(c.nodes).map(t=>{if(!t)return null;switch(t.type){case"in":return a("circle",{x:t.position.x,y:t.position.y,r:6,className:"fill-green-500"},t.id);case"out":return a("circle",{x:t.position.x,y:t.position.y,r:6,className:"fill-red-500"},t.id);case"join":return a("circle",{x:t.position.x,y:t.position.y,r:10,className:"fill-transparent stroke-blue-200",strokeWidth:3},t.id);default:W(t)}}),i.map((t,d)=>a(b,{points:t},d)),p&&a(b,{points:p})]})}const Q=8;function b({points:e}){const c=f.exports.useMemo(()=>{const o=y.straightThroughPoints(...e).autoRound(Q);return y.segmentToSvgPath(o)},[e]);return a("path",{d:c,strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round",className:"fill-transparent stroke-blue-600"})}const U=15;function v(e){let c=0,o=1,n=null;const m=[];for(;o<e.length;){for(;o<e.length&&e[c].distanceTo(e[o])<U;)o++;const r=e[c],i=e[Math.min(o,e.length-1)],h=i.sub(r).normalize(),u=S(R(H,t=>Math.abs(t-h.angle())),"Assertion Error: minBy(possibleDirections, dir => Math.abs(dir - direction.angle()))");(!n||u!==n.direction)&&(n&&m.push({direction:l.fromPolar(n.direction,1),referencePoint:m.length?n.start.lerp(i,.5):n.start}),n={start:r,direction:u}),c=o,o++}if(!n)return[];m.push({referencePoint:e[e.length-1],direction:l.fromPolar(n.direction,1)});const p=[e[0]];for(const[r,i]of I(m,2)){const h=i.direction.y*r.direction.x-i.direction.x*r.direction.y;if(h===0){console.log("parallel lines");continue}const u=(i.direction.x*(r.referencePoint.y-i.referencePoint.y)-i.direction.y*(r.referencePoint.x-i.referencePoint.x))/h;p.push(new l(r.referencePoint.x+u*r.direction.x,r.referencePoint.y+u*r.direction.y))}return p.push(e[e.length-1]),p}const X=S(document.getElementById("root"),'Assertion Error: document.getElementById("root")');L(X).render(a(B.StrictMode,{children:a(q,{})}));
