var Z=n=>{throw TypeError(n)};var Q=(n,t,e)=>t.has(n)||Z("Cannot "+e);var B=(n,t,e)=>(Q(n,t,"read from private field"),e?e.call(n):t.get(n)),V=(n,t,e)=>t.has(n)?Z("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),C=(n,t,e,r)=>(Q(n,t,"write to private field"),r?r.call(n,e):t.set(n,e),e);import"./chunk_modulepreload-polyfill.B5Qt9EMX.js";/* empty css                       */import{j,c as lt}from"./chunk_client.CotzxIPX.js";import{V as M}from"./chunk_Vector2.B_B2dMXe.js";import{c as ot,S as dt,a as ft}from"./chunk_index.wtV57k8u.js";import{b as at,a as mt}from"./chunk_assert.pxkjFBOg.js";import{r as X,m as R}from"./chunk_signia.MYNlGhjX.js";import{e as N,q as tt,u as gt,v as vt}from"./chunk_utils.BtQBvwlT.js";import{D as yt}from"./chunk_DebugSvg.--yBcz7l.js";import{T as wt}from"./chunk_Ticker.CCL_5-d9.js";import{a as Pt,s as bt}from"./chunk_useResizeObserver.DYIaNo-1.js";import{S as Tt}from"./chunk_svgPathBuilder.D8WIOAcJ.js";import{t as ct}from"./chunk_index.7f6X1YHT.js";import{r as W}from"./chunk_index.C5eOxiyT.js";import"./chunk_RingBuffer.DBvCcgdE.js";import"./chunk_DebugDraw.DAmUnYNO.js";import"./chunk_AABB.B469SoIe.js";import"./chunk_useMergedRefs.MPIvL6fk.js";import"./chunk_EventEmitter.DASG4daq.js";import"./chunk_ResizeObserver.C8OzoCMD.js";import"./chunk__commonjsHelpers.Cpj98o6Y.js";const G=ot("camera",{scope:"session"}).withDefaultProperties(()=>({center:M.ZERO.toJson(),zoom:1})),Y=G.createId("camera"),ut=ot("stroke",{scope:"document"}).withDefaultProperties(()=>({points:[]})),Et=dt.create({camera:G,stroke:ut});class xt extends ft{constructor(){super({schema:Et,props:void 0})}put1(t){return this.put([t])}delete(t){return this.remove([t])}}const At=1e3;function Dt(n){return{id:"draw on canvas",index:-1/0,distanceTo(){return 0},onDrag(t){const e=ut.create({});return n.store.put1(e),{onUpdate(r){n.store.update(e.id,s=>({...s,points:[...s.points,r.pagePosition.toJson()]}))},onCancel(){n.store.delete(e.id)}}}}}function It(n){return n.shapes.map(t=>({id:`drag shape ${t.id}`,index:1,distanceTo(e){return Math.min(...t.points.map(r=>e.distanceTo(r)))},onDrag(e){return{onUpdate(r){const s=r.pagePosition.sub(e.pagePosition);n.store.update(t.id,y=>({...y,points:t.points.map(P=>s.add(P).toJson())}))},onCancel(r){n.store.update(t.id,s=>({...s,points:t.points}))}}}}))}const w=class w{constructor(t,e,r,s,y,P){this.a=t,this.b=e,this.c=r,this.d=s,this.e=y,this.f=P}static translate(...t){const{x:e,y:r}=M.fromArgs(t);return new w(1,0,0,1,e,r)}static rotate(t){const e=Math.cos(t),r=Math.sin(t);return new w(e,r,-r,e,0,0)}static scale(...t){const{x:e,y:r}=M.fromArgs(t);return new w(e,0,0,r,0,0)}static scaleUniform(t){return w.scale(t,t)}static fromDomMatrix(t){return new w(t.a,t.b,t.c,t.d,t.e,t.f)}multiply(t){return new w(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.e+this.c*t.f+this.e,this.b*t.e+this.d*t.f+this.f)}translate(...t){const{x:e,y:r}=M.fromArgs(t);return this.multiply(w.translate(e,r))}rotate(t){return this.multiply(w.rotate(t))}scale(...t){const{x:e,y:r}=M.fromArgs(t);return this.multiply(w.scale(e,r))}scaleUniform(t){return this.scale(t,t)}invert(){const t=this.a*this.d-this.b*this.c;return new w(this.d/t,this.b/-t,this.c/-t,this.a/t,(this.d*this.e-this.c*this.f)/-t,(this.b*this.e-this.a*this.f)/t)}apply(...t){const e=M.fromArgs(t);return new M(this.a*e.x+this.c*e.y+this.e,this.b*e.x+this.d*e.y+this.f)}toString(t=2){let e=[this.a,this.b,this.c,this.d,this.e,this.f].map(s=>s.toFixed(t));const r=Math.max(...e.map(s=>s.length));return e=e.map(s=>s.padStart(r," ")),["Transform2d(",`  ${e[0]}, ${e[1]}, ${e[4]},`,`  ${e[1]}, ${e[2]}, ${e[5]},`,")"].join(`
`)}toCss(){return`matrix(${this.a}, ${this.b}, ${this.c}, ${this.d}, ${this.e}, ${this.f})`}toDomMatrix(){return new DOMMatrix([this.a,this.b,this.c,this.d,this.e,this.f])}};w.IDENTITY=new w(1,0,0,1,0,0);let K=w,et,rt,st,nt;function Mt(){function n(p,o){return function(l){(function(f,i){if(f.v)throw Error("attempted to call addInitializer after decoration was finished")})(o),r(l,"An initializer"),p.push(l)}}function t(p,o){if(!p(o))throw new TypeError("Attempted to access private element on non-instance")}function e(p,o,l,f,i,T,m,x,A){var a;switch(i){case 1:a="accessor";break;case 2:a="method";break;case 3:a="getter";break;case 4:a="setter";break;default:a="field"}var u,g,c={kind:a,name:m?"#"+o:St(o),static:T,private:m},v={v:!1};if(i!==0&&(c.addInitializer=n(f,v)),m||i!==0&&i!==2)if(i===2)u=function(h){return t(A,h),l.value};else{var d=i===0||i===1;(d||i===3)&&(u=m?function(h){return t(A,h),l.get.call(h)}:function(h){return l.get.call(h)}),(d||i===4)&&(g=m?function(h,b){t(A,h),l.set.call(h,b)}:function(h,b){l.set.call(h,b)})}else u=function(h){return h[o]},i===0&&(g=function(h,b){h[o]=b});var E=m?A.bind():function(h){return o in h};c.access=u&&g?{get:u,set:g,has:E}:u?{get:u,has:E}:{set:g,has:E};try{return p(x,c)}finally{v.v=!0}}function r(p,o){if(typeof p!="function")throw new TypeError(o+" must be a function")}function s(p,o){var l=typeof o;if(p===1){if(l!=="object"||o===null)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");o.get!==void 0&&r(o.get,"accessor.get"),o.set!==void 0&&r(o.set,"accessor.set"),o.init!==void 0&&r(o.init,"accessor.init")}else if(l!=="function")throw new TypeError((p===0?"field":p===10?"class":"method")+" decorators must return a function or void 0")}function y(p){return function(o){p(this,o)}}function P(p,o,l,f,i,T,m,x,A){var a,u,g,c,v,d,E,h,b=l[0];if(m?(i===0||i===1?(a={get:(v=l[3],function(){return v(this)}),set:y(l[4])},g="get"):i===3?(a={get:l[3]},g="get"):i===4?(a={set:l[3]},g="set"):a={value:l[3]},i!==0&&(i===1&&it(a.set,"#"+f,"set"),it(a[g||"value"],"#"+f,g))):i!==0&&(a=Object.getOwnPropertyDescriptor(o,f)),i===1?c={get:a.get,set:a.set}:i===2?c=a.value:i===3?c=a.get:i===4&&(c=a.set),typeof b=="function")(d=e(b,f,a,x,i,T,m,c,A))!==void 0&&(s(i,d),i===0?u=d:i===1?(u=d.init,E=d.get||c.get,h=d.set||c.set,c={get:E,set:h}):c=d);else for(var k=b.length-1;k>=0;k--){var D;(d=e(b[k],f,a,x,i,T,m,c,A))!==void 0&&(s(i,d),i===0?D=d:i===1?(D=d.init,E=d.get||c.get,h=d.set||c.set,c={get:E,set:h}):c=d,D!==void 0&&(u===void 0?u=D:typeof u=="function"?u=[u,D]:u.push(D)))}if(i===0||i===1){if(u===void 0)u=function(S,I){return I};else if(typeof u!="function"){var O=u;u=function(S,I){for(var _=I,J=0;J<O.length;J++)_=O[J].call(S,_);return _}}else{var ht=u;u=function(S,I){return ht.call(S,I)}}p.push(u)}i!==0&&(i===1?(a.get=c.get,a.set=c.set):i===2?a.value=c:i===3?a.get=c:i===4&&(a.set=c),m?i===1?(p.push(function(S,I){return c.get.call(S,I)}),p.push(function(S,I){return c.set.call(S,I)})):i===2?p.push(c):p.push(function(S,I){return c.call(S,I)}):Object.defineProperty(o,f,a))}function z(p,o,l){for(var f,i,T,m=[],x=new Map,A=new Map,a=0;a<o.length;a++){var u=o[a];if(Array.isArray(u)){var g,c,v=u[1],d=u[2],E=u.length>3,h=v>=5,b=l;if(h?(g=p,(v-=5)!=0&&(c=i=i||[]),E&&!T&&(T=function(O){return kt(O)===p}),b=T):(g=p.prototype,v!==0&&(c=f=f||[])),v!==0&&!E){var k=h?A:x,D=k.get(d)||0;if(D===!0||D===3&&v!==4||D===4&&v!==3)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+d);!D&&v>2?k.set(d,v):k.set(d,!0)}P(m,g,u,d,v,h,E,c,b)}}return $(m,f),$(m,i),m}function $(p,o){o&&p.push(function(l){for(var f=0;f<o.length;f++)o[f].call(l);return l})}return function(p,o,l,f){return{e:z(p,o,f),get c(){return function(i,T){if(T.length>0){for(var m=[],x=i,A=i.name,a=T.length-1;a>=0;a--){var u={v:!1};try{var g=T[a](x,{kind:"class",name:A,addInitializer:n(m,u)})}finally{u.v=!0}g!==void 0&&(s(10,g),x=g)}return[x,function(){for(var c=0;c<m.length;c++)m[c].call(x)}]}}(p,l)}}}}function pt(n,t,e,r){return(pt=Mt())(n,t,e,r)}function St(n){var t=jt(n,"string");return typeof t=="symbol"?t:t+""}function jt(n,t){if(typeof n!="object"||!n)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var r=e.call(n,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function it(n,t,e){typeof t=="symbol"&&(t=(t=t.description)?"["+t+"]":"");try{Object.defineProperty(n,"name",{configurable:!0,value:e?e+" "+t:t})}catch{}return n}function kt(n){if(Object(n)!==n)throw TypeError("right-hand side of 'in' should be an object, got "+(n!==null?typeof n:"null"));return n}var F,L,U;const H=class H{constructor(t){V(this,F);V(this,L);V(this,U);this.container=t,this.store=void et(this),C(this,F,rt(this,M.UNIT)),C(this,L,st(this,[])),this.onWheel=e=>{e.preventDefault(),e.ctrlKey?this.camera={...this.camera,zoom:Math.exp(-e.deltaY/100)*this.camera.zoom}:this.camera={...this.camera,center:new M(e.deltaX,e.deltaY).scale(1/this.camera.zoom).add(this.camera.center)}},C(this,U,nt(this,new Map)),this.onPointerDown=e=>{e.preventDefault(),this.container.setPointerCapture(e.pointerId);const s=this.updatePointerAndReturnEvent(e,"down").state;switch(s.type){case"drag":return;case"idle":return;default:N(s)}},this.onPointerMove=e=>{const r=this.updatePointerAndReturnEvent(e,"move"),s=r.state;switch(s.type){case"idle":return;case"drag":{s.drag.onUpdate(r);return}default:N(s)}},this.onPointerUp=e=>{var y,P;this.container.releasePointerCapture(e.pointerId);const r=this.updatePointerAndReturnEvent(e,"up"),s=r.state;switch(s.type){case"idle":return;case"drag":{(P=(y=s.drag).onEnd)==null||P.call(y,r),this.setPointerState(r,{type:"idle"});return}default:N(s)}},this.onPointerCancel=e=>{var y,P;this.container.releasePointerCapture(e.pointerId);const r=this.updatePointerAndReturnEvent(e,"cancel"),s=r.state;switch(s.type){case"idle":return;case"drag":(P=(y=s.drag).onCancel)==null||P.call(y,r),this.setPointerState(r,{type:"idle"});return;default:N(s)}},this.onTick=()=>{const e=Date.now()-At,r=new Map(this.pointers);for(const s of this.pointers.values())s.lastUpdatedAt<e&&r.delete(s.pointerId);this.pointers=r},this.store=new xt,this.store.put1(G.create({id:Y})),this.addTarget(Dt),this.addTarget(It)}get viewportSize(){return B(this,F)}set viewportSize(t){C(this,F,t)}get pageToViewport(){return K.translate(this.viewportSize.scale(.5)).scaleUniform(this.camera.zoom).translate(M.from(this.camera.center).scale(-1))}get viewportToPage(){return this.pageToViewport.invert()}get camera(){return at(this.store.get(Y),"Assertion Error: this.store.get(CAMERA_ID)")}set camera(t){mt(t.id===Y,"Assertion Error: newCamera.id === CAMERA_ID"),this.store.put([t])}get shapes(){return this.store.allRecords().filter(t=>t.typeName==="stroke")}get targetFns(){return B(this,L)}set targetFns(t){C(this,L,t)}addTarget(t){this.targetFns=[...this.targetFns,t]}get targets(){const t=[];for(const e of this.targetFns){const r=e(this);r&&(Array.isArray(r)?t.push(...r):t.push(r))}return tt(t,e=>e.index)}get targetsByIndex(){return gt(this.targets,t=>t.index)}getTargetAtPoint(t,{sensitivity:e,filter:r=()=>!0}){const s=e*this.camera.zoom;for(const[y,P]of tt([...this.targetsByIndex],([z])=>z).reverse()){let z=s,$=null;for(const p of P){if(!r(p))continue;const o=p.distanceTo(t);o<=z&&(z=o,$=p)}if($)return $}return null}get enabledGestures(){const t={drag:!1,twoFingerDrag:!1,tap:!1,doubleTap:!1};for(const e of this.targets)e.onDrag&&(t.drag=!0),e.onTwoFingerDrag&&(t.twoFingerDrag=!0),e.onTap&&(t.tap=!0),e.onDoubleTap&&(t.doubleTap=!0);return t}get pointers(){return B(this,U)}set pointers(t){C(this,U,t)}getPointer(t){return this.pointers.get(t)}setPointer(t){const e=new Map(this.pointers);e.set(t.pointerId,t),this.pointers=e}setPointerState(t,e){this.setPointer({...this.getPointer(t.pointerId)??t,state:e})}updatePointerAndReturnEvent(t,e){const r=this.getPointer(t.pointerId),s={pointerId:t.pointerId,viewportPosition:M.fromEvent(t),type:t.pointerType,isDown:e==="down"?!0:e==="up"||e==="cancel"?!1:(r==null?void 0:r.isDown)??!1,state:(r==null?void 0:r.state)??{type:"idle"},lastUpdatedAt:Date.now()};return this.setPointer(s),{...s,pagePosition:this.viewportToPage.apply(s.viewportPosition)}}};F=new WeakMap,L=new WeakMap,U=new WeakMap,[rt,st,nt,et]=pt(H,[[X,1,"viewportSize"],[R,3,"pageToViewport"],[R,3,"viewportToPage"],[R,3,"camera"],[R,3,"shapes"],[X,1,"targetFns"],[R,3,"targets"],[R,3,"targetsByIndex"],[R,3,"enabledGestures"],[X,1,"pointers"]],[]).e;let q=H;function Ct(){const[n,t]=W.useState(null),e=Pt(n,bt);return j.jsx("div",{ref:t,className:"fixed inset-0 touch-none",children:e&&n&&j.jsx(Rt,{size:e,container:n})})}const Rt=ct(function({size:t,container:e}){const r=W.useMemo(()=>new q(e),[e]);return W.useLayoutEffect(()=>{r.viewportSize=t},[r,t]),W.useEffect(()=>{const s=new wt,y=s.listen(()=>r.onTick());return s.start(),e.addEventListener("wheel",r.onWheel,{passive:!1,capture:!0}),e.addEventListener("pointerdown",r.onPointerDown),e.addEventListener("pointermove",r.onPointerMove),e.addEventListener("pointerup",r.onPointerUp),e.addEventListener("pointercancel",r.onPointerCancel),()=>{y(),s.stop(),e.removeEventListener("wheel",r.onWheel,{capture:!0}),e.removeEventListener("pointerdown",r.onPointerDown),e.removeEventListener("pointermove",r.onPointerMove),e.removeEventListener("pointerup",r.onPointerUp),e.removeEventListener("pointercancel",r.onPointerCancel)}},[r,e]),j.jsxs("svg",{viewBox:`0 0 ${t.x} ${t.y}`,width:t.x,height:t.y,children:[j.jsx("g",{transform:r.pageToViewport.toCss(),children:r.shapes.map(s=>j.jsx(zt,{shape:s},s.id))}),Array.from(r.pointers.values(),s=>j.jsx(yt,{position:s.viewportPosition,label:vt([s.pointerId,s.type,s.isDown?"down":null]).join(", ")},s.pointerId))]})}),zt=ct(function({shape:t}){if(!t.points.length)return null;const e=new Tt().moveTo(t.points[0]);for(const r of t.points)e.lineTo(r);return j.jsx("path",{d:e.toString(),stroke:"black",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})}),$t=at(document.getElementById("root"),'Assertion Error: document.getElementById("root")');lt($t).render(j.jsx(Ct,{}));
