var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},s={},n=e.parcelRequire0561;null==n&&((n=function(e){if(e in t)return t[e].exports;if(e in s){var n=s[e];delete s[e];var o={id:e,exports:{}};return t[e]=o,n.call(o.exports,o,o.exports),o.exports}var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){s[e]=t},e.parcelRequire0561=n);var o=n("87DYR");o=n("87DYR");var a=n("6i1fg");o=n("87DYR");const i={};o=n("87DYR");var r=n("7ic2V");class c extends r.default{getSortOrder(){return this.getSortOrderFn(this.entity)}constructor(e,t){super(e),this.getSortOrderFn=t}}var d=n("19ECN"),h=n("2dNNZ"),l=n("exw1r"),m=n("k9rmw"),u=n("h8N2y");const f=document.getElementById("root");o.assert(f);const p=new class{get width(){return this.canvas.width/this._scaleFactor}get height(){return this.canvas.height/this._scaleFactor}get scaleFactor(){return this._scaleFactor}get isPlaying(){return null!==this.frameHandle&&this._isPlaying}set isPlaying(e){o.assert(null!==this.frameHandle,"cannot set isPlaying without calling start"),this._isPlaying=e}get children(){return this._children}appendTo(e){e.appendChild(this.canvas)}hasSystem(e){return this.systemsByClass.has(e)}getSystem(e){const t=this.systemsByClass.get(e);return o.assert(t,`system, ${e.systemName} not found`),o.assert(t instanceof e,"system is wrong instance type"),t}addSystem(e){o.assert(!this.hasSystem(e.constructor),"only one system of each type allowed"),this.systemsByClass.set(e.constructor,e),e.afterAddToScene(this)}removeSystem(e){this.getSystem(e).beforeRemoveFromScene(this),this.systemsByClass.delete(e)}addChild(e){this._children.push(e),e.onAddedToScene(this)}addChildBefore(e,t){const s=this._children.indexOf(e);o.assert(-1!==s,"target child must be present"),this.addChildAtIndex(s,t)}addChildAfter(e,t){const s=this._children.indexOf(e);o.assert(-1!==s,"target child must be present"),this.addChildAtIndex(s+1,t)}addChildAtIndex(e,t){this._children.splice(e,0,t),t.onAddedToScene(this)}removeChild(e){const t=this._children.indexOf(e);return-1!==t&&(this.removeChildAtIndex(t),!0)}removeChildAtIndex(e){const t=this._children[e];return this._children.splice(e,1),t.onRemovedFromScene(),t}update(e){for(let t=0;t<1;t++){for(const t of this.systemsByClass.values())t.beforeUpdate(e);this._children.forEach((t=>t.update(e)));for(const t of this.systemsByClass.values())t.afterUpdate(e)}}draw(e){this.ctx.save(),this.ctx.scale(this._scaleFactor,this._scaleFactor),this.ctx.clearRect(0,0,this.width,this.height);for(const t of this.systemsByClass.values())t.beforeDraw(this.ctx,e);this._children.sort(((e,t)=>e.getSortOrder()-t.getSortOrder())).forEach((t=>t.draw(this.ctx,e)));for(const t of this.systemsByClass.values())t.afterDraw(this.ctx,e);this.ctx.restore()}start(){this._isPlaying=!0,this.frameHandle=window.requestAnimationFrame(this._tick)}stop(){null!==this.frameHandle&&(window.cancelAnimationFrame(this.frameHandle),this.frameHandle=null),this._isPlaying=!1,this.lastElapsedTime=null}_setupVisiblityChange(){let e=!1;document.addEventListener("visibilitychange",(()=>{document.hidden&&this.isPlaying&&(e=!0,this.stop()),e&&!document.hidden&&(e=!1,this.start())}))}constructor(e,t,s=1){this._children=[],this._isPlaying=!1,this.frameHandle=null,this.lastElapsedTime=null,this.systemsByClass=new Map,this._tick=e=>{e*=1;const t=this.lastElapsedTime;if(null!==t){const s=e-t;this.isPlaying&&(this.update(s),this.draw(e))}this.lastElapsedTime=e,this.frameHandle=window.requestAnimationFrame(this._tick)},this.canvas=document.createElement("canvas"),this.canvas.width=e*s,this.canvas.height=t*s,this.canvas.style.width=`${e}px`,this.canvas.style.height=`${t}px`;const n=this.canvas.getContext("2d");o.assert(n,"ctx"),this.ctx=n,this._scaleFactor=1*s,this._setupVisiblityChange()}}(800,600,window.devicePixelRatio);p.appendTo(f);const g=new class extends class{hasScene(){return null!==this.scene}getScene(){return o.assert(this.scene,"scene must be present"),this.scene}draw(e,t){}update(e){}addTo(e){return e.addChild(this),this}onAddedToScene(e){this.scene=e}onRemovedFromScene(){this.scene=null}getSortOrder(){return 0}constructor(){var e;this.id=(e=this.constructor.name,i[e]||(i[e]=0),`${e}@${i[e]++}`),this.scene=null}}{addComponent(e,...t){o.assert(!this.componentInstances.has(e),`component instance ${e.name} already exists`);const s=new e(this,...t);return this.componentInstances.set(e,s),s}hasComponent(e){return this.componentInstances.has(e)}getComponent(e){const t=this.componentInstances.get(e);return o.assert(t,`no instance for ${e.name} exists`),o.assert(t instanceof e,"wrong instance type"),t}removeComponent(e){const t=this.getComponent(e);return this.componentInstances.delete(e),t.onRemove(),t}draw(e,t){for(const s of this.componentInstances.values())s.beforeDraw(e,t);for(const s of this.componentInstances.values())s.draw(e,t);for(const s of this.componentInstances.values())s.afterDraw(e,t)}update(e){for(const t of this.componentInstances.values())t.beforeUpdate(e);for(const t of this.componentInstances.values())t.update(e);for(const t of this.componentInstances.values())t.afterUpdate(e)}onAddedToScene(e){super.onAddedToScene(e);for(const t of this.componentInstances.values())t.onAddedToScene(e)}onRemovedFromScene(){const e=this.getScene();super.onRemovedFromScene();for(const t of this.componentInstances.values())t.onRemovedFromScene(e)}getSortOrder(){return this.hasComponent(c)?this.getComponent(c).getSortOrder():super.getSortOrder()}constructor(...e){super(...e),this.componentInstances=new Map}};g.addComponent(d.PalTargetController,new a.default(100,50));const y=u.generateRandomPalConfig();g.addComponent(h.default,y).setAnimationController(new m.default(y)),g.addComponent(l.default,y),p.addChild(g),f.addEventListener("mousemove",(e=>{const t=e.clientX-p.canvas.offsetLeft,s=e.clientY-p.canvas.offsetTop;g.getComponent(d.PalTargetController).setTarget(new a.default(t-50,s))})),p.start();
//# sourceMappingURL=index.2b9eb323.js.map
