import{b as N,f as _e,a as k,g as Ve,c as T,d as H,t as He,r as w,s as X,j as Xe,o as v}from"./chunk_assert.773cf08f.js";/* empty css                       */import{u as U,e as z,t as A,m as Ye,d as Y,c as je,a as We,s as $e}from"./chunk_theme.27c7fb9c.js";import{r as p}from"./chunk_index.2e60a4fd.js";import{V as I}from"./chunk_Vector2.59035c21.js";import{D as Ke}from"./chunk_DebugDraw.090fc42c.js";import{j as l,F as ye,a as S,c as Ze}from"./chunk_jsx-runtime.d8530191.js";import{C as ie}from"./chunk_index.dc2a5aeb.js";import{d as xe,e as Ae,R as Se,C as Ce,r as qe,n as ee,h as Je}from"./chunk_color.657f5045.js";import"./chunk__commonjsHelpers.e5e952e9.js";function _(e){return WebGL2RenderingContext[e]}var se=(e=>(e.Fragment="FRAGMENT_SHADER",e.Vertex="VERTEX_SHADER",e))(se||{}),we=(e=>(e.StaticDraw="STATIC_DRAW",e.DynamicDraw="DYNAMIC_DRAW",e.StreamDraw="STREAM_DRAW",e.StaticRead="STATIC_READ",e.DynamicRead="DYNAMIC_READ",e.StreamRead="STREAM_READ",e.StaticCopy="STATIC_COPY",e.DynamicCopy="DYNAMIC_COPY",e.StreamCopy="STREAM_COPY",e))(we||{}),Ne=(e=>(e.Byte="BYTE",e.UnsignedByte="UNSIGNED_BYTE",e.Short="SHORT",e.UnsignedShort="UNSIGNED_SHORT",e.Float="FLOAT",e.HalfFloat="HALF_FLOAT",e))(Ne||{}),Ie=(e=>(e.Rgb="RGB",e.Rgba="RGBA",e.LuminanceAlpha="LUMINANCE_ALPHA",e.Luminance="LUMINANCE",e.Alpha="ALPHA",e.Red="RED",e.RedInteger="RED_INTEGER",e.Rg="RG",e.RgInteger="RG_INTEGER",e.RgbInteger="RGB_INTEGER",e.RgbaInteger="RGBA_INTEGER",e))(Ie||{}),Te=(e=>(e.UnsignedByte="UNSIGNED_BYTE",e.UnsignedShort565="UNSIGNED_SHORT_5_6_5",e.UnsignedShort4444="UNSIGNED_SHORT_4_4_4_4",e.UnsignedShort5551="UNSIGNED_SHORT_5_5_5_1",e.HalfFloat="HALF_FLOAT",e.Float="FLOAT",e.UnsignedInt10f11f11fRev="UNSIGNED_INT_10F_11F_11F_REV",e.UnsignedInt2101010Rev="UNSIGNED_INT_2_10_10_10_REV",e))(Te||{}),Le=(e=>(e.Rgb="RGB",e.Rgba="RGBA",e.LuminanceAlpha="LUMINANCE_ALPHA",e.Luminance="LUMINANCE",e.Alpha="ALPHA",e.R8="R8",e.R16f="R16F",e.R32f="R32F",e.R8ui="R8UI",e.Rg8="RG8",e.Rg16f="RG16F",e.Rg32f="RG32F",e.Rg8ui="RG8UI",e.Rgb8="RGB8",e.Srgb8="SRGB8",e.Rgb565="RGB565",e.R11fG11fB10f="R11F_G11F_B10F",e.Rgb9E5="RGB9_E5",e.Rgb16f="RGB16F",e.Rgb32f="RGB32F",e.Rgb8ui="RGB8UI",e.Rgba8="RGBA8",e.Srgb8Alpha8="SRGB8_ALPHA8",e.Rgb5A1="RGB5_A1",e.Rgb10A2="RGB10_A2",e.Rgba4="RGBA4",e.Rgba16f="RGBA16F",e.Rgba32f="RGBA32F",e.Rgba8ui="RGBA8UI",e))(Le||{}),ae=(e=>(e.Linear="LINEAR",e.Nearest="NEAREST",e.NearestMipmapNearest="NEAREST_MIPMAP_NEAREST",e.LinearMipmapNearest="LINEAR_MIPMAP_NEAREST",e.NearestMipmapLinear="NEAREST_MIPMAP_LINEAR",e.LinearMipmapLinear="LINEAR_MIPMAP_LINEAR",e))(ae||{}),ce=(e=>(e.Repeat="REPEAT",e.ClampToEdge="CLAMP_TO_EDGE",e.MirroredRepeat="MIRRORED_REPEAT",e))(ce||{});class O{constructor(t,r,n,o){this.gl=t,this.name=r,this.location=n,this.value=o}}class Qe extends O{apply(){this.gl.gl.uniform2f(this.location,this.value.x,this.value.y)}}class Ge extends O{apply(){this.gl.gl.uniform1f(this.location,this.value)}}class et extends O{apply(){this.gl.gl.uniform1ui(this.location,this.value?1:0)}}class tt extends O{apply(){this.gl.gl.uniform1i(this.location,this.value.textureUnit)}}class rt extends O{apply(){this.gl.gl.uniform1i(this.location,this.value)}}class ot{constructor(t,r,n){this.gl=t,this.vertexArray=r,this.buffer=n}bufferData(t,r){const{gl:n}=this.gl;n.bindBuffer(n.ARRAY_BUFFER,this.buffer),n.bufferData(n.ARRAY_BUFFER,t,_(r))}bindVao(){const{gl:t}=this.gl;t.bindVertexArray(this.vertexArray)}}class nt{constructor(t,r,n){this.vertexShader=r,this.fragmentShader=n,this.uniforms=[],this.gl=t;const{gl:o}=t,i=N(o.createProgram());if(o.attachShader(i,r.shader),o.attachShader(i,n.shader),o.linkProgram(i),!o.getProgramParameter(i,o.LINK_STATUS)){const a=`Failed to link shaders: ${o.getProgramInfoLog(i)}`;o.deleteProgram(i),_e(a)}this.program=i}createAndBindVertexArray({name:t,size:r,type:n,normalize:o=!1,stride:i=0,offset:d=0}){const{gl:a}=this.gl,b=this.gl.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b);const h=this.gl.createVertexArray();a.bindVertexArray(h);const c=a.getAttribLocation(this.program,t);return a.enableVertexAttribArray(c),a.vertexAttribPointer(c,r,_(n),o,i,d),new ot(this.gl,h,b)}getUniformLocation(t){return N(this.gl.gl.getUniformLocation(this.program,t),`uniform ${t} does not exist`)}addUniform(t,r,n){const o=new t(this.gl,r,this.getUniformLocation(r),n);return this.uniforms.push(o),o}uniformVector2(t,r){return this.addUniform(Qe,t,r)}uniformFloat(t,r){return this.addUniform(Ge,t,r)}uniformBool(t,r){return this.addUniform(et,t,r)}uniformTexture2d(t,r){return this.addUniform(tt,t,r)}uniformEnum(t,r){return this.addUniform(rt,t,r)}use(){this.gl.gl.useProgram(this.program);for(const t of this.uniforms)t.apply()}}class it{constructor(t,r,n){this.type=r,this.gl=t;const{gl:o}=t,i=N(o.createShader(_(r)));if(o.shaderSource(i,n),o.compileShader(i),!o.getShaderParameter(i,o.COMPILE_STATUS)){const a=`Failed to compile shader: ${o.getShaderInfoLog(i)}`;o.deleteShader(i),_e(a)}this.shader=i}}class st{constructor(t,r,n,o){this.gl=t,this.textureUnit=r,this.format=n,this.data=null,this.level=o!=null?o:0,this.texture=N(t.gl.createTexture())}set(t){this.data=t}bind(){const{gl:t}=this.gl;t.activeTexture(t.TEXTURE0+this.textureUnit),t.bindTexture(t.TEXTURE_2D,this.texture)}configure(t){const{gl:r}=this.gl;this.bind(),t.magFilter&&r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,_(t.magFilter)),t.minFilter&&r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,_(t.minFilter)),t.wrapS&&r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,_(t.wrapS)),t.wrapT&&r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,_(t.wrapT))}configureForData(){this.configure({magFilter:ae.Nearest,minFilter:ae.Nearest,wrapS:ce.ClampToEdge,wrapT:ce.ClampToEdge})}upload(){k(this.data,"data must be set on texture to upload"),this.bind(),this.gl.gl.texImage2D(WebGL2RenderingContext.TEXTURE_2D,this.level,_(this.format.internalFormat),this.data.width,this.data.height,0,_(this.format.pixelFormat),_(this.format.pixelType),this.data.data)}update(t){this.set(t),this.upload()}}class at{constructor(t){this.canvas=t,this.shaders=new B((n,o)=>new it(this,n,o),n=>this.gl.deleteShader(n.shader)),this.programs=new B((n,o)=>new nt(this,n,o),n=>this.gl.deleteProgram(n.program)),this.buffers=new B(()=>N(this.gl.createBuffer()),n=>this.gl.deleteBuffer(n)),this.vertexArrays=new B(()=>N(this.gl.createVertexArray()),n=>this.gl.deleteVertexArray(n)),this.textures=new B((n,o,i)=>new st(this,n,o,i),n=>this.gl.deleteTexture(n.texture));const r=t.getContext("webgl2");k(r,"browser does not support webgl2"),this.gl=r}destroy(){this.shaders.destroyAll(),this.programs.destroyAll(),this.buffers.destroyAll(),this.vertexArrays.destroyAll(),this.textures.destroyAll()}createShader(t,r){return this.shaders.create(t,r)}createProgram(t,r){return this.programs.create(t,r)}createBuffer(){return this.buffers.create()}createVertexArray(){return this.vertexArrays.create()}createTexture(t,r,n){return this.textures.create(t,r,n)}setDefaultViewport(){this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}clear(){const{gl:t}=this;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)}enumToString(t){const r=[];for(const n in this.gl)Ve(this.gl,n)===t&&r.push(n);return r.length?r.join(" | "):`0x${t.toString(16)}`}}class B{constructor(t,r){this.initializeResource=t,this.deleteResource=r,this.resources=[]}create(...t){const r=this.initializeResource(...t);return this.resources.push(r),r}destroyAll(){for(const t of this.resources)this.deleteResource(t);this.resources=[]}}var ct=`#version 300 es
#define MAX_BLOBS 32
#define ENTRIES_PER_BLOB 2
#define MODE_BLUR 0
#define MODE_INSIDE 1
#define MODE_OUTSIDE 2
#define MODE_FILL 3
#define INTERPOLATE_NAIVE 0
#define INTERPOLATE_VECTOR 1
#define INTERPOLATE_MIN 2
#define PI 3.1415926538
precision highp float;uniform sampler2D u_blobs;uniform float u_smoothness;uniform float u_blurSize;uniform float u_blurSpread;uniform int u_mode;uniform bool u_darkMode;uniform int u_interpolateMode;uniform float u_hueBias;in vec2 screenPosition;out vec4 outColor;float map(float value,float min1,float max1,float min2,float max2){return min2+(value-min1)*(max2-min2)/(max1-min1);}float sdfCircle(vec2 center,float radius){return length(center-screenPosition)-radius;}float opSmoothUnion(float d1,float d2,float k){float h=clamp(0.5+0.5*(d2-d1)/k,0.0,1.0);return mix(d2,d1,h)-k*h*(1.0-h);}float xyzF(float t){return mix(pow(t,1./3.),7.787037*t+0.139731,step(t,0.00885645));}float xyzR(float t){return mix(t*t*t,0.1284185*(t-0.139731),step(t,0.20689655));}vec3 rgb2lch(in vec3 c){vec3 wref=vec3(1.0,1.0,1.0);c*=mat3(0.4124,0.3576,0.1805,0.2126,0.7152,0.0722,0.0193,0.1192,0.9505);c.x=xyzF(c.x/wref.x);c.y=xyzF(c.y/wref.y);c.z=xyzF(c.z/wref.z);vec3 lab=vec3(max(0.,116.0*c.y-16.0),500.0*(c.x-c.y),200.0*(c.y-c.z));return vec3(lab.x,length(vec2(lab.y,lab.z)),atan(lab.z,lab.y));}vec3 lch2rgb(in vec3 c){vec3 wref=vec3(1.0,1.0,1.0);c=vec3(c.x,cos(c.z)*c.y,sin(c.z)*c.y);float lg=1./116.*(c.x+16.);vec3 xyz=vec3(wref.x*xyzR(lg+0.002*c.y),wref.y*xyzR(lg),wref.z*xyzR(lg-0.005*c.z));vec3 rgb=xyz*mat3(3.2406,-1.5372,-0.4986,-0.9689,1.8758,0.0415,0.0557,-0.2040,1.0570);return rgb;}float easeInOutCubic(in float t){return t<0.5 ? 4.*t*t*t:(t-1.)*(2.*t-2.)*(2.*t-2.)+1.;}float expDropOff(in float t,in float k){return 1./((t/k)+1.);}float rotate(in float angle,in float rotation){float rotated=angle+rotation;return atan(sin(rotated),cos(rotated));}void main(){int blobCount=min(textureSize(u_blobs,0).x/ENTRIES_PER_BLOB,MAX_BLOBS);float totalStrength=0.;vec3 totalColor=vec3(0);float dist=99999.0;vec2 hueVec=vec2(0);float minHue=0.;for(int i=0;i<blobCount;i++){vec4 d1=texelFetch(u_blobs,ivec2(i*ENTRIES_PER_BLOB,0),0);vec2 center=d1.xy;float radius=d1.z;vec3 blobColor=rgb2lch(texelFetch(u_blobs,ivec2((i*ENTRIES_PER_BLOB)+1,0),0).rgb);blobColor.z=rotate(blobColor.z,radians(u_hueBias));float sd=sdfCircle(center,radius);float strength=mix(smoothstep(1.0,0.0,sd/(u_blurSize*2.)),expDropOff(sd,u_blurSize),smoothstep(0.,1.,sd/u_blurSize));strength=pow(strength,5.0);totalStrength+=strength;totalColor+=blobColor*strength;hueVec+=vec2(cos(blobColor.z),sin(blobColor.z))*strength;if(u_interpolateMode==INTERPOLATE_MIN){float a=minHue/totalStrength;float d=blobColor.z-a;d=d>radians(180.)||d<radians(-180.)? d-radians(360.)*round(d/radians(360.)): d;minHue+=(strength*d);}dist=opSmoothUnion(sd,dist,u_smoothness);}float cutoff=smoothstep(0.0,1.0,-dist);vec3 bgColor=u_darkMode ? vec3(0): vec3(1);vec3 resultColor=vec3(1,0,1);if(u_interpolateMode==INTERPOLATE_NAIVE){resultColor=totalColor/totalStrength;}else if(u_interpolateMode==INTERPOLATE_VECTOR){resultColor=vec3((totalColor/totalStrength).xy,atan(hueVec.y,hueVec.x));}else if(u_interpolateMode==INTERPOLATE_MIN){resultColor=vec3((totalColor/totalStrength).xy,minHue/totalStrength);}resultColor.z=rotate(resultColor.z,radians(-u_hueBias));resultColor=lch2rgb(resultColor);if(u_mode==MODE_BLUR){outColor=vec4(mix(bgColor,resultColor,clamp(pow(totalStrength,1.-u_blurSpread),0.,1.)),1);}else if(u_mode==MODE_INSIDE){outColor=vec4(mix(bgColor,resultColor,cutoff),1);}else if(u_mode==MODE_OUTSIDE){outColor=vec4(mix(resultColor,bgColor,cutoff),1);}else if(u_mode==MODE_FILL){outColor=vec4(resultColor,1);}}`,lt=`#version 300 es
in vec2 a_position;uniform vec2 u_resolution;out vec2 screenPosition;void main(){screenPosition=a_position;vec2 zeroToOne=a_position/u_resolution;vec2 zeroToTwo=zeroToOne*2.0;vec2 clipSpace=zeroToTwo-1.0;gl_Position=vec4(clipSpace*vec2(1,-1),0,1);}`;function ut(){const[e,t]=p.exports.useState([]),r=p.exports.useRef([]),n=U((b,h,c)=>{var f,g;return r.current.push({type:"range",label:b,value:h,oldValue:h,...c}),(g=(f=e.find(m=>m.type==="range"&&m.label===b&&m.oldValue===h))==null?void 0:f.value)!=null?g:h}),o=U(function(h,c,f){var g,m;return r.current.push({type:"colorPicker",label:h,value:c,options:f,oldValue:c}),(m=(g=e.find(R=>R.type==="colorPicker"&&R.label===h&&z(R.oldValue,c)))==null?void 0:g.value)!=null?m:c}),i=U(function(h,c,f){var g,m;return r.current.push({type:"segmentedControl",label:h,value:c,options:f,oldValue:c}),(m=(g=e.find(R=>R.type==="segmentedControl"&&R.label===h&&z(R.oldValue,c)))==null?void 0:g.value)!=null?m:c}),d=U((b,h)=>{var c,f;return r.current.push({type:"checkbox",label:b,value:h,oldValue:h}),(f=(c=e.find(g=>g.type==="checkbox"&&g.label===b&&g.oldValue===h))==null?void 0:c.value)!=null?f:h}),a=U(()=>{z(e,r.current)||t(r.current),r.current=[]});return{render:()=>l(dt,{state:e,onChange:t}),ui:p.exports.useMemo(()=>({checkbox:d,range:n,flush:a,colorPicker:o,segmentedControl:i}),[d,o,a,n,i])}}function dt({state:e,onChange:t}){return l(ye,{children:e.map((r,n)=>{switch(r.type){case"checkbox":return l(ft,{label:r.label,value:r.value,onChange:o=>t(H(e,n,{...r,value:o}))},n);case"range":return l(ht,{label:r.label,value:r.value,onChange:o=>t(H(e,n,{...r,value:o})),min:r.min,max:r.max,step:r.step},n);case"colorPicker":return l(gt,{label:r.label,value:r.value,options:r.options,onChange:o=>t(H(e,n,{...r,value:o}))},n);case"segmentedControl":return l(bt,{label:r.label,value:r.value,options:r.options,onChange:o=>t(H(e,n,{...r,value:o}))},n);default:T(r)}})})}function ht({label:e,value:t,onChange:r,min:n,max:o,step:i}){const d=p.exports.useId();return S("div",{className:"flex flex-col gap-2 p-3",children:[l("label",{htmlFor:d,children:e}),S("div",{className:"flex items-center justify-between gap-3",children:[l("input",{id:d,className:"w-2/3 flex-auto",type:"range",value:t,min:n,max:o,step:i,onChange:a=>r(a.currentTarget.valueAsNumber)}),l("span",{className:"w-1/3 flex-none text-right",children:t.toPrecision(3)})]})]})}function ft({label:e,value:t,onChange:r}){const n=p.exports.useId();return S("div",{className:"flex gap-3 p-3",children:[l("input",{id:n,type:"checkbox",onChange:o=>r(o.currentTarget.checked),checked:t}),l("label",{htmlFor:n,children:e})]})}function gt({label:e,value:t,onChange:r,options:n}){return S("div",{className:"flex-col gap-3 p-3",children:[e,l("div",{className:"flex gap-1",children:n.map((o,i)=>l("div",{style:{background:o.color},className:"flex h-6 flex-1 cursor-pointer items-center justify-center",onClick:()=>r(o.value),children:z(o.value,t)&&l("div",{className:"h-3 w-3 rounded-full border-2 border-black bg-white"})},i))})]})}function bt({label:e,value:t,onChange:r,options:n}){return S("div",{className:"flex-col gap-3 p-3",children:[e,l("div",{className:"flex gap-2",children:n.map((o,i)=>l("button",{className:Ze("flex h-6 flex-auto items-center justify-center rounded text-sm",z(o.value,t)?"bg-gray-600":"hover:bg-gray-800"),onClick:()=>r(o.value),children:o.label},i))})]})}const mt=Math.PI/180,pt=180/Math.PI,j=18,Me=.96422,De=1,Pe=.82521,Ue=4/29,L=6/29,Be=3*L*L,Rt=L*L*L;function ke(e){if(e instanceof y)return new y(e.l,e.a,e.b,e.opacity);if(e instanceof C)return ze(e);e instanceof Se||(e=qe(e));var t=ne(e.r),r=ne(e.g),n=ne(e.b),o=te((.2225045*t+.7168786*r+.0606169*n)/De),i,d;return t===r&&r===n?i=d=o:(i=te((.4360747*t+.3850649*r+.1430804*n)/Me),d=te((.0139322*t+.0971045*r+.7141733*n)/Pe)),new y(116*o-16,500*(i-o),200*(o-d),e.opacity)}function vt(e,t,r,n){return arguments.length===1?ke(e):new y(e,t,r,n==null?1:n)}function y(e,t,r,n){this.l=+e,this.a=+t,this.b=+r,this.opacity=+n}xe(y,vt,Ae(Ce,{brighter(e){return new y(this.l+j*(e==null?1:e),this.a,this.b,this.opacity)},darker(e){return new y(this.l-j*(e==null?1:e),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,r=isNaN(this.b)?e:e-this.b/200;return t=Me*re(t),e=De*re(e),r=Pe*re(r),new Se(oe(3.1338561*t-1.6168667*e-.4906146*r),oe(-.9787684*t+1.9161415*e+.033454*r),oe(.0719453*t-.2289914*e+1.4052427*r),this.opacity)}}));function te(e){return e>Rt?Math.pow(e,1/3):e/Be+Ue}function re(e){return e>L?e*e*e:Be*(e-Ue)}function oe(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function ne(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Et(e){if(e instanceof C)return new C(e.h,e.c,e.l,e.opacity);if(e instanceof y||(e=ke(e)),e.a===0&&e.b===0)return new C(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*pt;return new C(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function le(e,t,r,n){return arguments.length===1?Et(e):new C(e,t,r,n==null?1:n)}function C(e,t,r,n){this.h=+e,this.c=+t,this.l=+r,this.opacity=+n}function ze(e){if(isNaN(e.h))return new y(e.l,0,0,e.opacity);var t=e.h*mt;return new y(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}xe(C,le,Ae(Ce,{brighter(e){return new C(this.h,this.c,this.l+j*(e==null?1:e),this.opacity)},darker(e){return new C(this.h,this.c,this.l-j*(e==null?1:e),this.opacity)},rgb(){return ze(this).rgb()}}));function _t(e){return function(t,r){var n=e((t=le(t)).h,(r=le(r)).h),o=ee(t.c,r.c),i=ee(t.l,r.l),d=ee(t.opacity,r.opacity);return function(a){return t.h=n(a),t.c=o(a),t.l=i(a),t.opacity=d(a),t+""}}}const yt=_t(Je);function xt(e,t){return e<5?ie(t(5)):e<10?E(t(5),t(10),v(5,10,e)):e<20?E(t(10),t(20),v(10,20,e)):e<30?E(t(20),t(30),v(20,30,e)):e<40?E(t(30),t(40),v(30,40,e)):e<50?E(t(40),t(50),v(40,50,e)):e<60?E(t(50),t(60),v(50,60,e)):e<70?E(t(60),t(70),v(60,70,e)):e<80?E(t(70),t(80),v(70,80,e)):e<90?E(t(80),t(90),v(80,90,e)):e<100?E(t(90),"#000000",v(90,100,e)):ie("#000000")}function E(e,t,r){return ie(yt(e,t)(r))}const At=Math.floor(w(5,10)),ue=[A.cyberRed,A.cyberOrange,A.cyberYellow,A.cyberGreen,A.cyberCyan,A.cyberBlue,A.cyberIndigo,A.cyberPurple,A.cyberPink],St=ue.map(e=>({value:e,color:e(50)}));function Ct({size:e}){const t=p.exports.useRef(null),r=p.exports.useRef(null),n=p.exports.useRef(),o=ut();return p.exports.useEffect(()=>(k(t.current&&r.current,"Assertion Error: displayCanvasRef.current && uiCanvasRef.current"),n.current=wt(t.current,r.current,o.ui),()=>{k(n.current,"Assertion Error: blobFactoryRef.current"),n.current.destroy(),n.current=void 0}),[o.ui]),p.exports.useEffect(()=>{k(n.current,"Assertion Error: blobFactoryRef.current"),n.current.setSize(e)},[e]),S(ye,{children:[S("div",{className:"absolute inset-0",onPointerMove:i=>{n.current&&n.current.onPointerMove(I.fromEvent(i))},onPointerDown:i=>{n.current&&n.current.onPointerDown(I.fromEvent(i))},onPointerUp:i=>{n.current&&n.current.onPointerUp(I.fromEvent(i))},children:[l("canvas",{ref:t,width:e.x*window.devicePixelRatio,height:e.y*window.devicePixelRatio,className:"absolute inset-0 h-full w-full"}),l("canvas",{ref:r,width:e.x*window.devicePixelRatio,height:e.y*window.devicePixelRatio,className:"absolute inset-0 h-full w-full"})]}),S("div",{className:"absolute right-0 top-0 h-full w-72 bg-gray-900",children:[S("ul",{className:"list-disc py-3 px-5 text-xs",children:[l("li",{children:"drag circles to move them"}),l("li",{children:"drag an edge to resize"}),l("li",{children:"drag in empty space for a new one"}),l("li",{children:"backspace to delete"}),l("li",{children:"refresh for something new"}),l("li",{children:"good color level for bgs in dark mode = ~80"}),l("li",{children:"good color level for bgs in light mode = ~20"})]}),o.render()]})]})}const ve=[{label:"blur",value:0},{label:"fill",value:3},{label:"inside",value:1},{label:"outside",value:2}],Ee=[{label:"naive",value:0},{label:"vector",value:1},{label:"min",value:2}];function wt(e,t,r){let n=I.ZERO,o={type:"idle"};const i=N(t.getContext("2d")),d=new Ke(i),a=new at(e),b=a.createShader(se.Fragment,ct),h=a.createShader(se.Vertex,lt),c=a.createProgram(h,b),f=He(At,u=>new de(new I(w(200,600),w(200,600)),w(30,100),X(ue))),g=c.uniformVector2("u_resolution",new I(100,100)),m=c.uniformFloat("u_smoothness",w(50,100)),R=c.uniformFloat("u_blurSize",150),he=c.uniformFloat("u_blurSpread",.8),M=c.uniformEnum("u_mode",X(ve).value),W=c.uniformBool("u_darkMode",Math.random()<.5),$=c.uniformEnum("u_interpolateMode",X(Ee).value),fe=c.uniformFloat("u_hueBias",w(0,360));let K=W.value?w(50,95):w(5,50),F=!1,Z=.5,V=!1,q=.5;const ge=c.createAndBindVertexArray({name:"a_position",size:2,type:Ne.Float}),J=a.createTexture(0,{internalFormat:Le.Rgba32f,pixelType:Te.Float,pixelFormat:Ie.Rgba});J.configureForData(),c.uniformTexture2d("u_blobs",J);const Oe=u=>{g.value=u,a.setDefaultViewport();const s=[0,0,u.x,u.y,0,u.y,0,0,u.x,0,u.x,u.y];ge.bufferData(new Float32Array(s),we.StaticDraw),me()},D=u=>{var s;return(s=f[u])!=null?s:null},be=()=>{switch(o.type){case"idle":case"unconfirmedCreate":case"selected":{let u=1/0,s=null,x=null;for(let P=0;P<f.length;P++){const Q=f[P],G=Q.center.distanceTo(n);G<Q.radius+5&&G<u&&(u=G,s=Q,x=P)}return[s,x]}case"moving":case"resizing":return[D(o.blobIndex),o.blobIndex];default:T(o)}},Fe=()=>{switch(o.type){case"idle":case"unconfirmedCreate":return null;case"moving":case"selected":case"resizing":return D(o.blobIndex);default:T(o)}},me=()=>{W.value=r.checkbox("dark mode",W.value),K=r.range("color level",K,{min:5,max:100,step:1}),$.value=r.segmentedControl("interpolation",$.value,Ee),$.value!==1&&(fe.value=r.range("hue bias",fe.value,{min:0,max:360,step:1})),M.value=r.segmentedControl("mode",M.value,ve),(M.value===1||M.value===2)&&(m.value=r.range("smoothness",m.value,{min:0,max:100,step:.1})),R.value=r.range("blur size",R.value,{min:0,max:200,step:.1}),M.value===0&&(he.value=r.range("blur spread",he.value,{min:.01,max:.99,step:.01})),F=r.checkbox("force chroma",F),F&&(Z=r.range("chroma",Z,{min:0,max:1,step:.01})),V=r.checkbox("force lightness",V),V&&(q=r.range("lightness",q,{min:0,max:1,step:.01})),a.clear(),J.update({width:f.length*2,height:1,data:new Float32Array(f.flatMap(x=>x.toArray(K,F?Z:null,V?q:null)))}),c.use(),ge.bindVao(),a.gl.drawArrays(WebGL2RenderingContext.TRIANGLES,0,6),d.clear(),d.ctx.resetTransform(),d.ctx.scale(window.devicePixelRatio,window.devicePixelRatio);const[u]=be(),s=Fe();u&&u!==s&&d.circle(u.center,u.radius,{stroke:"cyan",strokeWidth:1}),s&&(d.circle(s.center,s.radius,{stroke:"cyan",strokeWidth:2}),s.colorScale=r.colorPicker("color",s.colorScale,St)),d.fillText(Nt(o),new I(30,40),{fill:"white"}),r.flush()};let pe=!1;Xe((u,s)=>{if(pe){s();return}me()});const Re=u=>{o.type==="selected"&&Ye(u,"backspace")&&D(o.blobIndex)&&(f.splice(o.blobIndex,1),o={type:"idle"})};return window.addEventListener("keydown",Re),{setSize:Oe,destroy:()=>{a.destroy(),window.removeEventListener("keydown",Re),pe=!0},onPointerMove:u=>{switch(n=u,o.type){case"idle":case"selected":break;case"moving":{const s=D(o.blobIndex);s&&(s.center=n.add(o.offset));break}case"resizing":{const s=D(o.blobIndex);s&&(s.radius=n.distanceTo(s.center));break}case"unconfirmedCreate":{const s=o.center.distanceTo(n);if(s>5){const x=f.length;f.push(new de(o.center,s,X(ue))),o={type:"resizing",blobIndex:x}}break}default:T(o)}},onPointerDown:u=>{n=u;const[s,x]=be();switch(o.type){case"idle":case"selected":{s?Math.abs(s.center.distanceTo(n)-s.radius)<5?o={type:"resizing",blobIndex:x}:o={type:"moving",offset:s.center.sub(n),blobIndex:x}:o={type:"unconfirmedCreate",center:n};break}case"moving":case"unconfirmedCreate":case"resizing":break;default:T(o)}},onPointerUp:u=>{switch(n=u,o.type){case"idle":case"selected":break;case"moving":case"resizing":o={type:"selected",blobIndex:o.blobIndex};break;case"unconfirmedCreate":o={type:"idle"};break;default:T(o)}}}}class de{constructor(t,r,n){this.center=t,this.radius=r,this.colorScale=n}toArray(t,r,n){let o=xt(t,this.colorScale).lch();return r!==null&&(o=o.chroma(r*100)),n!==null&&(o=o.lightness(n*100)),o=o.rgb(),[this.center.x,this.center.y,this.radius,0,o.red()/255,o.green()/255,o.blue()/255,0]}toJSON(){return{center:this.center,radius:this.radius}}}de.size=8;function Nt(e){switch(e.type){case"idle":return Y(e.type);case"resizing":case"selected":return Y(e.type,{blob:e.blobIndex});case"moving":return Y(e.type,{offset:e.offset.toString(2),blob:e.blobIndex});case"unconfirmedCreate":return Y(e.type,{center:e.center.toString(2)})}}je(N(document.getElementById("root"))).render(l(It,{}));function It(){const[e,t]=p.exports.useState(null),r=We(e,$e);return l("div",{ref:t,className:"absolute inset-0 touch-none",children:r&&l(Ct,{size:r})})}
