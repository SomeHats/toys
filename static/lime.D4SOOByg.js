var ve=c=>{throw TypeError(c)};var me=(c,e,o)=>e.has(c)||ve("Cannot "+o);var Z=(c,e,o)=>(me(c,e,"read from private field"),o?o.call(c):e.get(c)),G=(c,e,o)=>e.has(c)?ve("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(c):e.set(c,o),V=(c,e,o,d)=>(me(c,e,"write to private field"),d?d.call(c,o):e.set(c,o),o);import"./chunk_modulepreload-polyfill.B5Qt9EMX.js";/* empty css                       */import{j as z,c as qe}from"./chunk_client.CotzxIPX.js";import{a as Ae,b as H}from"./chunk_assert.pxkjFBOg.js";import{a as Je,s as Qe}from"./chunk_useResizeObserver.DYIaNo-1.js";import{g as Ye,s as et}from"./chunk_storage.DBI0bUY6.js";import{z as tt,A as ee,x as nt,d as ye,B as we,i as te,w as rt}from"./chunk_utils.BtQBvwlT.js";import{S as it}from"./chunk_Spring.Dww0cPTw.js";import{T as st}from"./chunk_Ticker.CCL_5-d9.js";import{a as ot}from"./chunk_easings.B-aZwWel.js";import"./chunk_AABB.B469SoIe.js";import{V as N,S as C,R as Se,a as at}from"./chunk_Vector2.B_B2dMXe.js";import{r as ce,m as R,a as F}from"./chunk_signia.MYNlGhjX.js";import{c as le,S as ct,a as lt}from"./chunk_index.wtV57k8u.js";import{g as Ce,a as $e,b as Re}from"./chunk_perfectFreehand.BdOysC4l.js";import{c as ut,t as W}from"./chunk_index.7f6X1YHT.js";import{B as be}from"./chunk_Button.J1szTOvc.js";import{c as dt}from"./chunk_index.ZX3Pv0I0.js";import{r as Q,R as ft}from"./chunk_index.C5eOxiyT.js";import"./chunk_ResizeObserver.C8OzoCMD.js";import"./chunk_EventEmitter.DASG4daq.js";import"./chunk_RingBuffer.DBvCcgdE.js";import"./chunk__commonjsHelpers.Cpj98o6Y.js";import"./chunk_useMergedRefs.MPIvL6fk.js";import"./chunk_theme.DQE7OmCU.js";function ht(c,e,o,d,b){const T=c.lerp(e,b),_=e.lerp(o,b),k=o.lerp(d,b),D=T.lerp(_,b),a=_.lerp(k,b);return D.lerp(a,b)}let Pe,Ie;function pt(){function c(a,r){return function(u){(function(p,t){if(p.v)throw Error("attempted to call addInitializer after decoration was finished")})(r),d(u,"An initializer"),a.push(u)}}function e(a,r){if(!a(r))throw new TypeError("Attempted to access private element on non-instance")}function o(a,r,u,p,t,w,g,P,S){var n;switch(t){case 1:n="accessor";break;case 2:n="method";break;case 3:n="getter";break;case 4:n="setter";break;default:n="field"}var s,h,i={kind:n,name:g?"#"+r:gt(r),static:w,private:g},v={v:!1};if(t!==0&&(i.addInitializer=c(p,v)),g||t!==0&&t!==2)if(t===2)s=function(f){return e(S,f),u.value};else{var l=t===0||t===1;(l||t===3)&&(s=g?function(f){return e(S,f),u.get.call(f)}:function(f){return u.get.call(f)}),(l||t===4)&&(h=g?function(f,y){e(S,f),u.set.call(f,y)}:function(f,y){u.set.call(f,y)})}else s=function(f){return f[r]},t===0&&(h=function(f,y){f[r]=y});var m=g?S.bind():function(f){return r in f};i.access=s&&h?{get:s,set:h,has:m}:s?{get:s,has:m}:{set:h,has:m};try{return a(P,i)}finally{v.v=!0}}function d(a,r){if(typeof a!="function")throw new TypeError(r+" must be a function")}function b(a,r){var u=typeof r;if(a===1){if(u!=="object"||r===null)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");r.get!==void 0&&d(r.get,"accessor.get"),r.set!==void 0&&d(r.set,"accessor.set"),r.init!==void 0&&d(r.init,"accessor.init")}else if(u!=="function")throw new TypeError((a===0?"field":a===10?"class":"method")+" decorators must return a function or void 0")}function T(a){return function(r){a(this,r)}}function _(a,r,u,p,t,w,g,P,S){var n,s,h,i,v,l,m,f,y=u[0];if(g?(t===0||t===1?(n={get:(v=u[3],function(){return v(this)}),set:T(u[4])},h="get"):t===3?(n={get:u[3]},h="get"):t===4?(n={set:u[3]},h="set"):n={value:u[3]},t!==0&&(t===1&&xe(n.set,"#"+p,"set"),xe(n[h||"value"],"#"+p,h))):t!==0&&(n=Object.getOwnPropertyDescriptor(r,p)),t===1?i={get:n.get,set:n.set}:t===2?i=n.value:t===3?i=n.get:t===4&&(i=n.set),typeof y=="function")(l=o(y,p,n,P,t,w,g,i,S))!==void 0&&(b(t,l),t===0?s=l:t===1?(s=l.init,m=l.get||i.get,f=l.set||i.set,i={get:m,set:f}):i=l);else for(var j=y.length-1;j>=0;j--){var I;(l=o(y[j],p,n,P,t,w,g,i,S))!==void 0&&(b(t,l),t===0?I=l:t===1?(I=l.init,m=l.get||i.get,f=l.set||i.set,i={get:m,set:f}):i=l,I!==void 0&&(s===void 0?s=I:typeof s=="function"?s=[s,I]:s.push(I)))}if(t===0||t===1){if(s===void 0)s=function(E,x){return x};else if(typeof s!="function"){var M=s;s=function(E,x){for(var O=x,A=0;A<M.length;A++)O=M[A].call(E,O);return O}}else{var L=s;s=function(E,x){return L.call(E,x)}}a.push(s)}t!==0&&(t===1?(n.get=i.get,n.set=i.set):t===2?n.value=i:t===3?n.get=i:t===4&&(n.set=i),g?t===1?(a.push(function(E,x){return i.get.call(E,x)}),a.push(function(E,x){return i.set.call(E,x)})):t===2?a.push(i):a.push(function(E,x){return i.call(E,x)}):Object.defineProperty(r,p,n))}function k(a,r,u){for(var p,t,w,g=[],P=new Map,S=new Map,n=0;n<r.length;n++){var s=r[n];if(Array.isArray(s)){var h,i,v=s[1],l=s[2],m=s.length>3,f=v>=5,y=u;if(f?(h=a,(v-=5)!=0&&(i=t=t||[]),m&&!w&&(w=function(M){return mt(M)===a}),y=w):(h=a.prototype,v!==0&&(i=p=p||[])),v!==0&&!m){var j=f?S:P,I=j.get(l)||0;if(I===!0||I===3&&v!==4||I===4&&v!==3)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+l);!I&&v>2?j.set(l,v):j.set(l,!0)}_(g,h,s,l,v,f,m,i,y)}}return D(g,p),D(g,t),g}function D(a,r){r&&a.push(function(u){for(var p=0;p<r.length;p++)r[p].call(u);return u})}return function(a,r,u,p){return{e:k(a,r,p),get c(){return function(t,w){if(w.length>0){for(var g=[],P=t,S=t.name,n=w.length-1;n>=0;n--){var s={v:!1};try{var h=w[n](P,{kind:"class",name:S,addInitializer:c(g,s)})}finally{s.v=!0}h!==void 0&&(b(10,h),P=h)}return[P,function(){for(var i=0;i<g.length;i++)g[i].call(P)}]}}(a,u)}}}}function Ne(c,e,o,d){return(Ne=pt())(c,e,o,d)}function gt(c){var e=vt(c,"string");return typeof e=="symbol"?e:e+""}function vt(c,e){if(typeof c!="object"||!c)return c;var o=c[Symbol.toPrimitive];if(o!==void 0){var d=o.call(c,e);if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}function xe(c,e,o){typeof e=="symbol"&&(e=(e=e.description)?"["+e+"]":"");try{Object.defineProperty(c,"name",{configurable:!0,value:o?o+" "+e:e})}catch{}return c}function mt(c){if(Object(c)!==c)throw TypeError("right-hand side of 'in' should be an object, got "+(c!==null?typeof c:"null"));return c}var X;const fe=class fe{constructor(e){G(this,X,(Pe(this),Ie(this,N.ZERO)));this.lime=e}get screenPointer(){return Z(this,X)}set screenPointer(e){V(this,X,e)}get scenePointer(){return this.lime.viewport.screenToSlide(this.screenPointer)}updateFromEvent(e){this.screenPointer=N.fromEvent(e)}};X=new WeakMap,[Ie,Pe]=Ne(fe,[[ce,1,"screenPointer"],[R,3,"scenePointer"]],[]).e;let re=fe;const Le=1080,yt=Le/(16/9),$=new N(Le,yt),ne=new N(32,32),wt=200,Y={size:16,thinning:.5,smoothing:.5,last:!0};let Ee,je;function St(){function c(a,r){return function(u){(function(p,t){if(p.v)throw Error("attempted to call addInitializer after decoration was finished")})(r),d(u,"An initializer"),a.push(u)}}function e(a,r){if(!a(r))throw new TypeError("Attempted to access private element on non-instance")}function o(a,r,u,p,t,w,g,P,S){var n;switch(t){case 1:n="accessor";break;case 2:n="method";break;case 3:n="getter";break;case 4:n="setter";break;default:n="field"}var s,h,i={kind:n,name:g?"#"+r:bt(r),static:w,private:g},v={v:!1};if(t!==0&&(i.addInitializer=c(p,v)),g||t!==0&&t!==2)if(t===2)s=function(f){return e(S,f),u.value};else{var l=t===0||t===1;(l||t===3)&&(s=g?function(f){return e(S,f),u.get.call(f)}:function(f){return u.get.call(f)}),(l||t===4)&&(h=g?function(f,y){e(S,f),u.set.call(f,y)}:function(f,y){u.set.call(f,y)})}else s=function(f){return f[r]},t===0&&(h=function(f,y){f[r]=y});var m=g?S.bind():function(f){return r in f};i.access=s&&h?{get:s,set:h,has:m}:s?{get:s,has:m}:{set:h,has:m};try{return a(P,i)}finally{v.v=!0}}function d(a,r){if(typeof a!="function")throw new TypeError(r+" must be a function")}function b(a,r){var u=typeof r;if(a===1){if(u!=="object"||r===null)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");r.get!==void 0&&d(r.get,"accessor.get"),r.set!==void 0&&d(r.set,"accessor.set"),r.init!==void 0&&d(r.init,"accessor.init")}else if(u!=="function")throw new TypeError((a===0?"field":a===10?"class":"method")+" decorators must return a function or void 0")}function T(a){return function(r){a(this,r)}}function _(a,r,u,p,t,w,g,P,S){var n,s,h,i,v,l,m,f,y=u[0];if(g?(t===0||t===1?(n={get:(v=u[3],function(){return v(this)}),set:T(u[4])},h="get"):t===3?(n={get:u[3]},h="get"):t===4?(n={set:u[3]},h="set"):n={value:u[3]},t!==0&&(t===1&&De(n.set,"#"+p,"set"),De(n[h||"value"],"#"+p,h))):t!==0&&(n=Object.getOwnPropertyDescriptor(r,p)),t===1?i={get:n.get,set:n.set}:t===2?i=n.value:t===3?i=n.get:t===4&&(i=n.set),typeof y=="function")(l=o(y,p,n,P,t,w,g,i,S))!==void 0&&(b(t,l),t===0?s=l:t===1?(s=l.init,m=l.get||i.get,f=l.set||i.set,i={get:m,set:f}):i=l);else for(var j=y.length-1;j>=0;j--){var I;(l=o(y[j],p,n,P,t,w,g,i,S))!==void 0&&(b(t,l),t===0?I=l:t===1?(I=l.init,m=l.get||i.get,f=l.set||i.set,i={get:m,set:f}):i=l,I!==void 0&&(s===void 0?s=I:typeof s=="function"?s=[s,I]:s.push(I)))}if(t===0||t===1){if(s===void 0)s=function(E,x){return x};else if(typeof s!="function"){var M=s;s=function(E,x){for(var O=x,A=0;A<M.length;A++)O=M[A].call(E,O);return O}}else{var L=s;s=function(E,x){return L.call(E,x)}}a.push(s)}t!==0&&(t===1?(n.get=i.get,n.set=i.set):t===2?n.value=i:t===3?n.get=i:t===4&&(n.set=i),g?t===1?(a.push(function(E,x){return i.get.call(E,x)}),a.push(function(E,x){return i.set.call(E,x)})):t===2?a.push(i):a.push(function(E,x){return i.call(E,x)}):Object.defineProperty(r,p,n))}function k(a,r,u){for(var p,t,w,g=[],P=new Map,S=new Map,n=0;n<r.length;n++){var s=r[n];if(Array.isArray(s)){var h,i,v=s[1],l=s[2],m=s.length>3,f=v>=5,y=u;if(f?(h=a,(v-=5)!=0&&(i=t=t||[]),m&&!w&&(w=function(M){return It(M)===a}),y=w):(h=a.prototype,v!==0&&(i=p=p||[])),v!==0&&!m){var j=f?S:P,I=j.get(l)||0;if(I===!0||I===3&&v!==4||I===4&&v!==3)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+l);!I&&v>2?j.set(l,v):j.set(l,!0)}_(g,h,s,l,v,f,m,i,y)}}return D(g,p),D(g,t),g}function D(a,r){r&&a.push(function(u){for(var p=0;p<r.length;p++)r[p].call(u);return u})}return function(a,r,u,p){return{e:k(a,r,p),get c(){return function(t,w){if(w.length>0){for(var g=[],P=t,S=t.name,n=w.length-1;n>=0;n--){var s={v:!1};try{var h=w[n](P,{kind:"class",name:S,addInitializer:c(g,s)})}finally{s.v=!0}h!==void 0&&(b(10,h),P=h)}return[P,function(){for(var i=0;i<g.length;i++)g[i].call(P)}]}}(a,u)}}}}function Fe(c,e,o,d){return(Fe=St())(c,e,o,d)}function bt(c){var e=Pt(c,"string");return typeof e=="symbol"?e:e+""}function Pt(c,e){if(typeof c!="object"||!c)return c;var o=c[Symbol.toPrimitive];if(o!==void 0){var d=o.call(c,e);if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}function De(c,e,o){typeof e=="symbol"&&(e=(e=e.description)?"["+e+"]":"");try{Object.defineProperty(c,"name",{configurable:!0,value:o?o+" "+e:e})}catch{}return c}function It(c){if(Object(c)!==c)throw TypeError("right-hand side of 'in' should be an object, got "+(c!==null?typeof c:"null"));return c}class Be{constructor(e){this.parent=e,this.lime=e.lime}toDebugString(){return this.child?`${this.name}.${this.child.toDebugString()}`:this.name}}var B;const he=class he{constructor(e){G(this,B);this.lime=e,V(this,B,(Ee(this),je(this,new We(this)))),this.onPointerDown=o=>{var d,b;(b=(d=this.child).onPointerDown)==null||b.call(d,o)},this.onPointerMove=o=>{var d,b;(b=(d=this.child).onPointerMove)==null||b.call(d,o)},this.onPointerUp=o=>{var d,b;(b=(d=this.child).onPointerUp)==null||b.call(d,o)}}get child(){return Z(this,B)}set child(e){V(this,B,e)}toDebugString(){return`lime.${this.child.toDebugString()}`}};B=new WeakMap,[je,Ee]=Fe(he,[[ce,1,"child"]],[]).e;let ie=he;class We extends Be{constructor(){super(...arguments),this.name="idle"}onPointerDown(e){const o=this.lime.session.slideId;this.lime.updateSlide(o,d=>({...d,rawPoints:[this.lime.inputs.scenePointer]})),this.parent.child=new xt(this.parent,o)}}class xt extends Be{constructor(e,o){super(e),this.slideId=o,this.name="drawing"}onPointerMove(e){this.lime.updateSlide(this.slideId,o=>({...o,rawPoints:[...o.rawPoints,this.lime.inputs.scenePointer]}))}onPointerUp(e){this.parent.child=new We(this.parent)}}function U(c){const e=new RegExp(`^${c}\\:([a-zA-Z0-9_-]+)$`),o=d=>e.test(d)?Se.ok(d):Se.error(new at(`Expected ${c}:*, got ${d}`,[]));return C.string.transform(o,o,tt)}const Ve=C.object({typeName:C.value("doc"),id:U("doc"),slideIds:C.arrayOf(U("slide"))}),ue=le("doc",{scope:"document",validator:Ve.asValidator()}),q=ue.createId("doc"),He=C.object({typeName:C.value("slide"),id:U("slide"),rawPoints:C.arrayOf(N.schema)}),se=le("slide",{scope:"document",validator:He.asValidator()}).withDefaultProperties(()=>({rawPoints:[]})),Ue=C.object({typeName:C.value("session"),id:U("session"),slideId:U("slide"),tweenBezierControl:C.number,speed:C.number}),de=le("session",{scope:"session",validator:Ue.asValidator()}).withDefaultProperties(()=>({tweenBezierControl:.4,speed:650})),J=de.createId("session"),Et=C.union("typeName",{doc:Ve,slide:He,session:Ue}),ze=C.objectMap(C.string,Et),jt=ct.create({doc:ue,slide:se,session:de});class Dt extends lt{constructor(e){super({schema:jt,props:{},initialData:e})}insert(e){Ae(!this.get(e.id),"Assertion Error: !this.get(record.id)"),this.put([e])}}let ke,_e;function zt(){function c(a,r){return function(u){(function(p,t){if(p.v)throw Error("attempted to call addInitializer after decoration was finished")})(r),d(u,"An initializer"),a.push(u)}}function e(a,r){if(!a(r))throw new TypeError("Attempted to access private element on non-instance")}function o(a,r,u,p,t,w,g,P,S){var n;switch(t){case 1:n="accessor";break;case 2:n="method";break;case 3:n="getter";break;case 4:n="setter";break;default:n="field"}var s,h,i={kind:n,name:g?"#"+r:kt(r),static:w,private:g},v={v:!1};if(t!==0&&(i.addInitializer=c(p,v)),g||t!==0&&t!==2)if(t===2)s=function(f){return e(S,f),u.value};else{var l=t===0||t===1;(l||t===3)&&(s=g?function(f){return e(S,f),u.get.call(f)}:function(f){return u.get.call(f)}),(l||t===4)&&(h=g?function(f,y){e(S,f),u.set.call(f,y)}:function(f,y){u.set.call(f,y)})}else s=function(f){return f[r]},t===0&&(h=function(f,y){f[r]=y});var m=g?S.bind():function(f){return r in f};i.access=s&&h?{get:s,set:h,has:m}:s?{get:s,has:m}:{set:h,has:m};try{return a(P,i)}finally{v.v=!0}}function d(a,r){if(typeof a!="function")throw new TypeError(r+" must be a function")}function b(a,r){var u=typeof r;if(a===1){if(u!=="object"||r===null)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");r.get!==void 0&&d(r.get,"accessor.get"),r.set!==void 0&&d(r.set,"accessor.set"),r.init!==void 0&&d(r.init,"accessor.init")}else if(u!=="function")throw new TypeError((a===0?"field":a===10?"class":"method")+" decorators must return a function or void 0")}function T(a){return function(r){a(this,r)}}function _(a,r,u,p,t,w,g,P,S){var n,s,h,i,v,l,m,f,y=u[0];if(g?(t===0||t===1?(n={get:(v=u[3],function(){return v(this)}),set:T(u[4])},h="get"):t===3?(n={get:u[3]},h="get"):t===4?(n={set:u[3]},h="set"):n={value:u[3]},t!==0&&(t===1&&Te(n.set,"#"+p,"set"),Te(n[h||"value"],"#"+p,h))):t!==0&&(n=Object.getOwnPropertyDescriptor(r,p)),t===1?i={get:n.get,set:n.set}:t===2?i=n.value:t===3?i=n.get:t===4&&(i=n.set),typeof y=="function")(l=o(y,p,n,P,t,w,g,i,S))!==void 0&&(b(t,l),t===0?s=l:t===1?(s=l.init,m=l.get||i.get,f=l.set||i.set,i={get:m,set:f}):i=l);else for(var j=y.length-1;j>=0;j--){var I;(l=o(y[j],p,n,P,t,w,g,i,S))!==void 0&&(b(t,l),t===0?I=l:t===1?(I=l.init,m=l.get||i.get,f=l.set||i.set,i={get:m,set:f}):i=l,I!==void 0&&(s===void 0?s=I:typeof s=="function"?s=[s,I]:s.push(I)))}if(t===0||t===1){if(s===void 0)s=function(E,x){return x};else if(typeof s!="function"){var M=s;s=function(E,x){for(var O=x,A=0;A<M.length;A++)O=M[A].call(E,O);return O}}else{var L=s;s=function(E,x){return L.call(E,x)}}a.push(s)}t!==0&&(t===1?(n.get=i.get,n.set=i.set):t===2?n.value=i:t===3?n.get=i:t===4&&(n.set=i),g?t===1?(a.push(function(E,x){return i.get.call(E,x)}),a.push(function(E,x){return i.set.call(E,x)})):t===2?a.push(i):a.push(function(E,x){return i.call(E,x)}):Object.defineProperty(r,p,n))}function k(a,r,u){for(var p,t,w,g=[],P=new Map,S=new Map,n=0;n<r.length;n++){var s=r[n];if(Array.isArray(s)){var h,i,v=s[1],l=s[2],m=s.length>3,f=v>=5,y=u;if(f?(h=a,(v-=5)!=0&&(i=t=t||[]),m&&!w&&(w=function(M){return Tt(M)===a}),y=w):(h=a.prototype,v!==0&&(i=p=p||[])),v!==0&&!m){var j=f?S:P,I=j.get(l)||0;if(I===!0||I===3&&v!==4||I===4&&v!==3)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+l);!I&&v>2?j.set(l,v):j.set(l,!0)}_(g,h,s,l,v,f,m,i,y)}}return D(g,p),D(g,t),g}function D(a,r){r&&a.push(function(u){for(var p=0;p<r.length;p++)r[p].call(u);return u})}return function(a,r,u,p){return{e:k(a,r,p),get c(){return function(t,w){if(w.length>0){for(var g=[],P=t,S=t.name,n=w.length-1;n>=0;n--){var s={v:!1};try{var h=w[n](P,{kind:"class",name:S,addInitializer:c(g,s)})}finally{s.v=!0}h!==void 0&&(b(10,h),P=h)}return[P,function(){for(var i=0;i<g.length;i++)g[i].call(P)}]}}(a,u)}}}}function Xe(c,e,o,d){return(Xe=zt())(c,e,o,d)}function kt(c){var e=_t(c,"string");return typeof e=="symbol"?e:e+""}function _t(c,e){if(typeof c!="object"||!c)return c;var o=c[Symbol.toPrimitive];if(o!==void 0){var d=o.call(c,e);if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}function Te(c,e,o){typeof e=="symbol"&&(e=(e=e.description)?"["+e+"]":"");try{Object.defineProperty(c,"name",{configurable:!0,value:o?o+" "+e:e})}catch{}return c}function Tt(c){if(Object(c)!==c)throw TypeError("right-hand side of 'in' should be an object, got "+(c!==null?typeof c:"null"));return c}var K;const pe=class pe{constructor(){G(this,K,(ke(this),_e(this,N.ZERO)))}get screenSize(){return Z(this,K)}set screenSize(e){V(this,K,e)}get canvasOffset(){return new N(wt,0)}get canvasSize(){return this.screenSize.sub(this.canvasOffset)}get availableCanvasSize(){return this.canvasSize.sub(ne.scale(2))}get scaleFactor(){return Math.min(this.availableCanvasSize.x/$.x,this.availableCanvasSize.y/$.y)}get slideSize(){return $.scale(this.scaleFactor)}get slideOffset(){return new N(Math.max(ne.x,(this.canvasSize.x-this.slideSize.x)/2),Math.max(ne.y,(this.canvasSize.y-this.slideSize.y)/2))}screenToSlide(e){return e.sub(this.canvasOffset).sub(this.slideOffset).div(this.scaleFactor)}slideToScreen(e){return e.scale(this.scaleFactor).add(this.slideOffset).add(this.canvasOffset)}};K=new WeakMap,[_e,ke]=Xe(pe,[[ce,1,"screenSize"],[R,3,"canvasOffset"],[R,3,"canvasSize"],[R,3,"availableCanvasSize"],[R,3,"scaleFactor"],[R,3,"slideSize"],[R,3,"slideOffset"]],[]).e;let oe=pe,Me;function Mt(){function c(a,r){return function(u){(function(p,t){if(p.v)throw Error("attempted to call addInitializer after decoration was finished")})(r),d(u,"An initializer"),a.push(u)}}function e(a,r){if(!a(r))throw new TypeError("Attempted to access private element on non-instance")}function o(a,r,u,p,t,w,g,P,S){var n;switch(t){case 1:n="accessor";break;case 2:n="method";break;case 3:n="getter";break;case 4:n="setter";break;default:n="field"}var s,h,i={kind:n,name:g?"#"+r:Ot(r),static:w,private:g},v={v:!1};if(t!==0&&(i.addInitializer=c(p,v)),g||t!==0&&t!==2)if(t===2)s=function(f){return e(S,f),u.value};else{var l=t===0||t===1;(l||t===3)&&(s=g?function(f){return e(S,f),u.get.call(f)}:function(f){return u.get.call(f)}),(l||t===4)&&(h=g?function(f,y){e(S,f),u.set.call(f,y)}:function(f,y){u.set.call(f,y)})}else s=function(f){return f[r]},t===0&&(h=function(f,y){f[r]=y});var m=g?S.bind():function(f){return r in f};i.access=s&&h?{get:s,set:h,has:m}:s?{get:s,has:m}:{set:h,has:m};try{return a(P,i)}finally{v.v=!0}}function d(a,r){if(typeof a!="function")throw new TypeError(r+" must be a function")}function b(a,r){var u=typeof r;if(a===1){if(u!=="object"||r===null)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");r.get!==void 0&&d(r.get,"accessor.get"),r.set!==void 0&&d(r.set,"accessor.set"),r.init!==void 0&&d(r.init,"accessor.init")}else if(u!=="function")throw new TypeError((a===0?"field":a===10?"class":"method")+" decorators must return a function or void 0")}function T(a){return function(r){a(this,r)}}function _(a,r,u,p,t,w,g,P,S){var n,s,h,i,v,l,m,f,y=u[0];if(g?(t===0||t===1?(n={get:(v=u[3],function(){return v(this)}),set:T(u[4])},h="get"):t===3?(n={get:u[3]},h="get"):t===4?(n={set:u[3]},h="set"):n={value:u[3]},t!==0&&(t===1&&Oe(n.set,"#"+p,"set"),Oe(n[h||"value"],"#"+p,h))):t!==0&&(n=Object.getOwnPropertyDescriptor(r,p)),t===1?i={get:n.get,set:n.set}:t===2?i=n.value:t===3?i=n.get:t===4&&(i=n.set),typeof y=="function")(l=o(y,p,n,P,t,w,g,i,S))!==void 0&&(b(t,l),t===0?s=l:t===1?(s=l.init,m=l.get||i.get,f=l.set||i.set,i={get:m,set:f}):i=l);else for(var j=y.length-1;j>=0;j--){var I;(l=o(y[j],p,n,P,t,w,g,i,S))!==void 0&&(b(t,l),t===0?I=l:t===1?(I=l.init,m=l.get||i.get,f=l.set||i.set,i={get:m,set:f}):i=l,I!==void 0&&(s===void 0?s=I:typeof s=="function"?s=[s,I]:s.push(I)))}if(t===0||t===1){if(s===void 0)s=function(E,x){return x};else if(typeof s!="function"){var M=s;s=function(E,x){for(var O=x,A=0;A<M.length;A++)O=M[A].call(E,O);return O}}else{var L=s;s=function(E,x){return L.call(E,x)}}a.push(s)}t!==0&&(t===1?(n.get=i.get,n.set=i.set):t===2?n.value=i:t===3?n.get=i:t===4&&(n.set=i),g?t===1?(a.push(function(E,x){return i.get.call(E,x)}),a.push(function(E,x){return i.set.call(E,x)})):t===2?a.push(i):a.push(function(E,x){return i.call(E,x)}):Object.defineProperty(r,p,n))}function k(a,r,u){for(var p,t,w,g=[],P=new Map,S=new Map,n=0;n<r.length;n++){var s=r[n];if(Array.isArray(s)){var h,i,v=s[1],l=s[2],m=s.length>3,f=v>=5,y=u;if(f?(h=a,(v-=5)!=0&&(i=t=t||[]),m&&!w&&(w=function(M){return Ct(M)===a}),y=w):(h=a.prototype,v!==0&&(i=p=p||[])),v!==0&&!m){var j=f?S:P,I=j.get(l)||0;if(I===!0||I===3&&v!==4||I===4&&v!==3)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+l);!I&&v>2?j.set(l,v):j.set(l,!0)}_(g,h,s,l,v,f,m,i,y)}}return D(g,p),D(g,t),g}function D(a,r){r&&a.push(function(u){for(var p=0;p<r.length;p++)r[p].call(u);return u})}return function(a,r,u,p){return{e:k(a,r,p),get c(){return function(t,w){if(w.length>0){for(var g=[],P=t,S=t.name,n=w.length-1;n>=0;n--){var s={v:!1};try{var h=w[n](P,{kind:"class",name:S,addInitializer:c(g,s)})}finally{s.v=!0}h!==void 0&&(b(10,h),P=h)}return[P,function(){for(var i=0;i<g.length;i++)g[i].call(P)}]}}(a,u)}}}}function Ke(c,e,o,d){return(Ke=Mt())(c,e,o,d)}function Ot(c){var e=At(c,"string");return typeof e=="symbol"?e:e+""}function At(c,e){if(typeof c!="object"||!c)return c;var o=c[Symbol.toPrimitive];if(o!==void 0){var d=o.call(c,e);if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}function Oe(c,e,o){typeof e=="symbol"&&(e=(e=e.description)?"["+e+"]":"");try{Object.defineProperty(c,"name",{configurable:!0,value:o?o+" "+e:e})}catch{}return c}function Ct(c){if(Object(c)!==c)throw TypeError("right-hand side of 'in' should be an object, got "+(c!==null?typeof c:"null"));return c}const ge=class ge{constructor(e){this.store=e,this.state=(Me(this),new ie(this)),this.viewport=new oe,this.inputs=new re(this),this.ticker=new st,this.ensureStoreIsReady()}ensureStoreIsReady(){const e=this.store.query.records("slide").get();if(!e.length){const o=se.create({});this.store.put([o]),e.push(o)}this.store.get(q)||this.store.put([ue.create({id:q,slideIds:e.map(o=>o.id)})]),this.store.get(J)||this.store.put([de.create({id:J,slideId:e[0].id})])}get document(){return H(this.store.get(q),"Assertion Error: this.store.get(LIME_DOC_ID)")}updateDocument(e){this.store.update(q,o=>ee(o,e))}get session(){return H(this.store.get(J),"Assertion Error: this.store.get(SESSION_ID)")}updateSession(e){this.store.update(J,o=>ee(o,e))}getSlide(e){return H(this.store.get(e),"Assertion Error: this.store.get(slideId)")}getSlideIndex(e){const o=this.document.slideIds.indexOf(e);return Ae(o!==-1,"Assertion Error: slideIndex !== -1"),o}getSlideByIndex(e){const{slideIds:o}=this.document;return this.getSlide(o[nt(0,o.length,e)])}updateSlide(e,o){this.store.update(e,d=>ee(d,o))}get _slideStrokePointsCache(){return this.store.createComputedCache("slideStrokePoints",e=>Ce(e.rawPoints,Y))}getSlideStrokePoints(e){return H(this._slideStrokePointsCache.get(e),"Assertion Error: this._slideStrokePointsCache.get(slideId)")}get playheadSpring(){return new it({target:ut("playheadTarget",()=>this.getSlideIndex(this.session.slideId)),ticker:this.ticker,tension:100,friction:25})}get playhead(){return this.playheadSpring.value}get animationStepCache(){return this.store.createComputedCache("animationSteps",e=>{const{tweenBezierControl:o,speed:d}=this.session,b=this.getSlideByIndex(this.getSlideIndex(e.id)+1),T=e.rawPoints,_=b.rawPoints,k=this.getSlideStrokePoints(e.id),D=this.getSlideStrokePoints(b.id);if(!T.length||!D.length)return null;const a=k[k.length-1],r=D[0],u=a.point.distanceTo(r.point),p=a.point,t=a.point.sub(a.vector.scale(u*o)),w=r.point.add(r.vector.scale(u*o)),g=r.point,P=[];for(let l=0;l<u;l+=d/60){const m=te(0,u,l),f=ht(p,t,w,g,m);P.push(f)}const S=[0],n=[];let s=0,h=null;for(const l of T){if(h){const m=l.distanceTo(h);s+=m,S.push(s)}h=l,n.push(l)}const i=s;for(const l of P){if(h){const m=l.distanceTo(h);s+=m,S.push(s)}h=l,n.push(l)}const v=s-i;for(const l of _){if(h){const m=l.distanceTo(h);s+=m,S.push(s)}h=l,n.push(l)}return{allPoints:n,runningLengths:S,initialWindowStart:0,initialWindowEnd:i,finalWindowStart:i+v,finalWindowEnd:s}})}getPlayheadPoints(){const{playhead:e}=this,o=this.getSlideByIndex(Math.floor(e)),d=this.animationStepCache.get(o.id);if(!d)return o.rawPoints;const b=ot(e-Math.floor(e)),T=ye(d.initialWindowStart,d.finalWindowStart,b),_=ye(d.initialWindowEnd,d.finalWindowEnd,b),k=we(d.runningLengths,T),D=we(d.runningLengths,_,k),a=Math.min(k+1,d.allPoints.length),r=Math.min(D+1,d.allPoints.length),u=Math.max(D-1,0),p=d.allPoints[k].lerp(d.allPoints[a],te(d.runningLengths[k],d.runningLengths[a],T)),t=d.allPoints[D].lerp(d.allPoints[r],te(d.runningLengths[D],d.runningLengths[r],_));return[p,...d.allPoints.slice(a,u),t]}clearDocument(){this.store.clear(),this.ensureStoreIsReady()}newSlide(){const e=se.create({});this.store.insert(e),this.updateDocument(o=>({...o,slideIds:[...o.slideIds,e.id]})),this.updateSession(o=>({...o,slideId:e.id}))}changeSlide(e){const o=this.getSlide(e);this.updateSession(d=>({...d,slideId:o.id}))}onPointerDown(e){this.inputs.updateFromEvent(e),this.state.onPointerDown(e)}onPointerMove(e){this.inputs.updateFromEvent(e),this.state.onPointerMove(e)}onPointerUp(e){this.inputs.updateFromEvent(e),this.state.onPointerUp(e)}};[Me]=Ke(ge,[[R,3,"document"],[R,3,"session"],[R,3,"_slideStrokePointsCache"],[R,3,"playheadSpring"],[R,3,"animationStepCache"],[F,2,"clearDocument"],[F,2,"newSlide"],[F,2,"changeSlide"],[F,2,"onPointerDown"],[F,2,"onPointerMove"],[F,2,"onPointerUp"]],[]).e;let ae=ge;function $t(){const[c,e]=Q.useState(null),o=Je(c,Qe),[d,b]=Q.useState(null);return Q.useEffect(()=>{const T=Ye("lime.doc",ze,()=>({})),_=new Dt(T),k=new ae(_);k.ticker.start(),b(k);const D=rt(1e3,()=>{et("lime.doc",ze,_.serialize("all"))}),a=_.listen(()=>{D()});return()=>{a(),D.cancel(),k.ticker.stop()}},[]),z.jsx("div",{ref:e,className:"absolute inset-0 touch-none select-none overflow-hidden",children:o&&d&&z.jsx(Rt,{size:o,lime:d})})}const Rt=W(function({size:e,lime:o}){return Q.useEffect(()=>{o.viewport.screenSize=e},[e,o]),z.jsxs(z.Fragment,{children:[z.jsxs("div",{className:"absolute top-0 left-0 h-full w-[200px] bg-stone-50 flex p-4 gap-4 flex-col overflow-auto shadow-lg",children:[o.state.toDebugString(),o.document.slideIds.map(d=>z.jsx(Nt,{lime:o,slideId:d,isActive:o.session.slideId===d},d)),z.jsx(be,{className:"flex-none",onClick:()=>o.newSlide(),children:"+"}),z.jsx(be,{onClick:()=>o.clearDocument(),className:"mt-auto flex-none",children:"reset"})]}),z.jsx(Lt,{lime:o}),z.jsxs("div",{className:"absolute top-0 left-[200px] flex gap-4",children:[z.jsxs("label",{className:"gap-2 flex",children:["slop",z.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:o.session.tweenBezierControl,onChange:d=>o.updateSession(b=>({...b,tweenBezierControl:d.currentTarget.valueAsNumber}))}),o.session.tweenBezierControl]}),z.jsxs("label",{className:"gap-2 flex",children:["speed",z.jsx("input",{type:"range",min:"100",max:"2000",step:"1",value:o.session.speed,onChange:d=>o.updateSession(b=>({...b,speed:d.currentTarget.valueAsNumber}))}),o.session.speed]})]})]})}),Nt=W(function({lime:e,slideId:o,isActive:d}){return z.jsx("div",{className:dt("w-full aspect-video ring-1 rounded relative ring-stone-200 flex-none ",d&&"ring-blue-500 ring-2"),onClick:()=>e.changeSlide(o),children:z.jsx("div",{className:"absolute inset-0 rounded overflow-hidden",children:z.jsx(Ze,{scale:168/$.x,children:z.jsx(Ge,{lime:e,slideId:o})})})})}),Lt=W(function({lime:e}){const{canvasSize:o,canvasOffset:d,slideSize:b,slideOffset:T,scaleFactor:_}=e.viewport,{slideId:k}=e.session;return e.document.slideIds[(e.document.slideIds.indexOf(k)+1)%e.document.slideIds.length],z.jsx("div",{className:"absolute bg-stone-100",style:{width:o.x,height:o.y,left:d.x,top:d.y},onPointerDown:D=>e.onPointerDown(D.nativeEvent),onPointerMove:D=>e.onPointerMove(D.nativeEvent),onPointerUp:D=>e.onPointerUp(D.nativeEvent),children:z.jsx("div",{className:"absolute rounded-lg shadow-md overflow-hidden",style:{width:b.x,height:b.y,left:T.x,top:T.y},children:z.jsx(Ze,{scale:_,children:e.state.child.name==="drawing"?z.jsx(Ge,{lime:e,slideId:e.session.slideId}):z.jsx(Ft,{lime:e})})})})}),Ze=W(function({scale:e,children:o}){return z.jsx("div",{style:{width:$.x,height:$.y,transform:`scale(${e})`},className:"absolute origin-top-left bg-white overflow-hidden",children:o})}),Ge=W(function({lime:e,slideId:o}){const d=e.getSlideStrokePoints(o);if(!d.length)return null;const b=$e(d,Y);return z.jsx("svg",{className:"absolute inset-0",viewBox:`0 0 ${$.x} ${$.y}`,width:$.x,height:$.y,children:z.jsx("path",{d:Re(b),className:"fill-stone-600"})})}),Ft=W(function({lime:e}){const o=e.getPlayheadPoints(),d=Ce(o,Y),b=$e(d,Y);return z.jsx("svg",{className:"absolute inset-0",viewBox:`0 0 ${$.x} ${$.y}`,width:$.x,height:$.y,children:z.jsx("path",{d:Re(b),className:"fill-stone-600"})})}),Bt=H(document.getElementById("root"),'Assertion Error: document.getElementById("root")');qe(Bt).render(z.jsx(ft.StrictMode,{children:z.jsx($t,{})}));
