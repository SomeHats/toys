import{a as v,b as se,l as Me,K as M,t as Re,s as Ae,L as $e,h as Q,g as R,M as Ue,f as ke,C as je,B as me,E as Be,e as Fe,d as x,N as qe}from"../chunks/chunk_assert.a61dfbc1.js";/* empty css                               */import{a as _e,r as g,R as Qe}from"../chunks/chunk_index.0b2a17fa.js";import{R as We,a as B,j as P,c as F,F as Ze}from"../chunks/chunk_ResizeObserver.f9437ff6.js";import{V as S,b as ie,R as $,P as Ge,d as He,c as C,a as Je,e as ye,p as Xe}from"../chunks/chunk_Vector2.60ea25ce.js";import"../chunks/chunk__commonjsHelpers.fbcca4d8.js";var re=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,o,u;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(o=r;o--!==0;)if(!n(e[o],t[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(u=Object.keys(e),r=u.length,r!==Object.keys(t).length)return!1;for(o=r;o--!==0;)if(!Object.prototype.hasOwnProperty.call(t,u[o]))return!1;for(o=r;o--!==0;){var s=u[o];if(!n(e[s],t[s]))return!1}return!0}return e!==e&&t!==t},Ee,we=_e.exports;Ee=we.createRoot,we.hydrateRoot;let te;const U=new Map;function Ye(n){for(const e of n)for(const t of se(U.get(e.target),"callback does not exist for tracked entry"))t(e)}function be(){return te||(te=new We(Ye)),te}function et(n,e){let t=U.get(n);t||(t=new Set,U.set(n,t),be().observe(n)),t.add(e)}function tt(n,e){const t=U.get(n);v(t,"element is not tracked");const r=t.delete(e);v(r,"callback did not exist for element"),t.size===0&&(U.delete(n),be().unobserve(n))}function nt(n,e){const[t,r]=g.exports.useState(null);return g.exports.useEffect(()=>{if(!n)return;const o=u=>{r(e(u))};return et(n,o),()=>{tt(n,o)}},[n,e]),t}function rt(n){return new S(n.contentRect.width,n.contentRect.height)}const{min:D,PI:Mt}=Math,Se=.275;function Ve(n,e={}){const{size:t=16,smoothing:r=.5,thinning:o=.5,simulatePressure:u=!0,easing:s=y=>y,start:c={},end:h={},last:w=!1}=e,{cap:m=!0,easing:i=y=>y*(2-y)}=c,{cap:a=!0,easing:d=y=>--y*y*y+1}=h;if(n.length===0||t<=0)return[];const p=n[n.length-1].runningLength,l=c.taper===!1?0:c.taper===!0?Math.max(t,p):c.taper,f=h.taper===!1?0:h.taper===!0?Math.max(t,p):h.taper,I=Math.pow(t*r,2),H=[];let J=n.slice(0,10).reduce((y,O)=>{let T=O.pressure;if(u){const N=D(1,O.distance/t),ee=D(1,1-N);T=D(1,y+(ee-y)*(N*Se))}return(y+T)/2},n[0].pressure),E=Pe(t,o,n[n.length-1].pressure,s);n[0].vector;let X=n[0].point,Y=X;for(let y=0;y<n.length;y++){let{pressure:O}=n[y];const{point:T,vector:N,distance:ee,runningLength:L}=n[y];if(y<n.length-1&&p-L<3)continue;if(o){if(u){const ge=D(1,ee/t),Ke=D(1,1-ge);O=D(1,J+(Ke-J)*(ge*Se))}E=Pe(t,o,O,s)}else E=t/2;const ze=L<l?i(L/l):1,Ne=p-L<f?d((p-L)/f):1;if(E=Math.max(.01,E*Math.min(ze,Ne)),y===n.length-1){H.push({center:T,radius:E});continue}const fe=n[y+1].vector,Le=N.dot(fe);fe.lerp(N,Le).perpendicular().scale(E),Y=T,(y<=1||X.distanceToSq(Y)>I)&&(H.push({center:T,radius:E}),X=Y),J=O}return H}function Ie(n,e={}){var a,d;const{streamline:t=.5,size:r=16,last:o=!1}=e;if(n.length===0)return[];const u=.15+(1-t)*.85;let s=n.map(p=>({point:S.fromVectorLike(p),pressure:p.pressure}));if(s.length===2){const p=s[1];s=s.slice(0,-1);for(let l=1;l<5;l++)s.push({point:s[0].point.lerp(p.point,l/4),pressure:p.pressure})}s.length===1&&s.push({point:s[0].point.add(S.UNIT),pressure:s[0].pressure});const c=[{point:s[0].point,pressure:s[0].pressure!=null&&s[0].pressure>=0?s[0].pressure:.25,vector:S.UNIT,distance:0,runningLength:0}];let h=!1,w=0,m=c[0];const i=s.length-1;for(let p=1;p<s.length;p++){const l=s[p],f=o&&p===i?l.point:m.point.lerp(l.point,u);if(m.point.equals(f))continue;const I=f.distanceTo(m.point);if(w+=I,p<i&&!h){if(w<r)continue;h=!0}m={point:f,pressure:l.pressure!=null&&l.pressure>=0?l.pressure:.5,vector:m.point.sub(f).normalize(),distance:I,runningLength:w},c.push(m)}return c[0].vector=(d=(a=c[1])==null?void 0:a.vector)!=null?d:S.ZERO,c}function Pe(n,e,t,r=o=>o){return n*r(.5-e*(.5-t))}function ot(n){if(!n.length)return"";const e=["M",n[0].x,n[0].y,"Q"];for(let t=0;t<n.length;t++){const r=n[t],o=n[(t+1)%n.length],u=r.add(o).scale(.5);e.push(r.x,r.y,u.x,u.y)}return e.push("Z"),e.join(" ")}function Oe(n,e){const t=[n[0]];if(n.length===0)return[];let r=e,o=n[0],u=n[0].center;for(let s=1;s<n.length;s++){const c=n[s],h=n[Math.min(s+1,n.length-1)],w=c.center.add(h.center).scale(.5),m=c.center.distanceTo(o.center),i=u,a=c.center,d=w;let p=0;for(;m-p>=r;){const l=(r+p)/m;t.push({center:i.lerp(a,l).lerp(a.lerp(d,l),l),radius:Me(o.radius,c.radius,l)}),p+=r,r=e}r-=m-p,o=c,u=w}return t.push(n[n.length-1]),t}function st(n){const e=[],t=[];if(n.length===0)return[];if(n.length===1){const i=[];for(let a=0;a<12;a++)i.push(n[0].center.add(S.fromPolar(a*Math.PI/6,n[0].radius)));return i}const r=n[0],u=n[1].center.sub(r.center).normalize(),s=u.perpendicular().scale(r.radius);e.push(r.center.sub(u.scale(r.radius))),e.push(r.center.sub(s)),t.push(r.center.add(s));for(let i=1;i<n.length-1;i++){const a=n[i-1],d=n[i],f=n[i+1].center.sub(a.center).normalize().perpendicular().scale(d.radius);e.push(d.center.sub(f)),t.push(d.center.add(f))}const c=n[n.length-2],h=n[n.length-1],w=h.center.sub(c.center).normalize(),m=w.perpendicular().scale(h.radius);return e.push(h.center.sub(m)),e.push(h.center.add(w.scale(h.radius))),t.push(h.center.add(m)),e.concat(t.reverse())}function W(n){const e=g.exports.useRef();return g.exports.useLayoutEffect(()=>{e.current=n}),g.exports.useCallback((...t)=>{const r=e.current;return v(r,"fn does not exist"),r(...t)},[])}const it=30,at=500,A={size:16,streamline:.5,smoothing:.5,thinning:.5,simulatePressure:!0,easing:n=>n,start:{},end:{},last:!1};function ct(n){const[e,t]=g.exports.useState(()=>({undoStates:[],redoStates:null,pendingOp:null,current:{...n(),options:{}}})),r=W(()=>{console.log("BEGIN");const i=Math.random();return t(a=>(v(a.pendingOp==null,"Pending op already in progress"),{...a,pendingOp:{id:i,initialDoc:a.current.doc,initialOptions:a.current.options},current:{...a.current,options:{}}})),{update:a=>o(i,a),revert:()=>u(i),commit:(a={})=>s(i,a)}}),o=g.exports.useCallback((i,a)=>{t(d=>{var p;return console.log("UPDATE"),v(((p=d.pendingOp)==null?void 0:p.id)===i,"Pending op mismatch"),{...d,current:{...d.current,doc:M(d.current.doc,a)}}})},[]),u=g.exports.useCallback(i=>{console.log("REVERT"),t(a=>{var d;return v(((d=a.pendingOp)==null?void 0:d.id)===i,"Pending op mismatch"),{...a,pendingOp:null,current:{doc:a.pendingOp.initialDoc,location:a.current.location,options:a.pendingOp.initialOptions}}})},[]),s=g.exports.useCallback((i,a)=>{console.log("COMMIT"),t(d=>{var f;v(((f=d.pendingOp)==null?void 0:f.id)===i,"Pending op mismatch");const p=[{doc:d.pendingOp.initialDoc,location:d.current.location,options:d.pendingOp.initialOptions},...d.undoStates];for(;p.length>it;)p.pop();const l={...d.current,options:a};return a.lockstepLocation&&(l.location=M(l.location,a.lockstepLocation)),{...d,current:l,pendingOp:null,undoStates:p,redoStates:null}})},[]),c=W((i,a={})=>{const d=r();d.update(i),d.commit(a)}),h=g.exports.useCallback(()=>{console.log("UNDO"),t(i=>{var l;if(v(i.pendingOp==null,"Pending op in progress"),i.undoStates.length==0)return i;const[a,...d]=i.undoStates;if(!re(a.location,i.current.location)&&!i.current.options.lockstepLocation)return{...i,current:{...i.current,location:a.location}};const p=[i.current,...(l=i.redoStates)!=null?l:[]];return{...i,current:a,undoStates:d,redoStates:p}})},[]),w=g.exports.useCallback(()=>{console.log("REDO"),t(i=>{if(v(i.pendingOp==null,"pendign op in progress"),!i.redoStates||i.redoStates.length==0)return i;const[a,...d]=i.redoStates;if(!re(a.location,i.current.location)&&!a.options.lockstepLocation)return{...i,current:{...i.current,location:a.location}};const p=[i.current,...i.undoStates];return{...i,current:a.options.lockstepLocation?{...a,location:M(i.current.location,a.options.lockstepLocation)}:a,undoStates:p,redoStates:d.length===0?null:d}})},[]),m=g.exports.useCallback(i=>{t(a=>({...a,current:{...a.current,location:M(a.current.location,i)}}))},[]);return g.exports.useMemo(()=>{console.log("UNDO STATE CHANGED",e)},[e]),g.exports.useMemo(()=>({document:e.current.doc,location:e.current.location,beginOperation:r,updateDocument:c,updateLocation:m,undo:h,redo:w}),[r,c,m,w,e,h])}const ut="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".split("");class ae{constructor(e,t=16){this.randomLength=t,this.debugIdCounter=0,this.prefix=e,this.Id=`${e}.SAMPLE`;const r=new RegExp(`^${this.prefix}\\.([a-zA-Z0-9_]+)$`);this.parse=ie(He,o=>r.test(o)?$.ok(o):$.error(new Ge(`Expected ${this.prefix}.*, got ${o}`,[])))}generate(){const e=Re(this.randomLength,()=>Ae(ut)).join("");return`${this.prefix}.${e}`}}const z=new ae("key"),lt=C({id:z.parse,position:S.parse}),ce=new ae("shv"),dt=C({id:ce.parse,keyPointId:z.parse,rawPoints:Je(S.parse)}),Te=new ae("doc"),pt=C({id:Te.parse,keyPoints:ye(z.parse,lt),shapeVersions:ye(ce.parse,dt)});function ht(){return{id:Te.generate(),keyPoints:{},shapeVersions:{}}}class ue{constructor(e,t,r,o,u){this.id=e,this.keyPoints=t,this.shapeVersions=r,this.keyPointIdByShapeVersion=o,this.normalizedShapeVersions=u}with(e){var t,r,o,u,s;return new ue((t=e.id)!=null?t:this.id,(r=e.keyPoints)!=null?r:this.keyPoints,(o=e.shapeVersions)!=null?o:this.shapeVersions,(u=e.keyPointIdByShapeVersion)!=null?u:this.keyPointIdByShapeVersion,(s=e.normalizedCenterPointsByShapeVersion)!=null?s:this.normalizedShapeVersions)}}class k{static fromArray(e){return new k($e(e.map(t=>[t.id,t])))}constructor(e){this.data=e}has(e){return Q(this.data,e)}getIfExists(e){return R(this.data,e)}get(e){const t=this.getIfExists(e);return v(t!=null,`Item with id ${e} not found`),t}insert(e){return new k({...this.data,[e.id]:e})}delete(e){const{[e]:t,...r}=this.data;return new k(r)}*[Symbol.iterator](){for(const e in this.data)Q(this.data,e)&&(yield se(this.data[e]))}}class b{constructor(e={}){this.inverse=e}static build(e,t){const r={};for(const o of t){const u=o.id,s=o[e],c=R(r,s);c?c.push(u):r[s]=[u]}return new b(r)}lookupInverseIfExists(e){var t;return(t=R(this.inverse,e))==null?void 0:t[0]}lookupInverse(e){const t=this.lookupInverseIfExists(e);return v(t!=null,`Item with id ${e} not found`),t}add(e,t){const r=R(this.inverse,t);return r?(v(!r.includes(e),`relation ${t}<->${e} already exists in index`),new b({...this.inverse,[t]:[...r,e]})):new b({...this.inverse,[t]:[e]})}remove(e,t){const r=R(this.inverse,t);if(r){const o=r.indexOf(e);if(o>=0)return r.length>1?new b({...this.inverse,[t]:Ue(r,o)}):new b({...this.inverse,[t]:void 0})}ke(`relation ${t}<->${e} not found in index`)}}function ne(n){var o,u;if(n.length===0)return{versions:new k({})};const e=[];let t=0;for(const s of n){const c=Ie(s.rawPoints),h=(u=(o=c[c.length-1])==null?void 0:o.runningLength)!=null?u:0;e.push({id:s.id,strokePoints:c,length:h}),h>t&&(t=h)}const r=Math.floor(t/A.size);return{versions:k.fromArray(e.map(({strokePoints:s,length:c,id:h})=>({id:h,length:c,normalizedCenterPoints:Oe(Ve(s,A),c/r)})))}}class V{constructor(e,t=0,r=!0){if(this.data=e,this.version=t,!r)return;const o=this.serialize(),u=V.deserialize(o,this.version);re(this,u)||ke(`Mismatch after update:
Actual:
${JSON.stringify(this,null,2)}

Expected:
${JSON.stringify(u,null,2)}`)}static create(){return V.deserialize(ht())}static deserialize(e,t=0){const r=new k(e.shapeVersions);return new V(new ue(e.id,new k(e.keyPoints),r,b.build("keyPointId",r),ne(Array.from(r)).versions),t,!1)}with(...e){return new V(this.data.with(...e),this.version+1)}serialize(){return{id:this.data.id,keyPoints:this.data.keyPoints.data,shapeVersions:this.data.shapeVersions.data}}get keyPoints(){return this.data.keyPoints}get shapeVersions(){return this.data.shapeVersions}getShapeVersionForKeyPoint(e){return this.shapeVersions.get(this.data.keyPointIdByShapeVersion.lookupInverse(e))}addKeyPoint(e){console.log("doc.addKeyPoint",e);const t=ce.generate(),r=this.keyPoints.insert({id:e,position:S.UNIT}),o=this.shapeVersions.insert({id:t,keyPointId:e,rawPoints:[]});return this.with({keyPoints:r,shapeVersions:o,keyPointIdByShapeVersion:this.data.keyPointIdByShapeVersion.add(t,e),normalizedCenterPointsByShapeVersion:ne(Array.from(o)).versions})}replaceShapeVersionPoints(e,t){console.log("doc.replaceShapeVersionPoints",e);const r=this.shapeVersions.insert({...this.shapeVersions.get(e),rawPoints:t});return this.with({shapeVersions:r,normalizedCenterPointsByShapeVersion:ne(Array.from(r)).versions})}}const ft=C({pan:S.parse,zoom:Xe});class gt{constructor({pan:e,zoom:t},r,o){this.screenSize=r,this.update=o,this.pan=e,this.zoom=t}handleWheelEvent(e){console.log("wheel",e),e.preventDefault(),e.stopImmediatePropagation(),console.log(e.ctrlKey);const{deltaX:t,deltaY:r}=e;this.update(({pan:o,zoom:u})=>({pan:o.add(new S(t,r)),zoom:u}))}centerPan(){return this.pan.sub(this.screenSize.scale(.5))}screenToScene(e){return e.add(this.centerPan())}sceneToScreen(e){return e.sub(this.centerPan())}getSceneTransform(){const e=this.centerPan();return`translate(${-e.x}, ${-e.y})`}}const mt=C({keyPointId:z.parse,viewport:ft}),le=class{constructor({keyPointId:n,viewport:e={pan:S.ZERO,zoom:1}}){this.keyPointId=n,this.viewportState=e}serialize(){return{keyPointId:this.keyPointId,viewport:this.viewportState}}with(n){var e,t;return new le({keyPointId:(e=n.keyPointId)!=null?e:this.keyPointId,viewport:(t=n.viewport)!=null?t:this.viewportState})}};let de=le;de.parse=ie(mt,n=>$.ok(new le(n)));const yt=C({doc:ie(pt,n=>$.ok(V.deserialize(n))),location:de.parse});function wt(n){return me(`splatapus.${n}`)?yt(me(`splatapus.${n}`)).mapErr(t=>t.toString()):$.error("No saved data found")}function St(n,{doc:e,location:t}){Be(`splatapus.${n}`,{doc:e.serialize(),location:t.serialize()})}const Pt=je(at,St);function ve(){const n=z.generate();return{doc:V.create().addKeyPoint(n),location:new de({keyPointId:n})}}class vt{constructor(e,t){this.name=e,this.state=t}toDebugString(){const e=Fe(this.debugProperties()).map(([t,r])=>t.startsWith("_")?r:`${t} = ${r}`).join(", ");return`${this.name}(${e})`}}function pe(n){class e extends vt{constructor(r){super(n,r)}}return e}function he(n){const e={};for(const t of n)v(!Q(e,t.toolName),`tool ${t.toolName} already exists`),e[t.toolName]=t;return e}const q=class extends pe("draw"){isIdle(){return this.state.type==="idle"}getSelected(){return this}canvasClassName(){return""}onKeyDown(){return this}onKeyUp(){return this}onPointerDown({event:n,viewport:e}){switch(this.state.type){case"idle":return new q({type:"drawing",points:[e.screenToScene(S.fromEvent(n))]});case"drawing":return this;default:x(this.state)}}onPointerMove({event:n,viewport:e}){const t=this.state;switch(t.type){case"idle":return this;case"drawing":return new q({type:"drawing",points:[...t.points,e.screenToScene(S.fromEvent(n))]});default:x(t)}}onPointerUp({updateDocument:n,location:e}){const t=this.state;switch(t.type){case"idle":return this;case"drawing":return n(r=>r.replaceShapeVersionPoints(r.getShapeVersionForKeyPoint(e.keyPointId).id,t.points)),new q({type:"idle"});default:x(t)}}debugProperties(){switch(this.state.type){case"idle":return{_:"idle"};case"drawing":return{_:"drawing",points:String(this.state.points.length)};default:x(this.state)}}};let j=q;j.toolName="draw";class G extends pe("keypoint"){getSelected(){return this}isIdle(){return this.state.type==="idle"}canvasClassName(){return""}onKeyDown(e){return this}onKeyUp(e){return this}onPointerDown(e){return this}onPointerMove(e){return this}onPointerUp(e){return this}debugProperties(){return{_:this.state.type}}}G.toolName="keypoint";function xt({tool:n,onSelectTool:e}){const t=n.getSelected();return B("div",{className:"pointer-events-none absolute top-0 bottom-0 flex cursor-wait flex-col items-center justify-center gap-3 p-3",children:[P(xe,{letter:"d",isSelected:t.name==="draw",onClick:()=>e(new j({type:"idle"}))}),P(xe,{letter:"k",isSelected:t.name==="keypoint",onClick:()=>e(new G({type:"idle"}))})]})}function xe({letter:n,onClick:e,isSelected:t}){return P("button",{className:F("pointer-events-auto flex h-10 w-10 items-center justify-center rounded-full border border-stone-200 shadow-md",t?"text-stone-500 ring-2 ring-inset ring-purple-400":"text-stone-400"),onClick:e,children:n})}function kt(n){return qe?n.metaKey:n.ctrlKey}function oe(n,e){var r,o,u;const t=typeof e=="string"?{key:e}:e;return n.key.toLowerCase()===t.key.toLowerCase()&&((r=t.command)!=null?r:!1)===kt(n)&&((o=t.shift)!=null?o:!1)===n.shiftKey&&((u=t.alt)!=null?u:!1)===n.altKey}function K(n,e){return oe(n,e)&&n.repeat===!1}const _=class extends pe("quickPan"){getSelected(){return this.state.previousTool}isIdle(){return!0}canvasClassName(){return"cursor-grab"}onKeyDown(){return this}onKeyUp(){return this}onPointerDown({viewport:n,event:e}){const t=this.state;switch(t.type){case"idle":return new _({type:"dragging",previousScreenPoint:S.fromEvent(e),previousTool:t.previousTool});case"dragging":return this;default:x(t)}}onPointerMove({viewport:n,event:e,updateViewport:t}){const r=this.state;switch(r.type){case"idle":return this;case"dragging":{const o=S.fromEvent(e);return t(({pan:u,zoom:s})=>({pan:u.add(r.previousScreenPoint.sub(o).scale(s)),zoom:s})),new _({...r,previousScreenPoint:o})}default:x(r)}}onPointerUp(){const n=this.state;switch(n.type){case"idle":return this;case"dragging":return new _({type:"idle",previousTool:n.previousTool});default:x(n)}}debugProperties(){switch(this.state.type){case"idle":return{_:this.state.type,prev:this.state.previousTool.toDebugString()};case"dragging":return{_:this.state.type,point:this.state.previousScreenPoint.toString(2),prev:this.state.previousTool.toDebugString()};default:x(this.state)}}};let Z=_;Z.toolName="quickPan";function Et(n,e){const t=W(e),[r,o]=g.exports.useState(n);return{events:g.exports.useMemo(()=>({onKeyDown:s=>o(c=>{const h=t(s);if(Vt(c)&&c.isIdle()){if(K(s," "))return new Z({type:"idle",previousTool:c});if(K(s,"d"))return new j({type:"idle"});if(K(s,"k"))return new G({type:"idle"});if(K(s,{key:"z",command:!0}))return h.undo(),c;K(s,{key:"z",command:!0,shift:!0})&&h.redo()}return oe(s,{key:"0",command:!0})?(h.updateViewport({pan:S.ZERO,zoom:1}),c):c.onKeyDown(h)}),onKeyUp:s=>o(c=>c instanceof Z&&oe(s,{key:" "})?c.state.previousTool:c.onKeyUp(t(s))),onPointerDown:s=>o(c=>c.onPointerDown(t(s))),onPointerMove:s=>o(c=>c.onPointerMove(t(s))),onPointerUp:s=>o(c=>c.onPointerUp(t(s))),onSelectTool:s=>o(c=>c.isIdle()?s:c)}),[t]),tool:r}}const De=[j,G],bt=he(De);function Vt(n){return Q(bt,n.name)}const Ce=[Z];he(Ce);he([...De,...Ce]);function It(){const[n,e]=g.exports.useState(null),t=nt(n,rt);return P("div",{ref:e,className:"absolute inset-0 touch-none",children:t&&P(Ot,{size:t})})}function Ot({size:n}){const[e,t]=g.exports.useState(null),{document:r,location:o,updateDocument:u,updateLocation:s,undo:c,redo:h}=ct(()=>{{const l=wt("autosave");if(l.isOk())return l.value;console.error(`Error loading autosave: ${l.error}`)}return ve()});g.exports.useEffect(()=>{Pt("autosave",{doc:r,location:o})},[r,o]);const w=g.exports.useCallback(l=>s(f=>f.with({viewport:M(f.viewportState,l)})),[s]),m=g.exports.useMemo(()=>new gt(o.viewportState,n,w),[o.viewportState,n,w]),{tool:i,events:a}=Et(()=>new j({type:"idle"}),l=>({event:l,viewport:m,document:r,location:o,updateDocument:u,updateLocation:s,updateViewport:w,undo:c,redo:h})),d=W(l=>m.handleWheelEvent(l));g.exports.useEffect(()=>{if(!!e)return window.addEventListener("wheel",d,{passive:!1}),window.addEventListener("keydown",a.onKeyDown),window.addEventListener("keyup",a.onKeyUp),()=>{window.removeEventListener("wheel",d),window.removeEventListener("keydown",a.onKeyDown),window.removeEventListener("keyup",a.onKeyUp)}},[d,e,a]);const p=g.exports.useMemo(()=>{switch(i.name){case"quickPan":case"keypoint":return r.data.normalizedShapeVersions.get(r.getShapeVersionForKeyPoint(o.keyPointId).id).normalizedCenterPoints;case"draw":switch(i.state.type){case"idle":return r.data.normalizedShapeVersions.get(r.getShapeVersionForKeyPoint(o.keyPointId).id).normalizedCenterPoints;case"drawing":return Oe(Ve(Ie(i.state.points,A),A),A.size);default:return x(i.state)}default:x(i)}},[r,o.keyPointId,i]);return B(Ze,{children:[P(xt,{tool:i,onSelectTool:a.onSelectTool}),P("div",{className:"pointer-events-none absolute top-0",children:i.toDebugString()}),P("svg",{ref:t,viewBox:`0 0 ${n.x} ${n.y}`,onPointerDown:a.onPointerDown,onPointerMove:a.onPointerMove,onPointerUp:a.onPointerUp,className:i.canvasClassName(),children:P("g",{transform:m.getSceneTransform(),children:P("path",{d:ot(st(p))})})}),B("div",{className:"absolute bottom-0 left-0 flex w-full items-center justify-center gap-3 p-3",children:[B("div",{className:"flex min-w-0 flex-auto items-center justify-center gap-3",children:[Array.from(r.keyPoints,(l,f)=>P("button",{className:F("flex h-10 w-10 items-center justify-center rounded-full border border-stone-200 text-stone-400 shadow-md transition-transform hover:-translate-y-1",l.id===o.keyPointId?"text-stone-500 ring-2 ring-inset ring-purple-400":"text-stone-400"),onClick:()=>{s(I=>I.with({keyPointId:l.id}))},children:f+1},l.id)),P("button",{className:F("flex h-10 w-10 items-center justify-center rounded-full border border-stone-200 text-stone-400 shadow-md transition-transform hover:-translate-y-1"),onClick:()=>{const l=z.generate();u(f=>f.addKeyPoint(l),{lockstepLocation:f=>f.with({keyPointId:l})})},children:"+"})]}),P("button",{className:F("flex h-10 flex-none items-center justify-center justify-self-end rounded-full border border-stone-200 px-3 text-stone-400 shadow-md transition-transform hover:-translate-y-1"),onClick:()=>{const{doc:l,location:f}=ve();u(l,{lockstepLocation:f})},children:"reset"})]})]})}const Tt=se(document.getElementById("root"));Ee(Tt).render(P(Qe.StrictMode,{children:P(It,{})}));
