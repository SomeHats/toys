import{a as v,b as se,K,t as Me,s as Re,L as Ae,h as Q,g as M,M as $e,f as ke,l as Ue,C as je,B as me,E as Be,e as Fe,d as x,N as qe}from"../chunks/chunk_assert.a61dfbc1.js";/* empty css                               */import{a as _e,r as f,R as Qe}from"../chunks/chunk_index.0b2a17fa.js";import{R as We,a as B,j as w,c as F,F as Ze}from"../chunks/chunk_ResizeObserver.f9437ff6.js";import{V as S,b as ie,R as A,P as Ge,d as He,c as I,a as Je,e as ye,p as Xe}from"../chunks/chunk_Vector2.60ea25ce.js";import"../chunks/chunk__commonjsHelpers.fbcca4d8.js";var re=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,o,l;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(o=r;o--!==0;)if(!n(e[o],t[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(l=Object.keys(e),r=l.length,r!==Object.keys(t).length)return!1;for(o=r;o--!==0;)if(!Object.prototype.hasOwnProperty.call(t,l[o]))return!1;for(o=r;o--!==0;){var s=l[o];if(!n(e[s],t[s]))return!1}return!0}return e!==e&&t!==t},Ee,we=_e.exports;Ee=we.createRoot,we.hydrateRoot;let te;const $=new Map;function Ye(n){for(const e of n)for(const t of se($.get(e.target),"callback does not exist for tracked entry"))t(e)}function be(){return te||(te=new We(Ye)),te}function et(n,e){let t=$.get(n);t||(t=new Set,$.set(n,t),be().observe(n)),t.add(e)}function tt(n,e){const t=$.get(n);v(t,"element is not tracked");const r=t.delete(e);v(r,"callback did not exist for element"),t.size===0&&($.delete(n),be().unobserve(n))}function nt(n,e){const[t,r]=f.exports.useState(null);return f.exports.useEffect(()=>{if(!n)return;const o=l=>{r(e(l))};return et(n,o),()=>{tt(n,o)}},[n,e]),t}function rt(n){return new S(n.contentRect.width,n.contentRect.height)}function W(n){const e=f.exports.useRef();return f.exports.useLayoutEffect(()=>{e.current=n}),f.exports.useCallback((...t)=>{const r=e.current;return v(r,"fn does not exist"),r(...t)},[])}const ot=30,st=500,R={size:16,streamline:.5,smoothing:.5,thinning:.5,simulatePressure:!0,easing:n=>n,start:{},end:{},last:!1};function it(n){const[e,t]=f.exports.useState(()=>({undoStates:[],redoStates:null,pendingOp:null,current:{...n(),options:{}}})),r=W(()=>{console.log("BEGIN");const a=Math.random();return t(i=>(v(i.pendingOp==null,"Pending op already in progress"),{...i,pendingOp:{id:a,initialDoc:i.current.doc,initialOptions:i.current.options},current:{...i.current,options:{}}})),{update:i=>o(a,i),revert:()=>l(a),commit:(i={})=>s(a,i)}}),o=f.exports.useCallback((a,i)=>{t(d=>{var u;return console.log("UPDATE"),v(((u=d.pendingOp)==null?void 0:u.id)===a,"Pending op mismatch"),{...d,current:{...d.current,doc:K(d.current.doc,i)}}})},[]),l=f.exports.useCallback(a=>{console.log("REVERT"),t(i=>{var d;return v(((d=i.pendingOp)==null?void 0:d.id)===a,"Pending op mismatch"),{...i,pendingOp:null,current:{doc:i.pendingOp.initialDoc,location:i.current.location,options:i.pendingOp.initialOptions}}})},[]),s=f.exports.useCallback((a,i)=>{console.log("COMMIT"),t(d=>{var P;v(((P=d.pendingOp)==null?void 0:P.id)===a,"Pending op mismatch");const u=[{doc:d.pendingOp.initialDoc,location:d.current.location,options:d.pendingOp.initialOptions},...d.undoStates];for(;u.length>ot;)u.pop();const p={...d.current,options:i};return i.lockstepLocation&&(p.location=K(p.location,i.lockstepLocation)),{...d,current:p,pendingOp:null,undoStates:u,redoStates:null}})},[]),c=W((a,i={})=>{const d=r();d.update(a),d.commit(i)}),h=f.exports.useCallback(()=>{console.log("UNDO"),t(a=>{var p;if(v(a.pendingOp==null,"Pending op in progress"),a.undoStates.length==0)return a;const[i,...d]=a.undoStates;if(!re(i.location,a.current.location)&&!a.current.options.lockstepLocation)return{...a,current:{...a.current,location:i.location}};const u=[a.current,...(p=a.redoStates)!=null?p:[]];return{...a,current:i,undoStates:d,redoStates:u}})},[]),y=f.exports.useCallback(()=>{console.log("REDO"),t(a=>{if(v(a.pendingOp==null,"pendign op in progress"),!a.redoStates||a.redoStates.length==0)return a;const[i,...d]=a.redoStates;if(!re(i.location,a.current.location)&&!i.options.lockstepLocation)return{...a,current:{...a.current,location:i.location}};const u=[a.current,...a.undoStates];return{...a,current:i.options.lockstepLocation?{...i,location:K(a.current.location,i.options.lockstepLocation)}:i,undoStates:u,redoStates:d.length===0?null:d}})},[]),g=f.exports.useCallback(a=>{t(i=>({...i,current:{...i.current,location:K(i.current.location,a)}}))},[]);return f.exports.useMemo(()=>{console.log("UNDO STATE CHANGED",e)},[e]),f.exports.useMemo(()=>({document:e.current.doc,location:e.current.location,beginOperation:r,updateDocument:c,updateLocation:g,undo:h,redo:y}),[r,c,g,y,e,h])}const at="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".split("");class ae{constructor(e,t=16){this.randomLength=t,this.debugIdCounter=0,this.prefix=e,this.Id=`${e}.SAMPLE`;const r=new RegExp(`^${this.prefix}\\.([a-zA-Z0-9_]+)$`);this.parse=ie(He,o=>r.test(o)?A.ok(o):A.error(new Ge(`Expected ${this.prefix}.*, got ${o}`,[])))}generate(){const e=Me(this.randomLength,()=>Re(at)).join("");return`${this.prefix}.${e}`}}const C=new ae("key"),ct=I({id:C.parse,position:S.parse}),ce=new ae("shv"),ut=I({id:ce.parse,keyPointId:C.parse,rawPoints:Je(S.parse)}),Ve=new ae("doc"),lt=I({id:Ve.parse,keyPoints:ye(C.parse,ct),shapeVersions:ye(ce.parse,ut)});function dt(){return{id:Ve.generate(),keyPoints:{},shapeVersions:{}}}class ue{constructor(e,t,r,o,l){this.id=e,this.keyPoints=t,this.shapeVersions=r,this.keyPointIdByShapeVersion=o,this.normalizedShapeVersions=l}with(e){var t,r,o,l,s;return new ue((t=e.id)!=null?t:this.id,(r=e.keyPoints)!=null?r:this.keyPoints,(o=e.shapeVersions)!=null?o:this.shapeVersions,(l=e.keyPointIdByShapeVersion)!=null?l:this.keyPointIdByShapeVersion,(s=e.normalizedCenterPointsByShapeVersion)!=null?s:this.normalizedShapeVersions)}}class k{static fromArray(e){return new k(Ae(e.map(t=>[t.id,t])))}constructor(e){this.data=e}has(e){return Q(this.data,e)}getIfExists(e){return M(this.data,e)}get(e){const t=this.getIfExists(e);return v(t!=null,`Item with id ${e} not found`),t}insert(e){return new k({...this.data,[e.id]:e})}delete(e){const{[e]:t,...r}=this.data;return new k(r)}*[Symbol.iterator](){for(const e in this.data)Q(this.data,e)&&(yield se(this.data[e]))}}class b{constructor(e={}){this.inverse=e}static build(e,t){const r={};for(const o of t){const l=o.id,s=o[e],c=M(r,s);c?c.push(l):r[s]=[l]}return new b(r)}lookupInverseIfExists(e){var t;return(t=M(this.inverse,e))==null?void 0:t[0]}lookupInverse(e){const t=this.lookupInverseIfExists(e);return v(t!=null,`Item with id ${e} not found`),t}add(e,t){const r=M(this.inverse,t);return r?(v(!r.includes(e),`relation ${t}<->${e} already exists in index`),new b({...this.inverse,[t]:[...r,e]})):new b({...this.inverse,[t]:[e]})}remove(e,t){const r=M(this.inverse,t);if(r){const o=r.indexOf(e);if(o>=0)return r.length>1?new b({...this.inverse,[t]:$e(r,o)}):new b({...this.inverse,[t]:void 0})}ke(`relation ${t}<->${e} not found in index`)}}const{min:D,PI:At}=Math,Se=.275;function Oe(n,e={}){const{size:t=16,smoothing:r=.5,thinning:o=.5,simulatePressure:l=!0,easing:s=m=>m,start:c={},end:h={},last:y=!1}=e,{cap:g=!0,easing:a=m=>m*(2-m)}=c,{cap:i=!0,easing:d=m=>--m*m*m+1}=h;if(n.length===0||t<=0)return[];const u=n[n.length-1].runningLength,p=c.taper===!1?0:c.taper===!0?Math.max(t,u):c.taper,P=h.taper===!1?0:h.taper===!0?Math.max(t,u):h.taper,j=Math.pow(t*r,2),H=[];let J=n.slice(0,10).reduce((m,O)=>{let T=O.pressure;if(l){const z=D(1,O.distance/t),ee=D(1,1-z);T=D(1,m+(ee-m)*(z*Se))}return(m+T)/2},n[0].pressure),E=Pe(t,o,n[n.length-1].pressure,s);n[0].vector;let X=n[0].point,Y=X;for(let m=0;m<n.length;m++){let{pressure:O}=n[m];const{point:T,vector:z,distance:ee,runningLength:N}=n[m];if(m<n.length-1&&u-N<3)continue;if(o){if(l){const ge=D(1,ee/t),Ke=D(1,1-ge);O=D(1,J+(Ke-J)*(ge*Se))}E=Pe(t,o,O,s)}else E=t/2;const ze=N<p?a(N/p):1,Ne=u-N<P?d((u-N)/P):1;if(E=Math.max(.01,E*Math.min(ze,Ne)),m===n.length-1){H.push({center:T,radius:E});continue}const fe=n[m+1].vector,Le=z.dot(fe);fe.lerp(z,Le).perpendicular().scale(E),Y=T,(m<=1||X.distanceToSq(Y)>j)&&(H.push({center:T,radius:E}),X=Y),J=O}return H}function Te(n,e={}){var i,d;const{streamline:t=.5,size:r=16,last:o=!1}=e;if(n.length===0)return[];const l=.15+(1-t)*.85;let s=n.map(u=>({point:S.fromVectorLike(u),pressure:u.pressure}));if(s.length===2){const u=s[1];s=s.slice(0,-1);for(let p=1;p<5;p++)s.push({point:s[0].point.lerp(u.point,p/4),pressure:u.pressure})}s.length===1&&s.push({point:s[0].point.add(S.UNIT),pressure:s[0].pressure});const c=[{point:s[0].point,pressure:s[0].pressure!=null&&s[0].pressure>=0?s[0].pressure:.25,vector:S.UNIT,distance:0,runningLength:0}];let h=!1,y=0,g=c[0];const a=s.length-1;for(let u=1;u<s.length;u++){const p=s[u],P=o&&u===a?p.point:g.point.lerp(p.point,l);if(g.point.equals(P))continue;const j=P.distanceTo(g.point);if(y+=j,u<a&&!h){if(y<r)continue;h=!0}g={point:P,pressure:p.pressure!=null&&p.pressure>=0?p.pressure:.5,vector:g.point.sub(P).normalize(),distance:j,runningLength:y},c.push(g)}return c[0].vector=(d=(i=c[1])==null?void 0:i.vector)!=null?d:S.ZERO,c}function Pe(n,e,t,r=o=>o){return n*r(.5-e*(.5-t))}function pt(n){if(!n.length)return"";const e=["M",n[0].x,n[0].y,"Q"];for(let t=0;t<n.length;t++){const r=n[t],o=n[(t+1)%n.length],l=r.add(o).scale(.5);e.push(r.x,r.y,l.x,l.y)}return e.push("Z"),e.join(" ")}function De(n,e){const t=[n[0]];if(n.length===0)return[];let r=e,o=n[0],l=n[0].center;for(let s=1;s<n.length;s++){const c=n[s],h=n[Math.min(s+1,n.length-1)],y=c.center.add(h.center).scale(.5),g=c.center.distanceTo(o.center),a=l,i=c.center,d=y;let u=0;for(;g-u>=r;){const p=(r+u)/g;t.push({center:a.lerp(i,p).lerp(i.lerp(d,p),p),radius:Ue(o.radius,c.radius,p)}),u+=r,r=e}r-=g-u,o=c,l=y}return t.push(n[n.length-1]),t}function ne(n){var o,l;if(n.length===0)return{versions:new k({})};const e=[];let t=0;for(const s of n){const c=Te(s.rawPoints),h=(l=(o=c[c.length-1])==null?void 0:o.runningLength)!=null?l:0;e.push({id:s.id,strokePoints:c,length:h}),h>t&&(t=h)}const r=Math.floor(t/R.size);return{versions:k.fromArray(e.map(({strokePoints:s,length:c,id:h})=>({id:h,length:c,normalizedCenterPoints:De(Oe(s,R),c/r)})))}}class V{constructor(e,t=0,r=!0){if(this.data=e,this.version=t,!r)return;const o=this.serialize(),l=V.deserialize(o,this.version);re(this,l)||ke(`Mismatch after update:
Actual:
${JSON.stringify(this,null,2)}

Expected:
${JSON.stringify(l,null,2)}`)}static create(){return V.deserialize(dt())}static deserialize(e,t=0){const r=new k(e.shapeVersions);return new V(new ue(e.id,new k(e.keyPoints),r,b.build("keyPointId",r),ne(Array.from(r)).versions),t,!1)}with(...e){return new V(this.data.with(...e),this.version+1)}serialize(){return{id:this.data.id,keyPoints:this.data.keyPoints.data,shapeVersions:this.data.shapeVersions.data}}get keyPoints(){return this.data.keyPoints}get shapeVersions(){return this.data.shapeVersions}getShapeVersionForKeyPoint(e){return this.shapeVersions.get(this.data.keyPointIdByShapeVersion.lookupInverse(e))}addKeyPoint(e){console.log("doc.addKeyPoint",e);const t=ce.generate(),r=this.keyPoints.insert({id:e,position:S.UNIT}),o=this.shapeVersions.insert({id:t,keyPointId:e,rawPoints:[]});return this.with({keyPoints:r,shapeVersions:o,keyPointIdByShapeVersion:this.data.keyPointIdByShapeVersion.add(t,e),normalizedCenterPointsByShapeVersion:ne(Array.from(o)).versions})}replaceShapeVersionPoints(e,t){console.log("doc.replaceShapeVersionPoints",e);const r=this.shapeVersions.insert({...this.shapeVersions.get(e),rawPoints:t});return this.with({shapeVersions:r,normalizedCenterPointsByShapeVersion:ne(Array.from(r)).versions})}}const ht=I({pan:S.parse,zoom:Xe});class ft{constructor({pan:e,zoom:t},r,o){this.screenSize=r,this.update=o,this.pan=e,this.zoom=t}handleWheelEvent(e){console.log("wheel",e),e.preventDefault(),e.stopImmediatePropagation(),console.log(e.ctrlKey);const{deltaX:t,deltaY:r}=e;this.update(({pan:o,zoom:l})=>({pan:o.add(new S(t,r)),zoom:l}))}centerPan(){return this.pan.sub(this.screenSize.scale(.5))}screenToScene(e){return e.add(this.centerPan())}sceneToScreen(e){return e.sub(this.centerPan())}getSceneTransform(){const e=this.centerPan();return`translate(${-e.x}, ${-e.y})`}}const gt=I({keyPointId:C.parse,viewport:ht}),le=class{constructor({keyPointId:n,viewport:e={pan:S.ZERO,zoom:1}}){this.keyPointId=n,this.viewportState=e}serialize(){return{keyPointId:this.keyPointId,viewport:this.viewportState}}with(n){var e,t;return new le({keyPointId:(e=n.keyPointId)!=null?e:this.keyPointId,viewport:(t=n.viewport)!=null?t:this.viewportState})}};let de=le;de.parse=ie(gt,n=>A.ok(new le(n)));const mt=I({doc:ie(lt,n=>A.ok(V.deserialize(n))),location:de.parse});function yt(n){return me(`splatapus.${n}`)?mt(me(`splatapus.${n}`)).mapErr(t=>t.toString()):A.error("No saved data found")}function wt(n,{doc:e,location:t}){Be(`splatapus.${n}`,{doc:e.serialize(),location:t.serialize()})}const St=je(st,wt);function ve(){const n=C.generate();return{doc:V.create().addKeyPoint(n),location:new de({keyPointId:n})}}class Pt{constructor(e,t){this.name=e,this.state=t}getPointsForShapeVersion(e,t){return e.data.normalizedShapeVersions.get(t.id).normalizedCenterPoints}toDebugString(){const e=Fe(this.debugProperties()).map(([t,r])=>t.startsWith("_")?r:`${t} = ${r}`).join(", ");return`${this.name}(${e})`}}function pe(n){class e extends Pt{constructor(r){super(n,r)}}return e}function he(n){const e={};for(const t of n)v(!Q(e,t.toolName),`tool ${t.toolName} already exists`),e[t.toolName]=t;return e}const q=class extends pe("draw"){isIdle(){return this.state.type==="idle"}getSelected(){return this}canvasClassName(){return""}onKeyDown(){return this}onKeyUp(){return this}onPointerDown({event:n,viewport:e}){switch(this.state.type){case"idle":return new q({type:"drawing",points:[e.screenToScene(S.fromEvent(n))]});case"drawing":return this;default:x(this.state)}}onPointerMove({event:n,viewport:e}){const t=this.state;switch(t.type){case"idle":return this;case"drawing":return new q({type:"drawing",points:[...t.points,e.screenToScene(S.fromEvent(n))]});default:x(t)}}onPointerUp({updateDocument:n,location:e}){const t=this.state;switch(t.type){case"idle":return this;case"drawing":return n(r=>r.replaceShapeVersionPoints(r.getShapeVersionForKeyPoint(e.keyPointId).id,t.points)),new q({type:"idle"});default:x(t)}}getPointsForShapeVersion(n,e){switch(this.state.type){case"idle":return super.getPointsForShapeVersion(n,e);case"drawing":return De(Oe(Te(this.state.points,R),R),R.size);default:x(this.state)}}debugProperties(){switch(this.state.type){case"idle":return{_:"idle"};case"drawing":return{_:"drawing",points:String(this.state.points.length)};default:x(this.state)}}};let U=q;U.toolName="draw";class G extends pe("keypoint"){getSelected(){return this}isIdle(){return this.state.type==="idle"}canvasClassName(){return""}onKeyDown(e){return this}onKeyUp(e){return this}onPointerDown(e){return this}onPointerMove(e){return this}onPointerUp(e){return this}debugProperties(){return{_:this.state.type}}}G.toolName="keypoint";function vt({tool:n,onSelectTool:e}){const t=n.getSelected();return B("div",{className:"pointer-events-none absolute top-0 bottom-0 flex cursor-wait flex-col items-center justify-center gap-3 p-3",children:[w(xe,{letter:"d",isSelected:t.name==="draw",onClick:()=>e(new U({type:"idle"}))}),w(xe,{letter:"k",isSelected:t.name==="keypoint",onClick:()=>e(new G({type:"idle"}))})]})}function xe({letter:n,onClick:e,isSelected:t}){return w("button",{className:F("pointer-events-auto flex h-10 w-10 items-center justify-center rounded-full border border-stone-200 shadow-md",t?"text-stone-500 ring-2 ring-inset ring-purple-400":"text-stone-400"),onClick:e,children:n})}function xt(n){return qe?n.metaKey:n.ctrlKey}function oe(n,e){var r,o,l;const t=typeof e=="string"?{key:e}:e;return n.key.toLowerCase()===t.key.toLowerCase()&&((r=t.command)!=null?r:!1)===xt(n)&&((o=t.shift)!=null?o:!1)===n.shiftKey&&((l=t.alt)!=null?l:!1)===n.altKey}function L(n,e){return oe(n,e)&&n.repeat===!1}const _=class extends pe("quickPan"){getSelected(){return this.state.previousTool}isIdle(){return!0}canvasClassName(){return"cursor-grab"}onKeyDown(){return this}onKeyUp(){return this}onPointerDown({viewport:n,event:e}){const t=this.state;switch(t.type){case"idle":return new _({type:"dragging",previousScreenPoint:S.fromEvent(e),previousTool:t.previousTool});case"dragging":return this;default:x(t)}}onPointerMove({viewport:n,event:e,updateViewport:t}){const r=this.state;switch(r.type){case"idle":return this;case"dragging":{const o=S.fromEvent(e);return t(({pan:l,zoom:s})=>({pan:l.add(r.previousScreenPoint.sub(o).scale(s)),zoom:s})),new _({...r,previousScreenPoint:o})}default:x(r)}}onPointerUp(){const n=this.state;switch(n.type){case"idle":return this;case"dragging":return new _({type:"idle",previousTool:n.previousTool});default:x(n)}}debugProperties(){switch(this.state.type){case"idle":return{_:this.state.type,prev:this.state.previousTool.toDebugString()};case"dragging":return{_:this.state.type,point:this.state.previousScreenPoint.toString(2),prev:this.state.previousTool.toDebugString()};default:x(this.state)}}};let Z=_;Z.toolName="quickPan";function kt(n,e){const t=W(e),[r,o]=f.exports.useState(n);return{events:f.exports.useMemo(()=>({onKeyDown:s=>o(c=>{const h=t(s);if(bt(c)&&c.isIdle()){if(L(s," "))return new Z({type:"idle",previousTool:c});if(L(s,"d"))return new U({type:"idle"});if(L(s,"k"))return new G({type:"idle"});if(L(s,{key:"z",command:!0}))return h.undo(),c;L(s,{key:"z",command:!0,shift:!0})&&h.redo()}return oe(s,{key:"0",command:!0})?(h.updateViewport({pan:S.ZERO,zoom:1}),c):c.onKeyDown(h)}),onKeyUp:s=>o(c=>c instanceof Z&&oe(s,{key:" "})?c.state.previousTool:c.onKeyUp(t(s))),onPointerDown:s=>o(c=>c.onPointerDown(t(s))),onPointerMove:s=>o(c=>c.onPointerMove(t(s))),onPointerUp:s=>o(c=>c.onPointerUp(t(s))),onSelectTool:s=>o(c=>c.isIdle()?s:c)}),[t]),tool:r}}const Ie=[U,G],Et=he(Ie);function bt(n){return Q(Et,n.name)}const Ce=[Z];he(Ce);he([...Ie,...Ce]);function Vt(n){const e=[],t=[];if(n.length===0)return[];if(n.length===1){const a=[];for(let i=0;i<12;i++)a.push(n[0].center.add(S.fromPolar(i*Math.PI/6,n[0].radius)));return a}const r=n[0],l=n[1].center.sub(r.center).normalize(),s=l.perpendicular().scale(r.radius);e.push(r.center.sub(l.scale(r.radius))),e.push(r.center.sub(s)),t.push(r.center.add(s));for(let a=1;a<n.length-1;a++){const i=n[a-1],d=n[a],P=n[a+1].center.sub(i.center).normalize().perpendicular().scale(d.radius);e.push(d.center.sub(P)),t.push(d.center.add(P))}const c=n[n.length-2],h=n[n.length-1],y=h.center.sub(c.center).normalize(),g=y.perpendicular().scale(h.radius);return e.push(h.center.sub(g)),e.push(h.center.add(y.scale(h.radius))),t.push(h.center.add(g)),e.concat(t.reverse())}function Ot({centerPoints:n}){return w("path",{d:pt(Vt(n))})}function Tt({document:n,keyPointId:e,tool:t}){const r=n.getShapeVersionForKeyPoint(e);return w(Ot,{centerPoints:t.getPointsForShapeVersion(n,r)})}function Dt(){const[n,e]=f.exports.useState(null),t=nt(n,rt);return w("div",{ref:e,className:"absolute inset-0 touch-none",children:t&&w(It,{size:t})})}function It({size:n}){const[e,t]=f.exports.useState(null),{document:r,location:o,updateDocument:l,updateLocation:s,undo:c,redo:h}=it(()=>{{const u=yt("autosave");if(u.isOk())return u.value;console.error(`Error loading autosave: ${u.error}`)}return ve()});f.exports.useEffect(()=>{St("autosave",{doc:r,location:o})},[r,o]);const y=f.exports.useCallback(u=>s(p=>p.with({viewport:K(p.viewportState,u)})),[s]),g=f.exports.useMemo(()=>new ft(o.viewportState,n,y),[o.viewportState,n,y]),{tool:a,events:i}=kt(()=>new U({type:"idle"}),u=>({event:u,viewport:g,document:r,location:o,updateDocument:l,updateLocation:s,updateViewport:y,undo:c,redo:h})),d=W(u=>g.handleWheelEvent(u));return f.exports.useEffect(()=>{if(!!e)return window.addEventListener("wheel",d,{passive:!1}),window.addEventListener("keydown",i.onKeyDown),window.addEventListener("keyup",i.onKeyUp),()=>{window.removeEventListener("wheel",d),window.removeEventListener("keydown",i.onKeyDown),window.removeEventListener("keyup",i.onKeyUp)}},[d,e,i]),B(Ze,{children:[w(vt,{tool:a,onSelectTool:i.onSelectTool}),w("div",{className:"pointer-events-none absolute top-0",children:a.toDebugString()}),w("svg",{ref:t,viewBox:`0 0 ${n.x} ${n.y}`,onPointerDown:i.onPointerDown,onPointerMove:i.onPointerMove,onPointerUp:i.onPointerUp,className:a.canvasClassName(),children:w("g",{transform:g.getSceneTransform(),children:w(Tt,{document:r,keyPointId:o.keyPointId,tool:a})})}),B("div",{className:"absolute bottom-0 left-0 flex w-full items-center justify-center gap-3 p-3",children:[B("div",{className:"flex min-w-0 flex-auto items-center justify-center gap-3",children:[Array.from(r.keyPoints,(u,p)=>w("button",{className:F("flex h-10 w-10 items-center justify-center rounded-full border border-stone-200 text-stone-400 shadow-md transition-transform hover:-translate-y-1",u.id===o.keyPointId?"text-stone-500 ring-2 ring-inset ring-purple-400":"text-stone-400"),onClick:()=>{s(P=>P.with({keyPointId:u.id}))},children:p+1},u.id)),w("button",{className:F("flex h-10 w-10 items-center justify-center rounded-full border border-stone-200 text-stone-400 shadow-md transition-transform hover:-translate-y-1"),onClick:()=>{const u=C.generate();l(p=>p.addKeyPoint(u),{lockstepLocation:p=>p.with({keyPointId:u})})},children:"+"})]}),w("button",{className:F("flex h-10 flex-none items-center justify-center justify-self-end rounded-full border border-stone-200 px-3 text-stone-400 shadow-md transition-transform hover:-translate-y-1"),onClick:()=>{const{doc:u,location:p}=ve();l(u,{lockstepLocation:p})},children:"reset"})]})]})}const Ct=se(document.getElementById("root"));Ee(Ct).render(w(Qe.StrictMode,{children:w(Dt,{})}));
