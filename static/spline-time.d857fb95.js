import{S as U,d as O,T as _,b as V}from"./chunk_assert.10ad1a9b.js";/* empty css                       */import{r as v,a as X,R as $}from"./chunk_index.9ef61b8f.js";import{a as G,u as F,b as K,c as Y}from"./chunk_client.ed9e553f.js";import{A as R}from"./chunk_AABB.61e1191b.js";import{S as Z,V as N,R as Q}from"./chunk_Vector2.79af760a.js";import{B as J,u as tt,S as E}from"./chunk_svgPathBuilder.22142bef.js";import{u as ot,A as et}from"./chunk_useKeyPress.278f9416.js";import{a as nt}from"./chunk_useStoredState.0378cdd3.js";import{c as st}from"./chunk_index.9d627959.js";import{a as x,j as n,F as I}from"./chunk_jsx-runtime.faf32752.js";import"./chunk__commonjsHelpers.e5e952e9.js";import"./chunk_theme.5443e31e.js";import"./chunk_EventEmitter.18fc68ab.js";import"./chunk_storage.52c5eca5.js";const j=class{constructor(t){this.points=t}insertPointAtIndex(t,i){return new j(U(this.points,t,i))}updatePointAtIndex(t,i){return new j(O(this.points,t,i))}getClosestPointTo(t){if(this.points.length===0)return null;let i=0,e=this.points[0].distanceTo(t);for(let o=1;o<this.points.length;o++){const a=this.points[o].distanceTo(t);a<e&&(i=o,e=a)}return{index:i,point:this.points[i],distance:e}}getClosestPointIndexWithinRadius(t,i){const e=this.getClosestPointTo(t);return e&&e.distance<=i?e.index:null}};let D=j;D.schema=Z.arrayOf(N.schema).transform(t=>Q.ok(new j(t)),t=>t.points);const it=10,H=8,rt=[[-150,75],[0,-50],[0,50],[150,-75]].map(([t,i])=>new N(t,i));function at(){const[t,i]=v.exports.useState(null),e=G(t,K),[o,p]=nt("splineTime.line",D.schema,()=>new D(rt));return x("div",{className:"absolute inset-0 flex flex-col bg-stone-100",children:[x("div",{className:"flex flex-none items-center justify-between gap-3 bg-stone-100 px-4 py-3",children:[n("h1",{className:"flex-none font-bold tracking-wide text-stone-600",children:"spline time"}),n("div",{className:"text-stone-500",children:"click/drag to create/move points. hold shift to hide annotations."}),n(J,{onClick:()=>p(new D([])),children:"reset"})]}),n("div",{className:"relative flex-auto",ref:i,children:e&&n(ct,{size:e,line:o,setLine:p})})]})}function ct({size:t,line:i,setLine:e}){const p=(t.x-48)/2,a=(t.y-16*2)/2,l=!ot({key:"Shift",shift:et}),s=F(m=>{const g=m.currentTarget.getBoundingClientRect();return new N(m.clientX-g.left-p/2,m.clientY-g.top-a/2)}),r=F(m=>i.getClosestPointIndexWithinRadius(s(m),it)),[c,d]=v.exports.useState(null),{events:f,isGestureInProgress:h}=tt({onDragStart:m=>{m.preventDefault();const g=s(m),{pointIndex:A,offset:S}=(()=>{const y=r(m);if(y!==null)return{pointIndex:y,offset:i.points[y].sub(g)};const k=i.points.length;return e(w=>w.insertPointAtIndex(k,g)),{pointIndex:k,offset:N.ZERO}})();return d(A),{couldBeTap:!1,pointerCapture:!0,onMove:y=>{const k=s(y);e(w=>w.updatePointAtIndex(A,k.add(S)))},onEnd:y=>{const k=s(y);e(w=>w.updatePointAtIndex(A,k.add(S))),d(null)},onCancel:()=>{d(null)}}}}),[u,T]=v.exports.useState(null),P={line:i,hoveredPointIdx:h?null:u,activePointIdx:c,showExtras:l,onPointerDown:f.onPointerDown,onPointerMove:m=>{h||T(r(m)),f.onPointerMove(m)},onPointerUp:f.onPointerUp,onPointerCancel:f.onPointerCancel};return x(I,{children:[n(W,{...P,annotations:[B,q],location:R.fromLeftTopWidthHeight(16,0,p,a)}),n(W,{...P,annotations:[l&&B,pt,q],location:R.fromLeftTopWidthHeight(p+16*2,0,p,a)}),n(W,{...P,annotations:[l&&B,ut],location:R.fromLeftTopWidthHeight(16,a+16,p,a)}),n(W,{...P,annotations:[l&&B,lt],location:R.fromLeftTopWidthHeight(p+16*2,a+16,p,a)})]})}function W({location:t,line:i,hoveredPointIdx:e,activePointIdx:o,annotations:p=[],showExtras:a,onPointerDown:l,onPointerMove:s,onPointerUp:r,onPointerCancel:c}){const[d,f]=v.exports.useState(null);return x("div",{className:"absolute overflow-hidden rounded-lg bg-white",style:{left:t.left,top:t.top,width:t.width,height:t.height},children:[n("div",{className:"absolute inset-0 ",onPointerDown:h=>{console.log("a",h.currentTarget),l(h)},onPointerMove:s,onPointerUp:r,onPointerCancel:c,children:n("svg",{className:"absolute inset-0 h-full w-full",children:x("g",{transform:`translate(${t.width/2}, ${t.height/2})`,children:[p.map((h,u)=>h&&d&&n(v.exports.Fragment,{children:h({line:i,showExtras:a,uiTarget:d})},u)),a&&i.points.map((h,u)=>n("circle",{cx:h.x,cy:h.y,r:6,strokeWidth:2,className:st("stroke-blue-600",u===o?"fill-blue-600":u===e?"fill-blue-300":"fill-white")},u))]})})}),n("div",{className:"pointer-events-auto absolute z-10 w-full",ref:f})]})}function B({line:t}){const i=_(t.points,2).map(([e,o],p)=>{const a=e.distanceTo(o);let s=Math.ceil(a/5);s%2===1&&(s+=1);const r=a/s;return n("line",{x1:e.x,y1:e.y,x2:o.x,y2:o.y,className:"stroke-purple-300",fill:"none",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:`0 ${r}`},p)});return n(I,{children:i})}function pt({line:t,uiTarget:i}){const e=new E;switch(t.points.length){case 0:case 1:return null;case 2:{e.moveTo(t.points[0]),e.lineTo(t.points[1]);break}default:e.moveTo(t.points[0]),e.lineTo(t.points[0].lerp(t.points[1],.5));for(let o=1;o<t.points.length-1;o++)e.quadraticCurveTo(t.points[o],t.points[o].lerp(t.points[o+1],.5));e.lineTo(t.points[t.points.length-1])}return x(I,{children:[n("path",{d:e.toString(),className:"stroke-fuchsia-500",fill:"none",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}),n(z,{uiTarget:i,label:"midpoint quadratic"})]})}function q({line:t,showExtras:i}){if(!i)return null;const e=_(t.points,2).map(([o,p],a)=>{const l=p.sub(o).normalize().perpendicular(),s=o.lerp(p,.5),r=s.add(l.scale(H/2)),c=s.add(l.scale(-H/2));return n("line",{x1:r.x,y1:r.y,x2:c.x,y2:c.y,className:"stroke-purple-500",fill:"none",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"},a)});return n(I,{children:e})}function lt(t){return n(dt,{...t})}function dt({line:t,showExtras:i,uiTarget:e}){const[o,p]=v.exports.useState(.333),a=[],l=new E;switch(t.points.length){case 0:case 1:return null;case 2:l.moveTo(t.points[0]),l.lineTo(t.points[1]);break;default:{l.moveTo(t.points[0]);const s=t.points[2].sub(t.points[0]).normalize();let r=t.points[0].distanceTo(t.points[1]);const c=s.scale(r*o),d=t.points[1].sub(c);a.push({target:t.points[1],control:d}),l.quadraticCurveTo(d,t.points[1]);let f=s;for(let u=1;u<t.points.length-2;u++){const T=t.points[u+2].sub(t.points[u]).normalize();r=t.points[u].distanceTo(t.points[u+1]);const b=t.points[u].add(f.scale(r*o)),P=t.points[u+1].sub(T.scale(r*o));a.push({target:t.points[u],control:b}),a.push({target:t.points[u+1],control:P}),l.bezierCurveTo(b,P,t.points[u+1]),f=T}r=t.points[t.points.length-2].distanceTo(t.points[t.points.length-1]);const h=t.points[t.points.length-2].add(f.scale(r*o));a.push({target:t.points[t.points.length-2],control:h}),l.quadraticCurveTo(h,t.points[t.points.length-1]);break}}return x(I,{children:[i&&a.map(({target:s,control:r},c)=>x(v.exports.Fragment,{children:[n("line",{x1:s.x,y1:s.y,x2:r.x,y2:r.y,className:"stroke-purple-400",fill:"none",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),n("circle",{cx:r.x,cy:r.y,r:4,strokeWidth:2,className:"fill-white stroke-purple-400"})]},c)),n("path",{d:l.toString(),className:"stroke-fuchsia-500",fill:"none",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}),x(z,{label:"naive tangents",uiTarget:e,children:["slop:",n("input",{type:"range",value:o,onChange:s=>p(s.currentTarget.valueAsNumber),min:0,max:1,step:.001}),n("span",{className:"tabular-nums",children:o.toFixed(2)})]})]})}function ut(t){return n(ht,{...t})}function ht({line:t,showExtras:i,uiTarget:e}){const[o,p]=v.exports.useState(.5);if(t.points.length<2)return null;const a=[],l=new E;l.moveTo(t.points[0]);for(let s=0;s<t.points.length-1;s++){const r=s==0?t.points[0]:t.points[s-1],c=t.points[s],d=t.points[s+1],f=s+2<t.points.length?t.points[s+2]:d,h=Math.sqrt(Math.pow(r.x-c.x,2)+Math.pow(r.y-c.y,2)),u=Math.sqrt(Math.pow(c.x-d.x,2)+Math.pow(c.y-d.y,2)),T=Math.sqrt(Math.pow(d.x-f.x,2)+Math.pow(d.y-f.y,2)),b=Math.pow(T,o),P=Math.pow(T,2*o),m=Math.pow(u,o),g=Math.pow(u,2*o),A=Math.pow(h,o),S=Math.pow(h,2*o),y=2*S+3*A*m+g,k=2*P+3*b*m+g;let w=3*A*(A+m);w>0&&(w=1/w);let M=3*b*(b+m);M>0&&(M=1/M);let C=new N((-g*r.x+y*c.x+S*d.x)*w,(-g*r.y+y*c.y+S*d.y)*w),L=new N((P*c.x+k*d.x-g*f.x)*M,(P*c.y+k*d.y-g*f.y)*M);C.x==0&&C.y==0&&(C=c),L.x==0&&L.y==0&&(L=d),a.push({target:c,control:C}),a.push({target:d,control:L}),l.bezierCurveTo(C,L,d)}return x(I,{children:[i&&a.map(({target:s,control:r},c)=>x(v.exports.Fragment,{children:[n("line",{x1:s.x,y1:s.y,x2:r.x,y2:r.y,className:"stroke-purple-400",fill:"none",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),n("circle",{cx:r.x,cy:r.y,r:4,strokeWidth:2,className:"fill-white stroke-purple-400"})]},c))," ",n("path",{d:l.toString(),className:"stroke-fuchsia-500",fill:"none",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}),x(z,{label:"catmull-rom",uiTarget:e,children:["alpha:",n("input",{type:"range",value:o,onChange:s=>p(s.currentTarget.valueAsNumber),min:.001,max:1,step:.001}),n("span",{className:"tabular-nums",children:o.toFixed(2)})]})]})}function z({label:t,uiTarget:i,children:e}){return X.exports.createPortal(x("div",{className:"flex items-baseline justify-between gap-3",onPointerDown:o=>o.stopPropagation(),onPointerMove:o=>o.stopPropagation(),onPointerUp:o=>o.stopPropagation(),onPointerCancel:o=>o.stopPropagation(),children:[n("div",{className:"flex-auto p-3 font-semibold text-stone-500",children:t}),n("div",{className:"flex flex-none items-center justify-center gap-3 p-3",children:e})]}),i)}const mt=V(document.getElementById("root"),'Assertion Error: document.getElementById("root")');Y(mt).render(n($.StrictMode,{children:n(at,{})}));
