import{K as $r,e as fe,a as B,Q as Ue,k as ht,b as U,o as Cr}from"./chunk_utils.FedKR4y8.js";/* empty css                       */import{j as nt,c as ai}from"./chunk_client.49X8lzWC.js";import{a as fi,s as ci}from"./chunk_useResizeObserver.5uCfJT2T.js";import{g as hi,s as pi}from"./chunk_storage.qvEXzNVN.js";import{S as _i}from"./chunk_svgPathBuilder.C6vY1er4.js";import{a as di,p as kr}from"./chunk_pathFromCenterPoints.LS3rOhi6.js";import{b as li,c as vi,g as yi}from"./chunk_perfectFreehand.KvPY3wkI.js";import{V as _t,S as m,R as hn}from"./chunk_Vector2.1Qo3QJ05.js";import{I as me}from"./chunk_Ids.QypG9fr1.js";import{a as le,c as pn,i as _n,R as Et,w as gi,b as xt,t as Qe,r as mi}from"./chunk_track.rtZiweUj.js";import{r as Pe,R as Si}from"./chunk_index.HRzIbU8d.js";import{c as wi}from"./chunk_index.f10NbkGF.js";import"./chunk_ResizeObserver.-NVrOerG.js";import"./chunk__commonjsHelpers.5-cIlDoe.js";class Ei{constructor(){this._pointer=le("Inputs.pointer",_t.ZERO)}onPointerMove(t){t.isPrimary&&this._pointer.set(_t.fromEvent(t))}onPointerDown(t){t.isPrimary&&this._pointer.set(_t.fromEvent(t))}onPointerUp(t){t.isPrimary&&this._pointer.set(_t.fromEvent(t))}get pointer(){return this._pointer.value}}var Zt="delete",E=5,K=1<<E,T=K-1,v={};function Ne(){return{value:!1}}function W(e){e&&(e.value=!0)}function tr(){}function zt(e){return e.size===void 0&&(e.size=e.__iterate(dn)),e.size}function at(e,t){if(typeof t!="number"){var r=t>>>0;if(""+r!==t||r===4294967295)return NaN;t=r}return t<0?zt(e)+t:t}function dn(){return!0}function Xt(e,t,r){return(e===0&&!vn(e)||r!==void 0&&e<=-r)&&(t===void 0||r!==void 0&&t>=r)}function Tt(e,t){return ln(e,t,0)}function Gt(e,t){return ln(e,t,t)}function ln(e,t,r){return e===void 0?r:vn(e)?t===1/0?t:Math.max(0,t+e)|0:t===void 0||t===e?e:Math.min(t,e)|0}function vn(e){return e<0||e===0&&1/e===-1/0}var yn="@@__IMMUTABLE_ITERABLE__@@";function L(e){return!!(e&&e[yn])}var gn="@@__IMMUTABLE_KEYED__@@";function S(e){return!!(e&&e[gn])}var mn="@@__IMMUTABLE_INDEXED__@@";function R(e){return!!(e&&e[mn])}function Qt(e){return S(e)||R(e)}var M=function(t){return L(t)?t:$(t)},Y=function(e){function t(r){return S(r)?r:ct(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(M),vt=function(e){function t(r){return R(r)?r:J(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(M),Lt=function(e){function t(r){return L(r)&&!Qt(r)?r:Ct(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(M);M.Keyed=Y;M.Indexed=vt;M.Set=Lt;var Sn="@@__IMMUTABLE_SEQ__@@";function Se(e){return!!(e&&e[Sn])}var wn="@@__IMMUTABLE_RECORD__@@";function yt(e){return!!(e&&e[wn])}function H(e){return L(e)||yt(e)}var Dt="@@__IMMUTABLE_ORDERED__@@";function F(e){return!!(e&&e[Dt])}var te=0,X=1,V=2,Be=typeof Symbol=="function"&&Symbol.iterator,En="@@iterator",we=Be||En,y=function(t){this.next=t};y.prototype.toString=function(){return"[Iterator]"};y.KEYS=te;y.VALUES=X;y.ENTRIES=V;y.prototype.inspect=y.prototype.toSource=function(){return this.toString()};y.prototype[we]=function(){return this};function O(e,t,r,n){var i=e===0?t:e===1?r:[t,r];return n?n.value=i:n={value:i,done:!1},n}function D(){return{value:void 0,done:!0}}function er(e){return Array.isArray(e)?!0:!!Ee(e)}function xr(e){return e&&typeof e.next=="function"}function Ke(e){var t=Ee(e);return t&&t.call(e)}function Ee(e){var t=e&&(Be&&e[Be]||e[En]);if(typeof t=="function")return t}function Oi(e){var t=Ee(e);return t&&t===e.entries}function Ii(e){var t=Ee(e);return t&&t===e.keys}var $t=Object.prototype.hasOwnProperty;function rr(e){return Array.isArray(e)||typeof e=="string"?!0:e&&typeof e=="object"&&Number.isInteger(e.length)&&e.length>=0&&(e.length===0?Object.keys(e).length===1:e.hasOwnProperty(e.length-1))}var $=function(e){function t(r){return r==null?ir():H(r)?r.toSeq():Mi(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq {","}")},t.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},t.prototype.__iterate=function(n,i){var s=this._cache;if(s){for(var o=s.length,u=0;u!==o;){var a=s[i?o-++u:u++];if(n(a[1],a[0],this)===!1)break}return u}return this.__iterateUncached(n,i)},t.prototype.__iterator=function(n,i){var s=this._cache;if(s){var o=s.length,u=0;return new y(function(){if(u===o)return D();var a=s[i?o-++u:u++];return O(n,a[0],a[1])})}return this.__iteratorUncached(n,i)},t}(M),ct=function(e){function t(r){return r==null?ir().toKeyedSeq():L(r)?S(r)?r.toSeq():r.fromEntrySeq():yt(r)?r.toSeq():sr(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toKeyedSeq=function(){return this},t}($),J=function(e){function t(r){return r==null?ir():L(r)?S(r)?r.entrySeq():r.toIndexedSeq():yt(r)?r.toSeq().entrySeq():On(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toIndexedSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq [","]")},t}($),Ct=function(e){function t(r){return(L(r)&&!Qt(r)?r:J(r)).toSetSeq()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toSetSeq=function(){return this},t}($);$.isSeq=Se;$.Keyed=ct;$.Set=Ct;$.Indexed=J;$.prototype[Sn]=!0;var lt=function(e){function t(r){this._array=r,this.size=r.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,i){return this.has(n)?this._array[at(this,n)]:i},t.prototype.__iterate=function(n,i){for(var s=this._array,o=s.length,u=0;u!==o;){var a=i?o-++u:u++;if(n(s[a],a,this)===!1)break}return u},t.prototype.__iterator=function(n,i){var s=this._array,o=s.length,u=0;return new y(function(){if(u===o)return D();var a=i?o-++u:u++;return O(n,a,s[a])})},t}(J),nr=function(e){function t(r){var n=Object.keys(r).concat(Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(r):[]);this._object=r,this._keys=n,this.size=n.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,i){return i!==void 0&&!this.has(n)?i:this._object[n]},t.prototype.has=function(n){return $t.call(this._object,n)},t.prototype.__iterate=function(n,i){for(var s=this._object,o=this._keys,u=o.length,a=0;a!==u;){var f=o[i?u-++a:a++];if(n(s[f],f,this)===!1)break}return a},t.prototype.__iterator=function(n,i){var s=this._object,o=this._keys,u=o.length,a=0;return new y(function(){if(a===u)return D();var f=o[i?u-++a:a++];return O(n,f,s[f])})},t}(ct);nr.prototype[Dt]=!0;var zi=function(e){function t(r){this._collection=r,this.size=r.length||r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.__iterateUncached=function(n,i){if(i)return this.cacheResult().__iterate(n,i);var s=this._collection,o=Ke(s),u=0;if(xr(o))for(var a;!(a=o.next()).done&&n(a.value,u++,this)!==!1;);return u},t.prototype.__iteratorUncached=function(n,i){if(i)return this.cacheResult().__iterator(n,i);var s=this._collection,o=Ke(s);if(!xr(o))return new y(D);var u=0;return new y(function(){var a=o.next();return a.done?a:O(n,u++,a.value)})},t}(J),Ur;function ir(){return Ur||(Ur=new lt([]))}function sr(e){var t=or(e);if(t)return t.fromEntrySeq();if(typeof e=="object")return new nr(e);throw new TypeError("Expected Array or collection object of [k, v] entries, or keyed object: "+e)}function On(e){var t=or(e);if(t)return t;throw new TypeError("Expected Array or collection object of values: "+e)}function Mi(e){var t=or(e);if(t)return Oi(e)?t.fromEntrySeq():Ii(e)?t.toSetSeq():t;if(typeof e=="object")return new nr(e);throw new TypeError("Expected Array or collection object of values, or keyed object: "+e)}function or(e){return rr(e)?new lt(e):er(e)?new zi(e):void 0}var In="@@__IMMUTABLE_MAP__@@";function Oe(e){return!!(e&&e[In])}function ur(e){return Oe(e)&&F(e)}function We(e){return!!(e&&typeof e.equals=="function"&&typeof e.hashCode=="function")}function q(e,t){if(e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1;if(typeof e.valueOf=="function"&&typeof t.valueOf=="function"){if(e=e.valueOf(),t=t.valueOf(),e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1}return!!(We(e)&&We(t)&&e.equals(t))}var Ut=typeof Math.imul=="function"&&Math.imul(4294967295,2)===-2?Math.imul:function(t,r){t|=0,r|=0;var n=t&65535,i=r&65535;return n*i+((t>>>16)*i+n*(r>>>16)<<16>>>0)|0};function Ie(e){return e>>>1&1073741824|e&3221225471}var bi=Object.prototype.valueOf;function k(e){if(e==null)return Nr(e);if(typeof e.hashCode=="function")return Ie(e.hashCode(e));var t=Ti(e);if(t==null)return Nr(t);switch(typeof t){case"boolean":return t?1108378657:1108378656;case"number":return Ai(t);case"string":return t.length>Li?qi(t):Fe(t);case"object":case"function":return Ri(t);case"symbol":return Pi(t);default:if(typeof t.toString=="function")return Fe(t.toString());throw new Error("Value type "+typeof t+" cannot be hashed.")}}function Nr(e){return e===null?1108378658:1108378659}function Ai(e){if(e!==e||e===1/0)return 0;var t=e|0;for(t!==e&&(t^=e*4294967295);e>4294967295;)e/=4294967295,t^=e;return Ie(t)}function qi(e){var t=Te[e];return t===void 0&&(t=Fe(e),je===Di&&(je=0,Te={}),je++,Te[e]=t),t}function Fe(e){for(var t=0,r=0;r<e.length;r++)t=31*t+e.charCodeAt(r)|0;return Ie(t)}function Pi(e){var t=Wr[e];return t!==void 0||(t=zn(),Wr[e]=t),t}function Ri(e){var t;if(Ve&&(t=Ye.get(e),t!==void 0)||(t=e[pt],t!==void 0)||!Kr&&(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[pt],t!==void 0||(t=ji(e),t!==void 0)))return t;if(t=zn(),Ve)Ye.set(e,t);else{if(Br!==void 0&&Br(e)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(Kr)Object.defineProperty(e,pt,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(e.propertyIsEnumerable!==void 0&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[pt]=t;else if(e.nodeType!==void 0)e[pt]=t;else throw new Error("Unable to set a non-enumerable property on object.")}return t}var Br=Object.isExtensible,Kr=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function ji(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}function Ti(e){return e.valueOf!==bi&&typeof e.valueOf=="function"?e.valueOf(e):e}function zn(){var e=++Re;return Re&1073741824&&(Re=0),e}var Ve=typeof WeakMap=="function",Ye;Ve&&(Ye=new WeakMap);var Wr=Object.create(null),Re=0,pt="__immutablehash__";typeof Symbol=="function"&&(pt=Symbol(pt));var Li=16,Di=255,je=0,Te={},ze=function(e){function t(r,n){this._iter=r,this._useKeys=n,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,i){return this._iter.get(n,i)},t.prototype.has=function(n){return this._iter.has(n)},t.prototype.valueSeq=function(){return this._iter.valueSeq()},t.prototype.reverse=function(){var n=this,i=ar(this,!0);return this._useKeys||(i.valueSeq=function(){return n._iter.toSeq().reverse()}),i},t.prototype.map=function(n,i){var s=this,o=Pn(this,n,i);return this._useKeys||(o.valueSeq=function(){return s._iter.toSeq().map(n,i)}),o},t.prototype.__iterate=function(n,i){var s=this;return this._iter.__iterate(function(o,u){return n(o,u,s)},i)},t.prototype.__iterator=function(n,i){return this._iter.__iterator(n,i)},t}(ct);ze.prototype[Dt]=!0;var Mn=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.includes=function(n){return this._iter.includes(n)},t.prototype.__iterate=function(n,i){var s=this,o=0;return i&&zt(this),this._iter.__iterate(function(u){return n(u,i?s.size-++o:o++,s)},i)},t.prototype.__iterator=function(n,i){var s=this,o=this._iter.__iterator(X,i),u=0;return i&&zt(this),new y(function(){var a=o.next();return a.done?a:O(n,i?s.size-++u:u++,a.value,a)})},t}(J),bn=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.has=function(n){return this._iter.includes(n)},t.prototype.__iterate=function(n,i){var s=this;return this._iter.__iterate(function(o){return n(o,o,s)},i)},t.prototype.__iterator=function(n,i){var s=this._iter.__iterator(X,i);return new y(function(){var o=s.next();return o.done?o:O(n,o.value,o.value,o)})},t}(Ct),An=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.entrySeq=function(){return this._iter.toSeq()},t.prototype.__iterate=function(n,i){var s=this;return this._iter.__iterate(function(o){if(o){Vr(o);var u=L(o);return n(u?o.get(1):o[1],u?o.get(0):o[0],s)}},i)},t.prototype.__iterator=function(n,i){var s=this._iter.__iterator(X,i);return new y(function(){for(;;){var o=s.next();if(o.done)return o;var u=o.value;if(u){Vr(u);var a=L(u);return O(n,a?u.get(0):u[0],a?u.get(1):u[1],o)}}})},t}(ct);Mn.prototype.cacheResult=ze.prototype.cacheResult=bn.prototype.cacheResult=An.prototype.cacheResult=hr;function qn(e){var t=et(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var r=e.reverse.apply(this);return r.flip=function(){return e.reverse()},r},t.has=function(r){return e.includes(r)},t.includes=function(r){return e.has(r)},t.cacheResult=hr,t.__iterateUncached=function(r,n){var i=this;return e.__iterate(function(s,o){return r(o,s,i)!==!1},n)},t.__iteratorUncached=function(r,n){if(r===V){var i=e.__iterator(r,n);return new y(function(){var s=i.next();if(!s.done){var o=s.value[0];s.value[0]=s.value[1],s.value[1]=o}return s})}return e.__iterator(r===X?te:X,n)},t}function Pn(e,t,r){var n=et(e);return n.size=e.size,n.has=function(i){return e.has(i)},n.get=function(i,s){var o=e.get(i,v);return o===v?s:t.call(r,o,i,e)},n.__iterateUncached=function(i,s){var o=this;return e.__iterate(function(u,a,f){return i(t.call(r,u,a,f),a,o)!==!1},s)},n.__iteratorUncached=function(i,s){var o=e.__iterator(V,s);return new y(function(){var u=o.next();if(u.done)return u;var a=u.value,f=a[0];return O(i,f,t.call(r,a[1],f,e),u)})},n}function ar(e,t){var r=this,n=et(e);return n._iter=e,n.size=e.size,n.reverse=function(){return e},e.flip&&(n.flip=function(){var i=qn(e);return i.reverse=function(){return e.flip()},i}),n.get=function(i,s){return e.get(t?i:-1-i,s)},n.has=function(i){return e.has(t?i:-1-i)},n.includes=function(i){return e.includes(i)},n.cacheResult=hr,n.__iterate=function(i,s){var o=this,u=0;return s&&zt(e),e.__iterate(function(a,f){return i(a,t?f:s?o.size-++u:u++,o)},!s)},n.__iterator=function(i,s){var o=0;s&&zt(e);var u=e.__iterator(V,!s);return new y(function(){var a=u.next();if(a.done)return a;var f=a.value;return O(i,t?f[0]:s?r.size-++o:o++,f[1],a)})},n}function Rn(e,t,r,n){var i=et(e);return n&&(i.has=function(s){var o=e.get(s,v);return o!==v&&!!t.call(r,o,s,e)},i.get=function(s,o){var u=e.get(s,v);return u!==v&&t.call(r,u,s,e)?u:o}),i.__iterateUncached=function(s,o){var u=this,a=0;return e.__iterate(function(f,c,h){if(t.call(r,f,c,h))return a++,s(f,n?c:a-1,u)},o),a},i.__iteratorUncached=function(s,o){var u=e.__iterator(V,o),a=0;return new y(function(){for(;;){var f=u.next();if(f.done)return f;var c=f.value,h=c[0],p=c[1];if(t.call(r,p,h,e))return O(s,n?h:a++,p,f)}})},i}function $i(e,t,r){var n=mt().asMutable();return e.__iterate(function(i,s){n.update(t.call(r,i,s,e),0,function(o){return o+1})}),n.asImmutable()}function Ci(e,t,r){var n=S(e),i=(F(e)?tt():mt()).asMutable();e.__iterate(function(o,u){i.update(t.call(r,o,u,e),function(a){return a=a||[],a.push(n?[u,o]:o),a})});var s=cr(e);return i.map(function(o){return g(e,s(o))}).asImmutable()}function ki(e,t,r){var n=S(e),i=[[],[]];e.__iterate(function(o,u){i[t.call(r,o,u,e)?1:0].push(n?[u,o]:o)});var s=cr(e);return i.map(function(o){return g(e,s(o))})}function fr(e,t,r,n){var i=e.size;if(Xt(t,r,i))return e;var s=Tt(t,i),o=Gt(r,i);if(s!==s||o!==o)return fr(e.toSeq().cacheResult(),t,r,n);var u=o-s,a;u===u&&(a=u<0?0:u);var f=et(e);return f.size=a===0?a:e.size&&a||void 0,!n&&Se(e)&&a>=0&&(f.get=function(c,h){return c=at(this,c),c>=0&&c<a?e.get(c+s,h):h}),f.__iterateUncached=function(c,h){var p=this;if(a===0)return 0;if(h)return this.cacheResult().__iterate(c,h);var _=0,d=!0,l=0;return e.__iterate(function(z,x){if(!(d&&(d=_++<s)))return l++,c(z,n?x:l-1,p)!==!1&&l!==a}),l},f.__iteratorUncached=function(c,h){if(a!==0&&h)return this.cacheResult().__iterator(c,h);if(a===0)return new y(D);var p=e.__iterator(c,h),_=0,d=0;return new y(function(){for(;_++<s;)p.next();if(++d>a)return D();var l=p.next();return n||c===X||l.done?l:c===te?O(c,d-1,void 0,l):O(c,d-1,l.value[1],l)})},f}function xi(e,t,r){var n=et(e);return n.__iterateUncached=function(i,s){var o=this;if(s)return this.cacheResult().__iterate(i,s);var u=0;return e.__iterate(function(a,f,c){return t.call(r,a,f,c)&&++u&&i(a,f,o)}),u},n.__iteratorUncached=function(i,s){var o=this;if(s)return this.cacheResult().__iterator(i,s);var u=e.__iterator(V,s),a=!0;return new y(function(){if(!a)return D();var f=u.next();if(f.done)return f;var c=f.value,h=c[0],p=c[1];return t.call(r,p,h,o)?i===V?f:O(i,h,p,f):(a=!1,D())})},n}function jn(e,t,r,n){var i=et(e);return i.__iterateUncached=function(s,o){var u=this;if(o)return this.cacheResult().__iterate(s,o);var a=!0,f=0;return e.__iterate(function(c,h,p){if(!(a&&(a=t.call(r,c,h,p))))return f++,s(c,n?h:f-1,u)}),f},i.__iteratorUncached=function(s,o){var u=this;if(o)return this.cacheResult().__iterator(s,o);var a=e.__iterator(V,o),f=!0,c=0;return new y(function(){var h,p,_;do{if(h=a.next(),h.done)return n||s===X?h:s===te?O(s,c++,void 0,h):O(s,c++,h.value[1],h);var d=h.value;p=d[0],_=d[1],f&&(f=t.call(r,_,p,u))}while(f);return s===V?h:O(s,p,_,h)})},i}function Ui(e,t){var r=S(e),n=[e].concat(t).map(function(o){return L(o)?r&&(o=Y(o)):o=r?sr(o):On(Array.isArray(o)?o:[o]),o}).filter(function(o){return o.size!==0});if(n.length===0)return e;if(n.length===1){var i=n[0];if(i===e||r&&S(i)||R(e)&&R(i))return i}var s=new lt(n);return r?s=s.toKeyedSeq():R(e)||(s=s.toSetSeq()),s=s.flatten(!0),s.size=n.reduce(function(o,u){if(o!==void 0){var a=u.size;if(a!==void 0)return o+a}},0),s}function Tn(e,t,r){var n=et(e);return n.__iterateUncached=function(i,s){if(s)return this.cacheResult().__iterate(i,s);var o=0,u=!1;function a(f,c){f.__iterate(function(h,p){return(!t||c<t)&&L(h)?a(h,c+1):(o++,i(h,r?p:o-1,n)===!1&&(u=!0)),!u},s)}return a(e,0),o},n.__iteratorUncached=function(i,s){if(s)return this.cacheResult().__iterator(i,s);var o=e.__iterator(i,s),u=[],a=0;return new y(function(){for(;o;){var f=o.next();if(f.done!==!1){o=u.pop();continue}var c=f.value;if(i===V&&(c=c[1]),(!t||u.length<t)&&L(c))u.push(o),o=c.__iterator(i,s);else return r?f:O(i,a++,c,f)}return D()})},n}function Ni(e,t,r){var n=cr(e);return e.toSeq().map(function(i,s){return n(t.call(r,i,s,e))}).flatten(!0)}function Bi(e,t){var r=et(e);return r.size=e.size&&e.size*2-1,r.__iterateUncached=function(n,i){var s=this,o=0;return e.__iterate(function(u){return(!o||n(t,o++,s)!==!1)&&n(u,o++,s)!==!1},i),o},r.__iteratorUncached=function(n,i){var s=e.__iterator(X,i),o=0,u;return new y(function(){return(!u||o%2)&&(u=s.next(),u.done)?u:o%2?O(n,o++,t):O(n,o++,u.value,u)})},r}function Mt(e,t,r){t||(t=Ln);var n=S(e),i=0,s=e.toSeq().map(function(o,u){return[u,o,i++,r?r(o,u,e):o]}).valueSeq().toArray();return s.sort(function(o,u){return t(o[3],u[3])||o[2]-u[2]}).forEach(n?function(o,u){s[u].length=2}:function(o,u){s[u]=o[1]}),n?ct(s):R(e)?J(s):Ct(s)}function ce(e,t,r){if(t||(t=Ln),r){var n=e.toSeq().map(function(i,s){return[i,r(i,s,e)]}).reduce(function(i,s){return Fr(t,i[1],s[1])?s:i});return n&&n[0]}return e.reduce(function(i,s){return Fr(t,i,s)?s:i})}function Fr(e,t,r){var n=e(r,t);return n===0&&r!==t&&(r==null||r!==r)||n>0}function he(e,t,r,n){var i=et(e),s=new lt(r).map(function(o){return o.size});return i.size=n?s.max():s.min(),i.__iterate=function(o,u){for(var a=this.__iterator(X,u),f,c=0;!(f=a.next()).done&&o(f.value,c++,this)!==!1;);return c},i.__iteratorUncached=function(o,u){var a=r.map(function(h){return h=M(h),Ke(u?h.reverse():h)}),f=0,c=!1;return new y(function(){var h;return c||(h=a.map(function(p){return p.next()}),c=n?h.every(function(p){return p.done}):h.some(function(p){return p.done})),c?D():O(o,f++,t.apply(null,h.map(function(p){return p.value})))})},i}function g(e,t){return e===t?e:Se(e)?t:e.constructor(t)}function Vr(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function cr(e){return S(e)?Y:R(e)?vt:Lt}function et(e){return Object.create((S(e)?ct:R(e)?J:Ct).prototype)}function hr(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):$.prototype.cacheResult.call(this)}function Ln(e,t){return e===void 0&&t===void 0?0:e===void 0?1:t===void 0?-1:e>t?1:e<t?-1:0}function Q(e,t){t=t||0;for(var r=Math.max(0,e.length-t),n=new Array(r),i=0;i<r;i++)n[i]=e[i+t];return n}function pr(e,t){if(!e)throw new Error(t)}function N(e){pr(e!==1/0,"Cannot perform this action with an infinite size.")}function Dn(e){if(rr(e)&&typeof e!="string")return e;if(F(e))return e.toArray();throw new TypeError("Invalid keyPath: expected Ordered Collection or Array: "+e)}var Ki=Object.prototype.toString;function _r(e){if(!e||typeof e!="object"||Ki.call(e)!=="[object Object]")return!1;var t=Object.getPrototypeOf(e);if(t===null)return!0;for(var r=t,n=Object.getPrototypeOf(t);n!==null;)r=n,n=Object.getPrototypeOf(r);return r===t}function ft(e){return typeof e=="object"&&(H(e)||Array.isArray(e)||_r(e))}function Ft(e){try{return typeof e=="string"?JSON.stringify(e):String(e)}catch{return JSON.stringify(e)}}function $n(e,t){return H(e)?e.has(t):ft(e)&&$t.call(e,t)}function dr(e,t,r){return H(e)?e.get(t,r):$n(e,t)?typeof e.get=="function"?e.get(t):e[t]:r}function ve(e){if(Array.isArray(e))return Q(e);var t={};for(var r in e)$t.call(e,r)&&(t[r]=e[r]);return t}function Cn(e,t){if(!ft(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(H(e)){if(!e.remove)throw new TypeError("Cannot update immutable value without .remove() method: "+e);return e.remove(t)}if(!$t.call(e,t))return e;var r=ve(e);return Array.isArray(r)?r.splice(t,1):delete r[t],r}function kn(e,t,r){if(!ft(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(H(e)){if(!e.set)throw new TypeError("Cannot update immutable value without .set() method: "+e);return e.set(t,r)}if($t.call(e,t)&&r===e[t])return e;var n=ve(e);return n[t]=r,n}function gt(e,t,r,n){n||(n=r,r=void 0);var i=xn(H(e),e,Dn(t),0,r,n);return i===v?r:i}function xn(e,t,r,n,i,s){var o=t===v;if(n===r.length){var u=o?i:t,a=s(u);return a===u?t:a}if(!o&&!ft(t))throw new TypeError("Cannot update within non-data-structure value in path ["+r.slice(0,n).map(Ft)+"]: "+t);var f=r[n],c=o?v:dr(t,f,v),h=xn(c===v?e:H(c),c,r,n+1,i,s);return h===c?t:h===v?Cn(t,f):kn(o?e?Z():{}:t,f,h)}function Un(e,t,r){return gt(e,t,v,function(){return r})}function lr(e,t){return Un(this,e,t)}function Nn(e,t){return gt(e,t,function(){return v})}function vr(e){return Nn(this,e)}function yr(e,t,r,n){return gt(e,[t],r,n)}function gr(e,t,r){return arguments.length===1?e(this):yr(this,e,t,r)}function mr(e,t,r){return gt(this,e,t,r)}function Bn(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return Wn(this,e)}function Kn(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];if(typeof e!="function")throw new TypeError("Invalid merger function: "+e);return Wn(this,t,e)}function Wn(e,t,r){for(var n=[],i=0;i<t.length;i++){var s=Y(t[i]);s.size!==0&&n.push(s)}return n.length===0?e:e.toSeq().size===0&&!e.__ownerID&&n.length===1?e.constructor(n[0]):e.withMutations(function(o){for(var u=r?function(f,c){yr(o,c,v,function(h){return h===v?f:r(h,f,c)})}:function(f,c){o.set(c,f)},a=0;a<n.length;a++)n[a].forEach(u)})}function Wi(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return re(e,t)}function Fi(e,t){for(var r=[],n=arguments.length-2;n-- >0;)r[n]=arguments[n+2];return re(t,r,e)}function Vi(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return ee(e,t)}function Yi(e,t){for(var r=[],n=arguments.length-2;n-- >0;)r[n]=arguments[n+2];return ee(t,r,e)}function ee(e,t,r){return re(e,t,Hi(r))}function re(e,t,r){if(!ft(e))throw new TypeError("Cannot merge into non-data-structure value: "+e);if(H(e))return typeof r=="function"&&e.mergeWith?e.mergeWith.apply(e,[r].concat(t)):e.merge?e.merge.apply(e,t):e.concat.apply(e,t);for(var n=Array.isArray(e),i=e,s=n?vt:Y,o=n?function(a){i===e&&(i=ve(i)),i.push(a)}:function(a,f){var c=$t.call(i,f),h=c&&r?r(i[f],a,f):a;(!c||h!==i[f])&&(i===e&&(i=ve(i)),i[f]=h)},u=0;u<t.length;u++)s(t[u]).forEach(o);return i}function Hi(e){function t(r,n,i){return ft(r)&&ft(n)&&Ji(r,n)?re(r,[n],t):e?e(r,n,i):n}return t}function Ji(e,t){var r=$(e),n=$(t);return R(r)===R(n)&&S(r)===S(n)}function Fn(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return ee(this,e)}function Vn(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return ee(this,t,e)}function Sr(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return gt(this,e,Z(),function(n){return re(n,t)})}function wr(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return gt(this,e,Z(),function(n){return ee(n,t)})}function ne(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this}function ie(){return this.__ownerID?this:this.__ensureOwner(new tr)}function se(){return this.__ensureOwner()}function Er(){return this.__altered}var mt=function(e){function t(r){return r==null?Z():Oe(r)&&!F(r)?r:Z().withMutations(function(n){var i=e(r);N(i.size),i.forEach(function(s,o){return n.set(o,s)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return Z().withMutations(function(s){for(var o=0;o<n.length;o+=2){if(o+1>=n.length)throw new Error("Missing value for key: "+n[o]);s.set(n[o],n[o+1])}})},t.prototype.toString=function(){return this.__toString("Map {","}")},t.prototype.get=function(n,i){return this._root?this._root.get(0,void 0,n,i):i},t.prototype.set=function(n,i){return Jr(this,n,i)},t.prototype.remove=function(n){return Jr(this,n,v)},t.prototype.deleteAll=function(n){var i=M(n);return i.size===0?this:this.withMutations(function(s){i.forEach(function(o){return s.remove(o)})})},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Z()},t.prototype.sort=function(n){return tt(Mt(this,n))},t.prototype.sortBy=function(n,i){return tt(Mt(this,i,n))},t.prototype.map=function(n,i){var s=this;return this.withMutations(function(o){o.forEach(function(u,a){o.set(a,n.call(i,u,a,s))})})},t.prototype.__iterator=function(n,i){return new Zi(this,n,i)},t.prototype.__iterate=function(n,i){var s=this,o=0;return this._root&&this._root.iterate(function(u){return o++,n(u[1],u[0],s)},i),o},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?Or(this.size,this._root,n,this.__hash):this.size===0?Z():(this.__ownerID=n,this.__altered=!1,this)},t}(Y);mt.isMap=Oe;var I=mt.prototype;I[In]=!0;I[Zt]=I.remove;I.removeAll=I.deleteAll;I.setIn=lr;I.removeIn=I.deleteIn=vr;I.update=gr;I.updateIn=mr;I.merge=I.concat=Bn;I.mergeWith=Kn;I.mergeDeep=Fn;I.mergeDeepWith=Vn;I.mergeIn=Sr;I.mergeDeepIn=wr;I.withMutations=ne;I.wasAltered=Er;I.asImmutable=se;I["@@transducer/init"]=I.asMutable=ie;I["@@transducer/step"]=function(e,t){return e.set(t[0],t[1])};I["@@transducer/result"]=function(e){return e.asImmutable()};var Vt=function(t,r){this.ownerID=t,this.entries=r};Vt.prototype.get=function(t,r,n,i){for(var s=this.entries,o=0,u=s.length;o<u;o++)if(q(n,s[o][0]))return s[o][1];return i};Vt.prototype.update=function(t,r,n,i,s,o,u){for(var a=s===v,f=this.entries,c=0,h=f.length;c<h&&!q(i,f[c][0]);c++);var p=c<h;if(p?f[c][1]===s:a)return this;if(W(u),(a||!p)&&W(o),!(a&&f.length===1)){if(!p&&!a&&f.length>=rs)return Xi(t,f,i,s);var _=t&&t===this.ownerID,d=_?f:Q(f);return p?a?c===h-1?d.pop():d[c]=d.pop():d[c]=[i,s]:d.push([i,s]),_?(this.entries=d,this):new Vt(t,d)}};var bt=function(t,r,n){this.ownerID=t,this.bitmap=r,this.nodes=n};bt.prototype.get=function(t,r,n,i){r===void 0&&(r=k(n));var s=1<<((t===0?r:r>>>t)&T),o=this.bitmap;return o&s?this.nodes[Yn(o&s-1)].get(t+E,r,n,i):i};bt.prototype.update=function(t,r,n,i,s,o,u){n===void 0&&(n=k(i));var a=(r===0?n:n>>>r)&T,f=1<<a,c=this.bitmap,h=(c&f)!==0;if(!h&&s===v)return this;var p=Yn(c&f-1),_=this.nodes,d=h?_[p]:void 0,l=Ir(d,t,r+E,n,i,s,o,u);if(l===d)return this;if(!h&&l&&_.length>=ns)return Qi(t,_,c,a,l);if(h&&!l&&_.length===2&&Zr(_[p^1]))return _[p^1];if(h&&l&&_.length===1&&Zr(l))return l;var z=t&&t===this.ownerID,x=h?l?c:c^f:c|f,G=h?l?Hn(_,p,l,z):es(_,p,z):ts(_,p,l,z);return z?(this.bitmap=x,this.nodes=G,this):new bt(t,x,G)};var Yt=function(t,r,n){this.ownerID=t,this.count=r,this.nodes=n};Yt.prototype.get=function(t,r,n,i){r===void 0&&(r=k(n));var s=(t===0?r:r>>>t)&T,o=this.nodes[s];return o?o.get(t+E,r,n,i):i};Yt.prototype.update=function(t,r,n,i,s,o,u){n===void 0&&(n=k(i));var a=(r===0?n:n>>>r)&T,f=s===v,c=this.nodes,h=c[a];if(f&&!h)return this;var p=Ir(h,t,r+E,n,i,s,o,u);if(p===h)return this;var _=this.count;if(!h)_++;else if(!p&&(_--,_<is))return Gi(t,c,_,a);var d=t&&t===this.ownerID,l=Hn(c,a,p,d);return d?(this.count=_,this.nodes=l,this):new Yt(t,_,l)};var At=function(t,r,n){this.ownerID=t,this.keyHash=r,this.entries=n};At.prototype.get=function(t,r,n,i){for(var s=this.entries,o=0,u=s.length;o<u;o++)if(q(n,s[o][0]))return s[o][1];return i};At.prototype.update=function(t,r,n,i,s,o,u){n===void 0&&(n=k(i));var a=s===v;if(n!==this.keyHash)return a?this:(W(u),W(o),zr(this,t,r,n,[i,s]));for(var f=this.entries,c=0,h=f.length;c<h&&!q(i,f[c][0]);c++);var p=c<h;if(p?f[c][1]===s:a)return this;if(W(u),(a||!p)&&W(o),a&&h===2)return new it(t,this.keyHash,f[c^1]);var _=t&&t===this.ownerID,d=_?f:Q(f);return p?a?c===h-1?d.pop():d[c]=d.pop():d[c]=[i,s]:d.push([i,s]),_?(this.entries=d,this):new At(t,this.keyHash,d)};var it=function(t,r,n){this.ownerID=t,this.keyHash=r,this.entry=n};it.prototype.get=function(t,r,n,i){return q(n,this.entry[0])?this.entry[1]:i};it.prototype.update=function(t,r,n,i,s,o,u){var a=s===v,f=q(i,this.entry[0]);if(f?s===this.entry[1]:a)return this;if(W(u),a){W(o);return}return f?t&&t===this.ownerID?(this.entry[1]=s,this):new it(t,this.keyHash,[i,s]):(W(o),zr(this,t,r,k(i),[i,s]))};Vt.prototype.iterate=At.prototype.iterate=function(e,t){for(var r=this.entries,n=0,i=r.length-1;n<=i;n++)if(e(r[t?i-n:n])===!1)return!1};bt.prototype.iterate=Yt.prototype.iterate=function(e,t){for(var r=this.nodes,n=0,i=r.length-1;n<=i;n++){var s=r[t?i-n:n];if(s&&s.iterate(e,t)===!1)return!1}};it.prototype.iterate=function(e,t){return e(this.entry)};var Zi=function(e){function t(r,n,i){this._type=n,this._reverse=i,this._stack=r._root&&Yr(r._root)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){for(var n=this._type,i=this._stack;i;){var s=i.node,o=i.index++,u=void 0;if(s.entry){if(o===0)return Le(n,s.entry)}else if(s.entries){if(u=s.entries.length-1,o<=u)return Le(n,s.entries[this._reverse?u-o:o])}else if(u=s.nodes.length-1,o<=u){var a=s.nodes[this._reverse?u-o:o];if(a){if(a.entry)return Le(n,a.entry);i=this._stack=Yr(a,i)}continue}i=this._stack=this._stack.__prev}return D()},t}(y);function Le(e,t){return O(e,t[0],t[1])}function Yr(e,t){return{node:e,index:0,__prev:t}}function Or(e,t,r,n){var i=Object.create(I);return i.size=e,i._root=t,i.__ownerID=r,i.__hash=n,i.__altered=!1,i}var Hr;function Z(){return Hr||(Hr=Or(0))}function Jr(e,t,r){var n,i;if(e._root){var s=Ne(),o=Ne();if(n=Ir(e._root,e.__ownerID,0,void 0,t,r,s,o),!o.value)return e;i=e.size+(s.value?r===v?-1:1:0)}else{if(r===v)return e;i=1,n=new Vt(e.__ownerID,[[t,r]])}return e.__ownerID?(e.size=i,e._root=n,e.__hash=void 0,e.__altered=!0,e):n?Or(i,n):Z()}function Ir(e,t,r,n,i,s,o,u){return e?e.update(t,r,n,i,s,o,u):s===v?e:(W(u),W(o),new it(t,n,[i,s]))}function Zr(e){return e.constructor===it||e.constructor===At}function zr(e,t,r,n,i){if(e.keyHash===n)return new At(t,n,[e.entry,i]);var s=(r===0?e.keyHash:e.keyHash>>>r)&T,o=(r===0?n:n>>>r)&T,u,a=s===o?[zr(e,t,r+E,n,i)]:(u=new it(t,n,i),s<o?[e,u]:[u,e]);return new bt(t,1<<s|1<<o,a)}function Xi(e,t,r,n){e||(e=new tr);for(var i=new it(e,k(r),[r,n]),s=0;s<t.length;s++){var o=t[s];i=i.update(e,0,void 0,o[0],o[1])}return i}function Gi(e,t,r,n){for(var i=0,s=0,o=new Array(r),u=0,a=1,f=t.length;u<f;u++,a<<=1){var c=t[u];c!==void 0&&u!==n&&(i|=a,o[s++]=c)}return new bt(e,i,o)}function Qi(e,t,r,n,i){for(var s=0,o=new Array(K),u=0;r!==0;u++,r>>>=1)o[u]=r&1?t[s++]:void 0;return o[n]=i,new Yt(e,s+1,o)}function Yn(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function Hn(e,t,r,n){var i=n?e:Q(e);return i[t]=r,i}function ts(e,t,r,n){var i=e.length+1;if(n&&t+1===i)return e[t]=r,e;for(var s=new Array(i),o=0,u=0;u<i;u++)u===t?(s[u]=r,o=-1):s[u]=e[u+o];return s}function es(e,t,r){var n=e.length-1;if(r&&t===n)return e.pop(),e;for(var i=new Array(n),s=0,o=0;o<n;o++)o===t&&(s=1),i[o]=e[o+s];return i}var rs=K/4,ns=K/2,is=K/4,Jn="@@__IMMUTABLE_LIST__@@";function Mr(e){return!!(e&&e[Jn])}var oe=function(e){function t(r){var n=de();if(r==null)return n;if(Mr(r))return r;var i=e(r),s=i.size;return s===0?n:(N(s),s>0&&s<K?Ht(0,s,E,null,new ut(i.toArray())):n.withMutations(function(o){o.setSize(s),i.forEach(function(u,a){return o.set(a,u)})}))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("List [","]")},t.prototype.get=function(n,i){if(n=at(this,n),n>=0&&n<this.size){n+=this._origin;var s=Zn(this,n);return s&&s.array[n&T]}return i},t.prototype.set=function(n,i){return ss(this,n,i)},t.prototype.remove=function(n){return this.has(n)?n===0?this.shift():n===this.size-1?this.pop():this.splice(n,1):this},t.prototype.insert=function(n,i){return this.splice(n,0,i)},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=E,this._root=this._tail=this.__hash=void 0,this.__altered=!0,this):de()},t.prototype.push=function(){var n=arguments,i=this.size;return this.withMutations(function(s){ot(s,0,i+n.length);for(var o=0;o<n.length;o++)s.set(i+o,n[o])})},t.prototype.pop=function(){return ot(this,0,-1)},t.prototype.unshift=function(){var n=arguments;return this.withMutations(function(i){ot(i,-n.length);for(var s=0;s<n.length;s++)i.set(s,n[s])})},t.prototype.shift=function(){return ot(this,1)},t.prototype.concat=function(){for(var n=arguments,i=[],s=0;s<arguments.length;s++){var o=n[s],u=e(typeof o!="string"&&er(o)?o:[o]);u.size!==0&&i.push(u)}return i.length===0?this:this.size===0&&!this.__ownerID&&i.length===1?this.constructor(i[0]):this.withMutations(function(a){i.forEach(function(f){return f.forEach(function(c){return a.push(c)})})})},t.prototype.setSize=function(n){return ot(this,0,n)},t.prototype.map=function(n,i){var s=this;return this.withMutations(function(o){for(var u=0;u<s.size;u++)o.set(u,n.call(i,o.get(u),u,s))})},t.prototype.slice=function(n,i){var s=this.size;return Xt(n,i,s)?this:ot(this,Tt(n,s),Gt(i,s))},t.prototype.__iterator=function(n,i){var s=i?this.size:0,o=Xr(this,i);return new y(function(){var u=o();return u===Wt?D():O(n,i?--s:s++,u)})},t.prototype.__iterate=function(n,i){for(var s=i?this.size:0,o=Xr(this,i),u;(u=o())!==Wt&&n(u,i?--s:s++,this)!==!1;);return s},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?Ht(this._origin,this._capacity,this._level,this._root,this._tail,n,this.__hash):this.size===0?de():(this.__ownerID=n,this.__altered=!1,this)},t}(vt);oe.isList=Mr;var b=oe.prototype;b[Jn]=!0;b[Zt]=b.remove;b.merge=b.concat;b.setIn=lr;b.deleteIn=b.removeIn=vr;b.update=gr;b.updateIn=mr;b.mergeIn=Sr;b.mergeDeepIn=wr;b.withMutations=ne;b.wasAltered=Er;b.asImmutable=se;b["@@transducer/init"]=b.asMutable=ie;b["@@transducer/step"]=function(e,t){return e.push(t)};b["@@transducer/result"]=function(e){return e.asImmutable()};var ut=function(t,r){this.array=t,this.ownerID=r};ut.prototype.removeBefore=function(t,r,n){if(n===r?1<<r:this.array.length===0)return this;var i=n>>>r&T;if(i>=this.array.length)return new ut([],t);var s=i===0,o;if(r>0){var u=this.array[i];if(o=u&&u.removeBefore(t,r-E,n),o===u&&s)return this}if(s&&!o)return this;var a=qt(this,t);if(!s)for(var f=0;f<i;f++)a.array[f]=void 0;return o&&(a.array[i]=o),a};ut.prototype.removeAfter=function(t,r,n){if(n===(r?1<<r:0)||this.array.length===0)return this;var i=n-1>>>r&T;if(i>=this.array.length)return this;var s;if(r>0){var o=this.array[i];if(s=o&&o.removeAfter(t,r-E,n),s===o&&i===this.array.length-1)return this}var u=qt(this,t);return u.array.splice(i+1),s&&(u.array[i]=s),u};var Wt={};function Xr(e,t){var r=e._origin,n=e._capacity,i=Jt(n),s=e._tail;return o(e._root,e._level,0);function o(f,c,h){return c===0?u(f,h):a(f,c,h)}function u(f,c){var h=c===i?s&&s.array:f&&f.array,p=c>r?0:r-c,_=n-c;return _>K&&(_=K),function(){if(p===_)return Wt;var d=t?--_:p++;return h&&h[d]}}function a(f,c,h){var p,_=f&&f.array,d=h>r?0:r-h>>c,l=(n-h>>c)+1;return l>K&&(l=K),function(){for(;;){if(p){var z=p();if(z!==Wt)return z;p=null}if(d===l)return Wt;var x=t?--l:d++;p=o(_&&_[x],c-E,h+(x<<c))}}}}function Ht(e,t,r,n,i,s,o){var u=Object.create(b);return u.size=t-e,u._origin=e,u._capacity=t,u._level=r,u._root=n,u._tail=i,u.__ownerID=s,u.__hash=o,u.__altered=!1,u}var Gr;function de(){return Gr||(Gr=Ht(0,0,E))}function ss(e,t,r){if(t=at(e,t),t!==t)return e;if(t>=e.size||t<0)return e.withMutations(function(o){t<0?ot(o,t).set(0,r):ot(o,0,t+1).set(t,r)});t+=e._origin;var n=e._tail,i=e._root,s=Ne();return t>=Jt(e._capacity)?n=He(n,e.__ownerID,0,t,r,s):i=He(i,e.__ownerID,e._level,t,r,s),s.value?e.__ownerID?(e._root=i,e._tail=n,e.__hash=void 0,e.__altered=!0,e):Ht(e._origin,e._capacity,e._level,i,n):e}function He(e,t,r,n,i,s){var o=n>>>r&T,u=e&&o<e.array.length;if(!u&&i===void 0)return e;var a;if(r>0){var f=e&&e.array[o],c=He(f,t,r-E,n,i,s);return c===f?e:(a=qt(e,t),a.array[o]=c,a)}return u&&e.array[o]===i?e:(s&&W(s),a=qt(e,t),i===void 0&&o===a.array.length-1?a.array.pop():a.array[o]=i,a)}function qt(e,t){return t&&e&&t===e.ownerID?e:new ut(e?e.array.slice():[],t)}function Zn(e,t){if(t>=Jt(e._capacity))return e._tail;if(t<1<<e._level+E){for(var r=e._root,n=e._level;r&&n>0;)r=r.array[t>>>n&T],n-=E;return r}}function ot(e,t,r){t!==void 0&&(t|=0),r!==void 0&&(r|=0);var n=e.__ownerID||new tr,i=e._origin,s=e._capacity,o=i+t,u=r===void 0?s:r<0?s+r:i+r;if(o===i&&u===s)return e;if(o>=u)return e.clear();for(var a=e._level,f=e._root,c=0;o+c<0;)f=new ut(f&&f.array.length?[void 0,f]:[],n),a+=E,c+=1<<a;c&&(o+=c,i+=c,u+=c,s+=c);for(var h=Jt(s),p=Jt(u);p>=1<<a+E;)f=new ut(f&&f.array.length?[f]:[],n),a+=E;var _=e._tail,d=p<h?Zn(e,u-1):p>h?new ut([],n):_;if(_&&p>h&&o<s&&_.array.length){f=qt(f,n);for(var l=f,z=a;z>E;z-=E){var x=h>>>z&T;l=l.array[x]=qt(l.array[x],n)}l.array[h>>>E&T]=_}if(u<s&&(d=d&&d.removeAfter(n,0,u)),o>=p)o-=p,u-=p,a=E,f=null,d=d&&d.removeBefore(n,0,o);else if(o>i||p<h){for(c=0;f;){var G=o>>>a&T;if(G!==p>>>a&T)break;G&&(c+=(1<<a)*G),a-=E,f=f.array[G]}f&&o>i&&(f=f.removeBefore(n,a,o-c)),f&&p<h&&(f=f.removeAfter(n,a,p-c)),c&&(o-=c,u-=c)}return e.__ownerID?(e.size=u-o,e._origin=o,e._capacity=u,e._level=a,e._root=f,e._tail=d,e.__hash=void 0,e.__altered=!0,e):Ht(o,u,a,f,d)}function Jt(e){return e<K?0:e-1>>>E<<E}var tt=function(e){function t(r){return r==null?Nt():ur(r)?r:Nt().withMutations(function(n){var i=Y(r);N(i.size),i.forEach(function(s,o){return n.set(o,s)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("OrderedMap {","}")},t.prototype.get=function(n,i){var s=this._map.get(n);return s!==void 0?this._list.get(s)[1]:i},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this.__altered=!0,this):Nt()},t.prototype.set=function(n,i){return tn(this,n,i)},t.prototype.remove=function(n){return tn(this,n,v)},t.prototype.__iterate=function(n,i){var s=this;return this._list.__iterate(function(o){return o&&n(o[1],o[0],s)},i)},t.prototype.__iterator=function(n,i){return this._list.fromEntrySeq().__iterator(n,i)},t.prototype.__ensureOwner=function(n){if(n===this.__ownerID)return this;var i=this._map.__ensureOwner(n),s=this._list.__ensureOwner(n);return n?br(i,s,n,this.__hash):this.size===0?Nt():(this.__ownerID=n,this.__altered=!1,this._map=i,this._list=s,this)},t}(mt);tt.isOrderedMap=ur;tt.prototype[Dt]=!0;tt.prototype[Zt]=tt.prototype.remove;function br(e,t,r,n){var i=Object.create(tt.prototype);return i.size=e?e.size:0,i._map=e,i._list=t,i.__ownerID=r,i.__hash=n,i.__altered=!1,i}var Qr;function Nt(){return Qr||(Qr=br(Z(),de()))}function tn(e,t,r){var n=e._map,i=e._list,s=n.get(t),o=s!==void 0,u,a;if(r===v){if(!o)return e;i.size>=K&&i.size>=n.size*2?(a=i.filter(function(f,c){return f!==void 0&&s!==c}),u=a.toKeyedSeq().map(function(f){return f[0]}).flip().toMap(),e.__ownerID&&(u.__ownerID=a.__ownerID=e.__ownerID)):(u=n.remove(t),a=s===i.size-1?i.pop():i.set(s,void 0))}else if(o){if(r===i.get(s)[1])return e;u=n,a=i.set(s,[t,r])}else u=n.set(t,i.size),a=i.set(i.size,[t,r]);return e.__ownerID?(e.size=u.size,e._map=u,e._list=a,e.__hash=void 0,e.__altered=!0,e):br(u,a)}var Xn="@@__IMMUTABLE_STACK__@@";function ye(e){return!!(e&&e[Xn])}var dt=function(e){function t(r){return r==null?pe():ye(r)?r:pe().pushAll(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("Stack [","]")},t.prototype.get=function(n,i){var s=this._head;for(n=at(this,n);s&&n--;)s=s.next;return s?s.value:i},t.prototype.peek=function(){return this._head&&this._head.value},t.prototype.push=function(){var n=arguments;if(arguments.length===0)return this;for(var i=this.size+arguments.length,s=this._head,o=arguments.length-1;o>=0;o--)s={value:n[o],next:s};return this.__ownerID?(this.size=i,this._head=s,this.__hash=void 0,this.__altered=!0,this):Bt(i,s)},t.prototype.pushAll=function(n){if(n=e(n),n.size===0)return this;if(this.size===0&&ye(n))return n;N(n.size);var i=this.size,s=this._head;return n.__iterate(function(o){i++,s={value:o,next:s}},!0),this.__ownerID?(this.size=i,this._head=s,this.__hash=void 0,this.__altered=!0,this):Bt(i,s)},t.prototype.pop=function(){return this.slice(1)},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):pe()},t.prototype.slice=function(n,i){if(Xt(n,i,this.size))return this;var s=Tt(n,this.size),o=Gt(i,this.size);if(o!==this.size)return e.prototype.slice.call(this,n,i);for(var u=this.size-s,a=this._head;s--;)a=a.next;return this.__ownerID?(this.size=u,this._head=a,this.__hash=void 0,this.__altered=!0,this):Bt(u,a)},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?Bt(this.size,this._head,n,this.__hash):this.size===0?pe():(this.__ownerID=n,this.__altered=!1,this)},t.prototype.__iterate=function(n,i){var s=this;if(i)return new lt(this.toArray()).__iterate(function(a,f){return n(a,f,s)},i);for(var o=0,u=this._head;u&&n(u.value,o++,this)!==!1;)u=u.next;return o},t.prototype.__iterator=function(n,i){if(i)return new lt(this.toArray()).__iterator(n,i);var s=0,o=this._head;return new y(function(){if(o){var u=o.value;return o=o.next,O(n,s++,u)}return D()})},t}(vt);dt.isStack=ye;var C=dt.prototype;C[Xn]=!0;C.shift=C.pop;C.unshift=C.push;C.unshiftAll=C.pushAll;C.withMutations=ne;C.wasAltered=Er;C.asImmutable=se;C["@@transducer/init"]=C.asMutable=ie;C["@@transducer/step"]=function(e,t){return e.unshift(t)};C["@@transducer/result"]=function(e){return e.asImmutable()};function Bt(e,t,r,n){var i=Object.create(C);return i.size=e,i._head=t,i.__ownerID=r,i.__hash=n,i.__altered=!1,i}var en;function pe(){return en||(en=Bt(0))}var Gn="@@__IMMUTABLE_SET__@@";function Me(e){return!!(e&&e[Gn])}function Ar(e){return Me(e)&&F(e)}function qr(e,t){if(e===t)return!0;if(!L(t)||e.size!==void 0&&t.size!==void 0&&e.size!==t.size||e.__hash!==void 0&&t.__hash!==void 0&&e.__hash!==t.__hash||S(e)!==S(t)||R(e)!==R(t)||F(e)!==F(t))return!1;if(e.size===0&&t.size===0)return!0;var r=!Qt(e);if(F(e)){var n=e.entries();return t.every(function(a,f){var c=n.next().value;return c&&q(c[1],a)&&(r||q(c[0],f))})&&n.next().done}var i=!1;if(e.size===void 0)if(t.size===void 0)typeof e.cacheResult=="function"&&e.cacheResult();else{i=!0;var s=e;e=t,t=s}var o=!0,u=t.__iterate(function(a,f){if(r?!e.has(a):i?!q(a,e.get(f,v)):!q(e.get(f,v),a))return o=!1,!1});return o&&e.size===u}function St(e,t){var r=function(n){e.prototype[n]=t[n]};return Object.keys(t).forEach(r),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(r),e}function ge(e){if(!e||typeof e!="object")return e;if(!L(e)){if(!ft(e))return e;e=$(e)}if(S(e)){var t={};return e.__iterate(function(n,i){t[i]=ge(n)}),t}var r=[];return e.__iterate(function(n){r.push(ge(n))}),r}var ue=function(e){function t(r){return r==null?Kt():Me(r)&&!F(r)?r:Kt().withMutations(function(n){var i=e(r);N(i.size),i.forEach(function(s){return n.add(s)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(n){return this(Y(n).keySeq())},t.intersect=function(n){return n=M(n).toArray(),n.length?P.intersect.apply(t(n.pop()),n):Kt()},t.union=function(n){return n=M(n).toArray(),n.length?P.union.apply(t(n.pop()),n):Kt()},t.prototype.toString=function(){return this.__toString("Set {","}")},t.prototype.has=function(n){return this._map.has(n)},t.prototype.add=function(n){return _e(this,this._map.set(n,n))},t.prototype.remove=function(n){return _e(this,this._map.remove(n))},t.prototype.clear=function(){return _e(this,this._map.clear())},t.prototype.map=function(n,i){var s=this,o=!1,u=_e(this,this._map.mapEntries(function(a){var f=a[1],c=n.call(i,f,f,s);return c!==f&&(o=!0),[c,c]},i));return o?u:this},t.prototype.union=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return n=n.filter(function(s){return s.size!==0}),n.length===0?this:this.size===0&&!this.__ownerID&&n.length===1?this.constructor(n[0]):this.withMutations(function(s){for(var o=0;o<n.length;o++)typeof n[o]=="string"?s.add(n[o]):e(n[o]).forEach(function(u){return s.add(u)})})},t.prototype.intersect=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];if(n.length===0)return this;n=n.map(function(o){return e(o)});var s=[];return this.forEach(function(o){n.every(function(u){return u.includes(o)})||s.push(o)}),this.withMutations(function(o){s.forEach(function(u){o.remove(u)})})},t.prototype.subtract=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];if(n.length===0)return this;n=n.map(function(o){return e(o)});var s=[];return this.forEach(function(o){n.some(function(u){return u.includes(o)})&&s.push(o)}),this.withMutations(function(o){s.forEach(function(u){o.remove(u)})})},t.prototype.sort=function(n){return Rt(Mt(this,n))},t.prototype.sortBy=function(n,i){return Rt(Mt(this,i,n))},t.prototype.wasAltered=function(){return this._map.wasAltered()},t.prototype.__iterate=function(n,i){var s=this;return this._map.__iterate(function(o){return n(o,o,s)},i)},t.prototype.__iterator=function(n,i){return this._map.__iterator(n,i)},t.prototype.__ensureOwner=function(n){if(n===this.__ownerID)return this;var i=this._map.__ensureOwner(n);return n?this.__make(i,n):this.size===0?this.__empty():(this.__ownerID=n,this._map=i,this)},t}(Lt);ue.isSet=Me;var P=ue.prototype;P[Gn]=!0;P[Zt]=P.remove;P.merge=P.concat=P.union;P.withMutations=ne;P.asImmutable=se;P["@@transducer/init"]=P.asMutable=ie;P["@@transducer/step"]=function(e,t){return e.add(t)};P["@@transducer/result"]=function(e){return e.asImmutable()};P.__empty=Kt;P.__make=Qn;function _e(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:t.size===0?e.__empty():e.__make(t)}function Qn(e,t){var r=Object.create(P);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}var rn;function Kt(){return rn||(rn=Qn(Z()))}var ti=function(e){function t(r,n,i){if(!(this instanceof t))return new t(r,n,i);if(pr(i!==0,"Cannot step a Range by 0"),r=r||0,n===void 0&&(n=1/0),i=i===void 0?1:Math.abs(i),n<r&&(i=-i),this._start=r,this._end=n,this._step=i,this.size=Math.max(0,Math.ceil((n-r)/i-1)+1),this.size===0){if(De)return De;De=this}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"},t.prototype.get=function(n,i){return this.has(n)?this._start+at(this,n)*this._step:i},t.prototype.includes=function(n){var i=(n-this._start)/this._step;return i>=0&&i<this.size&&i===Math.floor(i)},t.prototype.slice=function(n,i){return Xt(n,i,this.size)?this:(n=Tt(n,this.size),i=Gt(i,this.size),i<=n?new t(0,0):new t(this.get(n,this._end),this.get(i,this._end),this._step))},t.prototype.indexOf=function(n){var i=n-this._start;if(i%this._step===0){var s=i/this._step;if(s>=0&&s<this.size)return s}return-1},t.prototype.lastIndexOf=function(n){return this.indexOf(n)},t.prototype.__iterate=function(n,i){for(var s=this.size,o=this._step,u=i?this._start+(s-1)*o:this._start,a=0;a!==s&&n(u,i?s-++a:a++,this)!==!1;)u+=i?-o:o;return a},t.prototype.__iterator=function(n,i){var s=this.size,o=this._step,u=i?this._start+(s-1)*o:this._start,a=0;return new y(function(){if(a===s)return D();var f=u;return u+=i?-o:o,O(n,i?s-++a:a++,f)})},t.prototype.equals=function(n){return n instanceof t?this._start===n._start&&this._end===n._end&&this._step===n._step:qr(this,n)},t}(J),De;function Pr(e,t,r){for(var n=Dn(t),i=0;i!==n.length;)if(e=dr(e,n[i++],v),e===v)return r;return e}function ei(e,t){return Pr(this,e,t)}function ri(e,t){return Pr(e,t,v)!==v}function os(e){return ri(this,e)}function ni(){N(this.size);var e={};return this.__iterate(function(t,r){e[r]=t}),e}M.isIterable=L;M.isKeyed=S;M.isIndexed=R;M.isAssociative=Qt;M.isOrdered=F;M.Iterator=y;St(M,{toArray:function(){N(this.size);var t=new Array(this.size||0),r=S(this),n=0;return this.__iterate(function(i,s){t[n++]=r?[s,i]:i}),t},toIndexedSeq:function(){return new Mn(this)},toJS:function(){return ge(this)},toKeyedSeq:function(){return new ze(this,!0)},toMap:function(){return mt(this.toKeyedSeq())},toObject:ni,toOrderedMap:function(){return tt(this.toKeyedSeq())},toOrderedSet:function(){return Rt(S(this)?this.valueSeq():this)},toSet:function(){return ue(S(this)?this.valueSeq():this)},toSetSeq:function(){return new bn(this)},toSeq:function(){return R(this)?this.toIndexedSeq():S(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return dt(S(this)?this.valueSeq():this)},toList:function(){return oe(S(this)?this.valueSeq():this)},toString:function(){return"[Collection]"},__toString:function(t,r){return this.size===0?t+r:t+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+r},concat:function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return g(this,Ui(this,t))},includes:function(t){return this.some(function(r){return q(r,t)})},entries:function(){return this.__iterator(V)},every:function(t,r){N(this.size);var n=!0;return this.__iterate(function(i,s,o){if(!t.call(r,i,s,o))return n=!1,!1}),n},filter:function(t,r){return g(this,Rn(this,t,r,!0))},partition:function(t,r){return ki(this,t,r)},find:function(t,r,n){var i=this.findEntry(t,r);return i?i[1]:n},forEach:function(t,r){return N(this.size),this.__iterate(r?t.bind(r):t)},join:function(t){N(this.size),t=t!==void 0?""+t:",";var r="",n=!0;return this.__iterate(function(i){n?n=!1:r+=t,r+=i!=null?i.toString():""}),r},keys:function(){return this.__iterator(te)},map:function(t,r){return g(this,Pn(this,t,r))},reduce:function(t,r,n){return nn(this,t,r,n,arguments.length<2,!1)},reduceRight:function(t,r,n){return nn(this,t,r,n,arguments.length<2,!0)},reverse:function(){return g(this,ar(this,!0))},slice:function(t,r){return g(this,fr(this,t,r,!0))},some:function(t,r){N(this.size);var n=!1;return this.__iterate(function(i,s,o){if(t.call(r,i,s,o))return n=!0,!1}),n},sort:function(t){return g(this,Mt(this,t))},values:function(){return this.__iterator(X)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==void 0?this.size===0:!this.some(function(){return!0})},count:function(t,r){return zt(t?this.toSeq().filter(t,r):this)},countBy:function(t,r){return $i(this,t,r)},equals:function(t){return qr(this,t)},entrySeq:function(){var t=this;if(t._cache)return new lt(t._cache);var r=t.toSeq().map(as).toIndexedSeq();return r.fromEntrySeq=function(){return t.toSeq()},r},filterNot:function(t,r){return this.filter($e(t),r)},findEntry:function(t,r,n){var i=n;return this.__iterate(function(s,o,u){if(t.call(r,s,o,u))return i=[o,s],!1}),i},findKey:function(t,r){var n=this.findEntry(t,r);return n&&n[0]},findLast:function(t,r,n){return this.toKeyedSeq().reverse().find(t,r,n)},findLastEntry:function(t,r,n){return this.toKeyedSeq().reverse().findEntry(t,r,n)},findLastKey:function(t,r){return this.toKeyedSeq().reverse().findKey(t,r)},first:function(t){return this.find(dn,null,t)},flatMap:function(t,r){return g(this,Ni(this,t,r))},flatten:function(t){return g(this,Tn(this,t,!0))},fromEntrySeq:function(){return new An(this)},get:function(t,r){return this.find(function(n,i){return q(i,t)},void 0,r)},getIn:ei,groupBy:function(t,r){return Ci(this,t,r)},has:function(t){return this.get(t,v)!==v},hasIn:os,isSubset:function(t){return t=typeof t.includes=="function"?t:M(t),this.every(function(r){return t.includes(r)})},isSuperset:function(t){return t=typeof t.isSubset=="function"?t:M(t),t.isSubset(this)},keyOf:function(t){return this.findKey(function(r){return q(r,t)})},keySeq:function(){return this.toSeq().map(us).toIndexedSeq()},last:function(t){return this.toSeq().reverse().first(t)},lastKeyOf:function(t){return this.toKeyedSeq().reverse().keyOf(t)},max:function(t){return ce(this,t)},maxBy:function(t,r){return ce(this,r,t)},min:function(t){return ce(this,t?sn(t):un)},minBy:function(t,r){return ce(this,r?sn(r):un,t)},rest:function(){return this.slice(1)},skip:function(t){return t===0?this:this.slice(Math.max(0,t))},skipLast:function(t){return t===0?this:this.slice(0,-Math.max(0,t))},skipWhile:function(t,r){return g(this,jn(this,t,r,!0))},skipUntil:function(t,r){return this.skipWhile($e(t),r)},sortBy:function(t,r){return g(this,Mt(this,r,t))},take:function(t){return this.slice(0,Math.max(0,t))},takeLast:function(t){return this.slice(-Math.max(0,t))},takeWhile:function(t,r){return g(this,xi(this,t,r))},takeUntil:function(t,r){return this.takeWhile($e(t),r)},update:function(t){return t(this)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=fs(this))}});var j=M.prototype;j[yn]=!0;j[we]=j.values;j.toJSON=j.toArray;j.__toStringMapper=Ft;j.inspect=j.toSource=function(){return this.toString()};j.chain=j.flatMap;j.contains=j.includes;St(Y,{flip:function(){return g(this,qn(this))},mapEntries:function(t,r){var n=this,i=0;return g(this,this.toSeq().map(function(s,o){return t.call(r,[o,s],i++,n)}).fromEntrySeq())},mapKeys:function(t,r){var n=this;return g(this,this.toSeq().flip().map(function(i,s){return t.call(r,i,s,n)}).flip())}});var ae=Y.prototype;ae[gn]=!0;ae[we]=j.entries;ae.toJSON=ni;ae.__toStringMapper=function(e,t){return Ft(t)+": "+Ft(e)};St(vt,{toKeyedSeq:function(){return new ze(this,!1)},filter:function(t,r){return g(this,Rn(this,t,r,!1))},findIndex:function(t,r){var n=this.findEntry(t,r);return n?n[0]:-1},indexOf:function(t){var r=this.keyOf(t);return r===void 0?-1:r},lastIndexOf:function(t){var r=this.lastKeyOf(t);return r===void 0?-1:r},reverse:function(){return g(this,ar(this,!1))},slice:function(t,r){return g(this,fr(this,t,r,!1))},splice:function(t,r){var n=arguments.length;if(r=Math.max(r||0,0),n===0||n===2&&!r)return this;t=Tt(t,t<0?this.count():this.size);var i=this.slice(0,t);return g(this,n===1?i:i.concat(Q(arguments,2),this.slice(t+r)))},findLastIndex:function(t,r){var n=this.findLastEntry(t,r);return n?n[0]:-1},first:function(t){return this.get(0,t)},flatten:function(t){return g(this,Tn(this,t,!1))},get:function(t,r){return t=at(this,t),t<0||this.size===1/0||this.size!==void 0&&t>this.size?r:this.find(function(n,i){return i===t},void 0,r)},has:function(t){return t=at(this,t),t>=0&&(this.size!==void 0?this.size===1/0||t<this.size:this.indexOf(t)!==-1)},interpose:function(t){return g(this,Bi(this,t))},interleave:function(){var t=[this].concat(Q(arguments)),r=he(this.toSeq(),J.of,t),n=r.flatten(!0);return r.size&&(n.size=r.size*t.length),g(this,n)},keySeq:function(){return ti(0,this.size)},last:function(t){return this.get(-1,t)},skipWhile:function(t,r){return g(this,jn(this,t,r,!1))},zip:function(){var t=[this].concat(Q(arguments));return g(this,he(this,on,t))},zipAll:function(){var t=[this].concat(Q(arguments));return g(this,he(this,on,t,!0))},zipWith:function(t){var r=Q(arguments);return r[0]=this,g(this,he(this,t,r))}});var kt=vt.prototype;kt[mn]=!0;kt[Dt]=!0;St(Lt,{get:function(t,r){return this.has(t)?t:r},includes:function(t){return this.has(t)},keySeq:function(){return this.valueSeq()}});var Pt=Lt.prototype;Pt.has=j.includes;Pt.contains=Pt.includes;Pt.keys=Pt.values;St(ct,ae);St(J,kt);St(Ct,Pt);function nn(e,t,r,n,i,s){return N(e.size),e.__iterate(function(o,u,a){i?(i=!1,r=o):r=t.call(n,r,o,u,a)},s),r}function us(e,t){return t}function as(e,t){return[t,e]}function $e(e){return function(){return!e.apply(this,arguments)}}function sn(e){return function(){return-e.apply(this,arguments)}}function on(){return Q(arguments)}function un(e,t){return e<t?1:e>t?-1:0}function fs(e){if(e.size===1/0)return 0;var t=F(e),r=S(e),n=t?1:0,i=e.__iterate(r?t?function(s,o){n=31*n+an(k(s),k(o))|0}:function(s,o){n=n+an(k(s),k(o))|0}:t?function(s){n=31*n+k(s)|0}:function(s){n=n+k(s)|0});return cs(i,n)}function cs(e,t){return t=Ut(t,3432918353),t=Ut(t<<15|t>>>-15,461845907),t=Ut(t<<13|t>>>-13,5),t=(t+3864292196|0)^e,t=Ut(t^t>>>16,2246822507),t=Ut(t^t>>>13,3266489909),t=Ie(t^t>>>16),t}function an(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}var Rt=function(e){function t(r){return r==null?Je():Ar(r)?r:Je().withMutations(function(n){var i=Lt(r);N(i.size),i.forEach(function(s){return n.add(s)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(n){return this(Y(n).keySeq())},t.prototype.toString=function(){return this.__toString("OrderedSet {","}")},t}(ue);Rt.isOrderedSet=Ar;var wt=Rt.prototype;wt[Dt]=!0;wt.zip=kt.zip;wt.zipWith=kt.zipWith;wt.zipAll=kt.zipAll;wt.__empty=Je;wt.__make=ii;function ii(e,t){var r=Object.create(wt);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}var fn;function Je(){return fn||(fn=ii(Nt()))}var hs={LeftThenRight:-1,RightThenLeft:1};function ps(e){if(yt(e))throw new Error("Can not call `Record` with an immutable Record as default values. Use a plain javascript object instead.");if(H(e))throw new Error("Can not call `Record` with an immutable Collection as default values. Use a plain javascript object instead.");if(e===null||typeof e!="object")throw new Error("Can not call `Record` with a non-object as default values. Use a plain javascript object instead.")}var A=function(t,r){var n;ps(t);var i=function(u){var a=this;if(u instanceof i)return u;if(!(this instanceof i))return new i(u);if(!n){n=!0;var f=Object.keys(t),c=s._indices={};s._name=r,s._keys=f,s._defaultValues=t;for(var h=0;h<f.length;h++){var p=f[h];c[p]=h,s[p]?typeof console=="object"&&console.warn&&console.warn("Cannot define "+jr(this)+' with property "'+p+'" since that property name is part of the Record API.'):_s(s,p)}}return this.__ownerID=void 0,this._values=oe().withMutations(function(_){_.setSize(a._keys.length),Y(u).forEach(function(d,l){_.set(a._indices[l],d===a._defaultValues[l]?void 0:d)})}),this},s=i.prototype=Object.create(w);return s.constructor=i,r&&(i.displayName=r),i};A.prototype.toString=function(){for(var t=jr(this)+" { ",r=this._keys,n,i=0,s=r.length;i!==s;i++)n=r[i],t+=(i?", ":"")+n+": "+Ft(this.get(n));return t+" }"};A.prototype.equals=function(t){return this===t||yt(t)&&jt(this).equals(jt(t))};A.prototype.hashCode=function(){return jt(this).hashCode()};A.prototype.has=function(t){return this._indices.hasOwnProperty(t)};A.prototype.get=function(t,r){if(!this.has(t))return r;var n=this._indices[t],i=this._values.get(n);return i===void 0?this._defaultValues[t]:i};A.prototype.set=function(t,r){if(this.has(t)){var n=this._values.set(this._indices[t],r===this._defaultValues[t]?void 0:r);if(n!==this._values&&!this.__ownerID)return Rr(this,n)}return this};A.prototype.remove=function(t){return this.set(t)};A.prototype.clear=function(){var t=this._values.clear().setSize(this._keys.length);return this.__ownerID?this:Rr(this,t)};A.prototype.wasAltered=function(){return this._values.wasAltered()};A.prototype.toSeq=function(){return jt(this)};A.prototype.toJS=function(){return ge(this)};A.prototype.entries=function(){return this.__iterator(V)};A.prototype.__iterator=function(t,r){return jt(this).__iterator(t,r)};A.prototype.__iterate=function(t,r){return jt(this).__iterate(t,r)};A.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var r=this._values.__ensureOwner(t);return t?Rr(this,r,t):(this.__ownerID=t,this._values=r,this)};A.isRecord=yt;A.getDescriptiveName=jr;var w=A.prototype;w[wn]=!0;w[Zt]=w.remove;w.deleteIn=w.removeIn=vr;w.getIn=ei;w.hasIn=j.hasIn;w.merge=Bn;w.mergeWith=Kn;w.mergeIn=Sr;w.mergeDeep=Fn;w.mergeDeepWith=Vn;w.mergeDeepIn=wr;w.setIn=lr;w.update=gr;w.updateIn=mr;w.withMutations=ne;w.asMutable=ie;w.asImmutable=se;w[we]=w.entries;w.toJSON=w.toObject=j.toObject;w.inspect=w.toSource=function(){return this.toString()};function Rr(e,t,r){var n=Object.create(Object.getPrototypeOf(e));return n._values=t,n.__ownerID=r,n}function jr(e){return e.constructor.displayName||e.constructor.name||"Record"}function jt(e){return sr(e._keys.map(function(t){return[t,e.get(t)]}))}function _s(e,t){try{Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(r){pr(this.__ownerID,"Cannot set on an immutable record."),this.set(t,r)}})}catch{}}var ds=function(e){function t(r,n){if(!(this instanceof t))return new t(r,n);if(this._value=r,this.size=n===void 0?1/0:Math.max(0,n),this.size===0){if(Ce)return Ce;Ce=this}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return this.size===0?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},t.prototype.get=function(n,i){return this.has(n)?this._value:i},t.prototype.includes=function(n){return q(this._value,n)},t.prototype.slice=function(n,i){var s=this.size;return Xt(n,i,s)?this:new t(this._value,Gt(i,s)-Tt(n,s))},t.prototype.reverse=function(){return this},t.prototype.indexOf=function(n){return q(this._value,n)?0:-1},t.prototype.lastIndexOf=function(n){return q(this._value,n)?this.size:-1},t.prototype.__iterate=function(n,i){for(var s=this.size,o=0;o!==s&&n(this._value,i?s-++o:o++,this)!==!1;);return o},t.prototype.__iterator=function(n,i){var s=this,o=this.size,u=0;return new y(function(){return u===o?D():O(n,i?o-++u:u++,s._value)})},t.prototype.equals=function(n){return n instanceof t?q(this._value,n._value):qr(n)},t}(J),Ce;function ls(e,t){return si([],t||vs,e,"",t&&t.length>2?[]:void 0,{"":e})}function si(e,t,r,n,i,s){if(typeof r!="string"&&!H(r)&&(rr(r)||er(r)||_r(r))){if(~e.indexOf(r))throw new TypeError("Cannot convert circular structure to Immutable");e.push(r),i&&n!==""&&i.push(n);var o=t.call(s,n,$(r).map(function(u,a){return si(e,t,u,a,i,r)}),i&&i.slice());return e.pop(),i&&i.pop(),o}return r}function vs(e,t){return R(t)?t.toList():S(t)?t.toMap():t.toSet()}var ys="4.3.4",gs={version:ys,Collection:M,Iterable:M,Seq:$,Map:mt,OrderedMap:tt,List:oe,Stack:dt,Set:ue,OrderedSet:Rt,PairSorting:hs,Record:A,Range:ti,Repeat:ds,is:q,fromJS:ls,hash:k,isImmutable:H,isCollection:L,isKeyed:S,isIndexed:R,isAssociative:Qt,isOrdered:F,isValueObject:We,isPlainObject:_r,isSeq:Se,isList:Mr,isMap:Oe,isOrderedMap:ur,isStack:ye,isSet:Me,isOrderedSet:Ar,isRecord:yt,get:dr,getIn:Pr,has:$n,hasIn:ri,merge:Wi,mergeDeep:Vi,mergeWith:Fi,mergeDeepWith:Yi,remove:Cn,removeIn:Nn,set:kn,setIn:Un,update:yr,updateIn:gt};const rt=gs;function Tr(e){return{valueSchema:e,diffSchema:m.never,apply(t,r){$r("Cannot apply diff to static value")},coalesce(t,r){$r("Cannot coalesce diffs for static value")}}}function Ze(e){return{valueSchema:e,diffSchema:e,apply(t,r){return[r,t]},coalesce(t,r){return r}}}function ms(e){return{valueSchema:m.arrayOf(e),diffSchema:Ss(e),apply(t,r){switch(r.type){case 1:return[r.value,{type:1,value:t}];case 0:{B(r.index>=0,"Assertion Error: diff.index >= 0"),B(r.index<=t.length,"Assertion Error: diff.index <= value.length"),B(r.deleteCount>=0,"Assertion Error: diff.deleteCount >= 0"),B(r.index+r.deleteCount<=t.length,"Assertion Error: diff.index + diff.deleteCount <= value.length");const n={type:0,index:r.index,deleteCount:r.insert.length,insert:t.slice(r.index,r.index+r.deleteCount)};return[t.slice(0,r.index).concat(r.insert,t.slice(r.index+r.deleteCount)),n]}default:fe(r)}},coalesce(t,r){switch(t.type){case 1:switch(r.type){case 1:return r;case 0:return{type:1,value:t.value.slice().splice(r.index,r.deleteCount,...r.insert)};default:throw fe(r)}case 0:switch(r.type){case 1:return r;case 0:{if(t.index+t.deleteCount<r.index||r.index+r.deleteCount<t.index)return null;const n=Math.min(t.index,r.index),i=Math.max(t.index+t.deleteCount,r.index+r.deleteCount),s=[...t.insert,...r.insert];return{type:0,index:n,deleteCount:i-n,insert:s}}default:throw fe(r)}default:throw fe(t)}}}}var Xe=(e=>(e[e.Splice=0]="Splice",e[e.Replace=1]="Replace",e))(Xe||{});function Ss(e){return m.indexedUnion("type",{0:m.object({type:m.value(0),index:m.number,deleteCount:m.number,insert:m.arrayOf(e)}).indexed({type:0,index:1,deleteCount:2,insert:3}),1:m.object({type:m.value(1),value:m.arrayOf(e)}).indexed({type:0,value:1})})}function be(e){return{config:e,valueSchema:m.object(Ue(e,t=>t.valueSchema)),diffSchema:m.object(Ue(e,t=>t.diffSchema.optional())),apply(t,r){const n={...t},i={};for(const s in r){const o=e[s],[u,a]=o.apply(t[s],r[s]);n[s]=u,i[s]=a}return[n,i]},coalesce(t,r){const n={...t};for(const i in r){const s=n[i],o=r[i];if(s===void 0)n[i]=o;else{const a=e[i].coalesce(s,o);if(a===null)return null;n[i]=a}}return n}}}function ws(e,t){return m.object({insert:m.objectMap(e,t.valueSchema).optional(),update:m.objectMap(e,m.arrayOf(t.diffSchema)).optional(),delete:m.objectMap(e,m.value(1)).optional()}).indexed({insert:0,update:1,delete:2})}function Lr(e,t){return{idSchema:e,record:t,valueSchema:m.arrayOf(t.valueSchema).transform(r=>hn.ok(rt.Map(r.map(n=>[n.id,n]))),m.cannotValidate("IncrementalTable"),r=>r.valueSeq().toArray()),diffSchema:ws(e,t),apply(r,n){const i=r.asMutable(),s={insert:void 0,update:void 0,delete:void 0};if(n.insert!==void 0){s.delete={};for(const o of ht(n.insert)){const u=U(n.insert[o],"Assertion Error: diff.insert[id]");B(!i.has(o),"Assertion Error: !result.has(id)"),i.set(o,u),s.delete[o]=1}}if(n.update!==void 0){s.update={};for(const o of ht(n.update)){const u=U(i.get(o),"Assertion Error: result.get(id)"),a=U(n.update[o],"Assertion Error: diff.update[id]");let f=u;const c=[];for(const h of a){const[p,_]=t.apply(f,h);f=p;const d=c[c.length-1],l=d?t.coalesce(d,_):null;l===null?c.push(_):c[c.length-1]=l}s.update[o]=c,i.set(o,f)}}if(n.delete!==void 0){s.insert={};for(const o of ht(n.delete)){const u=U(i.get(o),"Assertion Error: result.get(id)");i.delete(o),s.insert[o]=u}}return[i.asImmutable(),s]},coalesce(r,n){var s,o,u,a,f,c,h;const i={insert:void 0,update:void 0,delete:void 0};if(r.insert!==void 0&&(i.insert={...r.insert}),r.update!==void 0&&(i.update={...Ue(r.update,p=>p==null?void 0:p.slice())}),r.delete!==void 0&&(i.delete={...r.delete}),n.insert!==void 0){i.insert===void 0&&(i.insert={});for(const p of ht(n.insert))B(!i.insert[p]&&!((s=i.update)!=null&&s[p]),"Assertion Error: !result.insert[id] && !result.update?.[id]"),i.insert[p]=n.insert[p],(o=i.delete)!=null&&o[p]&&delete i.delete[p]}if(n.update!==void 0){i.update===void 0&&(i.update={});for(const p of ht(n.update)){B(!((u=i.delete)!=null&&u[p]),"Assertion Error: !result.delete?.[id]");const _=U(n.update[p],"Assertion Error: diff2.update[id]");let d=(a=i.insert)==null?void 0:a[p];if(d){for(const l of _){const[z,x]=t.apply(d,l);d=z}i.insert[p]=d}else{const l=(f=i.update)==null?void 0:f[p];if(l){const z=l[l.length-1],x=U(_[0],"Assertion Error: updates[0]"),G=z?t.coalesce(z,x):null;G===null?l.push(..._):(l[l.length-1]=G,l.push(..._.slice(1)))}else i.update[p]=_.slice()}}}if(n.delete!==void 0){i.delete===void 0&&(i.delete={});for(const p of ht(n.delete))(c=i.insert)!=null&&c[p]?delete i.insert[p]:((h=i.update)!=null&&h[p]&&delete i.update[p],i.delete[p]=1)}return i}}}function Es(e,t,r){const n=t[t.length-1],i=n?e.coalesce(n,r):null;return i===null?[...t,r]:[...t.slice(0,t.length-1),i]}class oi{constructor(t,r){this.parent=t,this.splat=r,this._child=le("State.child",null)}clear(){this._child.set(null)}enter(t,...r){const n=new t(this,...r);return this._child.set(n),n}get state(){return this._child.value}get path(){return this.state?`${this.name}.${this.state.path}`:this.name}onPointerDown(t){var r;(r=this.state)==null||r.onPointerDown(t)}onPointerMove(t){var r;(r=this.state)==null||r.onPointerMove(t)}onPointerUp(t){var r;(r=this.state)==null||r.onPointerUp(t)}onPointerCancel(t){var r;(r=this.state)==null||r.onPointerCancel(t)}}class ui extends oi{constructor(t){super(t,t.splat)}transitionTo(t,...r){return this.parent.enter(t,...r)}exit(){this.parent.clear()}}class Os extends oi{constructor(t){super(null,t),this.name="root",this.enter(cn)}clear(){this.enter(cn)}}class cn extends ui{constructor(){super(...arguments),this.name="idle"}onPointerDown(t){const r=this.splat.shapeVersions.signal.value.first();r&&this.transitionTo(Is,r.id)}}class Is extends ui{constructor(t,r){super(t),this.shapeVersionId=r,this.name="draw",this.mark=this.splat.mark("draw"),this.splat.shapeVersions.update(r,{rawPoints:{type:Xe.Replace,value:[this.splat.inputs.pointer]}})}onPointerMove(){this.splat.shapeVersions.update(this.shapeVersionId,{rawPoints:{type:Xe.Splice,index:this.splat.shapeVersions.get(this.shapeVersionId).rawPoints.length,insert:[this.splat.inputs.pointer],deleteCount:0}})}onPointerUp(){this.onPointerMove(),this.exit()}onPointerCancel(){this.splat.bail(this.mark),this.exit()}}class zs{constructor(t,r){this.tableSignal=t;const n=()=>{console.log("computeFromScratch");const i=rt.Map().asMutable(),s=rt.Map().asMutable();for(const[o,u]of t.value){const a=r(u);i.update(a,f=>f?f.add(o):rt.Set([o])),s.set(o,a)}return{index:i.asImmutable(),fields:s.asImmutable()}};this.result=pn(`${t.name}.${String(r)}`,(i,s)=>{if(_n(i))return n();const o=t.getDiffSince(s);if(o===Et)return n();const u=i.index.asMutable(),a=i.fields.asMutable();let f=!1;for(const c of o){if(c.insert)for(const[h,p]of Cr(c.insert)){if(!p)continue;const _=r(p);u.update(_,d=>d?d.add(h):rt.Set([h])),a.set(h,_),f=!0}if(c.update)for(const[h,p]of Cr(c.update)){if(!p)continue;const _=t.value.get(h);B(_,"Assertion Error: value");const d=U(a.get(h),"Assertion Error: fields.get(id)"),l=r(_);d!==l&&(u.update(d,z=>U(z,"Assertion Error: ids").remove(h)),u.update(l,z=>z?z.add(h):rt.Set([h])),a.set(h,l),f=!0)}if(c.delete)for(const h of ht(c.delete)){const p=U(a.get(h),"Assertion Error: fields.get(id)");u.update(p,_=>U(_,"Assertion Error: ids").remove(h)),a.delete(h),f=!0}}return f?{index:u.asImmutable(),fields:a.asImmutable()}:i})}*iterate(t){const r=this.result.value.index.get(t);if(r)for(const n of r){const i=this.tableSignal.value.get(n);B(i,"Assertion Error: value"),yield i}}getOneIfExists(t){const r=this.result.value.index.get(t);if(r)return B(r.size===1,"Assertion Error: ids.size === 1"),this.tableSignal.value.get(r.first())}getOne(t){const r=this.getOneIfExists(t);return B(r,"Assertion Error: value"),r}}const Ae=new me("key"),Ms=be({id:Tr(Ae.schema),position:Ze(_t.schema.nullable())}),bs=Lr(Ae.schema,Ms),qe=new me("shp"),As=be({id:Tr(qe.schema)}),qs=Lr(qe.schema,As),Dr=new me("shv"),Ps=be({id:Tr(Dr.schema),keyPointId:Ze(Ae.schema),shapeId:Ze(qe.schema),rawPoints:ms(_t.schema)}),Rs=Lr(Dr.schema,Ps),st=be({keyPoints:bs,shapes:qs,shapeVersions:Rs});function ke(e,t,r){return pn(String(t),(n,i)=>{const s=r(),o=s.value[t];if(_n(n))return o;if(o===n)return n;const u=s.getDiffSince(i);let a=Et;if(u!==Et)for(const f of u){const c=f[t];if(c!==void 0)if(a===Et)a=c;else{const h=e.config[t].coalesce(a,c);if(h)a=h;else{a=Et;break}}}return a===Et?o:gi(o,a)},{historyLength:10})}function xe(e,t){return{signal:e,[Symbol.iterator]:()=>e.value[Symbol.iterator](),getIfExists:r=>e.value.get(r),get:r=>{const n=e.value.get(r);return B(n!==void 0,`ID ${r} not found in ${e.name}`),n},insert:r=>{const n={};n[r.id]=r,t({insert:n})},update:(r,n)=>{const i={};i[r]=[n],t({update:i})},delete:r=>{const n={};n[r]=1,t({delete:n})}}}function js(e){let t=null;return r=>{t!==null&&cancelIdleCallback(t),t=requestIdleCallback(()=>{t=null,r()},{timeout:e})}}const Ge=new me("hst"),Ts=m.object({id:Ge.schema,inverse:m.arrayOf(st.diffSchema)}),It=class It{constructor(t,r){this.state=new Os(this),this.inputs=new Ei,this.shapeVersions=xe(ke(st,"shapeVersions",()=>this.doc),n=>this.update({shapeVersions:n})),this.shapes=xe(ke(st,"shapes",()=>this.doc),n=>this.update({shapes:n})),this.keyPoints=xe(ke(st,"keyPoints",()=>this.doc),n=>this.update({keyPoints:n})),this.shapeVersionsByShapeId=new zs(this.shapeVersions.signal,n=>n.shapeId),this.doc=le("Store.doc",t,{historyLength:100}),this.history=le("Store.history",dt(r))}static empty(){const t=Ae.generate(),r=qe.generate(),n=Dr.generate();return new It({keyPoints:rt.Map(),shapes:rt.Map(),shapeVersions:rt.Map()},dt()).updateWithoutHistory({keyPoints:{insert:{[t]:{id:t,position:_t.ZERO}}},shapes:{insert:{[r]:{id:r}}},shapeVersions:{insert:{[n]:{id:n,keyPointId:t,shapeId:r,rawPoints:[]}}}})}updateWithoutHistory(t){const[r,n]=st.apply(this.doc.value,t);return this.doc.set(r,t),this}update(t){const[r,n]=st.apply(this.doc.value,t);return this.doc.set(r,t),this.history.update(i=>{const s=i.peek();return s?i.pop().push({...s,inverse:Es(st,s.inverse,n)}):i.push({id:Ge.generate("initial"),inverse:[n]})}),this}clear(){const t=It.empty();this.doc.set(t.doc.value),this.history.set(t.history.value)}mark(t){const r=Ge.generate(t);return this.history.update(n=>n.push({id:r,inverse:[]})),r}bail(t){return xt(()=>{const r=this.history.value.findIndex(i=>i.id===t);U(r,"mark not found");const n=this.history.value.take(r+1);this.history.set(this.history.value.skip(r+1));for(const i of n)for(const s of i.inverse)this.updateWithoutHistory(s)}),this}onPointerDown(t){xt(()=>{t.isPrimary&&(this.inputs.onPointerDown(t),this.state.onPointerDown(t))})}onPointerMove(t){xt(()=>{t.isPrimary&&(this.inputs.onPointerMove(t),this.state.onPointerMove(t))})}onPointerUp(t){xt(()=>{t.isPrimary&&(this.inputs.onPointerUp(t),this.state.onPointerUp(t))})}onPointerCancel(t){xt(()=>{t.isPrimary&&this.state.onPointerCancel(t)})}};It.schema=m.object({doc:st.valueSchema,history:m.arrayOf(Ts)}).transform(({doc:t,history:r})=>hn.ok(new It(t,dt(r))),m.cannotValidate("Splat"),t=>({doc:t.doc.value,history:t.history.value.toArray()}));let Ot=It;const Ls=Qe(function(){const[t]=Pe.useState(()=>hi("splatapus2",Ot.schema,()=>Ot.empty()));Pe.useEffect(()=>(window.splat=t,mi("autosave",()=>{console.log("history",Ot.schema.serialize(t)),pi("splatapus2",Ot.schema,t)},{scheduleEffect:js(1e3)})),[t]);const[r,n]=Pe.useState(null),i=fi(r,s=>ci(s));return nt.jsx("div",{ref:n,className:"absolute inset-0 touch-none overflow-hidden",onPointerDown:s=>t.onPointerDown(s),onPointerMove:s=>t.onPointerMove(s),onPointerUp:s=>t.onPointerUp(s),onPointerCancel:s=>t.onPointerCancel(s),children:i&&nt.jsx(Ds,{splat:t,screenSize:i})})}),Ds=Qe(function({splat:t,screenSize:r}){return nt.jsx("svg",{viewBox:`0 0 ${r.x} ${r.y}`,className:wi("absolute left-0 top-0"),children:Array.from(t.shapes,([n,i])=>nt.jsx($s,{splat:t,shape:i},n))})}),$s=Qe(function({splat:t,shape:r}){const n=t.shapeVersionsByShapeId.getOne(r.id),[i,s]=Cs(n.rawPoints),o=li(di(i));return nt.jsxs("g",{children:[nt.jsx("path",{d:_i.midpointQuadraticViaPoints(n.rawPoints).toString(),fill:"none",strokeWidth:6,strokeLinejoin:"round",strokeLinecap:"round",className:"stroke-cyan-400"}),nt.jsx("path",{d:o,strokeWidth:6,strokeLinejoin:"round",strokeLinecap:"round",className:"fill-red-400"}),s]})});function Cs(e){if(e.length<2)return[[],[]];const t=vi(yi(e,kr),kr),{retainedPoints:r,dbg:n}=Ns(t);return[r,n]}const ks=10,xs=10;function Us(e,t){if(t===0||t===e.length-1)return null;const r=e[t-1],n=e[t],i=e[t+1],s=Math.abs(n.center.sub(r.center).angleBetween(i.center.sub(n.center)))/Math.PI*ks,o=(1-(n.radius<r.radius?n.radius/r.radius:r.radius/n.radius))*xs;return s+o}function Ns(e){const t=[];let r=1,n=0;const i=[e[0]];for(let s=1;s<e.length-1;s++){const o=U(Us(e,s),"Assertion Error: getCostAtIndex(points, i)");r-=o,n+=o,r<0&&(i.push(e[s]),r=1)}return i.push(e[e.length-1]),{retainedPoints:i,totalCost:n,dbg:t}}const Bs=U(document.getElementById("root"),'Assertion Error: document.getElementById("root")');ai(Bs).render(nt.jsx(Si.StrictMode,{children:nt.jsx(Ls,{})}));
