var Zt=Object.defineProperty;var Xt=(e,t,r)=>t in e?Zt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var u=(e,t,r)=>Xt(e,typeof t!="symbol"?t+"":t,r);import{R as V,r as Z}from"./chunk_index.C5eOxiyT.js";import{c as S,g as At}from"./chunk__commonjsHelpers.Cpj98o6Y.js";const X="__TLDRAW_LIBRARY_VERSIONS__";function Qt(){if(globalThis[X])return globalThis[X];const e={versions:[],didWarn:!1,scheduledNotice:null};return Object.defineProperty(globalThis,X,{value:e,writable:!1,configurable:!1,enumerable:!1}),e}function it(e,t,r){if(!e||!t||!r)throw new Error("Missing name/version/module system in built version of tldraw library");const n=Qt();if(n.versions.push({name:e,version:t,modules:r}),!n.scheduledNotice)try{n.scheduledNotice=setTimeout(()=>{n.scheduledNotice=null,gt(n)},100)}catch{gt(n)}}function gt(e){if(!e.versions.length||e.didWarn)return;const t=e.versions.sort((a,c)=>pt(a.version,c.version)),r=t[t.length-1].version,n=new Set,s=new Map;for(const a of t){if(s.has(a.name)){n.delete(a.name),Q(s,a.name,new Set).add(a.version);continue}a.version===r?n.add(a.name):(n.delete(a.name),Q(s,a.name,new Set).add(a.version))}if(s.size>0){const a=[`${E("[tldraw]",["bold","bgRed","textWhite"])} ${E("You have multiple versions of tldraw libraries installed. This can lead to bugs and unexpected behavior.",["textRed","bold"])}`,"",`The latest version you have installed is ${E(`v${r}`,["bold","textBlue"])}. The following libraries are on the latest version:`,...Array.from(n,c=>`  • ✅ ${E(c,["bold"])}`),"","The following libraries are not on the latest version, or have multiple versions installed:",...Array.from(s,([c,l])=>{const p=Array.from(l).sort(pt).map(f=>E(`v${f}`,f===r?["textGreen"]:["textRed"]));return`  • ❌ ${E(c,["bold"])} (${p.join(", ")})`})];console.log(a.join(`
`)),e.didWarn=!0;return}const i=new Map;for(const a of t)Q(i,a.name,{version:a.version,modules:[]}).modules.push(a.modules);const o=new Map;for(const[a,c]of i)c.modules.length>1&&o.set(a,c);if(o.size>0){const a=[`${E("[tldraw]",["bold","bgRed","textWhite"])} ${E("You have multiple instances of some tldraw libraries active. This can lead to bugs and unexpected behavior. ",["textRed","bold"])}`,"","This usually means that your bundler is misconfigured, and is importing the same library multiple times - usually once as an ES Module, and once as a CommonJS module.","","The following libraries have been imported multiple times:",...Array.from(o,([c,l])=>{const p=l.modules.map((f,m)=>f==="esm"?`      ${m+1}. ES Modules`:`      ${m+1}. CommonJS`).join(`
`);return`  • ❌ ${E(c,["bold"])} v${l.version}: 
${p}`}),"","You should configure your bundler to only import one version of each library."];console.log(a.join(`
`)),e.didWarn=!0;return}}function pt(e,t){const r=e.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/),n=t.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/);return!r||!n?e.localeCompare(t):r[1]!==n[1]?Number(r[1])-Number(n[1]):r[2]!==n[2]?Number(r[2])-Number(n[2]):r[3]!==n[3]?Number(r[3])-Number(n[3]):r[4]&&n[4]?r[4].localeCompare(n[4]):r[4]?1:n[4]?-1:0}const te={bold:"1",textBlue:"94",textRed:"31",textGreen:"32",bgRed:"41",textWhite:"97"};function E(e,t=[]){return`\x1B[${t.map(r=>te[r]).join(";")}m${e}\x1B[m`}function Q(e,t,r){return e.has(t)?e.get(t):(e.set(t,r),r)}var Rt="Expected a function",mt=NaN,ee="[object Symbol]",re=/^\s+|\s+$/g,ne=/^[-+]0x[0-9a-f]+$/i,se=/^0b[01]+$/i,ie=/^0o[0-7]+$/i,ae=parseInt,oe=typeof S=="object"&&S&&S.Object===Object&&S,ce=typeof self=="object"&&self&&self.Object===Object&&self,ue=oe||ce||Function("return this")(),le=Object.prototype,he=le.toString,fe=Math.max,de=Math.min,tt=function(){return ue.Date.now()};function ge(e,t,r){var n,s,i,o,a,c,l=0,p=!1,f=!1,m=!0;if(typeof e!="function")throw new TypeError(Rt);t=yt(t)||0,z(r)&&(p=!!r.leading,f="maxWait"in r,i=f?fe(yt(r.maxWait)||0,t):i,m="trailing"in r?!!r.trailing:m);function _(d){var b=n,P=s;return n=s=void 0,l=d,o=e.apply(P,b),o}function x(d){return l=d,a=setTimeout(T,t),p?_(d):o}function N(d){var b=d-c,P=d-l,dt=t-b;return f?de(dt,i-P):dt}function I(d){var b=d-c,P=d-l;return c===void 0||b>=t||b<0||f&&P>=i}function T(){var d=tt();if(I(d))return M(d);a=setTimeout(T,N(d))}function M(d){return a=void 0,m&&n?_(d):(n=s=void 0,o)}function O(){a!==void 0&&clearTimeout(a),l=0,n=c=s=a=void 0}function J(){return a===void 0?o:M(tt())}function k(){var d=tt(),b=I(d);if(n=arguments,s=this,c=d,b){if(a===void 0)return x(c);if(f)return a=setTimeout(T,t),_(c)}return a===void 0&&(a=setTimeout(T,t)),o}return k.cancel=O,k.flush=J,k}function pe(e,t,r){var n=!0,s=!0;if(typeof e!="function")throw new TypeError(Rt);return z(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),ge(e,t,{leading:n,maxWait:t,trailing:s})}function z(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function me(e){return!!e&&typeof e=="object"}function ye(e){return typeof e=="symbol"||me(e)&&he.call(e)==ee}function yt(e){if(typeof e=="number")return e;if(ye(e))return mt;if(z(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=z(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(re,"");var r=se.test(e);return r||ie.test(e)?ae(e.slice(2),r?2:8):ne.test(e)?mt:+e}var _e=pe;const Zr=At(_e);var be=200,at="__lodash_hash_undefined__",Ee=1/0,we="[object Function]",Se="[object GeneratorFunction]",ve=/[\\^$.*+?()[\]{}|]/g,Ce=/^\[object .+?Constructor\]$/,Te=typeof S=="object"&&S&&S.Object===Object&&S,Ae=typeof self=="object"&&self&&self.Object===Object&&self,ot=Te||Ae||Function("return this")();function Re(e,t){var r=e?e.length:0;return!!r&&Ie(e,t,0)>-1}function xe(e,t,r,n){for(var s=e.length,i=r+-1;++i<s;)if(t(e[i],i,e))return i;return-1}function Ie(e,t,r){if(t!==t)return xe(e,Oe,r);for(var n=r-1,s=e.length;++n<s;)if(e[n]===t)return n;return-1}function Oe(e){return e!==e}function ke(e,t){return e.has(t)}function De(e,t){return e==null?void 0:e[t]}function Le(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function xt(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var Pe=Array.prototype,je=Function.prototype,It=Object.prototype,et=ot["__core-js_shared__"],_t=function(){var e=/[^.]+$/.exec(et&&et.keys&&et.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Ot=je.toString,ct=It.hasOwnProperty,Ue=It.toString,$e=RegExp("^"+Ot.call(ct).replace(ve,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Be=Pe.splice,Ne=ut(ot,"Map"),rt=ut(ot,"Set"),$=ut(Object,"create");function R(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Me(){this.__data__=$?$(null):{}}function Ve(e){return this.has(e)&&delete this.__data__[e]}function ze(e){var t=this.__data__;if($){var r=t[e];return r===at?void 0:r}return ct.call(t,e)?t[e]:void 0}function We(e){var t=this.__data__;return $?t[e]!==void 0:ct.call(t,e)}function Fe(e,t){var r=this.__data__;return r[e]=$&&t===void 0?at:t,this}R.prototype.clear=Me;R.prototype.delete=Ve;R.prototype.get=ze;R.prototype.has=We;R.prototype.set=Fe;function D(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ge(){this.__data__=[]}function Ye(e){var t=this.__data__,r=q(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():Be.call(t,r,1),!0}function qe(e){var t=this.__data__,r=q(t,e);return r<0?void 0:t[r][1]}function He(e){return q(this.__data__,e)>-1}function Ke(e,t){var r=this.__data__,n=q(r,e);return n<0?r.push([e,t]):r[n][1]=t,this}D.prototype.clear=Ge;D.prototype.delete=Ye;D.prototype.get=qe;D.prototype.has=He;D.prototype.set=Ke;function L(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Je(){this.__data__={hash:new R,map:new(Ne||D),string:new R}}function Ze(e){return H(this,e).delete(e)}function Xe(e){return H(this,e).get(e)}function Qe(e){return H(this,e).has(e)}function tr(e,t){return H(this,e).set(e,t),this}L.prototype.clear=Je;L.prototype.delete=Ze;L.prototype.get=Xe;L.prototype.has=Qe;L.prototype.set=tr;function W(e){var t=-1,r=e?e.length:0;for(this.__data__=new L;++t<r;)this.add(e[t])}function er(e){return this.__data__.set(e,at),this}function rr(e){return this.__data__.has(e)}W.prototype.add=W.prototype.push=er;W.prototype.has=rr;function q(e,t){for(var r=e.length;r--;)if(lr(e[r][0],t))return r;return-1}function nr(e){if(!kt(e)||or(e))return!1;var t=hr(e)||Le(e)?$e:Ce;return t.test(cr(e))}function sr(e,t,r){var n=-1,s=Re,i=e.length,o=!0,a=[],c=a;if(i>=be){var l=ir(e);if(l)return xt(l);o=!1,s=ke,c=new W}else c=a;t:for(;++n<i;){var p=e[n],f=p;if(p=p!==0?p:0,o&&f===f){for(var m=c.length;m--;)if(c[m]===f)continue t;a.push(p)}else s(c,f,r)||(c!==a&&c.push(f),a.push(p))}return a}var ir=rt&&1/xt(new rt([,-0]))[1]==Ee?function(e){return new rt(e)}:fr;function H(e,t){var r=e.__data__;return ar(t)?r[typeof t=="string"?"string":"hash"]:r.map}function ut(e,t){var r=De(e,t);return nr(r)?r:void 0}function ar(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function or(e){return!!_t&&_t in e}function cr(e){if(e!=null){try{return Ot.call(e)}catch{}try{return e+""}catch{}}return""}function ur(e){return e&&e.length?sr(e):[]}function lr(e,t){return e===t||e!==e&&t!==t}function hr(e){var t=kt(e)?Ue.call(e):"";return t==we||t==Se}function kt(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function fr(){}var dr=ur;const Xr=At(dr);function Dt(e){const t=(...r)=>{try{return e(...r)}catch(n){throw n instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(n,t),n}};return t}const Qr=()=>{},tn={ok(e){return{ok:!0,value:e}},err(e){return{ok:!1,error:e}}};function en(e,t){const r=t&&e&&typeof e=="object"&&t in e?e[t]:e;throw new Error(`Unknown switch case ${r}`)}const gr=Dt((e,t)=>{if(!e)throw new Error(t||"Assertion Error")}),rn=Dt((e,t)=>{if(e==null)throw new Error(t??"value must be defined");return e});function pr(){let e,t;const r=new Promise((n,s)=>{e=n,t=s});return Object.assign(r,{resolve:e,reject:t})}function nn(e){return new Promise(t=>setTimeout(t,e))}async function sn(e,t){return window.fetch(e,{referrerPolicy:"strict-origin-when-cross-origin",...t})}const mr=(e,t)=>{const r=new window.Image(e,t);return r.referrerPolicy="strict-origin-when-cross-origin",r};/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */function yr(e){const t=new Uint8Array(e);if(!t||!(typeof Buffer<"u"&&Buffer.isBuffer(t)||t instanceof Uint8Array)||t.length<16||!(t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71&&t[4]===13&&t[5]===10&&t[6]===26&&t[7]===10))return!1;function n(i,o,a,c,l=1024){if(!o)return-1;o=new RegExp(o,"g");const p=o.source.length,f=new TextDecoder,m=i.length;if(typeof c>"u"&&(c=m),a>=m||c<=0||a>=c)return-1;i=i.subarray(a,c);let _=-1,x=0,N=0,I="";t:for(;x<i.length;){const T=x+l,M=i.subarray(x,T),O=f.decode(M,{stream:!0}),J=I+O;let k,d=-1;for(;(k=o.exec(J))!==null;){d=k.index-I.length,_=N+d;break t}x=T,N+=O.length;const b=d>-1?d+p:O.length-p;I=O.slice(b)}return _>=0&&(_+=a>=0?a:m+a),_}const s=n(t,"IDAT",12);return s>=12?n(t,"acTL",8,s)>=8:!1}const _r=e=>new Uint8Array(e)[3]===44;/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Józef Sokołowski <j.k.sokolowski@gmail.com>
 */function bt(e,t){let r=0;for(;e[t+r];)r+=e[t+r]+1;return r+1}function br(e){return new TextDecoder("ascii").decode(e.slice(0,3))==="GIF"}function Er(e){const t=new Uint8Array(e);let r,n,s=0,i=0;if(!br(e))return!1;for(r=t[10]&128,n=t[10]&7,s+=6,s+=7,s+=r?3*Math.pow(2,n+1):0;i<2&&s<t.length;)switch(t[s]){case 44:i+=1,r=t[s+9]&128,n=t[s+9]&7,s+=10,s+=r?3*Math.pow(2,n+1):0,s+=bt(t,s+1)+1;break;case 33:s+=2,s+=bt(t,s);break;case 59:s=t.length;break;default:s=t.length;break}return i>1}/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */let nt=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(nt=new Int32Array(nt));const wr=(e,t)=>{let r=~~t^-1;for(let n=0;n<e.length;n++)r=nt[(r^e[n])&255]^r>>>8;return r^-1},Et=4,wt=4;class w{static isPng(t,r){return t.getUint8(r+0)===137&&t.getUint8(r+1)===80&&t.getUint8(r+2)===78&&t.getUint8(r+3)===71&&t.getUint8(r+4)===13&&t.getUint8(r+5)===10&&t.getUint8(r+6)===26&&t.getUint8(r+7)===10}static getChunkType(t,r){return[String.fromCharCode(t.getUint8(r)),String.fromCharCode(t.getUint8(r+1)),String.fromCharCode(t.getUint8(r+2)),String.fromCharCode(t.getUint8(r+3))].join("")}static readChunks(t,r=0){const n={};if(!w.isPng(t,r))throw new Error("Not a PNG");for(r+=8;r<=t.buffer.byteLength;){const s=r,i=t.getInt32(r);r+=4;const o=w.getChunkType(t,r);if(o==="IDAT"&&n[o]){r+=i+Et+wt;continue}if(o==="IEND")break;n[o]={start:s,dataOffset:r+4,size:i},r+=i+Et+wt}return n}static parsePhys(t,r){return{ppux:t.getUint32(r),ppuy:t.getUint32(r+4),unit:t.getUint8(r+4)}}static findChunk(t,r){return w.readChunks(t)[r]}static setPhysChunk(t,r=1,n){let s=46,i=0;const o=w.findChunk(t,"pHYs");o&&(s=o.start,i=o.size);const a=w.findChunk(t,"IDAT");a&&(s=a.start,i=0);const c=new ArrayBuffer(21),l=new DataView(c);l.setUint32(0,9),l.setUint8(4,112),l.setUint8(5,72),l.setUint8(6,89),l.setUint8(7,115);const p=2835.5;l.setInt32(8,p*r),l.setInt32(12,p*r),l.setInt8(16,1);const f=new Uint8Array(c.slice(4,17));l.setInt32(17,wr(f));const m=t.buffer.slice(0,s),_=t.buffer.slice(s+i);return new Blob([m,c,_],n)}}/*!
 * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
 */function Sr(e){return!e||e.length<12?!1:e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}function vr(e){const t=new Uint8Array(e);return!Sr(t)||!t||t.length<21?!1:(t[20]>>1&1)===1}const Lt=Object.freeze(["image/svg+xml"]),Pt=Object.freeze(["image/jpeg","image/png","image/webp"]),jt=Object.freeze(["image/gif","image/apng","image/avif"]),Ut=Object.freeze([...Pt,...Lt,...jt]),Cr=Object.freeze(["video/mp4","video/webm","video/quicktime"]),Tr=Object.freeze([...Ut,...Cr]),an=Tr.join(",");class j{static loadVideo(t){return new Promise((r,n)=>{const s=document.createElement("video");s.onloadeddata=()=>r(s),s.onerror=i=>{console.error(i),n(new Error("Could not load video"))},s.crossOrigin="anonymous",s.src=t})}static async getVideoFrameAsDataUrl(t,r=0){const n=pr();let s=!1;const i=()=>{if(!s)if(t.readyState>=t.HAVE_METADATA)s=!0,t.currentTime=r;else return;if(t.readyState>=t.HAVE_CURRENT_DATA){const a=document.createElement("canvas");a.width=t.videoWidth,a.height=t.videoHeight;const c=a.getContext("2d");if(!c)throw new Error("Could not get 2d context");c.drawImage(t,0,0),n.resolve(a.toDataURL())}},o=a=>{console.error(a),n.reject(new Error("Could not get video frame"))};t.addEventListener("loadedmetadata",i),t.addEventListener("loadeddata",i),t.addEventListener("canplay",i),t.addEventListener("seeked",i),t.addEventListener("error",o),t.addEventListener("stalled",o),i();try{return await n}finally{t.removeEventListener("loadedmetadata",i),t.removeEventListener("loadeddata",i),t.removeEventListener("canplay",i),t.removeEventListener("seeked",i),t.removeEventListener("error",o),t.removeEventListener("stalled",o)}}static getImageAndDimensions(t){return new Promise((r,n)=>{const s=mr();s.onload=()=>{let i;s.naturalWidth?i={w:s.naturalWidth,h:s.naturalHeight}:(document.body.appendChild(s),i={w:s.clientWidth,h:s.clientHeight},document.body.removeChild(s)),r({...i,image:s})},s.onerror=i=>{console.error(i),n(new Error("Could not load image"))},s.crossOrigin="anonymous",s.referrerPolicy="strict-origin-when-cross-origin",s.style.visibility="hidden",s.style.position="absolute",s.style.opacity="0",s.style.zIndex="-9999",s.src=t})}static async getVideoSize(t){return j.usingObjectURL(t,async r=>{const n=await j.loadVideo(r);return{w:n.videoWidth,h:n.videoHeight}})}static async getImageSize(t){const{w:r,h:n}=await j.usingObjectURL(t,j.getImageAndDimensions);try{if(t.type==="image/png"){const s=new DataView(await t.arrayBuffer());if(w.isPng(s,0)){const i=w.findChunk(s,"pHYs");if(i){const o=w.parsePhys(s,i.dataOffset);if(o.unit===0&&o.ppux===o.ppuy){const c=Math.max(o.ppux/2834.645669291339,1);return{w:Math.round(r/c),h:Math.round(n/c)}}}}}}catch(s){return console.error(s),{w:r,h:n}}return{w:r,h:n}}static async isAnimated(t){return t.type==="image/gif"?Er(await t.arrayBuffer()):t.type==="image/avif"?_r(await t.arrayBuffer()):t.type==="image/webp"?vr(await t.arrayBuffer()):t.type==="image/apng"?yr(await t.arrayBuffer()):!1}static isAnimatedImageType(t){return jt.includes(t||"")}static isStaticImageType(t){return Pt.includes(t||"")}static isVectorImageType(t){return Lt.includes(t||"")}static isImageType(t){return Ut.includes(t||"")}static async usingObjectURL(t,r){const n=URL.createObjectURL(t);try{return await r(n)}finally{URL.revokeObjectURL(n)}}}function on(e){return e!==void 0}function Ar(){return typeof globalThis<"u"&&globalThis.structuredClone?[globalThis.structuredClone,!0]:typeof global<"u"&&global.structuredClone?[global.structuredClone,!0]:typeof window<"u"&&window.structuredClone?[window.structuredClone,!0]:[e=>e&&JSON.parse(JSON.stringify(e)),!1]}const $t=Ar(),Rr=$t[0];$t[1];const cn=Object.getPrototypeOf(Rr({}));it("@tldraw/utils","3.13.3","esm");function Bt(e){return e&&typeof e=="object"&&"parents"in e}function Nt(e){for(let t=0,r=e.parents.length;t<r;t++)if(e.parents[t].__unsafe__getWithoutCapture(!0),e.parents[t].lastChangedEpoch!==e.parentEpochs[t])return!0;return!1}function F(e,t){if(e.children.remove(t)&&e.children.isEmpty&&Bt(e))for(let r=0,n=e.parents.length;r<n;r++)F(e.parents[r],e)}function lt(e,t){if(e.children.add(t)&&Bt(e))for(let r=0,n=e.parents.length;r<n;r++)lt(e.parents[r],e)}function Mt(e,t){return e===t||Object.is(e,t)||!!(e&&t&&typeof e.equals=="function"&&e.equals(t))}function C(e,t){const r=Symbol.for(`com.tldraw.state/${e}`),n=globalThis;return n[r]??(n[r]=t()),n[r]}const Vt=C("empty_array",()=>Object.freeze([])),St=8;class G{constructor(){u(this,"arraySize",0);u(this,"array",Array(St));u(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(t){if(this.array)return this.array.indexOf(t)!==-1?!1:this.arraySize<St?(this.array[this.arraySize]=t,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(t),!0);if(this.set)return this.set.has(t)?!1:(this.set.add(t),!0);throw new Error("no set or array")}remove(t){if(this.array){const r=this.array.indexOf(t);return r===-1?!1:(this.array[r]=void 0,this.arraySize--,r!==this.arraySize&&(this.array[r]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(t)?(this.set.delete(t),!0):!1;throw new Error("no set or array")}visit(t){if(this.array){for(let r=0;r<this.arraySize;r++){const n=this.array[r];typeof n<"u"&&t(n)}return}if(this.set){this.set.forEach(t);return}throw new Error("no set or array")}*[Symbol.iterator](){if(this.array)for(let t=0;t<this.arraySize;t++){const r=this.array[t];typeof r<"u"&&(yield r)}else if(this.set)yield*this.set;else throw new Error("no set or array")}has(t){return this.array?this.array.indexOf(t)!==-1:this.set.has(t)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const A=Symbol.for("com.tldraw.state/RESET_VALUE");class zt{constructor(t){u(this,"index",0);u(this,"buffer");this.capacity=t,this.buffer=new Array(t)}pushEntry(t,r,n){if(n!==void 0){if(n===A){this.clear();return}this.buffer[this.index]=[t,r,n],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(t){const{index:r,capacity:n,buffer:s}=this;for(let i=0;i<n;i++){const o=(r-1+n-i)%n,a=s[o];if(!a)return A;const[c,l]=a;if(i===0&&t>=l)return[];if(c<=t&&t<l){const p=i+1,f=new Array(p);for(let m=0;m<p;m++)f[m]=s[(o+m)%n][2];return f}}return A}}const v=-1;class xr{constructor(t,r,n){u(this,"_isActivelyListening",!1);u(this,"lastTraversedEpoch",v);u(this,"lastReactedEpoch",v);u(this,"_scheduleCount",0);u(this,"__debug_ancestor_epochs__",null);u(this,"parentSet",new G);u(this,"parentEpochs",[]);u(this,"parents",[]);u(this,"_scheduleEffect");u(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=t,this.runEffect=r,this._scheduleEffect=n==null?void 0:n.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==y()){if(this.parents.length&&!Nt(this)){this.lastReactedEpoch=y();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let t=0,r=this.parents.length;t<r;t++)lt(this.parents[t],this)}detach(){this._isActivelyListening=!1;for(let t=0,r=this.parents.length;t<r;t++)F(this.parents[t],this)}execute(){try{Yt(this);const t=y(),r=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=t,r}finally{qt()}}}const K=C("EffectScheduler",()=>xr);function un(e,t,r){const n=new K(e,t,r);return n.attach(),n.scheduleEffect(),()=>{n.detach()}}function ln(e,t,r){const n=new K(e,t,r);return{scheduler:n,start:s=>{const i=(s==null?void 0:s.force)??!1;n.attach(),i?n.scheduleEffect():n.maybeScheduleEffect()},stop:()=>{n.detach()}}}class Ir{constructor(t){u(this,"initialAtomValues",new Map);this.parent=t}get isRoot(){return this.parent===null}commit(){if(h.globalIsReacting)for(const t of this.initialAtomValues.keys())Ft(t);else this.isRoot?Wt(this.initialAtomValues.keys()):this.initialAtomValues.forEach((t,r)=>{this.parent.initialAtomValues.has(r)||this.parent.initialAtomValues.set(r,t)})}abort(){h.globalEpoch++,this.initialAtomValues.forEach((t,r)=>{var n;r.set(t),(n=r.historyBuffer)==null||n.clear()}),this.commit()}}const h=C("transactions",()=>({globalEpoch:v+1,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:v+1}));function Or(){return h.reactionEpoch}function y(){return h.globalEpoch}function kr(){return h.globalIsReacting}function ht(e,t){t.lastTraversedEpoch!==h.globalEpoch&&(t.lastTraversedEpoch=h.globalEpoch,t instanceof K?e.add(t):t.children.visit(r=>ht(e,r)))}function Wt(e){var r;if(h.globalIsReacting)throw new Error("flushChanges cannot be called during a reaction");const t=h.currentTransaction;try{h.currentTransaction=null,h.globalIsReacting=!0,h.reactionEpoch=h.globalEpoch;const n=new Set;for(const i of e)i.children.visit(o=>ht(n,o));for(const i of n)i.maybeScheduleEffect();let s=0;for(;(r=h.cleanupReactors)!=null&&r.size;){if(s++>1e3)throw new Error("Reaction update depth limit exceeded");const i=h.cleanupReactors;h.cleanupReactors=null;for(const o of i)o.maybeScheduleEffect()}}finally{h.cleanupReactors=null,h.globalIsReacting=!1,h.currentTransaction=t}}function Dr(e,t){h.currentTransaction?h.currentTransaction.initialAtomValues.has(e)||h.currentTransaction.initialAtomValues.set(e,t):h.globalIsReacting?Ft(e):Wt([e])}function Ft(e){const t=h.cleanupReactors??(h.cleanupReactors=new Set);e.children.visit(r=>ht(t,r))}function Lr(){h.globalEpoch++}function Pr(e){const t=new Ir(h.currentTransaction);h.currentTransaction=t;try{let r,n=!1;try{r=e(()=>n=!0)}catch(s){throw t.abort(),s}return n?t.abort():t.commit(),r}finally{h.currentTransaction=h.currentTransaction.parent}}function hn(e){return h.currentTransaction?e():Pr(e)}let vt=!1;function jr(){vt||(vt=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const U=Symbol.for("com.tldraw.state/UNINITIALIZED");function fn(e){return e===U}const st=C("WithDiff",()=>class{constructor(t,r){this.value=t,this.diff=r}});function gn(e,t){return new st(e,t)}class Ur{constructor(t,r,n){u(this,"lastChangedEpoch",v);u(this,"lastTraversedEpoch",v);u(this,"__debug_ancestor_epochs__",null);u(this,"lastCheckedEpoch",v);u(this,"parentSet",new G);u(this,"parents",[]);u(this,"parentEpochs",[]);u(this,"children",new G);u(this,"historyBuffer");u(this,"state",U);u(this,"error",null);u(this,"computeDiff");u(this,"isEqual");this.name=t,this.derive=r,n!=null&&n.historyLength&&(this.historyBuffer=new zt(n.historyLength)),this.computeDiff=n==null?void 0:n.computeDiff,this.isEqual=(n==null?void 0:n.isEqual)??Mt}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(t){var s;const r=this.lastChangedEpoch===v,n=y();if(!r&&(this.lastCheckedEpoch===n||this.isActivelyListening&&kr()&&this.lastTraversedEpoch<Or()||!Nt(this)))if(this.lastCheckedEpoch=n,this.error){if(t)return this.state;throw this.error.thrownValue}else return this.state;try{Yt(this);const i=this.derive(this.state,this.lastCheckedEpoch),o=i instanceof st?i.value:i,a=this.state===U;if(a||!this.isEqual(o,this.state)){if(this.historyBuffer&&!a){const c=i instanceof st?i.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,y(),c??((s=this.computeDiff)==null?void 0:s.call(this,this.state,o,this.lastCheckedEpoch,y()))??A)}this.lastChangedEpoch=y(),this.state=o}return this.error=null,this.lastCheckedEpoch=y(),this.state}catch(i){if(this.state!==U&&(this.state=U,this.lastChangedEpoch=y()),this.lastCheckedEpoch=y(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:i},!t)throw i;return this.state}finally{qt()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{Y(this)}}getDiffSince(t){var r;return this.__unsafe__getWithoutCapture(!0),Y(this),t>=this.lastChangedEpoch?Vt:((r=this.historyBuffer)==null?void 0:r.getChangesSince(t))??A}}const B=C("Computed",()=>Ur);function $r(e={},t,r,n){const s=n.value,i=Symbol.for("__@tldraw/state__computed__"+r);return n.value=function(){let o=this[i];return o||(o=new B(r,s.bind(this),e),Object.defineProperty(this,i,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},n.value[Gt]=!0,n}function Br(e={},t,r,n){const s=n.get,i=Symbol.for("__@tldraw/state__computed__"+r);return n.get=function(){let o=this[i];return o||(o=new B(r,s.bind(this),e),Object.defineProperty(this,i,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},n}function Nr(e,t,r){gr(r.kind==="method","@computed can only be used on methods");const n=Symbol.for("__@tldraw/state__computed__"+String(r.name)),s=function(){let i=this[n];return i||(i=new B(String(r.name),t.bind(this),e),Object.defineProperty(this,n,{enumerable:!1,configurable:!1,writable:!1,value:i})),i.get()};return s[Gt]=!0,s}function Ct(e={},t){if(t.length===2){const[r,n]=t;return Nr(e,r,n)}else{const[r,n,s]=t;return s.get?(jr(),Br(e,r,n,s)):$r(e,r,n,s)}}const Gt="@@__isComputedMethod__@@";function pn(){if(arguments.length===1){const e=arguments[0];return(...t)=>Ct(e,t)}else return typeof arguments[0]=="string"?new B(arguments[0],arguments[1],arguments[2]):Ct(void 0,arguments)}function ft(e){return e&&e instanceof B}class Mr{constructor(t,r){u(this,"offset",0);u(this,"maybeRemoved");this.below=t,this.child=r}}const g=C("capture",()=>({stack:null}));function mn(e){const t=g.stack;g.stack=null;try{return e()}finally{g.stack=t}}function Yt(e){if(g.stack=new Mr(g.stack,e),e.__debug_ancestor_epochs__){const t=e.__debug_ancestor_epochs__;e.__debug_ancestor_epochs__=null;for(const r of e.parents)r.__unsafe__getWithoutCapture(!0);Vr(e,t)}e.parentSet.clear()}function qt(){const e=g.stack;if(g.stack=e.below,e.offset<e.child.parents.length){for(let t=e.offset;t<e.child.parents.length;t++){const r=e.child.parents[t];e.child.parentSet.has(r)||F(r,e.child)}e.child.parents.length=e.offset,e.child.parentEpochs.length=e.offset}if(e.maybeRemoved)for(let t=0;t<e.maybeRemoved.length;t++){const r=e.maybeRemoved[t];e.child.parentSet.has(r)||F(r,e.child)}e.child.__debug_ancestor_epochs__&&Ht(e.child,e.child.__debug_ancestor_epochs__)}function Y(e){if(g.stack){if(g.stack.child.parentSet.has(e))return;if(g.stack.child.parentSet.add(e),g.stack.child.isActivelyListening&&lt(e,g.stack.child),g.stack.offset<g.stack.child.parents.length){const r=g.stack.child.parents[g.stack.offset];r!==e&&(g.stack.maybeRemoved?g.stack.maybeRemoved.push(r):g.stack.maybeRemoved=[r])}g.stack.child.parents[g.stack.offset]=e,g.stack.child.parentEpochs[g.stack.offset]=e.lastChangedEpoch,g.stack.offset++}}function Ht(e,t){for(let r=0;r<e.parents.length;r++){const n=e.parents[r],s=e.parentEpochs[r];t.set(n,s),ft(n)&&Ht(n,t)}return t}function Kt(e,t){const r={};for(let n=0;n<e.parents.length;n++){const s=e.parents[n];if(!t.has(s))continue;const i=t.get(s);s.lastChangedEpoch!==i&&(ft(s)?r[s.name]=Kt(s,t):r[s.name]=null)}return r}function Vr(e,t){const r=Kt(e,t);if(Object.keys(r).length===0){console.log(`Effect(${e.name}) was executed manually.`);return}let n=ft(e)?`Computed(${e.name}) is recomputing because:`:`Effect(${e.name}) is executing because:`;function s(i,o){const a=`
`+" ".repeat(o)+"↳ ";for(const[c,l]of Object.entries(i))l?(n+=`${a}Computed(${c}) changed`,s(l,o+2)):n+=`${a}Atom(${c}) changed`}s(r,1),console.log(n)}class zr{constructor(t,r,n){u(this,"isEqual");u(this,"computeDiff");u(this,"lastChangedEpoch",y());u(this,"children",new G);u(this,"historyBuffer");this.name=t,this.current=r,this.isEqual=(n==null?void 0:n.isEqual)??null,n&&(n.historyLength&&(this.historyBuffer=new zt(n.historyLength)),this.computeDiff=n.computeDiff)}__unsafe__getWithoutCapture(t){return this.current}get(){return Y(this),this.current}set(t,r){var s,i;if(((s=this.isEqual)==null?void 0:s.call(this,this.current,t))??Mt(this.current,t))return this.current;Lr(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,y(),r??((i=this.computeDiff)==null?void 0:i.call(this,this.current,t,this.lastChangedEpoch,y()))??A),this.lastChangedEpoch=y();const n=this.current;return this.current=t,Dr(this,n),t}update(t){return this.set(t(this.current))}getDiffSince(t){var r;return Y(this),t>=this.lastChangedEpoch?Vt:((r=this.historyBuffer)==null?void 0:r.getChangesSince(t))??A}}const Wr=C("Atom",()=>zr);function yn(e,t,r){return new Wr(e,t,r)}const Jt=1,Fr=C("apiVersion",()=>Jt);if(Fr!==Jt)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");it("@tldraw/state","3.13.3","esm");function Gr(e,t,r=[]){const n=V.useRef(t);n.current=t;const[s,i,o]=V.useMemo(()=>{let a=null;const c=f=>(a=f,()=>{a=null}),l=new K(`useStateTracking(${e})`,()=>{var f;return(f=n.current)==null?void 0:f.call(n)},{scheduleEffect(){a==null||a()}});return[l,c,()=>l.scheduleCount]},[e,...r]);return V.useSyncExternalStore(i,o,o),V.useEffect(()=>(s.attach(),s.maybeScheduleEffect(),()=>{s.detach()}),[s]),s.execute()}const Tt={apply(e,t,r){return Gr(e.displayName??e.name??"tracked(???)",()=>e.apply(t,r))}},Yr=Symbol.for("react.memo"),qr=Symbol.for("react.forward_ref");function _n(e){let t=null;const r=e.$$typeof;return r===Yr&&(e=e.type,t=e.compare),r===qr?Z.memo(Z.forwardRef(new Proxy(e.render,Tt))):Z.memo(new Proxy(e,Tt),t)}it("@tldraw/state-react","3.13.3","esm");export{an as D,K as E,mr as I,j as M,w as P,A as R,cn as S,U,Xr as _,yn as a,hn as b,pn as c,gr as d,Vt as e,sn as f,en as g,it as h,fn as i,rn as j,Zr as k,nn as l,mn as m,Qr as n,tn as o,pr as p,on as q,un as r,Rr as s,_n as t,Gr as u,ln as v,gn as w};
