var ht=s=>{throw TypeError(s)};var pt=(s,e,u)=>e.has(s)||ht("Cannot "+u);var L=(s,e,u)=>(pt(s,e,"read from private field"),u?u.call(s):e.get(s)),B=(s,e,u)=>e.has(s)?ht("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,u),N=(s,e,u,h)=>(pt(s,e,"write to private field"),h?h.call(s,u):e.set(s,u),u);import{R as Kt,z as Nt,A as Ct,w as Ut}from"./chunk_utils.CSiPn6yw.js";/* empty css                       */import{j as z,c as Ft}from"./chunk_client.CotzxIPX.js";import{a as zt,b as $}from"./chunk_assert.pxkjFBOg.js";import{b as Lt}from"./chunk_DebugSvg.Bt0G2Qkn.js";import{a as Bt,s as Qt}from"./chunk_useResizeObserver.DnDEPOOq.js";import{g as qt,s as Zt}from"./chunk_storage.BtxlEzFH.js";import{V as O,S as x,R as dt,a as Ht}from"./chunk_Vector2.BFoa__dl.js";import{r as H,m as C}from"./chunk_signia.CS1dw6KR.js";import{I as Gt}from"./chunk_Ids.gQRklNmK.js";import{b as Jt,t as J}from"./chunk_index.BVMwOSmr.js";import{c as W,S as Wt,a as Xt}from"./chunk_index.wcXEbXm_.js";import{r as U,R as Yt}from"./chunk_index.C5eOxiyT.js";import"./chunk_DebugDraw.CrSpCKoE.js";import"./chunk_AABB.CekZtYjv.js";import"./chunk_useMergedRefs.MPIvL6fk.js";import"./chunk_svgPathBuilder.tqI_yD_n.js";import"./chunk_ResizeObserver.C8OzoCMD.js";import"./chunk_RingBuffer.ClstRnzI.js";import"./chunk__commonjsHelpers.Cpj98o6Y.js";let vt,gt;function te(){function s(a,i){return function(l){(function(p,t){if(p.v)throw Error("attempted to call addInitializer after decoration was finished")})(i),h(l,"An initializer"),a.push(l)}}function e(a,i){if(!a(i))throw new TypeError("Attempted to access private element on non-instance")}function u(a,i,l,p,t,m,d,b,P){var r;switch(t){case 1:r="accessor";break;case 2:r="method";break;case 3:r="getter";break;case 4:r="setter";break;default:r="field"}var o,v,n={kind:r,name:d?"#"+i:ee(i),static:m,private:d},g={v:!1};if(t!==0&&(n.addInitializer=s(p,g)),d||t!==0&&t!==2)if(t===2)o=function(c){return e(P,c),l.value};else{var f=t===0||t===1;(f||t===3)&&(o=d?function(c){return e(P,c),l.get.call(c)}:function(c){return l.get.call(c)}),(f||t===4)&&(v=d?function(c,y){e(P,c),l.set.call(c,y)}:function(c,y){l.set.call(c,y)})}else o=function(c){return c[i]},t===0&&(v=function(c,y){c[i]=y});var w=d?P.bind():function(c){return i in c};n.access=o&&v?{get:o,set:v,has:w}:o?{get:o,has:w}:{set:v,has:w};try{return a(b,n)}finally{g.v=!0}}function h(a,i){if(typeof a!="function")throw new TypeError(i+" must be a function")}function j(a,i){var l=typeof i;if(a===1){if(l!=="object"||i===null)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");i.get!==void 0&&h(i.get,"accessor.get"),i.set!==void 0&&h(i.set,"accessor.set"),i.init!==void 0&&h(i.init,"accessor.init")}else if(l!=="function")throw new TypeError((a===0?"field":a===10?"class":"method")+" decorators must return a function or void 0")}function V(a){return function(i){a(this,i)}}function R(a,i,l,p,t,m,d,b,P){var r,o,v,n,g,f,w,c,y=l[0];if(d?(t===0||t===1?(r={get:(g=l[3],function(){return g(this)}),set:V(l[4])},v="get"):t===3?(r={get:l[3]},v="get"):t===4?(r={set:l[3]},v="set"):r={value:l[3]},t!==0&&(t===1&&yt(r.set,"#"+p,"set"),yt(r[v||"value"],"#"+p,v))):t!==0&&(r=Object.getOwnPropertyDescriptor(i,p)),t===1?n={get:r.get,set:r.set}:t===2?n=r.value:t===3?n=r.get:t===4&&(n=r.set),typeof y=="function")(f=u(y,p,r,b,t,m,d,n,P))!==void 0&&(j(t,f),t===0?o=f:t===1?(o=f.init,w=f.get||n.get,c=f.set||n.set,n={get:w,set:c}):n=f);else for(var k=y.length-1;k>=0;k--){var I;(f=u(y[k],p,r,b,t,m,d,n,P))!==void 0&&(j(t,f),t===0?I=f:t===1?(I=f.init,w=f.get||n.get,c=f.set||n.set,n={get:w,set:c}):n=f,I!==void 0&&(o===void 0?o=I:typeof o=="function"?o=[o,I]:o.push(I)))}if(t===0||t===1){if(o===void 0)o=function(E,S){return S};else if(typeof o!="function"){var A=o;o=function(E,S){for(var D=S,T=0;T<A.length;T++)D=A[T].call(E,D);return D}}else{var K=o;o=function(E,S){return K.call(E,S)}}a.push(o)}t!==0&&(t===1?(r.get=n.get,r.set=n.set):t===2?r.value=n:t===3?r.get=n:t===4&&(r.set=n),d?t===1?(a.push(function(E,S){return n.get.call(E,S)}),a.push(function(E,S){return n.set.call(E,S)})):t===2?a.push(n):a.push(function(E,S){return n.call(E,S)}):Object.defineProperty(i,p,r))}function _(a,i,l){for(var p,t,m,d=[],b=new Map,P=new Map,r=0;r<i.length;r++){var o=i[r];if(Array.isArray(o)){var v,n,g=o[1],f=o[2],w=o.length>3,c=g>=5,y=l;if(c?(v=a,(g-=5)!=0&&(n=t=t||[]),w&&!m&&(m=function(A){return ne(A)===a}),y=m):(v=a.prototype,g!==0&&(n=p=p||[])),g!==0&&!w){var k=c?P:b,I=k.get(f)||0;if(I===!0||I===3&&g!==4||I===4&&g!==3)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+f);!I&&g>2?k.set(f,g):k.set(f,!0)}R(d,v,o,f,g,c,w,n,y)}}return M(d,p),M(d,t),d}function M(a,i){i&&a.push(function(l){for(var p=0;p<i.length;p++)i[p].call(l);return l})}return function(a,i,l,p){return{e:_(a,i,p),get c(){return function(t,m){if(m.length>0){for(var d=[],b=t,P=t.name,r=m.length-1;r>=0;r--){var o={v:!1};try{var v=m[r](b,{kind:"class",name:P,addInitializer:s(d,o)})}finally{o.v=!0}v!==void 0&&(j(10,v),b=v)}return[b,function(){for(var n=0;n<d.length;n++)d[n].call(b)}]}}(a,l)}}}}function Dt(s,e,u,h){return(Dt=te())(s,e,u,h)}function ee(s){var e=re(s,"string");return typeof e=="symbol"?e:e+""}function re(s,e){if(typeof s!="object"||!s)return s;var u=s[Symbol.toPrimitive];if(u!==void 0){var h=u.call(s,e);if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}function yt(s,e,u){typeof e=="symbol"&&(e=(e=e.description)?"["+e+"]":"");try{Object.defineProperty(s,"name",{configurable:!0,value:u?u+" "+e:e})}catch{}return s}function ne(s){if(Object(s)!==s)throw TypeError("right-hand side of 'in' should be an object, got "+(s!==null?typeof s:"null"));return s}var Q;const ct=class ct{constructor(e){B(this,Q,(vt(this),gt(this,O.ZERO)));this.splat=e}get screenSize(){return L(this,Q)}set screenSize(e){N(this,Q,e)}get pan(){return this.splat.location.position}set pan(e){this.splat.updateLocation({position:e})}get zoom(){return this.splat.location.zoom}set zoom(e){this.splat.updateLocation({zoom:e})}};Q=new WeakMap,[gt,vt]=Dt(ct,[[H,1,"screenSize"]],[]).e;let et=ct,mt,wt;function ie(){function s(a,i){return function(l){(function(p,t){if(p.v)throw Error("attempted to call addInitializer after decoration was finished")})(i),h(l,"An initializer"),a.push(l)}}function e(a,i){if(!a(i))throw new TypeError("Attempted to access private element on non-instance")}function u(a,i,l,p,t,m,d,b,P){var r;switch(t){case 1:r="accessor";break;case 2:r="method";break;case 3:r="getter";break;case 4:r="setter";break;default:r="field"}var o,v,n={kind:r,name:d?"#"+i:oe(i),static:m,private:d},g={v:!1};if(t!==0&&(n.addInitializer=s(p,g)),d||t!==0&&t!==2)if(t===2)o=function(c){return e(P,c),l.value};else{var f=t===0||t===1;(f||t===3)&&(o=d?function(c){return e(P,c),l.get.call(c)}:function(c){return l.get.call(c)}),(f||t===4)&&(v=d?function(c,y){e(P,c),l.set.call(c,y)}:function(c,y){l.set.call(c,y)})}else o=function(c){return c[i]},t===0&&(v=function(c,y){c[i]=y});var w=d?P.bind():function(c){return i in c};n.access=o&&v?{get:o,set:v,has:w}:o?{get:o,has:w}:{set:v,has:w};try{return a(b,n)}finally{g.v=!0}}function h(a,i){if(typeof a!="function")throw new TypeError(i+" must be a function")}function j(a,i){var l=typeof i;if(a===1){if(l!=="object"||i===null)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");i.get!==void 0&&h(i.get,"accessor.get"),i.set!==void 0&&h(i.set,"accessor.set"),i.init!==void 0&&h(i.init,"accessor.init")}else if(l!=="function")throw new TypeError((a===0?"field":a===10?"class":"method")+" decorators must return a function or void 0")}function V(a){return function(i){a(this,i)}}function R(a,i,l,p,t,m,d,b,P){var r,o,v,n,g,f,w,c,y=l[0];if(d?(t===0||t===1?(r={get:(g=l[3],function(){return g(this)}),set:V(l[4])},v="get"):t===3?(r={get:l[3]},v="get"):t===4?(r={set:l[3]},v="set"):r={value:l[3]},t!==0&&(t===1&&bt(r.set,"#"+p,"set"),bt(r[v||"value"],"#"+p,v))):t!==0&&(r=Object.getOwnPropertyDescriptor(i,p)),t===1?n={get:r.get,set:r.set}:t===2?n=r.value:t===3?n=r.get:t===4&&(n=r.set),typeof y=="function")(f=u(y,p,r,b,t,m,d,n,P))!==void 0&&(j(t,f),t===0?o=f:t===1?(o=f.init,w=f.get||n.get,c=f.set||n.set,n={get:w,set:c}):n=f);else for(var k=y.length-1;k>=0;k--){var I;(f=u(y[k],p,r,b,t,m,d,n,P))!==void 0&&(j(t,f),t===0?I=f:t===1?(I=f.init,w=f.get||n.get,c=f.set||n.set,n={get:w,set:c}):n=f,I!==void 0&&(o===void 0?o=I:typeof o=="function"?o=[o,I]:o.push(I)))}if(t===0||t===1){if(o===void 0)o=function(E,S){return S};else if(typeof o!="function"){var A=o;o=function(E,S){for(var D=S,T=0;T<A.length;T++)D=A[T].call(E,D);return D}}else{var K=o;o=function(E,S){return K.call(E,S)}}a.push(o)}t!==0&&(t===1?(r.get=n.get,r.set=n.set):t===2?r.value=n:t===3?r.get=n:t===4&&(r.set=n),d?t===1?(a.push(function(E,S){return n.get.call(E,S)}),a.push(function(E,S){return n.set.call(E,S)})):t===2?a.push(n):a.push(function(E,S){return n.call(E,S)}):Object.defineProperty(i,p,r))}function _(a,i,l){for(var p,t,m,d=[],b=new Map,P=new Map,r=0;r<i.length;r++){var o=i[r];if(Array.isArray(o)){var v,n,g=o[1],f=o[2],w=o.length>3,c=g>=5,y=l;if(c?(v=a,(g-=5)!=0&&(n=t=t||[]),w&&!m&&(m=function(A){return ae(A)===a}),y=m):(v=a.prototype,g!==0&&(n=p=p||[])),g!==0&&!w){var k=c?P:b,I=k.get(f)||0;if(I===!0||I===3&&g!==4||I===4&&g!==3)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+f);!I&&g>2?k.set(f,g):k.set(f,!0)}R(d,v,o,f,g,c,w,n,y)}}return M(d,p),M(d,t),d}function M(a,i){i&&a.push(function(l){for(var p=0;p<i.length;p++)i[p].call(l);return l})}return function(a,i,l,p){return{e:_(a,i,p),get c(){return function(t,m){if(m.length>0){for(var d=[],b=t,P=t.name,r=m.length-1;r>=0;r--){var o={v:!1};try{var v=m[r](b,{kind:"class",name:P,addInitializer:s(d,o)})}finally{o.v=!0}v!==void 0&&(j(10,v),b=v)}return[b,function(){for(var n=0;n<d.length;n++)d[n].call(b)}]}}(a,l)}}}}function Tt(s,e,u,h){return(Tt=ie())(s,e,u,h)}function oe(s){var e=se(s,"string");return typeof e=="symbol"?e:e+""}function se(s,e){if(typeof s!="object"||!s)return s;var u=s[Symbol.toPrimitive];if(u!==void 0){var h=u.call(s,e);if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}function bt(s,e,u){typeof e=="symbol"&&(e=(e=e.description)?"["+e+"]":"");try{Object.defineProperty(s,"name",{configurable:!0,value:u?u+" "+e:e})}catch{}return s}function ae(s){if(Object(s)!==s)throw TypeError("right-hand side of 'in' should be an object, got "+(s!==null?typeof s:"null"));return s}class Vt{constructor(e){this.parent=e,this.splat=e.splat}toDebugString(){return this.child?`${this.name}.${this.child.toDebugString()}`:this.name}}var F;const ut=class ut{constructor(e){B(this,F);this.splat=e,N(this,F,(mt(this),wt(this,new xt(this)))),this.onPointerDown=u=>{var h,j;(j=(h=this.child).onPointerDown)==null||j.call(h,u)},this.onPointerMove=u=>{var h,j;(j=(h=this.child).onPointerMove)==null||j.call(h,u)},this.onPointerUp=u=>{var h,j;(j=(h=this.child).onPointerUp)==null||j.call(h,u)},this.onPointerCancel=u=>{var h,j;(j=(h=this.child).onPointerCancel)==null||j.call(h,u)}}get child(){return L(this,F)}set child(e){N(this,F,e)}toDebugString(){return`root.${this.child.toDebugString()}`}};F=new WeakMap,[wt,mt]=Tt(ut,[[H,1,"child"]],[]).e;let rt=ut;class xt extends Vt{constructor(){super(...arguments),this.name="idle"}onPointerDown(e){const{activeKeyPoint:u,firstShape:h}=this.splat,j=this.splat.getShapeVersion(h.id,u.id),V=this.splat.history.mark();this.splat.update({...j,rawPoints:[O.fromEvent(e)]}),this.parent.child=new ce(this.parent,j.id,V)}}class ce extends Vt{constructor(e,u,h){super(e),this.shapeVersionId=u,this.mark=h,this.name="draw"}onPointerMove(e){console.log("onPointerMove",O.fromEvent(e).toString()),this.splat.updateById(this.shapeVersionId,u=>({...u,rawPoints:[...u.rawPoints,O.fromEvent(e)]}))}onPointerUp(e){this.parent.child=new xt(this.parent)}onPointerCancel(e){this.splat.history.bailToMark(this.mark)}}let Pt,It,St;function ue(){function s(a,i){return function(l){(function(p,t){if(p.v)throw Error("attempted to call addInitializer after decoration was finished")})(i),h(l,"An initializer"),a.push(l)}}function e(a,i){if(!a(i))throw new TypeError("Attempted to access private element on non-instance")}function u(a,i,l,p,t,m,d,b,P){var r;switch(t){case 1:r="accessor";break;case 2:r="method";break;case 3:r="getter";break;case 4:r="setter";break;default:r="field"}var o,v,n={kind:r,name:d?"#"+i:le(i),static:m,private:d},g={v:!1};if(t!==0&&(n.addInitializer=s(p,g)),d||t!==0&&t!==2)if(t===2)o=function(c){return e(P,c),l.value};else{var f=t===0||t===1;(f||t===3)&&(o=d?function(c){return e(P,c),l.get.call(c)}:function(c){return l.get.call(c)}),(f||t===4)&&(v=d?function(c,y){e(P,c),l.set.call(c,y)}:function(c,y){l.set.call(c,y)})}else o=function(c){return c[i]},t===0&&(v=function(c,y){c[i]=y});var w=d?P.bind():function(c){return i in c};n.access=o&&v?{get:o,set:v,has:w}:o?{get:o,has:w}:{set:v,has:w};try{return a(b,n)}finally{g.v=!0}}function h(a,i){if(typeof a!="function")throw new TypeError(i+" must be a function")}function j(a,i){var l=typeof i;if(a===1){if(l!=="object"||i===null)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");i.get!==void 0&&h(i.get,"accessor.get"),i.set!==void 0&&h(i.set,"accessor.set"),i.init!==void 0&&h(i.init,"accessor.init")}else if(l!=="function")throw new TypeError((a===0?"field":a===10?"class":"method")+" decorators must return a function or void 0")}function V(a){return function(i){a(this,i)}}function R(a,i,l,p,t,m,d,b,P){var r,o,v,n,g,f,w,c,y=l[0];if(d?(t===0||t===1?(r={get:(g=l[3],function(){return g(this)}),set:V(l[4])},v="get"):t===3?(r={get:l[3]},v="get"):t===4?(r={set:l[3]},v="set"):r={value:l[3]},t!==0&&(t===1&&Et(r.set,"#"+p,"set"),Et(r[v||"value"],"#"+p,v))):t!==0&&(r=Object.getOwnPropertyDescriptor(i,p)),t===1?n={get:r.get,set:r.set}:t===2?n=r.value:t===3?n=r.get:t===4&&(n=r.set),typeof y=="function")(f=u(y,p,r,b,t,m,d,n,P))!==void 0&&(j(t,f),t===0?o=f:t===1?(o=f.init,w=f.get||n.get,c=f.set||n.set,n={get:w,set:c}):n=f);else for(var k=y.length-1;k>=0;k--){var I;(f=u(y[k],p,r,b,t,m,d,n,P))!==void 0&&(j(t,f),t===0?I=f:t===1?(I=f.init,w=f.get||n.get,c=f.set||n.set,n={get:w,set:c}):n=f,I!==void 0&&(o===void 0?o=I:typeof o=="function"?o=[o,I]:o.push(I)))}if(t===0||t===1){if(o===void 0)o=function(E,S){return S};else if(typeof o!="function"){var A=o;o=function(E,S){for(var D=S,T=0;T<A.length;T++)D=A[T].call(E,D);return D}}else{var K=o;o=function(E,S){return K.call(E,S)}}a.push(o)}t!==0&&(t===1?(r.get=n.get,r.set=n.set):t===2?r.value=n:t===3?r.get=n:t===4&&(r.set=n),d?t===1?(a.push(function(E,S){return n.get.call(E,S)}),a.push(function(E,S){return n.set.call(E,S)})):t===2?a.push(n):a.push(function(E,S){return n.call(E,S)}):Object.defineProperty(i,p,r))}function _(a,i,l){for(var p,t,m,d=[],b=new Map,P=new Map,r=0;r<i.length;r++){var o=i[r];if(Array.isArray(o)){var v,n,g=o[1],f=o[2],w=o.length>3,c=g>=5,y=l;if(c?(v=a,(g-=5)!=0&&(n=t=t||[]),w&&!m&&(m=function(A){return he(A)===a}),y=m):(v=a.prototype,g!==0&&(n=p=p||[])),g!==0&&!w){var k=c?P:b,I=k.get(f)||0;if(I===!0||I===3&&g!==4||I===4&&g!==3)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+f);!I&&g>2?k.set(f,g):k.set(f,!0)}R(d,v,o,f,g,c,w,n,y)}}return M(d,p),M(d,t),d}function M(a,i){i&&a.push(function(l){for(var p=0;p<i.length;p++)i[p].call(l);return l})}return function(a,i,l,p){return{e:_(a,i,p),get c(){return function(t,m){if(m.length>0){for(var d=[],b=t,P=t.name,r=m.length-1;r>=0;r--){var o={v:!1};try{var v=m[r](b,{kind:"class",name:P,addInitializer:s(d,o)})}finally{o.v=!0}v!==void 0&&(j(10,v),b=v)}return[b,function(){for(var n=0;n<d.length;n++)d[n].call(b)}]}}(a,l)}}}}function Mt(s,e,u,h){return(Mt=ue())(s,e,u,h)}function le(s){var e=fe(s,"string");return typeof e=="symbol"?e:e+""}function fe(s,e){if(typeof s!="object"||!s)return s;var u=s[Symbol.toPrimitive];if(u!==void 0){var h=u.call(s,e);if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}function Et(s,e,u){typeof e=="symbol"&&(e=(e=e.description)?"["+e+"]":"");try{Object.defineProperty(s,"name",{configurable:!0,value:u?u+" "+e:e})}catch{}return s}function he(s){if(Object(s)!==s)throw TypeError("right-hand side of 'in' should be an object, got "+(s!==null?typeof s:"null"));return s}const pe=new Gt("undo");var q,Z;const lt=class lt{constructor(e){B(this,q,(Pt(this),It(this,[])));B(this,Z,St(this,[]));this.splat=e}get undos(){return L(this,q)}set undos(e){N(this,q,e)}get redos(){return L(this,Z)}set redos(e){N(this,Z,e)}get canUndo(){return this.undos.length>0}get canRedo(){return this.redos.length>0}restore(e){Jt(()=>{this.splat.store.clear(),this.splat.store.put(Kt(e.store)),this.splat.ensureStoreIsUsable()})}mark(){const e={id:pe.generate(),store:this.splat.store.serialize()};return this.undos=[e,...this.undos],this.redos=[],e.id}undo(){if(this.canUndo){const[e,...u]=this.undos;this.undos=u,this.redos=[e,...this.redos],this.restore(e)}}redo(){if(this.canRedo){const[e,...u]=this.redos;this.redos=u,this.undos=[e,...this.undos],this.restore(e)}}bailToMark(e){const u=this.undos[0];zt(u.id===e,"Assertion Error: lastUndo.id === mark"),this.undos=this.undos.slice(0,-1),this.restore(u)}};q=new WeakMap,Z=new WeakMap,[It,St,Pt]=Mt(lt,[[H,1,"undos"],[H,1,"redos"]],[]).e;let nt=lt;function X(s){const e=new RegExp(`^${s}\\:([a-zA-Z0-9_]+)$`),u=h=>e.test(h)?dt.ok(h):dt.error(new Ht(`Expected ${s}.*, got ${h}`,[]));return x.string.transform(u,u,Nt)}const Y=x.object({typeName:x.value("keyPoint"),id:X("keyPoint"),position:O.schema.nullable()}),it=W("keyPoint",{scope:"document",validator:Y.asValidator()}),st=x.object({typeName:x.value("shape"),id:X("shape")}),ot=W("shape",{scope:"document",validator:st.asValidator()}),Rt=x.object({typeName:x.value("shapeVersion"),id:X("shapeVersion"),keyPointId:Y.config.id,shapeId:st.config.id,rawPoints:x.arrayOf(O.schema)}),_t=W("shapeVersion",{scope:"document",validator:Rt.asValidator()}),$t=x.object({typeName:x.value("location"),id:X("location"),position:O.schema,zoom:x.number,activeKeyPointId:Y.config.id}),at=W("location",{scope:"session",validator:$t.asValidator()}),tt=at.createId("location"),de=x.union("typeName",{keyPoint:Y,shape:st,shapeVersion:Rt,location:$t}),ve=Wt.create({keyPoint:it,shape:ot,shapeVersion:_t,location:at}),jt=x.objectMap(x.string,de);class ge extends Xt{constructor(e){super({schema:ve,props:{},initialData:e})}}let kt;function ye(){function s(a,i){return function(l){(function(p,t){if(p.v)throw Error("attempted to call addInitializer after decoration was finished")})(i),h(l,"An initializer"),a.push(l)}}function e(a,i){if(!a(i))throw new TypeError("Attempted to access private element on non-instance")}function u(a,i,l,p,t,m,d,b,P){var r;switch(t){case 1:r="accessor";break;case 2:r="method";break;case 3:r="getter";break;case 4:r="setter";break;default:r="field"}var o,v,n={kind:r,name:d?"#"+i:me(i),static:m,private:d},g={v:!1};if(t!==0&&(n.addInitializer=s(p,g)),d||t!==0&&t!==2)if(t===2)o=function(c){return e(P,c),l.value};else{var f=t===0||t===1;(f||t===3)&&(o=d?function(c){return e(P,c),l.get.call(c)}:function(c){return l.get.call(c)}),(f||t===4)&&(v=d?function(c,y){e(P,c),l.set.call(c,y)}:function(c,y){l.set.call(c,y)})}else o=function(c){return c[i]},t===0&&(v=function(c,y){c[i]=y});var w=d?P.bind():function(c){return i in c};n.access=o&&v?{get:o,set:v,has:w}:o?{get:o,has:w}:{set:v,has:w};try{return a(b,n)}finally{g.v=!0}}function h(a,i){if(typeof a!="function")throw new TypeError(i+" must be a function")}function j(a,i){var l=typeof i;if(a===1){if(l!=="object"||i===null)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");i.get!==void 0&&h(i.get,"accessor.get"),i.set!==void 0&&h(i.set,"accessor.set"),i.init!==void 0&&h(i.init,"accessor.init")}else if(l!=="function")throw new TypeError((a===0?"field":a===10?"class":"method")+" decorators must return a function or void 0")}function V(a){return function(i){a(this,i)}}function R(a,i,l,p,t,m,d,b,P){var r,o,v,n,g,f,w,c,y=l[0];if(d?(t===0||t===1?(r={get:(g=l[3],function(){return g(this)}),set:V(l[4])},v="get"):t===3?(r={get:l[3]},v="get"):t===4?(r={set:l[3]},v="set"):r={value:l[3]},t!==0&&(t===1&&At(r.set,"#"+p,"set"),At(r[v||"value"],"#"+p,v))):t!==0&&(r=Object.getOwnPropertyDescriptor(i,p)),t===1?n={get:r.get,set:r.set}:t===2?n=r.value:t===3?n=r.get:t===4&&(n=r.set),typeof y=="function")(f=u(y,p,r,b,t,m,d,n,P))!==void 0&&(j(t,f),t===0?o=f:t===1?(o=f.init,w=f.get||n.get,c=f.set||n.set,n={get:w,set:c}):n=f);else for(var k=y.length-1;k>=0;k--){var I;(f=u(y[k],p,r,b,t,m,d,n,P))!==void 0&&(j(t,f),t===0?I=f:t===1?(I=f.init,w=f.get||n.get,c=f.set||n.set,n={get:w,set:c}):n=f,I!==void 0&&(o===void 0?o=I:typeof o=="function"?o=[o,I]:o.push(I)))}if(t===0||t===1){if(o===void 0)o=function(E,S){return S};else if(typeof o!="function"){var A=o;o=function(E,S){for(var D=S,T=0;T<A.length;T++)D=A[T].call(E,D);return D}}else{var K=o;o=function(E,S){return K.call(E,S)}}a.push(o)}t!==0&&(t===1?(r.get=n.get,r.set=n.set):t===2?r.value=n:t===3?r.get=n:t===4&&(r.set=n),d?t===1?(a.push(function(E,S){return n.get.call(E,S)}),a.push(function(E,S){return n.set.call(E,S)})):t===2?a.push(n):a.push(function(E,S){return n.call(E,S)}):Object.defineProperty(i,p,r))}function _(a,i,l){for(var p,t,m,d=[],b=new Map,P=new Map,r=0;r<i.length;r++){var o=i[r];if(Array.isArray(o)){var v,n,g=o[1],f=o[2],w=o.length>3,c=g>=5,y=l;if(c?(v=a,(g-=5)!=0&&(n=t=t||[]),w&&!m&&(m=function(A){return be(A)===a}),y=m):(v=a.prototype,g!==0&&(n=p=p||[])),g!==0&&!w){var k=c?P:b,I=k.get(f)||0;if(I===!0||I===3&&g!==4||I===4&&g!==3)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+f);!I&&g>2?k.set(f,g):k.set(f,!0)}R(d,v,o,f,g,c,w,n,y)}}return M(d,p),M(d,t),d}function M(a,i){i&&a.push(function(l){for(var p=0;p<i.length;p++)i[p].call(l);return l})}return function(a,i,l,p){return{e:_(a,i,p),get c(){return function(t,m){if(m.length>0){for(var d=[],b=t,P=t.name,r=m.length-1;r>=0;r--){var o={v:!1};try{var v=m[r](b,{kind:"class",name:P,addInitializer:s(d,o)})}finally{o.v=!0}v!==void 0&&(j(10,v),b=v)}return[b,function(){for(var n=0;n<d.length;n++)d[n].call(b)}]}}(a,l)}}}}function Ot(s,e,u,h){return(Ot=ye())(s,e,u,h)}function me(s){var e=we(s,"string");return typeof e=="symbol"?e:e+""}function we(s,e){if(typeof s!="object"||!s)return s;var u=s[Symbol.toPrimitive];if(u!==void 0){var h=u.call(s,e);if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}function At(s,e,u){typeof e=="symbol"&&(e=(e=e.description)?"["+e+"]":"");try{Object.defineProperty(s,"name",{configurable:!0,value:u?u+" "+e:e})}catch{}return s}function be(s){if(Object(s)!==s)throw TypeError("right-hand side of 'in' should be an object, got "+(s!==null?typeof s:"null"));return s}const ft=class ft{constructor(e){this.store=e,this.history=(kt(this),new nt(this)),this.interaction=new rt(this),this.viewport=new et(this),this.ensureStoreIsUsable()}ensureStoreIsUsable(){const{allKeyPointIds:e,allShapeIds:u}=this;let h,j;e.length?h=e[0]:(h=it.createId(),this.insert(it.create({id:h,position:O.ZERO}))),u.length?j=u[0]:(j=ot.createId(),this.insert(ot.create({id:j}))),this.getShapeVersionIfExists(j,h)||this.insert(_t.create({keyPointId:h,shapeId:j,rawPoints:[]})),this.get(tt)||this.insert(at.create({id:tt,position:O.ZERO,zoom:1,activeKeyPointId:h}))}get location(){return $(this.store.get(tt),"Assertion Error: this.store.get(LOCATION_ID)")}updateLocation(e){this.store.put([{...this.location,...e}])}get(e){return this.store.get(e)}update(e){const u=$(this.store.get(e.id),"Assertion Error: this.store.get(record.id)");this.store.put([{...u,...e}])}updateById(e,u){const h=$(this.get(e),"Assertion Error: this.get(id)");this.store.put([Ct(h,u)])}insert(e){zt(!this.get(e.id),"Assertion Error: !this.get(record.id)"),this.store.put([e])}get allKeyPointIdsQuery(){return this.store.query.ids("keyPoint")}get allKeyPointIds(){return Array.from(this.allKeyPointIdsQuery.get()).sort()}get activeKeyPoint(){return this.get(this.location.activeKeyPointId)??$(this.get($(this.allKeyPointIds[0],"Assertion Error: this.allKeyPointIds[0]")),"Assertion Error: this.get(assertExists(this.allKeyPointIds[0]))")}get allShapeIdsQuery(){return this.store.query.ids("shape")}get allShapeIds(){return Array.from(this.allShapeIdsQuery.get()).sort()}get firstShape(){return $(this.get($(this.allShapeIds[0],"Assertion Error: this.allShapeIds[0]")),"Assertion Error: this.get(assertExists(this.allShapeIds[0]))")}getShapeVersionIfExists(e,u){return this.store.query.record("shapeVersion",()=>({shapeId:{eq:e},keyPointId:{eq:u}})).get()}getShapeVersion(e,u){return $(this.getShapeVersionIfExists(e,u),"Assertion Error: this.getShapeVersionIfExists(shapeId, keyPointId)")}};[kt]=Ot(ft,[[C,3,"allKeyPointIdsQuery"],[C,3,"allKeyPointIds"],[C,3,"activeKeyPoint"],[C,3,"allShapeIdsQuery"],[C,3,"allShapeIds"],[C,3,"firstShape"]],[]).e;let G=ft;function Pe(){const[s,e]=U.useState(null),u=Bt(s,Qt),[h,j]=U.useState(null);return U.useEffect(()=>{const V=qt("splatapus3.doc",jt,()=>({})),R=new ge(V);j(R);const _=Ut(1e3,()=>{Zt("splatapus3.doc",jt,R.serialize("all"))}),M=R.listen(()=>{_()});return()=>{M(),_.cancel()}},[]),z.jsx("div",{ref:e,className:"absolute inset-0 touch-none select-none overflow-hidden",children:u&&h&&z.jsx(Ie,{size:u,store:h})})}const Ie=J(function({size:e,store:u}){const[h,j]=U.useState(()=>new G(u));h.store!==u&&j(new G(u));const V=U.useRef(null);return U.useLayoutEffect(()=>{h.viewport.screenSize=e},[h,e]),z.jsx(z.Fragment,{children:z.jsxs("div",{ref:V,className:"absolute inset-0",onPointerDown:h.interaction.onPointerDown,onPointerMove:h.interaction.onPointerMove,onPointerUp:h.interaction.onPointerUp,onPointerCancel:h.interaction.onPointerCancel,children:[h.interaction.toDebugString(),z.jsx(Se,{splat:h})]})})}),Se=J(function({splat:e}){const{screenSize:u}=e.viewport;return z.jsx("svg",{viewBox:`0 0 ${u.x} ${u.y}`,className:"absolute left-0 top-0",children:z.jsx("g",{children:z.jsx(Ee,{splat:e})})})}),Ee=J(function({splat:e}){const{allShapeIds:u}=e;return z.jsx(z.Fragment,{children:u.map(h=>z.jsx(je,{shapeId:h,splat:e},h))})}),je=J(function({shapeId:e,splat:u}){const h=u.getShapeVersion(e,u.activeKeyPoint.id);return z.jsx(z.Fragment,{children:z.jsx(Lt,{points:h.rawPoints})})}),ke=$(document.getElementById("root"),'Assertion Error: document.getElementById("root")');Ft(ke).render(z.jsx(Yt.StrictMode,{children:z.jsx(Pe,{})}));
