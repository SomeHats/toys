import{a as S,b as q,l as ce,K as ve,t as ue,s as we,L as ke,h as Y,g as D,M as Ee,f as le,i as Ve,d as R,N as be}from"../chunks/chunk_assert.5a48dca8.js";/* empty css                               */import{a as ze,r as f,R as Ce}from"../chunks/chunk_index.0b2a17fa.js";import{V as x,b as Oe,R as _,P as Ie,d as Re,c as H,a as Me,e as ee}from"../chunks/chunk_Vector2.a2532df9.js";import{R as Ae,j as k,a as te,F as Le,c as ne}from"../chunks/chunk_ResizeObserver.f9437ff6.js";import{b as De}from"../chunks/chunk_easings.104fb955.js";import"../chunks/chunk__commonjsHelpers.fbcca4d8.js";var Ne=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,s,l;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(s=r;s--!==0;)if(!n(e[s],t[s]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(l=Object.keys(e),r=l.length,r!==Object.keys(t).length)return!1;for(s=r;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,l[s]))return!1;for(s=r;s--!==0;){var i=l[s];if(!n(e[i],t[i]))return!1}return!0}return e!==e&&t!==t},de,re=ze.exports;de=re.createRoot,re.hydrateRoot;let T;const $=new Map;function $e(n){for(const e of n)for(const t of q($.get(e.target),"callback does not exist for tracked entry"))t(e)}function pe(){return T||(T=new Ae($e)),T}function Fe(n,e){let t=$.get(n);t||(t=new Set,$.set(n,t),pe().observe(n)),t.add(e)}function Ke(n,e){const t=$.get(n);S(t,"element is not tracked");const r=t.delete(e);S(r,"callback did not exist for element"),t.size===0&&($.delete(n),pe().unobserve(n))}function je(n,e){const[t,r]=f.exports.useState(null);return f.exports.useEffect(()=>{if(!n)return;const s=l=>{r(e(l))};return Fe(n,s),()=>{Ke(n,s)}},[n,e]),t}function Be(n){return new x(n.contentRect.width,n.contentRect.height)}const{min:I,PI:ct}=Math,se=.275;function he(n,e={}){const{size:t=16,smoothing:r=.5,thinning:s=.5,simulatePressure:l=!0,easing:i=m=>m,start:d={},end:h={},last:P=!1}=e,{cap:y=!0,easing:c=m=>m*(2-m)}=d,{cap:u=!0,easing:a=m=>--m*m*m+1}=h;if(n.length===0||t<=0)return[];const o=n[n.length-1].runningLength,p=d.taper===!1?0:d.taper===!0?Math.max(t,o):d.taper,g=h.taper===!1?0:h.taper===!0?Math.max(t,o):h.taper,v=Math.pow(t*r,2),b=[];let z=n.slice(0,10).reduce((m,C)=>{let O=C.pressure;if(l){const A=I(1,C.distance/t),B=I(1,1-A);O=I(1,m+(B-m)*(A*se))}return(m+O)/2},n[0].pressure),w=oe(t,s,n[n.length-1].pressure,i);n[0].vector;let K=n[0].point,j=K;for(let m=0;m<n.length;m++){let{pressure:C}=n[m];const{point:O,vector:A,distance:B,runningLength:L}=n[m];if(m<n.length-1&&o-L<3)continue;if(s){if(l){const X=I(1,B/t),xe=I(1,1-X);C=I(1,z+(xe-z)*(X*se))}w=oe(t,s,C,i)}else w=t/2;const ye=L<p?c(L/p):1,Pe=o-L<g?a((o-L)/g):1;if(w=Math.max(.01,w*Math.min(ye,Pe)),m===n.length-1){b.push({center:O,radius:w});continue}const W=n[m+1].vector,Se=A.dot(W);W.lerp(A,Se).perpendicular().scale(w),j=O,(m<=1||K.distanceToSq(j)>v)&&(b.push({center:O,radius:w}),K=j),z=C}return b}function fe(n,e={}){var u,a;const{streamline:t=.5,size:r=16,last:s=!1}=e;if(n.length===0)return[];const l=.15+(1-t)*.85;let i=n.map(o=>({point:x.fromVectorLike(o),pressure:o.pressure}));if(i.length===2){const o=i[1];i=i.slice(0,-1);for(let p=1;p<5;p++)i.push({point:i[0].point.lerp(o.point,p/4),pressure:o.pressure})}i.length===1&&i.push({point:i[0].point.add(x.UNIT),pressure:i[0].pressure});const d=[{point:i[0].point,pressure:i[0].pressure!=null&&i[0].pressure>=0?i[0].pressure:.25,vector:x.UNIT,distance:0,runningLength:0}];let h=!1,P=0,y=d[0];const c=i.length-1;for(let o=1;o<i.length;o++){const p=i[o],g=s&&o===c?p.point:y.point.lerp(p.point,l);if(y.point.equals(g))continue;const v=g.distanceTo(y.point);if(P+=v,o<c&&!h){if(P<r)continue;h=!0}y={point:g,pressure:p.pressure!=null&&p.pressure>=0?p.pressure:.5,vector:y.point.sub(g).normalize(),distance:v,runningLength:P},d.push(y)}return d[0].vector=(a=(u=d[1])==null?void 0:u.vector)!=null?a:x.ZERO,d}function oe(n,e,t,r=s=>s){return n*r(.5-e*(.5-t))}function Te(n){if(!n.length)return"";const e=["M",n[0].x,n[0].y,"Q"];for(let t=0;t<n.length;t++){const r=n[t],s=n[(t+1)%n.length],l=r.add(s).scale(.5);e.push(r.x,r.y,l.x,l.y)}return e.push("Z"),e.join(" ")}function ge(n,e){const t=[n[0]];if(n.length===0)return[];let r=e,s=n[0],l=n[0].center;for(let i=1;i<n.length;i++){const d=n[i],h=n[Math.min(i+1,n.length-1)],P=d.center.add(h.center).scale(.5),y=d.center.distanceTo(s.center),c=l,u=d.center,a=P;let o=0;for(;y-o>=r;){const p=(r+o)/y;t.push({center:c.lerp(u,p).lerp(u.lerp(a,p),p),radius:ce(s.radius,d.radius,p)}),o+=r,r=e}r-=y-o,s=d,l=P}return t.push(n[n.length-1]),t}function Ue(n){const e=[],t=[];if(n.length===0)return[];if(n.length===1){const c=[];for(let u=0;u<12;u++)c.push(n[0].center.add(x.fromPolar(u*Math.PI/6,n[0].radius)));return c}const r=n[0],l=n[1].center.sub(r.center).normalize(),i=l.perpendicular().scale(r.radius);e.push(r.center.sub(l.scale(r.radius))),e.push(r.center.sub(i)),t.push(r.center.add(i));for(let c=1;c<n.length-1;c++){const u=n[c-1],a=n[c],g=n[c+1].center.sub(u.center).normalize().perpendicular().scale(a.radius);e.push(a.center.sub(g)),t.push(a.center.add(g))}const d=n[n.length-2],h=n[n.length-1],P=h.center.sub(d.center).normalize(),y=P.perpendicular().scale(h.radius);return e.push(h.center.sub(y)),e.push(h.center.add(P.scale(h.radius))),t.push(h.center.add(y)),e.concat(t.reverse())}function G(n){const e=f.exports.useRef();return f.exports.useLayoutEffect(()=>{e.current=n}),f.exports.useCallback((...t)=>{const r=e.current;return S(r,"fn does not exist"),r(...t)},[])}function ie(n,e){return typeof e=="function"?e(n):e}function Ge(n){const[e,t]=f.exports.useState(()=>({undoStates:[],redoStates:null,pendingOp:null,current:n()})),r=G(()=>{console.log("BEGIN");const c=Math.random();return t(u=>(S(u.pendingOp==null,"Pending op already in progress"),{...u,pendingOp:{id:c,initialState:u.current.doc}})),{update:u=>s(c,u),revert:()=>l(c),commit:()=>i(c)}}),s=f.exports.useCallback((c,u)=>{t(a=>{var o;return console.log("UPDATE"),S(((o=a.pendingOp)==null?void 0:o.id)===c,"Pending op mismatch"),{...a,current:{doc:ie(a.current.doc,u),location:a.current.location}}})},[]),l=f.exports.useCallback(c=>{console.log("REVERT"),t(u=>{var a;return S(((a=u.pendingOp)==null?void 0:a.id)===c,"Pending op mismatch"),{...u,pendingOp:null,current:{doc:u.pendingOp.initialState,location:u.current.location}}})},[]),i=f.exports.useCallback(c=>{console.log("COMMIT"),t(u=>{var a;return S(((a=u.pendingOp)==null?void 0:a.id)===c,"Pending op mismatch"),{...u,pendingOp:null,undoStates:[{doc:u.pendingOp.initialState,location:u.current.location},...u.undoStates],redoStates:null}})},[]),d=G(c=>{const u=r();u.update(c),u.commit()}),h=f.exports.useCallback(()=>{console.log("UNDO"),t(c=>{var p;if(S(c.pendingOp==null,"Pending op in progress"),c.undoStates.length==0)return c;const[u,...a]=c.undoStates,o=[c.current,...(p=c.redoStates)!=null?p:[]];return{...c,current:u,undoStates:a,redoStates:o}})},[]),P=f.exports.useCallback(()=>{console.log("REDO"),t(c=>{if(S(c.pendingOp==null,"pendign op in progress"),!c.redoStates||c.redoStates.length==0)return c;const[u,...a]=c.redoStates,o=[c.current,...c.undoStates];return{...c,current:u,undoStates:o,redoStates:a.length===0?null:a}})},[]),y=f.exports.useCallback(c=>{t(u=>({...u,current:{...u.current,location:ie(u.current.location,c)}}))},[]);return f.exports.useMemo(()=>{console.log("RENDER CHANGED",e)},[e]),f.exports.useMemo(()=>({document:e.current.doc,location:e.current.location,beginOperation:r,updateDocument:d,updateLocation:y,undo:h,redo:P}),[r,d,y,P,e,h])}function qe(n){return ve?n.metaKey:n.ctrlKey}function ae(n,e){const t=G(r=>{var l,i,d;const s=typeof n=="string"?{key:n}:n;r.key.toLowerCase()===s.key.toLowerCase()&&((l=s.command)!=null?l:!1)===qe(r)&&((i=s.shift)!=null?i:!1)===r.shiftKey&&((d=s.alt)!=null?d:!1)===r.altKey&&r.repeat===!1&&(r.preventDefault(),console.log("ACTIVATING!",s,r),e(r))});f.exports.useEffect(()=>(document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)),[t])}class Z{constructor(e,t,r,s,l){this.id=e,this.keyPoints=t,this.shapeVersions=r,this.keyPointIdByShapeVersion=s,this.normalizedShapeVersions=l}with(e){var t,r,s,l,i;return new Z((t=e.id)!=null?t:this.id,(r=e.keyPoints)!=null?r:this.keyPoints,(s=e.shapeVersions)!=null?s:this.shapeVersions,(l=e.keyPointIdByShapeVersion)!=null?l:this.keyPointIdByShapeVersion,(i=e.normalizedCenterPointsByShapeVersion)!=null?i:this.normalizedShapeVersions)}}const He="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".split("");class J{constructor(e,t=16){this.randomLength=t,this.prefix=e,this.Id=`${e}.SAMPLE`;const r=new RegExp(`^${this.prefix}\\.([a-zA-Z0-9]+)$`);this.parse=Oe(Re,s=>r.test(s)?_.ok(s):_.error(new Ie(`Expected ${this.prefix}.*, got ${s}`,[])))}generate(){const e=ue(this.randomLength,()=>we(He)).join("");return`${this.prefix}.${e}`}}const F=new J("key"),Ze=H({id:F.parse,position:x.parse}),Q=new J("shv"),Je=H({id:Q.parse,keyPointId:F.parse,rawPoints:Me(x.parse)}),me=new J("doc");H({id:me.parse,keyPoints:ee(F.parse,Ze),shapeVersions:ee(Q.parse,Je)});function Qe(){return{id:me.generate(),keyPoints:{},shapeVersions:{}}}class E{static fromArray(e){return new E(ke(e.map(t=>[t.id,t])))}constructor(e){this.data=e}has(e){return Y(this.data,e)}getIfExists(e){return D(this.data,e)}get(e){const t=this.getIfExists(e);return S(t!=null,`Item with id ${e} not found`),t}insert(e){return new E({...this.data,[e.id]:e})}delete(e){const{[e]:t,...r}=this.data;return new E(r)}*[Symbol.iterator](){for(const e in this.data)Y(this.data,e)&&(yield q(this.data[e]))}}class V{constructor(e={}){this.inverse=e}static build(e,t){const r={};for(const s of t){const l=s.id,i=s[e],d=D(r,i);d?d.push(l):r[i]=[l]}return new V(r)}lookupInverseIfExists(e){var t;return(t=D(this.inverse,e))==null?void 0:t[0]}lookupInverse(e){const t=this.lookupInverseIfExists(e);return S(t!=null,`Item with id ${e} not found`),t}add(e,t){const r=D(this.inverse,t);return r?(S(!r.includes(e),`relation ${t}<->${e} already exists in index`),new V({...this.inverse,[t]:[...r,e]})):new V({...this.inverse,[t]:[e]})}remove(e,t){const r=D(this.inverse,t);if(r){const s=r.indexOf(e);if(s>=0)return r.length>1?new V({...this.inverse,[t]:Ee(r,s)}):new V({...this.inverse,[t]:void 0})}le(`relation ${t}<->${e} not found in index`)}}const N={size:16,streamline:.5,smoothing:.5,thinning:.5,simulatePressure:!0,easing:n=>n,start:{},end:{},last:!1};function U(n){var s,l;if(n.length===0)return{versions:new E({})};const e=[];let t=0;for(const i of n){const d=fe(i.rawPoints),h=(l=(s=d[d.length-1])==null?void 0:s.runningLength)!=null?l:0;e.push({id:i.id,strokePoints:d,length:h}),h>t&&(t=h)}const r=Math.floor(t/N.size);return{versions:E.fromArray(e.map(({strokePoints:i,length:d,id:h})=>({id:h,length:d,normalizedCenterPoints:ge(he(i,N),d/r)})))}}class M{constructor(e,t=!0){if(this.data=e,!t)return;const r=this.serialize(),s=M.deserialize(r);Ne(this,s)||le(`Mismatch after update:
Actual:
${JSON.stringify(this,null,2)}

Expected:
${JSON.stringify(s,null,2)}`)}static create(){return M.deserialize(Qe())}static deserialize(e){const t=new E(e.shapeVersions);return new M(new Z(e.id,new E(e.keyPoints),t,V.build("keyPointId",t),U(Array.from(t)).versions),!1)}with(...e){return new M(this.data.with(...e))}serialize(){return{id:this.data.id,keyPoints:this.data.keyPoints.data,shapeVersions:this.data.shapeVersions.data}}get keyPoints(){return this.data.keyPoints}get shapeVersions(){return this.data.shapeVersions}getShapeVersionForKeyPoint(e){return this.shapeVersions.get(this.data.keyPointIdByShapeVersion.lookupInverse(e))}addKeyPoint(e){const t=Q.generate(),r=this.keyPoints.insert({id:e,position:x.UNIT}),s=this.shapeVersions.insert({id:t,keyPointId:e,rawPoints:[]});return this.with({keyPoints:r,shapeVersions:s,keyPointIdByShapeVersion:this.data.keyPointIdByShapeVersion.add(t,e),normalizedCenterPointsByShapeVersion:U(Array.from(s)).versions})}replaceShapeVersionPoints(e,t){const r=this.shapeVersions.insert({...this.shapeVersions.get(e),rawPoints:t});return this.with({shapeVersions:r,normalizedCenterPointsByShapeVersion:U(Array.from(r)).versions})}}function We(){const[n,e]=f.exports.useState(null),t=je(n,Be);return k("div",{ref:e,className:"absolute inset-0 touch-none",children:t&&k(Ye,{size:t})})}const Xe=1e3;function Ye({size:n}){const[e,t]=f.exports.useState({type:"idle"}),{document:r,location:s,updateDocument:l,updateLocation:i,undo:d,redo:h}=Ge(()=>{const a=F.generate();return{doc:M.create().addKeyPoint(a),location:{keyPointId:a}}});ae({key:"z",command:!0},d),ae({key:"z",command:!0,shift:!0},h),f.exports.useEffect(()=>{let a=!1;return Ve((o,p)=>{if(a){p();return}t(g=>{switch(g.type){case"idle":case"drawing":return g;case"lerp":{const v=be(g.startedAtMs,g.startedAtMs+Xe,o);return v>1?{type:"idle"}:{...g,progress:v}}default:R(g)}})}),()=>{a=!0}});const P=f.exports.useCallback(a=>{a.preventDefault(),t(o=>{switch(o.type){case"lerp":return o;case"idle":return{type:"drawing",points:[x.fromEvent(a)]};case"drawing":return o;default:R(o)}})},[]),y=f.exports.useCallback(a=>{a.preventDefault(),t(o=>{switch(o.type){case"idle":case"lerp":return o;case"drawing":return{...o,points:[...o.points,x.fromEvent(a)]};default:R(o)}})},[]),c=f.exports.useCallback(a=>{a.preventDefault(),t(o=>{switch(o.type){case"idle":case"lerp":return o;case"drawing":return l(p=>p.replaceShapeVersionPoints(p.getShapeVersionForKeyPoint(s.keyPointId).id,o.points)),{type:"idle"};default:R(o)}})},[s.keyPointId,l]),u=f.exports.useMemo(()=>{switch(e.type){case"idle":return r.data.normalizedShapeVersions.get(r.getShapeVersionForKeyPoint(s.keyPointId).id).normalizedCenterPoints;case"drawing":return ge(he(fe(e.points,N),N),N.size);case"lerp":{const a=r.getShapeVersionForKeyPoint(e.from),o=r.getShapeVersionForKeyPoint(e.to),p=r.data.normalizedShapeVersions.get(a.id).normalizedCenterPoints,g=r.data.normalizedShapeVersions.get(o.id).normalizedCenterPoints,v=De(e.progress);return ue(Math.max(p.length,g.length),b=>{const z=p[Math.min(b,p.length-1)],w=g[Math.min(b,g.length-1)];return{center:z.center.lerp(w.center,v),radius:ce(z.radius,w.radius,v)}})}default:R(e)}},[e,r,s.keyPointId]);return te(Le,{children:[k("div",{className:"pointer-events-none absolute top-0",children:_e(e)}),k("svg",{viewBox:`0 0 ${n.x} ${n.y}`,onPointerDown:P,onPointerMove:y,onPointerUp:c,children:k("path",{d:Te(Ue(u))})}),te("div",{className:"absolute bottom-0 left-0 flex w-full items-center justify-center gap-3 p-3",children:[Array.from(r.keyPoints,(a,o)=>k("button",{className:ne("flex h-10 w-10 items-center justify-center rounded border border-stone-200 text-stone-400 shadow-md transition-transform hover:-translate-y-1",a.id===s.keyPointId?" text-stone-500 ring-2 ring-inset ring-purple-400":"text-stone-400"),onClick:()=>{i({keyPointId:a.id}),t({type:"lerp",from:s.keyPointId,to:a.id,startedAtMs:performance.now(),progress:0})},children:o+1},a.id)),k("button",{className:ne("flex h-10 w-10 items-center justify-center rounded border border-stone-200 text-stone-400 shadow-md transition-transform hover:-translate-y-1"),onClick:()=>{const a=F.generate();l(o=>o.addKeyPoint(a)),i({keyPointId:a})},children:"+"})]})]})}function _e(n){switch(n.type){case"idle":return"idle";case"lerp":return`lerp(from = ${n.from}, to = ${n.to}, progress = ${n.progress})`;case"drawing":return`drawing(points = ${n.points.length})`;default:R(n)}}const et=q(document.getElementById("root"));de(et).render(k(Ce.StrictMode,{children:k(We,{})}));
