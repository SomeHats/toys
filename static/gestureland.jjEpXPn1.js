var q=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var B=(i,t,e)=>(q(i,t,"read from private field"),e?e.call(i):t.get(i)),O=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},R=(i,t,e,r)=>(q(i,t,"write to private field"),r?r.call(i,e):t.set(i,e),e);import{e as V,b as nt,a as ut,v as Q,w as pt,x as ht}from"./chunk_utils.ferkvykK.js";/* empty css                       */import{j as S,c as lt}from"./chunk_client.3vOul-ua.js";import{V as I}from"./chunk_Vector2.Rt8uspPZ.js";import{c as it,S as dt,a as ft}from"./chunk_StoreSchema.6oVjlI9P.js";import{r as Y,m as j}from"./chunk_signia._kyOjg0K.js";import{D as gt}from"./chunk_DebugSvg.agFedmLV.js";import{T as mt}from"./chunk_Ticker.W3AthjLp.js";import{a as vt,s as wt}from"./chunk_useResizeObserver.1WDF-mnU.js";import{S as yt}from"./chunk_svgPathBuilder.tgy0QjT8.js";import{t as ot}from"./chunk_track.lGoURb00.js";import{r as W}from"./chunk_index.V9mWGg2B.js";import"./chunk__commonjsHelpers.5-cIlDoe.js";import"./chunk_RingBuffer.a9K5McfO.js";import"./chunk_DebugDraw.i6bvNLxG.js";import"./chunk_AABB.JpHgKg04.js";import"./chunk_useMergedRefs.DOPNtTgk.js";import"./chunk_EventEmitter.RDaT1QTq.js";import"./chunk_ResizeObserver.-NVrOerG.js";const K=it("camera",{scope:"session"}).withDefaultProperties(()=>({center:I.ZERO.toJson(),zoom:1})),_=K.createId("camera"),at=it("stroke",{scope:"document"}).withDefaultProperties(()=>({points:[]})),Pt=ft.create({camera:K,stroke:at});class bt extends dt{constructor(){super({schema:Pt,props:void 0})}put1(t){return this.put([t])}delete(t){return this.remove([t])}}const Tt=1e3;function Et(i){return{id:"draw on canvas",index:-1/0,distanceTo(){return 0},onDrag(t){const e=at.create({});return i.store.put1(e),{onUpdate(r){i.store.update(e.id,s=>({...s,points:[...s.points,r.pagePosition.toJson()]}))},onCancel(){i.store.delete(e.id)}}}}}function xt(i){return i.shapes.map(t=>({id:`drag shape ${t.id}`,index:1,distanceTo(e){return Math.min(...t.points.map(r=>e.distanceTo(r)))},onDrag(e){return{onUpdate(r){const s=r.pagePosition.sub(e.pagePosition);i.store.update(t.id,m=>({...m,points:t.points.map(y=>s.add(y).toJson())}))},onCancel(r){i.store.update(t.id,s=>({...s,points:t.points}))}}}}))}const w=class w{constructor(t,e,r,s,m,y){this.a=t,this.b=e,this.c=r,this.d=s,this.e=m,this.f=y}static translate(...t){const{x:e,y:r}=I.fromArgs(t);return new w(1,0,0,1,e,r)}static rotate(t){const e=Math.cos(t),r=Math.sin(t);return new w(e,r,-r,e,0,0)}static scale(...t){const{x:e,y:r}=I.fromArgs(t);return new w(e,0,0,r,0,0)}static scaleUniform(t){return w.scale(t,t)}static fromDomMatrix(t){return new w(t.a,t.b,t.c,t.d,t.e,t.f)}multiply(t){return new w(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.e+this.c*t.f+this.e,this.b*t.e+this.d*t.f+this.f)}translate(...t){const{x:e,y:r}=I.fromArgs(t);return this.multiply(w.translate(e,r))}rotate(t){return this.multiply(w.rotate(t))}scale(...t){const{x:e,y:r}=I.fromArgs(t);return this.multiply(w.scale(e,r))}scaleUniform(t){return this.scale(t,t)}invert(){const t=this.a*this.d-this.b*this.c;return new w(this.d/t,this.b/-t,this.c/-t,this.a/t,(this.d*this.e-this.c*this.f)/-t,(this.b*this.e-this.a*this.f)/t)}apply(...t){const e=I.fromArgs(t);return new I(this.a*e.x+this.c*e.y+this.e,this.b*e.x+this.d*e.y+this.f)}toString(t=2){let e=[this.a,this.b,this.c,this.d,this.e,this.f].map(s=>s.toFixed(t));const r=Math.max(...e.map(s=>s.length));return e=e.map(s=>s.padStart(r," ")),["Transform2d(",`  ${e[0]}, ${e[1]}, ${e[4]},`,`  ${e[1]}, ${e[2]}, ${e[5]},`,")"].join(`
`)}toCss(){return`matrix(${this.a}, ${this.b}, ${this.c}, ${this.d}, ${this.e}, ${this.f})`}toDomMatrix(){return new DOMMatrix([this.a,this.b,this.c,this.d,this.e,this.f])}};w.IDENTITY=new w(1,0,0,1,0,0);let G=w;var tt,et,rt,st;function At(){function i(u,o){return function(d){(function(f,n){if(f.v)throw new Error("attempted to call "+n+" after decoration was finished")})(o,"addInitializer"),r(d,"An initializer"),u.push(d)}}function t(u,o){if(!u(o))throw new TypeError("Attempted to access private element on non-instance")}function e(u,o,d,f,n,b,g,x,A){var p;switch(n){case 1:p="accessor";break;case 2:p="method";break;case 3:p="getter";break;case 4:p="setter";break;default:p="field"}var c,a,v={kind:p,name:g?"#"+o:o,static:b,private:g},h={v:!1};if(n!==0&&(v.addInitializer=i(f,h)),g||n!==0&&n!==2)if(n===2)c=function(l){return t(A,l),d.value};else{var P=n===0||n===1;(P||n===3)&&(c=g?function(l){return t(A,l),d.get.call(l)}:function(l){return d.get.call(l)}),(P||n===4)&&(a=g?function(l,E){t(A,l),d.set.call(l,E)}:function(l,E){d.set.call(l,E)})}else c=function(l){return l[o]},n===0&&(a=function(l,E){l[o]=E});var T=g?A.bind():function(l){return o in l};v.access=c&&a?{get:c,set:a,has:T}:c?{get:c,has:T}:{set:a,has:T};try{return u(x,v)}finally{h.v=!0}}function r(u,o){if(typeof u!="function")throw new TypeError(o+" must be a function")}function s(u,o){var d=typeof o;if(u===1){if(d!=="object"||o===null)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");o.get!==void 0&&r(o.get,"accessor.get"),o.set!==void 0&&r(o.set,"accessor.set"),o.init!==void 0&&r(o.init,"accessor.init")}else if(d!=="function"){var f;throw f=u===0?"field":u===10?"class":"method",new TypeError(f+" decorators must return a function or void 0")}}function m(u){return function(o){u(this,o)}}function y(u,o,d,f,n,b,g,x,A){var p,c,a,v,h,P,T,l=d[0];if(g?p=n===0||n===1?{get:(v=d[3],function(){return v(this)}),set:m(d[4])}:n===3?{get:d[3]}:n===4?{set:d[3]}:{value:d[3]}:n!==0&&(p=Object.getOwnPropertyDescriptor(o,f)),n===1?a={get:p.get,set:p.set}:n===2?a=p.value:n===3?a=p.get:n===4&&(a=p.set),typeof l=="function")(h=e(l,f,p,x,n,b,g,a,A))!==void 0&&(s(n,h),n===0?c=h:n===1?(c=h.init,P=h.get||a.get,T=h.set||a.set,a={get:P,set:T}):a=h);else for(var E=l.length-1;E>=0;E--){var M;(h=e(l[E],f,p,x,n,b,g,a,A))!==void 0&&(s(n,h),n===0?M=h:n===1?(M=h.init,P=h.get||a.get,T=h.set||a.set,a={get:P,set:T}):a=h,M!==void 0&&(c===void 0?c=M:typeof c=="function"?c=[c,M]:c.push(M)))}if(n===0||n===1){if(c===void 0)c=function(k,D){return D};else if(typeof c!="function"){var C=c;c=function(k,D){for(var J=D,X=0;X<C.length;X++)J=C[X].call(k,J);return J}}else{var N=c;c=function(k,D){return N.call(k,D)}}u.push(c)}n!==0&&(n===1?(p.get=a.get,p.set=a.set):n===2?p.value=a:n===3?p.get=a:n===4&&(p.set=a),g?n===1?(u.push(function(k,D){return a.get.call(k,D)}),u.push(function(k,D){return a.set.call(k,D)})):n===2?u.push(a):u.push(function(k,D){return a.call(k,D)}):Object.defineProperty(o,f,p))}function z(u,o,d){for(var f,n,b,g=[],x=new Map,A=new Map,p=0;p<o.length;p++){var c=o[p];if(Array.isArray(c)){var a,v,h=c[1],P=c[2],T=c.length>3,l=h>=5,E=d;if(l?(a=u,(h-=5)!==0&&(v=n=n||[]),T&&!b&&(b=function(N){return Dt(N)===u}),E=b):(a=u.prototype,h!==0&&(v=f=f||[])),h!==0&&!T){var M=l?A:x,C=M.get(P)||0;if(C===!0||C===3&&h!==4||C===4&&h!==3)throw new Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+P);!C&&h>2?M.set(P,h):M.set(P,!0)}y(g,a,c,P,h,l,T,v,E)}}return $(g,f),$(g,n),g}function $(u,o){o&&u.push(function(d){for(var f=0;f<o.length;f++)o[f].call(d);return d})}return function(u,o,d,f){return{e:z(u,o,f),get c(){return function(n,b){if(b.length>0){for(var g=[],x=n,A=n.name,p=b.length-1;p>=0;p--){var c={v:!1};try{var a=b[p](x,{kind:"class",name:A,addInitializer:i(g,c)})}finally{c.v=!0}a!==void 0&&(s(10,a),x=a)}return[x,function(){for(var v=0;v<g.length;v++)g[v].call(x)}]}}(u,d)}}}}function ct(i,t,e,r){return(ct=At())(i,t,e,r)}function Dt(i){if(Object(i)!==i)throw TypeError("right-hand side of 'in' should be an object, got "+(i!==null?typeof i:"null"));return i}var F,L,U;const Z=class Z{constructor(t){O(this,F,void 0);O(this,L,void 0);O(this,U,void 0);this.container=t,R(this,F,(st(this),tt(this,I.UNIT))),R(this,L,et(this,[])),this.onWheel=e=>{e.preventDefault(),e.ctrlKey?this.camera={...this.camera,zoom:Math.exp(-e.deltaY/100)*this.camera.zoom}:this.camera={...this.camera,center:new I(e.deltaX,e.deltaY).scale(1/this.camera.zoom).add(this.camera.center)}},R(this,U,rt(this,new Map)),this.onPointerDown=e=>{e.preventDefault(),this.container.setPointerCapture(e.pointerId);const r=this.updatePointerAndReturnEvent(e,"down");this.enabledGestures;const s=r.state;switch(s.type){case"drag":return;case"idle":return;default:V(s)}},this.onPointerMove=e=>{const r=this.updatePointerAndReturnEvent(e,"move"),s=r.state;switch(s.type){case"idle":return;case"drag":{s.drag.onUpdate(r);return}default:V(s)}},this.onPointerUp=e=>{var m,y;this.container.releasePointerCapture(e.pointerId);const r=this.updatePointerAndReturnEvent(e,"up"),s=r.state;switch(s.type){case"idle":return;case"drag":{(y=(m=s.drag).onEnd)==null||y.call(m,r),this.setPointerState(r,{type:"idle"});return}default:V(s)}},this.onPointerCancel=e=>{var m,y;this.container.releasePointerCapture(e.pointerId);const r=this.updatePointerAndReturnEvent(e,"cancel"),s=r.state;switch(s.type){case"idle":return;case"drag":(y=(m=s.drag).onCancel)==null||y.call(m,r),this.setPointerState(r,{type:"idle"});return;default:V(s)}},this.onTick=()=>{const e=Date.now()-Tt,r=new Map(this.pointers);for(const s of this.pointers.values())s.lastUpdatedAt<e&&r.delete(s.pointerId);this.pointers=r},this.store=new bt,this.store.put1(K.create({id:_})),this.addTarget(Et),this.addTarget(xt)}get viewportSize(){return B(this,F)}set viewportSize(t){R(this,F,t)}get pageToViewport(){return G.translate(this.viewportSize.scale(.5)).scaleUniform(this.camera.zoom).translate(I.from(this.camera.center).scale(-1))}get viewportToPage(){return this.pageToViewport.invert()}get camera(){return nt(this.store.get(_),"Assertion Error: this.store.get(CAMERA_ID)")}set camera(t){ut(t.id===_,"Assertion Error: newCamera.id === CAMERA_ID"),this.store.put([t])}get shapes(){return this.store.allRecords().filter(t=>t.typeName==="stroke")}get targetFns(){return B(this,L)}set targetFns(t){R(this,L,t)}addTarget(t){this.targetFns=[...this.targetFns,t]}get targets(){const t=[];for(const e of this.targetFns){const r=e(this);r&&(Array.isArray(r)?t.push(...r):t.push(r))}return Q(t,e=>e.index)}get targetsByIndex(){return pt(this.targets,t=>t.index)}getTargetAtPoint(t,{sensitivity:e,filter:r=()=>!0}){const s=e*this.camera.zoom;for(const[m,y]of Q([...this.targetsByIndex],([z])=>z).reverse()){let z=s,$=null;for(const u of y){if(!r(u))continue;const o=u.distanceTo(t);o<=z&&(z=o,$=u)}if($)return $}return null}get enabledGestures(){const t={drag:!1,twoFingerDrag:!1,tap:!1,doubleTap:!1};for(const e of this.targets)e.onDrag&&(t.drag=!0),e.onTwoFingerDrag&&(t.twoFingerDrag=!0),e.onTap&&(t.tap=!0),e.onDoubleTap&&(t.doubleTap=!0);return t}get pointers(){return B(this,U)}set pointers(t){R(this,U,t)}getPointer(t){return this.pointers.get(t)}setPointer(t){const e=new Map(this.pointers);e.set(t.pointerId,t),this.pointers=e}setPointerState(t,e){this.setPointer({...this.getPointer(t.pointerId)??t,state:e})}updatePointerAndReturnEvent(t,e){const r=this.getPointer(t.pointerId),s={pointerId:t.pointerId,viewportPosition:I.fromEvent(t),type:t.pointerType,isDown:e==="down"?!0:e==="up"||e==="cancel"?!1:(r==null?void 0:r.isDown)??!1,state:(r==null?void 0:r.state)??{type:"idle"},lastUpdatedAt:Date.now()};return this.setPointer(s),{...s,pagePosition:this.viewportToPage.apply(s.viewportPosition)}}};F=new WeakMap,L=new WeakMap,U=new WeakMap,[tt,et,rt,st]=ct(Z,[[Y,1,"viewportSize"],[j,3,"pageToViewport"],[j,3,"viewportToPage"],[j,3,"camera"],[j,3,"shapes"],[Y,1,"targetFns"],[j,3,"targets"],[j,3,"targetsByIndex"],[j,3,"enabledGestures"],[Y,1,"pointers"]],[]).e;let H=Z;function It(){const[i,t]=W.useState(null),e=vt(i,wt);return S.jsx("div",{ref:t,className:"fixed inset-0 touch-none",children:e&&i&&S.jsx(Mt,{size:e,container:i})})}const Mt=ot(function({size:t,container:e}){const r=W.useMemo(()=>new H(e),[e]);return W.useLayoutEffect(()=>{r.viewportSize=t},[r,t]),W.useEffect(()=>{const s=new mt,m=s.listen(()=>r.onTick());return s.start(),e.addEventListener("wheel",r.onWheel,{passive:!1,capture:!0}),e.addEventListener("pointerdown",r.onPointerDown),e.addEventListener("pointermove",r.onPointerMove),e.addEventListener("pointerup",r.onPointerUp),e.addEventListener("pointercancel",r.onPointerCancel),()=>{m(),s.stop(),e.removeEventListener("wheel",r.onWheel,{capture:!0}),e.removeEventListener("pointerdown",r.onPointerDown),e.removeEventListener("pointermove",r.onPointerMove),e.removeEventListener("pointerup",r.onPointerUp),e.removeEventListener("pointercancel",r.onPointerCancel)}},[r,e]),S.jsxs("svg",{viewBox:`0 0 ${t.x} ${t.y}`,width:t.x,height:t.y,children:[S.jsx("g",{transform:r.pageToViewport.toCss(),children:r.shapes.map(s=>S.jsx(kt,{shape:s},s.id))}),Array.from(r.pointers.values(),s=>S.jsx(gt,{position:s.viewportPosition,label:ht([s.pointerId,s.type,s.isDown?"down":null]).join(", ")},s.pointerId))]})}),kt=ot(function({shape:t}){if(!t.points.length)return null;const e=new yt().moveTo(t.points[0]);for(const r of t.points)e.lineTo(r);return S.jsx("path",{d:e.toString(),stroke:"black",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})}),St=nt(document.getElementById("root"),'Assertion Error: document.getElementById("root")');lt(St).render(S.jsx(It,{}));
