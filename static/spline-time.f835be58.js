import{S as U,a as V,T as X,d as $,b as K}from"./chunk_assert.0ed02936.js";/* empty css                       */import{a as Y,r as M,R as Z}from"./chunk_index.9ef61b8f.js";import{a as J,u as q,b as Q,c as tt}from"./chunk_client.eaa7f0af.js";import{A as B}from"./chunk_AABB.f2958295.js";import{V as I,S as et,R as ot}from"./chunk_Vector2.5cb4ef59.js";import{u as nt}from"./chunk_useGestureDetector.d67667c7.js";import{u as st,A as rt}from"./chunk_useKeyPress.48c97e3a.js";import{a as it}from"./chunk_useStoredState.008f527c.js";import{B as at}from"./chunk_Button.6da7c224.js";import{S as D}from"./chunk_svgPathBuilder.0ac8eb16.js";import{a as P,F as A,j as n}from"./chunk_jsx-runtime.faf32752.js";import{c as ct}from"./chunk_index.9d627959.js";import{C as lt}from"./chunk_Circle.e4377e7a.js";import{C as pt}from"./chunk_CirclePathSegment.d32e85d1.js";import{P as dt}from"./chunk_Path.6a94b7de.js";import"./chunk__commonjsHelpers.e5e952e9.js";import"./chunk_storage.b7e3575d.js";import"./chunk_theme.5443e31e.js";import"./chunk_EventEmitter.18fc68ab.js";const _=8;function G({control:t,target:o}){return P(A,{children:[n("line",{x1:o.x,y1:o.y,x2:t.x,y2:t.y,className:"stroke-purple-400",fill:"none",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),n("circle",{cx:t.x,cy:t.y,r:4,strokeWidth:2,className:"fill-white stroke-purple-400"})]})}function R({path:t}){return n("path",{d:t,className:"stroke-fuchsia-500",fill:"none",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"})}function z({from:t,to:o}){const s=t.distanceTo(o);let r=Math.ceil(s/5);r%2===1&&(r+=1);const i=s/r;return n("line",{x1:t.x,y1:t.y,x2:o.x,y2:o.y,className:"stroke-purple-300",fill:"none",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:`0 ${i}`})}function H({from:t,to:o,progress:s}){const e=o.sub(t).normalize().perpendicular(),r=t.lerp(o,s),i=r.add(e.scale(_/2)),u=r.add(e.scale(-_/2));return n("line",{x1:i.x,y1:i.y,x2:u.x,y2:u.y,className:"stroke-purple-500",fill:"none",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"})}function F({label:t,uiTarget:o,children:s}){return Y.exports.createPortal(P("div",{className:"flex items-baseline justify-between gap-3",onPointerDown:e=>e.stopPropagation(),onPointerMove:e=>e.stopPropagation(),onPointerUp:e=>e.stopPropagation(),onPointerCancel:e=>e.stopPropagation(),children:[n("div",{className:"flex-auto p-3 font-semibold text-stone-500",children:t}),n("div",{className:"flex flex-none items-center justify-center gap-3 p-3",children:s})]}),o)}function ut(t){return n(ht,{...t})}function ht({line:t,showExtras:o,uiTarget:s}){const[e,r]=M.exports.useState(.5);if(t.points.length<2)return null;const i=[],u=new D;u.moveTo(t.points[0]);for(let a=0;a<t.points.length-1;a++){const h=a==0?t.points[0]:t.points[a-1],l=t.points[a],c=t.points[a+1],p=a+2<t.points.length?t.points[a+2]:c,d=Math.sqrt(Math.pow(h.x-l.x,2)+Math.pow(h.y-l.y,2)),f=Math.sqrt(Math.pow(l.x-c.x,2)+Math.pow(l.y-c.y,2)),x=Math.sqrt(Math.pow(c.x-p.x,2)+Math.pow(c.y-p.y,2)),w=Math.pow(x,e),v=Math.pow(x,2*e),m=Math.pow(f,e),g=Math.pow(f,2*e),y=Math.pow(d,e),k=Math.pow(d,2*e),b=2*k+3*y*m+g,S=2*v+3*w*m+g;let T=3*y*(y+m);T>0&&(T=1/T);let L=3*w*(w+m);L>0&&(L=1/L);let C=new I((-g*h.x+b*l.x+k*c.x)*T,(-g*h.y+b*l.y+k*c.y)*T),N=new I((v*l.x+S*c.x-g*p.x)*L,(v*l.y+S*c.y-g*p.y)*L);C.x==0&&C.y==0&&(C=l),N.x==0&&N.y==0&&(N=c),i.push({target:l,control:C}),i.push({target:c,control:N}),u.bezierCurveTo(C,N,c)}return P(A,{children:[o&&i.map(({target:a,control:h},l)=>n(G,{target:a,control:h},l)),n(R,{path:u.toString()}),P(F,{label:"catmull-rom",uiTarget:s,children:["alpha:",n("input",{type:"range",value:e,onChange:a=>r(a.currentTarget.valueAsNumber),min:.001,max:1,step:.001}),n("span",{className:"tabular-nums",children:e.toFixed(2)})]})]})}function mt({line:t,uiTarget:o}){const s=new D;switch(t.points.length){case 0:case 1:return null;case 2:{s.moveTo(t.points[0]),s.lineTo(t.points[1]);break}default:s.moveTo(t.points[0]),s.lineTo(t.points[0].lerp(t.points[1],.5));for(let e=1;e<t.points.length-1;e++)s.quadraticCurveTo(t.points[e],t.points[e].lerp(t.points[e+1],.5));s.lineTo(t.points[t.points.length-1])}return P(A,{children:[n(R,{path:s.toString()}),n(F,{uiTarget:o,label:"midpoint quadratic"})]})}function ft({line:t,showExtras:o}){if(!o)return null;const s=U(t.points,2).map(([e,r],i)=>n(H,{from:e,to:r,progress:.5},i));return n(A,{children:s})}function xt(t){return n(gt,{...t})}function gt({line:t,showExtras:o,uiTarget:s}){const[e,r]=M.exports.useState(.333),i=[],u=[],a=new D;switch(t.points.length){case 0:case 1:return null;case 2:a.moveTo(t.points[0]),a.lineTo(t.points[1]);break;default:{a.moveTo(t.points[0]);let h=null;for(let l=0;l<t.points.length-1;l++){const c=t.points[l],p=t.points[l+1],d=t.points[l+2],f=c.distanceTo(p);let x;if(h&&(x=c.add(h.scale(f*e)),i.push({target:c,control:x})),d){const w=p.distanceTo(d),v=f+w,m=c.lerp(d,f/v),g=(d.x-c.x)*(p.y-c.y)-(d.y-c.y)*(p.x-c.x)>0;u.push(n(z,{from:c,to:d})),u.push(n(z,{from:m,to:p}));let y=p.sub(m).normalize().perpendicular();g||(y=y.scale(-1));const k=p.sub(y.scale(f*e));i.push({target:p,control:k}),x?a.bezierCurveTo(x,k,p):a.quadraticCurveTo(k,p),h=y}else V(x,"Assertion Error: controlPointBefore"),a.quadraticCurveTo(x,p)}}}return P(A,{children:[o&&i.map(({target:h,control:l},c)=>n(G,{target:h,control:l},c)),o&&u.map((h,l)=>n(M.exports.Fragment,{children:h},l)),n(R,{path:a.toString()}),P(F,{label:"alex mode",uiTarget:s,children:["slop:",n("input",{type:"range",value:e,onChange:h=>r(h.currentTarget.valueAsNumber),min:0,max:1,step:.001}),n("span",{className:"tabular-nums",children:e.toFixed(2)})]})]})}function O({style:t}){return t==="final"?({line:o})=>{if(!o.points.length)return null;const s=new D;s.moveTo(o.points[0]);for(let e=1;e<o.points.length;e++)s.lineTo(o.points[e]);return n(R,{path:s.toString()})}:({line:o})=>{const s=U(o.points,2).map(([e,r],i)=>n(z,{from:e,to:r},i));return n(A,{children:s})}}const j=class{constructor(t){this.points=t}insertPointAtIndex(t,o){return new j(X(this.points,t,o))}updatePointAtIndex(t,o){return new j($(this.points,t,o))}getClosestPointTo(t){if(this.points.length===0)return null;let o=0,s=this.points[0].distanceTo(t);for(let e=1;e<this.points.length;e++){const i=this.points[e].distanceTo(t);i<s&&(o=e,s=i)}return{index:o,point:this.points[o],distance:s}}getClosestPointIndexWithinRadius(t,o){const s=this.getClosestPointTo(t);return s&&s.distance<=o?s.index:null}};let E=j;E.schema=et.arrayOf(I.schema).transform(t=>ot.ok(new j(t)),t=>t.points);function Pt({line:t,uiTarget:o,showExtras:s}){const e=[],r=new D;switch(t.points.length){case 0:case 1:return null;case 2:{r.moveTo(t.points[0]),r.lineTo(t.points[1]);break}default:{r.moveTo(t.points[0]);let i=t.points[0].lerp(t.points[1],.5);r.lineTo(i);for(let u=1;u<t.points.length-1;u++){const a=t.points[u],h=t.points[u+1],l=a.lerp(h,.5),c=i.distanceTo(a),p=l.distanceTo(a),d=Math.min(c,p),f=a.lerp(i,d/c),x=a.lerp(l,d/p);e.push(n(H,{from:a,to:i,progress:d/c})),e.push(n(H,{from:a,to:l,progress:d/p})),r.lineTo(f);const w=dt.segmentAcrossCircle(new lt(a,d),f.angleTo(a),a.angleTo(x));w instanceof pt?(r.lineTo(f),r.arcTo(w.circle.radius,w.circle.radius,0,0,w.isAnticlockwise?0:1,x)):r.lineTo(x),i=l}r.lineTo(t.points[t.points.length-1])}}return P(A,{children:[s&&e.map((i,u)=>n(M.exports.Fragment,{children:i},u)),n(R,{path:r.toString()}),n(F,{uiTarget:o,label:"arcs"})]})}const yt=20,wt=[[-150,75],[0,-50],[0,50],[150,-75]].map(([t,o])=>new I(t,o));function Tt(){const[t,o]=M.exports.useState(null),s=J(t,Q),[e,r]=it("splineTime.line",E.schema,()=>new E(wt));return P("div",{className:"absolute inset-0 flex flex-col bg-stone-100",children:[P("div",{className:"flex flex-none items-center justify-between gap-3 bg-stone-100 px-4 py-3",children:[n("h1",{className:"flex-none font-bold tracking-wide text-stone-600",children:"spline time"}),n("div",{className:"text-stone-500",children:"click/drag to create/move points. hold shift to hide annotations."}),n(at,{onClick:()=>r(new E([])),children:"reset"})]}),n("div",{className:"relative flex-auto touch-none",ref:o,children:s&&n(vt,{size:s,line:e,setLine:r})})]})}function vt({size:t,line:o,setLine:s}){const r=(t.x-48)/2,i=(t.y-16*2)/2,u=!st({key:"Shift",shift:rt}),a=q(m=>{const g=m.currentTarget.getBoundingClientRect();return new I(m.clientX-g.left-r/2,m.clientY-g.top-i/2)}),h=q(m=>o.getClosestPointIndexWithinRadius(a(m),yt)),[l,c]=M.exports.useState(null),{events:p,isGestureInProgress:d}=nt({onDragStart:m=>{m.preventDefault();const g=a(m),{pointIndex:y,offset:k}=(()=>{const b=h(m);if(b!==null)return{pointIndex:b,offset:o.points[b].sub(g)};const S=o.points.length;return s(T=>T.insertPointAtIndex(S,g)),{pointIndex:S,offset:I.ZERO}})();return c(y),{couldBeTap:!1,pointerCapture:!0,onMove:b=>{const S=a(b);s(T=>T.updatePointAtIndex(y,S.add(k)))},onEnd:b=>{const S=a(b);s(T=>T.updatePointAtIndex(y,S.add(k))),c(null)},onCancel:()=>{c(null)}}}}),[f,x]=M.exports.useState(null),v={line:o,hoveredPointIdx:d?null:f,activePointIdx:l,showExtras:u,onPointerDown:p.onPointerDown,onPointerMove:m=>{d||x(h(m)),p.onPointerMove(m)},onPointerUp:p.onPointerUp,onPointerCancel:p.onPointerCancel};return P(A,{children:[n(W,{...v,layers:[u&&O({style:"dotted"}),Pt],location:B.fromLeftTopWidthHeight(16,0,r,i)}),n(W,{...v,layers:[u&&O({style:"dotted"}),mt,ft],location:B.fromLeftTopWidthHeight(r+16*2,0,r,i)}),n(W,{...v,layers:[ut],location:B.fromLeftTopWidthHeight(16,i+16,r,i)}),n(W,{...v,layers:[xt],location:B.fromLeftTopWidthHeight(r+16*2,i+16,r,i)})]})}function W({location:t,line:o,hoveredPointIdx:s,activePointIdx:e,layers:r=[],showExtras:i,onPointerDown:u,onPointerMove:a,onPointerUp:h,onPointerCancel:l}){const[c,p]=M.exports.useState(null);return P("div",{className:"absolute overflow-hidden rounded-lg bg-white",style:{left:t.left,top:t.top,width:t.width,height:t.height},children:[n("div",{className:"absolute inset-0 ",onPointerDown:d=>{console.log("a",d.currentTarget),u(d)},onPointerMove:a,onPointerUp:h,onPointerCancel:l,children:n("svg",{className:"absolute inset-0 h-full w-full",children:P("g",{transform:`translate(${t.width/2}, ${t.height/2})`,children:[r.map((d,f)=>d&&c&&n(M.exports.Fragment,{children:d({line:o,showExtras:i,uiTarget:c})},f)),i&&o.points.map((d,f)=>n("circle",{cx:d.x,cy:d.y,r:6,strokeWidth:2,className:ct("stroke-blue-600",f===e?"fill-blue-600":f===s?"fill-blue-300":"fill-white")},f))]})})}),n("div",{className:"pointer-events-auto absolute z-10 w-full",ref:p})]})}const kt=K(document.getElementById("root"),'Assertion Error: document.getElementById("root")');tt(kt).render(n(Z.StrictMode,{children:n(Tt,{})}));
