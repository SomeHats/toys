var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},o={},i=e.parcelRequire0561;null==i&&((i=function(e){if(e in t)return t[e].exports;if(e in o){var i=o[e];delete o[e];var s={id:e,exports:{}};return t[e]=s,i.call(s.exports,s,s.exports),s.exports}var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){o[e]=t},e.parcelRequire0561=i);var s=i("6i1fg"),n=i("96RKe");const r={assert:(n=i("96RKe")).noop,clear:n.noop,count:n.noop,countReset:n.noop,debug:n.noop,dir:n.noop,dirxml:n.noop,error:n.noop,group:n.noop,groupCollapsed:n.noop,groupEnd:n.noop,info:n.noop,log:n.noop,table:n.noop,time:n.noop,timeEnd:n.noop,timeLog:n.noop,timeStamp:n.noop,trace:n.noop,warn:n.noop,profile:n.noop,profileEnd:n.noop,Console:console.Console};s=i("6i1fg");function d(e,t,o=r){for(const i of e.iterateRootNodes())a(e,i,t,o)}function a(e,t,o,i=r){const n=t,d=Array.from(e.iterateChildNodes(t))[0],a=d?Array.from(e.iterateChildNodes(d))[0]:void 0;if(!n||!d||!a)return;const l=n.toCircle(),h=d.toCircle(),c=a.toCircle(),u=l.outerTangentsWith(h),p=h.outerTangentsWith(c);if(!u||!p)return;const g=u[0],b=p[0];o.debugLine2(g,{color:"lime"}),o.debugLine2(b,{color:"lime"});const f=g.pointAtIntersectionWith(b),y=h.center.angleTo(f),x=g.isPointWithinBounds(f)&&b.isPointWithinBounds(f)?f:h.pointOnCircumference(y);o.debugPointX(x);const v=g.start,m=x,w=g.start.lerp(g.end,.2).sub(v),k=s.default.fromPolar(y+Math.PI/2,.2*g.length);o.debugVectorAtPoint(w,v),o.debugVectorAtPoint(k,m),o.debugBezierCurve(v,v.add(w),m.sub(k),m)}n=i("96RKe"),s=i("6i1fg");const l=new s.default(5,0),h=.75*Math.PI;const c=document.createElement("canvas"),u=c.getContext("2d"),p=document.body.clientWidth,g=document.body.clientHeight,b=window.devicePixelRatio;c.width=p*b,c.height=g*b,c.style.width=`${p}px`,c.style.height=`${g}px`,u.scale(b,b);const f=new class{clear(e){e?(this.applyFillOptions({fill:e}),this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)):this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}beginPath(){this.ctx.beginPath()}moveTo({x:e,y:t}){this.ctx.moveTo(e,t)}lineTo({x:e,y:t}){this.ctx.lineTo(e,t)}arc({x:e,y:t},o,i,s,n){this.ctx.arc(e,t,o,i,s,n)}arcTo(e,t,o){this.ctx.arcTo(e.x,e.y,t.x,t.y,o)}quadraticCurveTo(e,t){this.ctx.quadraticCurveTo(e.x,e.y,t.x,t.y)}bezierCurveTo(e,t,o){this.ctx.bezierCurveTo(e.x,e.y,t.x,t.y,o.x,o.y)}applyStrokeOptions({strokeWidth:e=1,stroke:t,strokeCap:o="butt",strokeDash:i=[],strokeDashOffset:s=0,strokeJoin:n="round"}){t&&(this.ctx.lineWidth=e,this.ctx.strokeStyle=t,this.ctx.lineCap=o,this.ctx.setLineDash(i),this.ctx.lineDashOffset=s,this.ctx.lineJoin=n)}stroke(e){e.stroke&&(this.applyStrokeOptions(e),this.ctx.stroke())}applyFillOptions({fill:e}){e&&(this.ctx.fillStyle=e)}fill(e){e.fill&&(this.applyFillOptions(e),this.ctx.fill())}applyStrokeAndFillOptions(e){this.applyFillOptions(e),this.applyStrokeOptions(e)}strokeAndFill(e){this.fill(e),this.stroke(e)}getDebugStrokeOptions(e="magenta"){return{stroke:e,strokeWidth:.5}}debugStroke(e="magenta"){this.stroke(this.getDebugStrokeOptions(e))}fillText(e,t,o={}){this.applyFillOptions(o),this.ctx.fillText(e,t.x,t.y)}circle(e,t,o){this.beginPath(),this.arc(e,t,0,2*Math.PI),this.strokeAndFill(o)}ellipse(e,t,o,i){this.beginPath(),this.ctx.ellipse(e.x,e.y,t,o,0,0,2*Math.PI),this.strokeAndFill(i)}debugLabel(e,t,o){e&&(this.applyFillOptions({fill:o}),this.fillText(e,t.add(l)))}debugPointX(e,{color:t="magenta",label:o}={}){this.debugLabel(o,e,t),this.beginPath(),this.ctx.moveTo(e.x-3,e.y-3),this.ctx.lineTo(e.x+3,e.y+3),this.ctx.moveTo(e.x+3,e.y-3),this.ctx.lineTo(e.x-3,e.y+3),this.stroke({strokeWidth:.5,stroke:t})}debugPointO(e,{color:t="magenta",label:o}={}){this.debugLabel(o,e,t),this.circle(e,3,{strokeWidth:.5,stroke:t})}debugArrow(e,t,{color:o="magenta",label:i}={}){this.debugLabel(i,s.default.average([e,t]),o),this.ctx.beginPath(),this.moveTo(e),this.lineTo(t);const n=t.sub(e),r=n.rotate(-h).withMagnitude(5).add(t),d=n.rotate(+h).withMagnitude(5).add(t);this.moveTo(r),this.lineTo(t),this.lineTo(d),this.stroke({strokeWidth:.5,stroke:o})}debugVectorAtPoint(e,t,o){this.debugArrow(t,t.add(e),o)}polygon(e,t={}){this.beginPath(),this.moveTo(e[e.length-1]);for(const t of e)this.lineTo(t);this.strokeAndFill(t)}polyLine(e,t={}){this.beginPath(),this.moveTo(e[0]);for(let t=1;t<e.length;t++)this.lineTo(e[t]);this.stroke(t)}debugPolygon(e,{color:t="magenta",label:o}={}){this.debugLabel(o,e[0],t),this.polygon(e,this.getDebugStrokeOptions(t))}debugPolyLine(e,{color:t="magenta",label:o}={}){this.debugLabel(o,e[0],t),this.polyLine(e,this.getDebugStrokeOptions(t))}debugQuadraticCurve(e,t,o,{color:i="magenta",label:s}={}){this.debugLabel(s,e,i),this.beginPath(),this.moveTo(e),this.quadraticCurveTo(t,o),this.stroke(this.getDebugStrokeOptions(i))}debugBezierCurve(e,t,o,i,{color:s="magenta",label:n}={}){this.debugLabel(n,e,s),this.beginPath(),this.moveTo(e),this.bezierCurveTo(t,o,i),this.stroke(this.getDebugStrokeOptions(s))}debugLine2(e,{color:t="magenta",label:o}={}){this.debugLabel(o,e.start,t),this.debugArrow(e.start,e.end,{color:t,label:o})}aabb(e,t){t.debug&&this.debugLabel(t.debug.label,e.origin,t.debug.color||"magenta"),this.ctx.beginPath(),this.ctx.rect(e.left,e.top,e.width,e.height),this.strokeAndFill(t)}constructor(e){this.ctx=e}}(u);document.body.appendChild(c);var y=i("87DYR"),x=i("4TER2");class v{static create(e,t){return new v(v.ids.next(),e,t)}toCircle(){return new x.default(this.position,this.radius)}constructor(e,t,o){this.id=e,this.position=t,this.radius=o}}v.ids=new class{next(){return`${this.prefix}${this.number++}`}constructor(e){this.prefix=e,this.number=0}}("BlobTreeNode");s=i("6i1fg");const m=new class{getSelectedNode(){switch(this.state.type){case"idle":return null;case"createNode":case"selectedIdle":case"moveNode":case"resizeNode":return this.state.node;default:n.exhaustiveSwitchError(this.state)}}getHover(){let e=null,t=1/0;for(const o of this.blobTree.iterateNodes()){const i=o.position.distanceTo(this.mousePosition);i>o.radius+6||i<t&&(t=i,e=o)}if(!e)return null;const o=Math.min(.1*e.radius,6);return{node:e,mode:t<e.radius-o?"center":"edge"}}onMouseMove(e){this.mousePosition=e}onMouseDown(e){switch(this.state.type){case"idle":case"selectedIdle":{const t=this.getHover();if(t)switch(t.mode){case"center":return void(this.state={type:"moveNode",node:t.node,offset:t.node.position.sub(this.mousePosition)});case"edge":return void(this.state={type:"resizeNode",node:t.node,offset:t.node.radius-t.node.position.distanceTo(this.mousePosition)});default:n.exhaustiveSwitchError(t.mode)}return void(this.state={type:"createNode",node:"idle"===this.state.type?this.blobTree.createNewRoot(e,1):this.blobTree.createNewChild(this.state.node,e,1)})}case"selectedIdle":return void(this.state={type:"createNode",node:this.blobTree.createNewChild(this.state.node,e,1)});case"createNode":case"moveNode":case"resizeNode":return;default:n.exhaustiveSwitchError(this.state)}}onMouseUp(e){switch(this.state.type){case"idle":case"selectedIdle":return;case"createNode":case"moveNode":case"resizeNode":return void(this.state={type:"selectedIdle",node:this.state.node});default:n.exhaustiveSwitchError(this.state)}}onKeyDown(e){console.log(e)," "===e&&d(this.blobTree,this.canvas,console)}tick(){switch(this.state.type){case"idle":return;case"createNode":return void(this.state.node.radius=this.state.node.position.distanceTo(this.mousePosition));case"moveNode":return void(this.state.node.position=this.mousePosition.add(this.state.offset));case"resizeNode":this.state.node.radius=this.mousePosition.distanceTo(this.state.node.position)+this.state.offset;case"selectedIdle":return;default:n.exhaustiveSwitchError(this.state)}}draw(){this.canvas.clear();this.getSelectedNode();const e=this.getHover();this.canvas.beginPath(),d(this.blobTree,this.canvas);for(const t of this.blobTree.iterateNodes()){const o=t===this.getSelectedNode()?{stroke:"lime",strokeWidth:2}:t===(null==e?void 0:e.node)?{stroke:"lime",strokeWidth:1}:{stroke:"magenta",strokeWidth:1};this.canvas.circle(t.position,t.radius,o);for(const e of this.blobTree.iterateChildNodes(t))this.canvas.polyLine([t.position,e.position],{stroke:"cyan",strokeWidth:1})}}constructor(e,t){this.canvas=e,this.blobTree=t,this.mousePosition=s.default.ZERO,this.state={type:"idle"}}}(f,new class{getNodeByIdIfExists(e){return this.nodesById.get(e)}getNodeById(e){const t=this.getNodeByIdIfExists(e);return y.assert(t),t}getNodeParentIfExists(e){const t=this.parentById.get(e.id);if(t)return this.getNodeById(t)}getMutableChildIds(e){let t=this.childrenById.get(e.id);return t||(t=[],this.childrenById.set(e.id,t)),t}createNewRoot(e,t){const o=v.create(e,t);return this.nodesById.set(o.id,o),o}createNewChild(e,t,o){const i=v.create(t,o);return this.nodesById.set(i.id,i),this.parentById.set(i.id,e.id),this.getMutableChildIds(e).push(i.id),i}*iterateNodes(){for(const e of this.nodesById.values())yield e}*iterateChildNodes(e){var t;for(const o of null!==(t=this.childrenById.get(e.id))&&void 0!==t?t:[])yield this.getNodeById(o)}*iterateRootNodes(){for(const e of this.nodesById.values())this.getNodeParentIfExists(e)||(yield e)}constructor(){this.nodesById=new Map,this.childrenById=new Map,this.parentById=new Map}});document.addEventListener("mousemove",(e=>{m.onMouseMove(new s.default(e.clientX,e.clientY))})),document.addEventListener("mousedown",(e=>{m.onMouseDown(new s.default(e.clientX,e.clientY))})),document.addEventListener("mouseup",(e=>{m.onMouseUp(new s.default(e.clientX,e.clientY))})),document.addEventListener("keydown",(e=>{m.onKeyDown(e.key)})),n.frameLoop((()=>{m.tick(),m.draw()}));
//# sourceMappingURL=index.5ed438b6.js.map
