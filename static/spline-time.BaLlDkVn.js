import"./chunk_modulepreload-polyfill.B5Qt9EMX.js";/* empty css                       */import{j as e,c as V}from"./chunk_client.CotzxIPX.js";import{a as G,b as X}from"./chunk_assert.pxkjFBOg.js";import{A as F}from"./chunk_AABB.B469SoIe.js";import{S as H,V as S,R as Y}from"./chunk_Vector2.B_B2dMXe.js";import{a as $,b as K,u as z}from"./chunk_useResizeObserver.DYIaNo-1.js";import{u as Z}from"./chunk_useGestureDetector.Bmm7IKUH.js";import{u as J,A as Q}from"./chunk_useKeyPress.CdSUVvaF.js";import{b as _}from"./chunk_useStoredState.Bfhm1NPl.js";import{B as tt}from"./chunk_Button.J1szTOvc.js";import{S as et,c as ot,T as U}from"./chunk_utils.BtQBvwlT.js";import{S as L}from"./chunk_svgPathBuilder.D8WIOAcJ.js";import{B as O,F as B,D as E,L as W}from"./chunk_guides.DxAroGe8.js";import{a as nt,r as A,R as st}from"./chunk_index.C5eOxiyT.js";import{C as rt}from"./chunk_Circle.CMegmtsq.js";import{C as it}from"./chunk_StraightPathSegment.Bu_aMk_m.js";import{P as at}from"./chunk_Path.DV6-s179.js";import{c as ct}from"./chunk_index.ZX3Pv0I0.js";import"./chunk_ResizeObserver.C8OzoCMD.js";import"./chunk_storage.DBI0bUY6.js";import"./chunk_useMergedRefs.MPIvL6fk.js";import"./chunk_theme.DQE7OmCU.js";import"./chunk_EventEmitter.DASG4daq.js";import"./chunk__commonjsHelpers.Cpj98o6Y.js";import"./chunk_Line2.C-olQP7f.js";const M=class M{constructor(n){this.points=n}insertPointAtIndex(n,s){return new M(et(this.points,n,s))}updatePointAtIndex(n,s){return new M(ot(this.points,n,s))}getClosestPointTo(n){if(this.points.length===0)return null;let s=0,o=this.points[0].distanceTo(n);for(let i=1;i<this.points.length;i++){const u=this.points[i].distanceTo(n);u<o&&(s=i,o=u)}return{index:s,point:this.points[s],distance:o}}getClosestPointIndexWithinRadius(n,s){const o=this.getClosestPointTo(n);return o&&o.distance<=s?o.index:null}};M.schema=H.arrayOf(S.schema).transform(n=>Y.ok(new M(n)),H.cannotValidate("SplineTimeLine"),n=>n.points);let D=M;function k({label:t,uiTarget:n,children:s}){return nt.createPortal(e.jsxs("div",{className:"flex items-baseline justify-between gap-3",onPointerDown:o=>o.stopPropagation(),onPointerMove:o=>o.stopPropagation(),onPointerUp:o=>o.stopPropagation(),onPointerCancel:o=>o.stopPropagation(),children:[e.jsx("div",{className:"flex-auto p-3 font-semibold text-stone-500",children:t}),e.jsx("div",{className:"flex flex-none items-center justify-center gap-3 p-3",children:s})]}),n)}function pt(t){return e.jsx(lt,{...t})}function lt({line:t,showExtras:n,uiTarget:s}){const[o,i]=A.useState(.333),c=[],u=[],r=new L;switch(t.points.length){case 0:case 1:return null;case 2:r.moveTo(t.points[0]),r.lineTo(t.points[1]);break;default:{r.moveTo(t.points[0]);let m=null;for(let p=0;p<t.points.length-1;p++){const a=t.points[p],l=t.points[p+1],d=t.points[p+2],x=a.distanceTo(l);let f;if(m&&(f=a.add(m.scale(x*o)),c.push({target:a,control:f})),d){const j=l.distanceTo(d),y=x+j,h=a.lerp(d,x/y),g=(d.x-a.x)*(l.y-a.y)-(d.y-a.y)*(l.x-a.x)>0;u.push(e.jsx(E,{from:a,to:d})),u.push(e.jsx(E,{from:h,to:l}));let P=l.sub(h).normalize().perpendicular();g||(P=P.scale(-1));const v=l.sub(P.scale(x*o));c.push({target:l,control:v}),f?r.bezierCurveTo(f,v,l):r.quadraticCurveTo(v,l),m=P}else G(f,"Assertion Error: controlPointBefore"),r.quadraticCurveTo(f,l)}}}return e.jsxs(e.Fragment,{children:[n&&c.map(({target:m,control:p},a)=>e.jsx(O,{target:m,control:p},a)),n&&u.map((m,p)=>e.jsx(A.Fragment,{children:m},p)),e.jsx(B,{path:r.toString()}),e.jsxs(k,{label:"alex mode",uiTarget:s,children:["slop:",e.jsx("input",{type:"range",value:o,onChange:m=>i(m.currentTarget.valueAsNumber),min:0,max:1,step:.001}),e.jsx("span",{className:"tabular-nums",children:o.toFixed(2)})]})]})}function dt({line:t,uiTarget:n,showExtras:s}){const o=[],i=new L;switch(t.points.length){case 0:case 1:return null;case 2:{i.moveTo(t.points[0]),i.lineTo(t.points[1]);break}default:{i.moveTo(t.points[0]);let c=t.points[0].lerp(t.points[1],.5);i.lineTo(c);for(let u=1;u<t.points.length-1;u++){const r=t.points[u],m=t.points[u+1],p=r.lerp(m,.5),a=c.distanceTo(r),l=p.distanceTo(r),d=Math.min(a,l),x=r.lerp(c,d/a),f=r.lerp(p,d/l);o.push(e.jsx(W,{from:r,to:c,progress:d/a})),o.push(e.jsx(W,{from:r,to:p,progress:d/l})),i.lineTo(x);const j=at.segmentAcrossCircle(new rt(r,d),x.angleTo(r),r.angleTo(f));j instanceof it?(i.lineTo(x),i.arcTo(j.circle.radius,j.circle.radius,0,!1,!j.isAnticlockwise,f)):i.lineTo(f),c=p}i.lineTo(t.points[t.points.length-1])}}return e.jsxs(e.Fragment,{children:[s&&o.map((c,u)=>e.jsx(A.Fragment,{children:c},u)),e.jsx(B,{path:i.toString()}),e.jsx(k,{uiTarget:n,label:"arcs"})]})}function ut(t){return e.jsx(mt,{...t})}function mt({line:t,showExtras:n,uiTarget:s}){const[o,i]=A.useState(.5);if(t.points.length<2)return null;const c=[],u=new L;u.moveTo(t.points[0]);for(let r=0;r<t.points.length-1;r++){const m=r==0?t.points[0]:t.points[r-1],p=t.points[r],a=t.points[r+1],l=r+2<t.points.length?t.points[r+2]:a,d=Math.sqrt(Math.pow(m.x-p.x,2)+Math.pow(m.y-p.y,2)),x=Math.sqrt(Math.pow(p.x-a.x,2)+Math.pow(p.y-a.y,2)),f=Math.sqrt(Math.pow(a.x-l.x,2)+Math.pow(a.y-l.y,2)),j=Math.pow(f,o),y=Math.pow(f,2*o),h=Math.pow(x,o),g=Math.pow(x,2*o),P=Math.pow(d,o),v=Math.pow(d,2*o),T=2*v+3*P*h+g,b=2*y+3*j*h+g;let w=3*P*(P+h);w>0&&(w=1/w);let C=3*j*(j+h);C>0&&(C=1/C);let I=new S((-g*m.x+T*p.x+v*a.x)*w,(-g*m.y+T*p.y+v*a.y)*w),N=new S((y*p.x+b*a.x-g*l.x)*C,(y*p.y+b*a.y-g*l.y)*C);I.x==0&&I.y==0&&(I=p),N.x==0&&N.y==0&&(N=a),c.push({target:p,control:I}),c.push({target:a,control:N}),u.bezierCurveTo(I,N,a)}return e.jsxs(e.Fragment,{children:[n&&c.map(({target:r,control:m},p)=>e.jsx(O,{target:r,control:m},p)),e.jsx(B,{path:u.toString()}),e.jsxs(k,{label:"catmull-rom",uiTarget:s,children:["alpha:",e.jsx("input",{type:"range",value:o,onChange:r=>i(r.currentTarget.valueAsNumber),min:.001,max:1,step:.001}),e.jsx("span",{className:"tabular-nums",children:o.toFixed(2)})]})]})}function ht({line:t,uiTarget:n}){const s=new L;switch(t.points.length){case 0:case 1:return null;case 2:{s.moveTo(t.points[0]),s.lineTo(t.points[1]);break}default:s.moveTo(t.points[0]),s.lineTo(t.points[0].lerp(t.points[1],.5));for(let o=1;o<t.points.length-1;o++)s.quadraticCurveTo(t.points[o],t.points[o].lerp(t.points[o+1],.5));s.lineTo(t.points[t.points.length-1])}return e.jsxs(e.Fragment,{children:[e.jsx(B,{path:s.toString()}),e.jsx(k,{uiTarget:n,label:"midpoint quadratic"})]})}function xt({line:t,showExtras:n}){if(!n)return null;const s=U(t.points,2).map(([o,i],c)=>e.jsx(W,{from:o,to:i,progress:.5},c));return e.jsx(e.Fragment,{children:s})}function q({style:t}){return t==="final"?({line:n})=>{if(!n.points.length)return null;const s=new L;s.moveTo(n.points[0]);for(let o=1;o<n.points.length;o++)s.lineTo(n.points[o]);return e.jsx(B,{path:s.toString()})}:({line:n})=>{const s=U(n.points,2).map(([o,i],c)=>e.jsx(E,{from:o,to:i},c));return e.jsx(e.Fragment,{children:s})}}const ft=20,gt=[[-150,75],[0,-50],[0,50],[150,-75]].map(([t,n])=>new S(t,n));function Pt(){const[t,n]=A.useState(null),s=$(t,K),[o,i]=_("splineTime.line",D.schema,()=>new D(gt));return e.jsxs("div",{className:"absolute inset-0 flex flex-col bg-stone-100",children:[e.jsxs("div",{className:"flex flex-none items-center justify-between gap-3 bg-stone-100 px-4 py-3",children:[e.jsx("h1",{className:"flex-none font-bold tracking-wide text-stone-600",children:"spline time"}),e.jsx("div",{className:"text-stone-500",children:"click/drag to create/move points. hold shift to hide annotations."}),e.jsx(tt,{onClick:()=>i(new D([])),children:"reset"})]}),e.jsx("div",{className:"relative flex-auto touch-none",ref:n,children:s&&e.jsx(jt,{size:s,line:o,setLine:i})})]})}function jt({size:t,line:n,setLine:s}){const i=(t.x-48)/2,c=(t.y-16*2)/2,u=!J({key:"Shift",shift:Q}),r=z(h=>{const g=h.currentTarget.getBoundingClientRect();return new S(h.clientX-g.left-i/2,h.clientY-g.top-c/2)}),m=z(h=>n.getClosestPointIndexWithinRadius(r(h),ft)),[p,a]=A.useState(null),{events:l,isGestureInProgress:d}=Z({onDragStart:h=>{h.preventDefault();const g=r(h),{pointIndex:P,offset:v}=(()=>{const T=m(h);if(T!==null)return{pointIndex:T,offset:n.points[T].sub(g)};const b=n.points.length;return s(w=>w.insertPointAtIndex(b,g)),{pointIndex:b,offset:S.ZERO}})();return a(P),{couldBeTap:!1,pointerCapture:!0,onMove:T=>{const b=r(T);s(w=>w.updatePointAtIndex(P,b.add(v)))},onEnd:T=>{const b=r(T);s(w=>w.updatePointAtIndex(P,b.add(v))),a(null)},onCancel:()=>{a(null)}}}}),[x,f]=A.useState(null),y={line:n,hoveredPointIdx:d?null:x,activePointIdx:p,showExtras:u,onPointerDown:l.onPointerDown,onPointerMove:h=>{d||f(m(h)),l.onPointerMove(h)},onPointerUp:l.onPointerUp,onPointerCancel:l.onPointerCancel};return e.jsxs(e.Fragment,{children:[e.jsx(R,{...y,layers:[u&&q({style:"dotted"}),dt],location:F.fromLeftTopWidthHeight(16,0,i,c)}),e.jsx(R,{...y,layers:[u&&q({style:"dotted"}),ht,xt],location:F.fromLeftTopWidthHeight(i+16*2,0,i,c)}),e.jsx(R,{...y,layers:[ut],location:F.fromLeftTopWidthHeight(16,c+16,i,c)}),e.jsx(R,{...y,layers:[pt],location:F.fromLeftTopWidthHeight(i+16*2,c+16,i,c)})]})}function R({location:t,line:n,hoveredPointIdx:s,activePointIdx:o,layers:i=[],showExtras:c,onPointerDown:u,onPointerMove:r,onPointerUp:m,onPointerCancel:p}){const[a,l]=A.useState(null);return e.jsxs("div",{className:"absolute overflow-hidden rounded-lg bg-white",style:{left:t.left,top:t.top,width:t.width,height:t.height},children:[e.jsx("div",{className:"absolute inset-0 ",onPointerDown:d=>{console.log("a",d.currentTarget),u(d)},onPointerMove:r,onPointerUp:m,onPointerCancel:p,children:e.jsx("svg",{className:"absolute inset-0 h-full w-full",children:e.jsxs("g",{transform:`translate(${t.width/2}, ${t.height/2})`,children:[i.map((d,x)=>d&&a&&e.jsx(A.Fragment,{children:d({line:n,showExtras:c,uiTarget:a})},x)),c&&n.points.map((d,x)=>e.jsx("circle",{cx:d.x,cy:d.y,r:6,strokeWidth:2,className:ct("stroke-blue-600",x===o?"fill-blue-600":x===s?"fill-blue-300":"fill-white")},x))]})})}),e.jsx("div",{className:"pointer-events-auto absolute z-10 w-full",ref:l})]})}const wt=X(document.getElementById("root"),'Assertion Error: document.getElementById("root")');V(wt).render(e.jsx(st.StrictMode,{children:e.jsx(Pt,{})}));
