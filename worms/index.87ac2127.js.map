{"mappings":"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","sources":["src/worms/canvas.ts","src/lib/assert.ts","src/worms/colors.ts","src/worms/worms-main.ts"],"sourcesContent":["import { DebugDraw } from '../lib/DebugDraw';\n\nexport const canvasEl = document.createElement('canvas');\nexport const ctx = canvasEl.getContext('2d')!;\nexport const width = document.body.clientWidth;\nexport const height = document.body.clientHeight;\nexport const scale = window.devicePixelRatio;\n\ncanvasEl.width = width * scale;\ncanvasEl.height = height * scale;\ncanvasEl.style.width = `${width}px`;\ncanvasEl.style.height = `${height}px`;\nctx.scale(scale, scale);\nexport const canvas = new DebugDraw(ctx);\ndocument.body.appendChild(canvasEl);\n","export function fail(message: string): never {\n  throw new Error(message);\n}\n\nexport function assert(value: unknown, message?: string): asserts value {\n  if (!value) {\n    fail(message || 'Assertion Error');\n  }\n}\n","import Color from 'color';\n\n// // https://coolors.co/f2dc5d-f2a359-db9065-a4031f-240b36\n// export const BG = new Color('#240b36');\n// export const SNAKES = [\n//   new Color('#f2dc5d'),\n//   new Color('#f2a359'),\n//   new Color('#db9065'),\n//   new Color('#a4031f'),\n// ];\n\n// https://coolors.co/ba2d0b-d5f2e3-73ba9b-003e1f-01110a\n// export const BG = new Color('#01110a');\n\n// export const SNAKES = [\n//   new Color('#ba2d0b'),\n//   new Color('#d5f2e3'),\n//   new Color('#73ba9b'),\n//   new Color('#003e1f'),\n// ];\n\n// https://coolors.co/f4e04d-f2ed6f-cee397-8db1ab-587792\nexport const BG = new Color('#E2ECC9');\nexport const SNAKES = [\n  new Color('#C33C54'),\n  new Color('#bfb915'),\n  new Color('#96ba3b'),\n  new Color('#39847f'),\n  new Color('#12416b'),\n];\n","import { canvas, width, height } from './canvas';\nimport Vector2 from '../lib/geom/Vector2';\nimport {\n  compact,\n  getId,\n  sample,\n  shuffle,\n  times,\n  randomInt,\n  frameLoop,\n  uniq,\n  random,\n} from '../lib/utils';\nimport createTriangleGrid, { Triangle } from '../lib/createTriangleGrid';\nimport { assert } from '../lib/assert';\nimport { SNAKES, BG } from './colors';\nimport { schemePaired } from 'd3-scale-chromatic';\n\nconst TILE_SIZE = 50;\nconst ARC_LENGTH = (Math.PI * TILE_SIZE) / 6;\n\nconst trianglesById = createTriangleGrid(TILE_SIZE, width, height);\n\n// for (const triangle of trianglesById.values()) {\n//   canvas.debugPolygon(triangle.points, { color: 'lime' });\n// }\n\ntype Palatte = {\n  palette: Array<string>;\n  current(): string;\n  next(): string;\n  reset(idx?: number): void;\n};\nconst makeColorPalette = (): Palatte => {\n  const palette = times(randomInt(2, 6), () => sample(SNAKES).string());\n  if (uniq(palette).length === 1) return makeColorPalette();\n\n  let i = 0;\n  return {\n    palette,\n    current: () => {\n      return palette[i % palette.length];\n    },\n    next: () => {\n      i++;\n      return palette[i % palette.length];\n    },\n    reset: (idx = 0) => {\n      i = idx;\n    },\n  };\n};\n\nfunction getSharedPoints(a: Triangle, b: Triangle) {\n  const neighbour = a.neighbours.find(n => n.triangle === b);\n  assert(neighbour, 'must be a neighbour');\n  return neighbour.sharedPoints;\n}\n\nconst occupied = new Set<Triangle>();\ntype Snake = {\n  triangles: Array<Triangle>;\n  palette: ReturnType<typeof makeColorPalette>;\n  speed: number;\n  base: number;\n  offset: number;\n  length: number;\n  isDead: boolean;\n};\n\nconst makeSnake = () => {\n  const triangles: Array<Triangle> = [];\n  const palette = makeColorPalette();\n  let neighbours = [...trianglesById.values()];\n  for (let i = 0; i < 2; i++) {\n    const availableNeighbours = neighbours.filter(\n      neighbour => !occupied.has(neighbour),\n    );\n    if (!availableNeighbours.length) break;\n    const triangle = sample(availableNeighbours);\n    triangles.push(triangle);\n    occupied.add(triangle);\n    neighbours = triangle.neighbours.map(n => n.triangle);\n  }\n\n  // if (triangles.length < 2) continue;\n  return {\n    triangles,\n    palette,\n    speed: random(0.06, 0.12),\n    offset: 0,\n    base: 0,\n    length: triangles.length,\n    isDead: false,\n  };\n};\nconst snakes: Snake[] = [];\n\nfor (let si = 0; si < 10; si++) {\n  snakes.push(makeSnake());\n}\n\nframeLoop(() => {\n  canvas.clear(BG.string());\n\n  for (const snake of snakes) {\n    snake.offset += snake.speed;\n    if (snake.offset > 1) {\n      snake.offset--;\n      snake.base++;\n\n      if (!snake.isDead) {\n        const headTriangle = snake.triangles[0];\n        const availableNeighbours = headTriangle.neighbours.filter(\n          neighbour => !occupied.has(neighbour.triangle),\n        );\n        if (availableNeighbours.length) {\n          const triangle = sample(availableNeighbours).triangle;\n          occupied.add(triangle);\n          snake.triangles.unshift(triangle);\n          snake.base--;\n          snake.length++;\n        } else {\n          snake.isDead = true;\n          snakes.push(makeSnake());\n        }\n      }\n\n      const lastTriangle = snake.triangles[snake.triangles.length - snake.base];\n      if (lastTriangle) {\n        occupied.delete(lastTriangle);\n        snake.length--;\n      }\n    }\n\n    const { triangles, palette } = snake;\n    palette.reset(snake.base);\n    for (let i = 0; i < snake.length; i++) {\n      const triangle = triangles[i];\n      const last: Triangle | undefined = triangles[i - 1];\n      const next: Triangle | undefined = triangles[i + 1];\n      const currentColor = palette.current();\n      const nextColor = palette.next();\n\n      canvas.beginPath();\n      if (!last) {\n        continue;\n        // assert(next);\n        // const neck = Vector2.average(getSharedPoints(triangle, next));\n        // const head = triangle.center\n        //   .sub(neck)\n        //   .withMagnitude(ARC_LENGTH)\n        //   .add(neck);\n        // canvas.moveTo(head);\n        // canvas.lineTo(neck);\n      } else if (!next) {\n        assert(last);\n        canvas.moveTo(Vector2.average(getSharedPoints(triangle, last)));\n        canvas.lineTo(triangle.center);\n      } else {\n        canvas.moveTo(Vector2.average(getSharedPoints(triangle, last)));\n        canvas.arcTo(triangle.center, next.center, TILE_SIZE / 2 - 0.5);\n      }\n      if (!(i === 1 && !snake.isDead)) {\n        canvas.stroke({\n          strokeWidth: TILE_SIZE / 2,\n          stroke: currentColor,\n          strokeCap: 'round',\n          strokeDash: [ARC_LENGTH, ARC_LENGTH],\n          strokeDashOffset: snake.offset * ARC_LENGTH,\n        });\n      }\n      if (!(i === snake.length - 1 && snake.isDead)) {\n        canvas.stroke({\n          strokeWidth: TILE_SIZE / 2,\n          stroke: nextColor,\n          strokeCap: 'round',\n          strokeDash: [ARC_LENGTH, ARC_LENGTH],\n          strokeDashOffset: snake.offset * ARC_LENGTH - ARC_LENGTH,\n        });\n      }\n    }\n  }\n});\n"],"names":["$b3c7083e9080e657$export$4d41f66daf6338dc","document","createElement","$b3c7083e9080e657$export$a4ecf2d011151542","getContext","$b3c7083e9080e657$export$b7952bcb5d125510","body","clientWidth","$b3c7083e9080e657$export$5e9f82a2cb459528","clientHeight","$b3c7083e9080e657$export$8f869025bba9609b","window","devicePixelRatio","width","height","style","concat","scale","$b3c7083e9080e657$export$dd37cca076be4c97","$bK7pi","DebugDraw","appendChild","$52750c4f2800ba92$export$b8795f4f643ce74f","value","message","Error","$52750c4f2800ba92$export$62d771998a1345d1","$9ac8ee26b70516ab$export$be5a783879320ec3","$parcel$interopDefault","$aG1uz","$9ac8ee26b70516ab$export$9de115b64c1e7807","$b2045f7671f5356f$var$ARC_LENGTH","Math","PI","$b2045f7671f5356f$var$trianglesById","$44e7r","default","$b2045f7671f5356f$var$makeColorPalette","palette","$8pNpe","times","randomInt","sample","string","uniq","length","i","current","next","reset","param","$b2045f7671f5356f$var$getSharedPoints","a","b","neighbour","neighbours","find","n","triangle","sharedPoints","$b2045f7671f5356f$var$occupied","Set","$b2045f7671f5356f$var$makeSnake","triangles","$eUMMJ","toConsumableArray","values","availableNeighbours","filter","has","push","add","map","speed","random","offset","base","isDead","$b2045f7671f5356f$var$snakes","si","frameLoop","clear","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","done","snake","unshift","lastTriangle","delete","last","currentColor","nextColor","beginPath","moveTo","$54lVR","average","arcTo","center","$b2045f7671f5356f$var$TILE_SIZE","lineTo","stroke","strokeWidth","strokeCap","strokeDash","strokeDashOffset","err","return"],"version":3,"file":"index.87ac2127.js.map"}