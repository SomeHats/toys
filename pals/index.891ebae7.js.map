{"mappings":"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","sources":["src/pals/PalController.ts","src/pals/PalGeom.ts","src/pals/PalLegGeom.ts","src/pals/PalRenderer.ts","src/lib/canvasShapeHelpers.ts","src/lib/geom/StraightPathSegment.ts","src/lib/geom/CirclePathSegment.ts","src/pals/PalWalkAnimationController.ts","src/pals/PalConfig.ts","src/pals/colors.ts"],"sourcesContent":["import Component from '../lib/scene/Component';\nimport { constrain, normalizeAngle } from '../lib/utils';\nimport Vector2 from '../lib/geom/Vector2';\nimport Entity from '../lib/scene/Entity';\n\nconst MAX_SPEED = 80;\nconst ACCELERATION = 200;\nconst DECELERATION = 200;\n\nexport class PalControlData extends Component {\n  speed: number = 0;\n  position: Vector2;\n  heading: number = 0;\n  headingVelocity: number = 0;\n\n  constructor(entity: Entity, position: Vector2) {\n    super(entity);\n    this.position = position;\n  }\n\n  getVelocity(): Vector2 {\n    return this.getHeadingVec().scale(this.speed);\n  }\n\n  private getHeadingVec(): Vector2 {\n    return Vector2.fromPolar(this.heading, 1);\n  }\n}\n\nexport class PalTargetController extends Component {\n  private data: PalControlData;\n  private target: Vector2;\n\n  constructor(entity: Entity, position: Vector2) {\n    super(entity);\n    this.target = position;\n    this.data = entity.addComponent(PalControlData, position);\n  }\n\n  setTarget(newTarget: Vector2) {\n    this.target = newTarget;\n  }\n\n  update(dtMilliseconds: number) {\n    const dtSeconds = dtMilliseconds / 1000;\n    const angleToTarget = this.data.position.angleTo(this.target);\n\n    const distance = this.target.distanceTo(this.data.position);\n    if (distance > 15) {\n      this.accelerate(ACCELERATION, dtSeconds);\n    } else {\n      this.accelerate(-DECELERATION, dtSeconds);\n    }\n\n    if (distance > 10) {\n      const angleDelta = normalizeAngle(angleToTarget - this.data.heading);\n      const lastHeading = this.data.heading;\n      this.data.heading += angleDelta / 10;\n      this.data.headingVelocity =\n        normalizeAngle(this.data.heading - lastHeading) / dtSeconds;\n    } else {\n      this.data.headingVelocity = 0;\n    }\n  }\n\n  private accelerate(amt: number, dtSeconds: number) {\n    const lastSpeed = this.data.speed;\n    this.data.speed = constrain(\n      0,\n      MAX_SPEED,\n      this.data.speed + amt * dtSeconds,\n    );\n    const avgSpeed = (lastSpeed + this.data.speed) / 2;\n    this.data.position = this.data.position.add(\n      Vector2.fromPolar(this.data.heading, avgSpeed * dtSeconds),\n    );\n  }\n}\n\nexport class PalAbsoluteController extends Component {\n  private data: PalControlData;\n\n  constructor(entity: Entity, position: Vector2) {\n    super(entity);\n    this.data = entity.addComponent(PalControlData, position);\n  }\n\n  setPosition(position: Vector2, heading: number, dtSeconds: number) {\n    const lastPosition = this.data.position;\n    const lastHeading = this.data.heading;\n\n    this.data.heading = heading;\n    this.data.headingVelocity =\n      normalizeAngle(this.data.heading - lastHeading) / dtSeconds;\n    this.data.speed = lastPosition.distanceTo(position) / dtSeconds;\n    this.data.position = position;\n  }\n}\n","import Component from '../lib/scene/Component';\nimport Entity from '../lib/scene/Entity';\nimport Circle from '../lib/geom/Circle';\nimport { PalControlData } from './PalController';\nimport { shuffle, flatten, times, lerp } from '../lib/utils';\nimport { PalConfig } from './PalConfig';\nimport PalLegGeom, { PalLegGeomUpdate } from './PalLegGeom';\nimport { assert } from '../lib/assert';\n\nconst HALF_PI = Math.PI / 2;\n\nexport type PalGeomUpdate = {\n  bobAmount: number;\n  legs: Array<PalLegGeomUpdate>;\n};\n\nexport interface PalAnimationController {\n  update(\n    dtMilliseconds: number,\n    controlData: PalControlData,\n    legs: Array<PalLegGeom>,\n  ): PalGeomUpdate;\n}\n\nexport default class PalGeom extends Component {\n  private controlData: PalControlData;\n  legs: Array<PalLegGeom>;\n  private animationController: PalAnimationController | null = null;\n  private bobAmount: number = 0;\n\n  constructor(entity: Entity, private config: PalConfig) {\n    super(entity);\n    this.controlData = entity.getComponent(PalControlData);\n    this.legs = shuffle(\n      flatten(\n        times(config.legPairs, (n) => {\n          const progress = (n + 1) / (config.legPairs + 1);\n          return [\n            new PalLegGeom(\n              this.controlData,\n              this,\n              config,\n              lerp(HALF_PI - 1, HALF_PI + 1, progress),\n            ),\n            new PalLegGeom(\n              this.controlData,\n              this,\n              config,\n              lerp(-HALF_PI + 1, -HALF_PI - 1, progress),\n            ),\n          ];\n        }),\n      ),\n    );\n  }\n\n  setAnimationController(animationController: PalAnimationController) {\n    this.animationController = animationController;\n  }\n\n  update(dtMilliseconds: number) {\n    if (this.animationController) {\n      const update = this.animationController.update(\n        dtMilliseconds,\n        this.controlData,\n        this.legs,\n      );\n      this.bobAmount = update.bobAmount;\n\n      assert(update.legs.length === this.legs.length);\n      this.legs.forEach((leg, i) => leg.update(update.legs[i]));\n    }\n  }\n\n  getBod(): Circle {\n    const bob = this.config.bodBob * this.bobAmount;\n\n    return Circle.create(\n      this.controlData.position.x,\n      this.controlData.position.y - this.config.bodHeight - bob,\n      this.config.radius,\n    );\n  }\n}\n","import PalGeom from './PalGeom';\nimport { PalConfig } from './PalConfig';\nimport Vector2 from '../lib/geom/Vector2';\nimport { PalControlData } from './PalController';\nimport { lerp } from '../lib/utils';\n\nconst getLegRadius = ({ radius, hipHeight, legWidth }: PalConfig) =>\n  Math.sqrt(radius * radius - (radius - hipHeight) * (radius - hipHeight)) -\n  legWidth;\n\nexport type PalLegGeomUpdate = {\n  footXY: Vector2;\n  footProjectionOrigin: Vector2;\n  liftAmount: number;\n};\n\nexport default class PalLegGeom {\n  hipRadius: number;\n  kneeRadius: number;\n  floorRadius: number;\n\n  footXY: Vector2;\n  footOrigin: Vector2;\n  liftAmount: number = 0;\n\n  constructor(\n    private palData: PalControlData,\n    private palGeom: PalGeom,\n    private config: PalConfig,\n    public angleOffset: number,\n  ) {\n    this.hipRadius = getLegRadius(config);\n    this.kneeRadius = getLegRadius(config) * config.kneeScale;\n    this.floorRadius = getLegRadius(config);\n\n    this.footXY = this.getIdealFootRestingXY();\n    this.footOrigin = this.getIdealFootRestingXY();\n  }\n\n  update(update: PalLegGeomUpdate) {\n    this.footXY = update.footXY;\n    this.footOrigin = update.footProjectionOrigin;\n    this.liftAmount = update.liftAmount;\n  }\n\n  getIdealFootRestingXY(): Vector2 {\n    return Vector2.fromPolar(\n      this.palData.heading + this.angleOffset,\n      this.floorRadius,\n    ).add(this.palData.position);\n  }\n\n  getFootXY(): Vector2 {\n    return this.footXY;\n  }\n\n  getFootZ(): number {\n    return lerp(0, this.getHipZ() * this.config.legMaxLift, this.liftAmount);\n  }\n\n  getFootOrigin(): Vector2 {\n    return this.footOrigin;\n  }\n\n  getKneeXY(): Vector2 {\n    return this.palData.position\n      .add(\n        Vector2.fromPolar(\n          this.palData.heading + this.angleOffset,\n          this.kneeRadius,\n        ),\n      )\n      .add(\n        Vector2.fromPolar(\n          this.palData.heading,\n          this.liftAmount * this.config.kneeMaxOut,\n        ),\n      );\n  }\n\n  getKneeZ(): number {\n    return (this.getFootZ() + this.getHipZ()) / 2;\n  }\n\n  getKneeOrigin(): Vector2 {\n    return this.getHipOrigin().lerp(this.getFootOrigin(), 0.5);\n  }\n\n  getHipXY(): Vector2 {\n    return this.palData.position.add(\n      Vector2.fromPolar(\n        this.palData.heading + this.angleOffset,\n        this.hipRadius,\n      ),\n    );\n    // return this._hipEllipse\n    //   .pointOnCircumference(this.angle)\n    //   .add(this.palData.bod.center);\n  }\n\n  getHipZ(): number {\n    const bod = this.palGeom.getBod();\n    return (\n      this.palData.position.y -\n      bod.center.y -\n      (bod.radius - this.config.hipHeight)\n    );\n  }\n\n  getHipOrigin(): Vector2 {\n    return this.palData.position;\n  }\n}\n","import Component from '../lib/scene/Component';\nimport { PalControlData } from './PalController';\nimport Entity from '../lib/scene/Entity';\nimport PalGeom from './PalGeom';\nimport * as ShapeHelpers from '../lib/canvasShapeHelpers';\nimport { normalizeAngle, constrain } from '../lib/utils';\nimport Circle from '../lib/geom/Circle';\nimport { PalConfig } from './PalConfig';\nimport PalLegGeom from './PalLegGeom';\nimport Vector2 from '../lib/geom/Vector2';\n\nconst Y_SCALE = 0.3;\nconst HALF_PI = Math.PI / 2;\n\nexport default class PalRenderer extends Component {\n  private data: PalControlData;\n  private geom: PalGeom;\n\n  constructor(entity: Entity, private config: PalConfig) {\n    super(entity);\n    this.data = entity.getComponent(PalControlData);\n    this.geom = entity.getComponent(PalGeom);\n  }\n\n  draw(ctx: CanvasRenderingContext2D) {\n    const heading = normalizeAngle(this.data.heading);\n\n    ctx.setLineDash([]);\n    ctx.beginPath();\n\n    const bod = this.geom.getBod();\n    ctx.ellipse(\n      this.data.position.x,\n      this.data.position.y,\n      bod.radius * 0.8,\n      bod.radius * 0.8 * 0.3,\n      0,\n      0,\n      2 * Math.PI,\n    );\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';\n    ctx.fill();\n\n    this.geom.legs\n      .filter(l => normalizeAngle(l.angleOffset + heading) < 0)\n      .forEach(leg => this.drawLeg(ctx, leg));\n    this.geom.legs\n      .filter(l => normalizeAngle(l.angleOffset + heading) >= 0)\n      .forEach(leg => this.drawLeg(ctx, leg));\n    this.drawBod(ctx, bod);\n  }\n\n  private drawLeg(ctx: CanvasRenderingContext2D, leg: PalLegGeom) {\n    ctx.beginPath();\n\n    const angle = this.data.heading + leg.angleOffset;\n\n    const colorDarkenAmount = constrain(\n      0,\n      1,\n      Math.abs(normalizeAngle(-HALF_PI - angle) / HALF_PI),\n    );\n    const legColor = this.config.color.darken(\n      0.2 * (1 - colorDarkenAmount * colorDarkenAmount),\n    );\n\n    const hip = this.projectZ(\n      leg.getHipXY(),\n      leg.getHipZ(),\n      leg.getHipOrigin(),\n    );\n    const knee = this.projectZ(\n      leg.getKneeXY(),\n      leg.getKneeZ(),\n      leg.getKneeOrigin(),\n    );\n    const foot = this.projectZ(\n      leg.getFootXY(),\n      leg.getFootZ(),\n      leg.getFootOrigin(),\n    );\n\n    ctx.moveTo(hip.x, hip.y);\n    ctx.quadraticCurveTo(knee.x, knee.y, foot.x, foot.y);\n    ctx.lineCap = 'round';\n    ctx.strokeStyle = legColor.toString();\n    ctx.lineWidth = this.config.legWidth;\n    ctx.stroke();\n  }\n\n  private drawBod(ctx: CanvasRenderingContext2D, bod: Circle) {\n    ctx.save();\n    ctx.beginPath();\n    ShapeHelpers.circle(ctx, bod.center.x, bod.center.y, this.config.radius);\n    ctx.fillStyle = this.config.color.toString();\n    ctx.fill();\n    ctx.clip();\n\n    const faceX =\n      (normalizeAngle(HALF_PI - this.data.heading) / HALF_PI) *\n      this.config.radius;\n\n    // EYES\n    ctx.beginPath();\n    ShapeHelpers.circle(\n      ctx,\n      faceX + bod.center.x + this.config.eyeX,\n      bod.center.y - this.config.eyeY,\n      this.config.eyeRadius,\n    );\n    ShapeHelpers.circle(\n      ctx,\n      faceX + bod.center.x - this.config.eyeX,\n      bod.center.y - this.config.eyeY,\n      this.config.eyeRadius,\n    );\n    ctx.fillStyle = this.config.color.darken(0.5).toString();\n    ctx.fill();\n\n    // MOUTH\n    ctx.beginPath();\n    ctx.moveTo(\n      faceX + bod.center.x - this.config.mouthWidth,\n      bod.center.y - this.config.mouthY,\n    );\n    ctx.quadraticCurveTo(\n      faceX + bod.center.x,\n      bod.center.y - this.config.mouthY + this.config.mouthSmile,\n      faceX + bod.center.x + this.config.mouthWidth,\n      bod.center.y - this.config.mouthY,\n    );\n    ctx.lineWidth = this.config.mouthThickness;\n    ctx.strokeStyle = this.config.color.darken(0.5).toString();\n    ctx.stroke();\n\n    // BUTT\n    ctx.beginPath();\n    this.makeButtLine(ctx, bod, faceX + this.config.radius * 2);\n    this.makeButtLine(ctx, bod, faceX - this.config.radius * 2);\n    ctx.lineWidth = this.config.buttThickness;\n    ctx.strokeStyle = this.config.color.darken(0.3).toString();\n    ctx.stroke();\n\n    ctx.restore();\n  }\n\n  private makeButtLine(\n    ctx: CanvasRenderingContext2D,\n    bod: Circle,\n    buttX: number,\n  ) {\n    ctx.moveTo(buttX * 1.6 + bod.center.x, bod.center.y + this.config.buttTop);\n    ctx.quadraticCurveTo(\n      buttX * 1.7 + bod.center.x,\n      bod.center.y + (this.config.buttTop + this.config.buttBottom) * 0.65,\n      buttX + bod.center.x,\n      bod.center.y + this.config.buttBottom,\n    );\n  }\n\n  private projectZ(xy: Vector2, z: number, origin: Vector2): Vector2 {\n    return new Vector2(xy.x, origin.y - z + (xy.y - origin.y) * Y_SCALE);\n  }\n}\n","// @flow\nimport Path from './geom/Path';\nimport StraightPathSegment from './geom/StraightPathSegment';\nimport CirclePathSegment from './geom/CirclePathSegment';\n\nexport function circle(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  radius: number,\n) {\n  ctx.arc(x, y, radius, 0, 2 * Math.PI, false);\n}\n\nexport function path(ctx: CanvasRenderingContext2D, path: Path) {\n  if (path.segments.length) {\n    ctx.moveTo(path.segments[0].getStart().x, path.segments[0].getStart().y);\n  }\n\n  for (const segment of path.segments) {\n    if (segment instanceof StraightPathSegment) {\n      ctx.lineTo(segment.getEnd().x, segment.getEnd().y);\n    } else if (segment instanceof CirclePathSegment) {\n      ctx.arc(\n        segment.circle.center.x,\n        segment.circle.center.y,\n        segment.circle.radius,\n        segment.startAngle,\n        segment.endAngle,\n        segment.isAnticlockwise,\n      );\n    } else {\n      throw new Error(`Unknown path segment type: ${segment.toString()}`);\n    }\n  }\n}\n","// @flow\nimport { constrain } from '../utils';\nimport Vector2 from './Vector2';\nimport { PathSegment } from './Path';\nimport Line2 from './Line2';\n\nexport default class StraightPathSegment implements PathSegment {\n  readonly line: Line2;\n  private readonly delta: Vector2;\n\n  constructor(start: Vector2, end: Vector2) {\n    this.line = new Line2(start, end);\n    this.delta = this.line.getDelta();\n    Object.freeze(this);\n  }\n\n  getStart(): Vector2 {\n    return this.line.start;\n  }\n\n  getEnd(): Vector2 {\n    return this.line.end;\n  }\n\n  getDelta(): Vector2 {\n    return this.delta;\n  }\n\n  getLength(): number {\n    return this.delta.magnitude;\n  }\n\n  get angle(): number {\n    return this.delta.angle;\n  }\n\n  getPointAtPosition(position: number): Vector2 {\n    const constrainedPosition = constrain(0, this.getLength(), position);\n    return this.delta.withMagnitude(constrainedPosition).add(this.line.start);\n  }\n\n  getAngleAtPosition(): number {\n    return this.delta.angle;\n  }\n}\n","// @flow\nimport { constrain, mapRange } from '../utils';\nimport Vector2 from './Vector2';\nimport Circle from './Circle';\nimport { PathSegment } from './Path';\n\nexport default class CirclePathSegment implements PathSegment {\n  readonly circle: Circle;\n  readonly startAngle: number;\n  readonly endAngle: number;\n\n  constructor(\n    center: Vector2,\n    radius: number,\n    startAngle: number,\n    endAngle: number,\n  ) {\n    this.circle = Circle.create(center.x, center.y, radius);\n    this.startAngle = startAngle;\n    this.endAngle = endAngle;\n    Object.freeze(this);\n  }\n\n  getStart(): Vector2 {\n    return this.circle.pointOnCircumference(this.startAngle);\n  }\n\n  getEnd(): Vector2 {\n    return this.circle.pointOnCircumference(this.endAngle);\n  }\n\n  get angleDifference(): number {\n    return Math.atan2(\n      Math.sin(this.endAngle - this.startAngle),\n      Math.cos(this.endAngle - this.startAngle),\n    );\n  }\n\n  getLength(): number {\n    const proportion = Math.abs(this.angleDifference) / (Math.PI * 2);\n    return this.circle.circumference * proportion;\n  }\n\n  get isAnticlockwise(): boolean {\n    return this.angleDifference < 0;\n  }\n\n  getPointAtPosition(position: number): Vector2 {\n    const angle = mapRange(\n      0,\n      this.getLength(),\n      this.startAngle,\n      this.startAngle + this.angleDifference,\n      constrain(0, this.getLength(), position),\n    );\n    return this.circle.pointOnCircumference(angle);\n  }\n\n  getAngleAtPosition(position: number): number {\n    if (this.isAnticlockwise) {\n      return (\n        mapRange(\n          0,\n          this.getLength(),\n          this.startAngle,\n          this.startAngle + this.angleDifference,\n          constrain(0, this.getLength(), position),\n        ) -\n        Math.PI / 2\n      );\n    } else {\n      return (\n        mapRange(\n          0,\n          this.getLength(),\n          this.startAngle,\n          this.startAngle + this.angleDifference,\n          constrain(0, this.getLength(), position),\n        ) +\n        Math.PI / 2\n      );\n    }\n  }\n}\n","import { PalAnimationController, PalGeomUpdate } from './PalGeom';\nimport { PalControlData } from './PalController';\nimport PalLegGeom, { PalLegGeomUpdate } from './PalLegGeom';\nimport Vector2 from '../lib/geom/Vector2';\nimport { PalConfig } from './PalConfig';\nimport { constrain, mapRange } from '../lib/utils';\nimport { assert } from '../lib/assert';\n\ntype LegState = {\n  lastFootOnFloorXY: Vector2;\n  lastFootOnFloorPalPosition: Vector2;\n  stepProgress: number;\n  restTimer: number;\n  currentStepMaxLift: number;\n};\n\nfunction isStepping({ stepProgress }: LegState): boolean {\n  return stepProgress > 0;\n}\n\nfunction isResting({ restTimer }: LegState): boolean {\n  return restTimer > 0;\n}\n\nexport default class PalWalkAnimationController\n  implements PalAnimationController {\n  private legStates = new Map<PalLegGeom, LegState>();\n\n  constructor(private config: PalConfig) {}\n\n  update(\n    dtMilliseconds: number,\n    pal: PalControlData,\n    legs: Array<PalLegGeom>,\n  ): PalGeomUpdate {\n    const dtSeconds = dtMilliseconds / 1000;\n\n    for (const leg of legs) {\n      this.updateLegState(dtSeconds, pal, legs, leg);\n    }\n    const legUpdates = legs.map(leg => this.getLegUpdate(pal, leg));\n\n    const totalLift = legUpdates.reduce(\n      (sum, update) => sum + update.liftAmount,\n      0,\n    );\n    const avgLift = totalLift / legs.length;\n\n    return {\n      bobAmount: avgLift,\n      legs: legUpdates,\n    };\n  }\n\n  private canLiftLeg(\n    pal: PalControlData,\n    legs: Array<PalLegGeom>,\n    leg: PalLegGeom,\n  ): boolean {\n    assert(legs.includes(leg), 'whos leg even is this');\n    const enoughLegsOnFloor =\n      legs.filter(l => l !== leg && !isStepping(this.getLegState(pal, leg)))\n        .length > Math.floor(Math.log(legs.length));\n\n    const anyStepsJustStarted = legs.some(leg => {\n      const state = this.getLegState(pal, leg);\n      return (\n        state.stepProgress > 0 && state.stepProgress < 1 / (legs.length / 2)\n      );\n    });\n\n    return enoughLegsOnFloor && !anyStepsJustStarted;\n  }\n\n  private updateLegState(\n    dtSeconds: number,\n    pal: PalControlData,\n    legs: Array<PalLegGeom>,\n    leg: PalLegGeom,\n  ) {\n    const state = this.getLegState(pal, leg);\n\n    state.restTimer = constrain(\n      0,\n      this.config.stepRestDuration,\n      state.restTimer - dtSeconds,\n    );\n    if (isResting(state)) return;\n\n    if (isStepping(state)) {\n      state.stepProgress = constrain(\n        0,\n        1,\n        state.stepProgress + dtSeconds / this.config.stepDuration,\n      );\n\n      if (state.stepProgress === 1) {\n        state.lastFootOnFloorXY = this.getFootXY(pal, leg, state);\n        state.lastFootOnFloorPalPosition = pal.position;\n        state.stepProgress = 0;\n        state.restTimer = this.config.stepDuration;\n      }\n    } else {\n      const footLeanDistance = leg\n        .getFootXY()\n        .distanceTo(leg.getIdealFootRestingXY());\n      if (\n        footLeanDistance > this.config.stepThreshold &&\n        this.canLiftLeg(pal, legs, leg)\n      ) {\n        state.currentStepMaxLift = constrain(\n          0,\n          1,\n          mapRange(\n            this.config.stepThreshold,\n            this.config.fullStepDistance,\n            0.1,\n            1,\n            footLeanDistance,\n          ),\n        );\n        state.stepProgress = constrain(\n          0,\n          1,\n          state.stepProgress + dtSeconds / this.config.stepDuration,\n        );\n      }\n    }\n  }\n\n  private getInitialLegState(pal: PalControlData, leg: PalLegGeom): LegState {\n    return {\n      lastFootOnFloorXY: leg.getIdealFootRestingXY(),\n      lastFootOnFloorPalPosition: pal.position,\n      stepProgress: 0,\n      restTimer: 0,\n      currentStepMaxLift: 1,\n    };\n  }\n\n  private getLegState(pal: PalControlData, leg: PalLegGeom): LegState {\n    const state = this.legStates.get(leg);\n    if (state) {\n      return state;\n    }\n\n    const initialState = this.getInitialLegState(pal, leg);\n    this.legStates.set(leg, initialState);\n    return initialState;\n  }\n\n  private getLegUpdate(pal: PalControlData, leg: PalLegGeom): PalLegGeomUpdate {\n    const state = this.getLegState(pal, leg);\n    return {\n      footXY: this.getFootXY(pal, leg, state),\n      footProjectionOrigin: this.getFootOrigin(pal, leg, state),\n      liftAmount: this.getLegLiftAmount(state),\n    };\n  }\n\n  private getFootXY(\n    pal: PalControlData,\n    leg: PalLegGeom,\n    state: LegState,\n  ): Vector2 {\n    if (isStepping(state)) {\n      const start = state.lastFootOnFloorXY;\n      const target = this.getPredictedIdealFootXYAtEndOfOfStep(pal, leg, state);\n      return start.lerp(target, state.stepProgress);\n    }\n\n    return state.lastFootOnFloorXY;\n  }\n\n  private getFootOrigin(\n    pal: PalControlData,\n    leg: PalLegGeom,\n    state: LegState,\n  ): Vector2 {\n    if (isStepping(state)) {\n      return state.lastFootOnFloorPalPosition.lerp(\n        pal.position,\n        state.stepProgress,\n      );\n    }\n\n    return state.lastFootOnFloorPalPosition;\n  }\n\n  private getPredictedIdealFootXYAtEndOfOfStep(\n    pal: PalControlData,\n    leg: PalLegGeom,\n    state: LegState,\n  ): Vector2 {\n    const timeRemaining = (1.4 - state.stepProgress) * this.config.stepDuration;\n\n    const predictedPosition = pal\n      .getVelocity()\n      .scale(timeRemaining)\n      .add(pal.position);\n\n    const predictedHeading = pal.heading + pal.headingVelocity * timeRemaining;\n\n    return Vector2.fromPolar(\n      predictedHeading + leg.angleOffset,\n      leg.floorRadius,\n    ).add(predictedPosition);\n  }\n\n  private getLegLiftAmount({\n    stepProgress,\n    currentStepMaxLift,\n  }: LegState): number {\n    return Math.sin(stepProgress * Math.PI) * currentStepMaxLift;\n  }\n}\n","import Color from 'color';\nimport { varyRelative, varyAbsolute, random, randomInt } from '../lib/utils';\nimport { BLUE } from './colors';\n\nexport type PalConfig = {\n  radius: number;\n  bodHeight: number;\n  bodBob: number;\n  eyeY: number;\n  eyeX: number;\n  eyeRadius: number;\n  mouthThickness: number;\n  mouthY: number;\n  mouthWidth: number;\n  mouthSmile: number;\n  buttTop: number;\n  buttBottom: number;\n  buttThickness: number;\n  color: Color;\n  hipHeight: number;\n  kneeScale: number;\n  legMaxLift: number;\n  kneeMaxOut: number;\n  stepDuration: number;\n  stepRestDuration: number;\n  stepThreshold: number;\n  fullStepDistance: number;\n  legWidth: number;\n  legPairs: number;\n};\n\nexport const classicPalConfig: PalConfig = {\n  radius: 14,\n  bodHeight: 25,\n  bodBob: 15,\n  eyeY: 6,\n  eyeX: 5,\n  eyeRadius: 2,\n  mouthThickness: 2,\n  mouthY: 2,\n  mouthWidth: 8,\n  mouthSmile: 4,\n  buttTop: 6,\n  buttBottom: 12,\n  buttThickness: 1.4,\n  color: BLUE.lighten(0.2),\n  hipHeight: 10,\n  kneeScale: 1.3,\n  legMaxLift: 0.3,\n  kneeMaxOut: 14,\n  stepDuration: 0.2,\n  stepRestDuration: 0.2,\n  stepThreshold: 0.2,\n  fullStepDistance: 20,\n  legWidth: 4,\n  legPairs: 1,\n};\n\nexport const generateRandomPalConfig = (): PalConfig => {\n  const radius = varyRelative(14, 0.2);\n  const hipHeight = varyRelative(radius * 0.7, 0.3);\n  const bodHeight = varyRelative(radius * 2, 0.3);\n  const legLength = bodHeight - (radius - hipHeight); // typical: 24\n\n  return {\n    radius,\n    bodHeight,\n    bodBob: varyRelative(radius, 0.2),\n    eyeY: varyRelative(radius * 0.5, 0.2),\n    eyeX: varyRelative(radius * 0.4, 0.3),\n    eyeRadius: varyRelative(radius * 0.15, 0.4),\n    mouthThickness: varyRelative(radius * 0.15, 0.4),\n    mouthY: varyAbsolute(0, radius * 0.2),\n    mouthWidth: varyRelative(radius * 0.5, 0.3),\n    mouthSmile: varyRelative(radius * 0.3, 0.3),\n    buttTop: varyRelative(radius * 0.4, 0.2),\n    buttBottom: varyRelative(radius * 0.85, 0.15),\n    buttThickness: varyRelative(radius * 0.1, 0.5),\n    color: BLUE.lighten(random(-0.2, 0.2))\n      .saturate(random(-0.2, 0.2))\n      .rotate(random(-10, 10)),\n    hipHeight,\n    kneeScale: varyAbsolute(1.3, 0.3),\n    legMaxLift: random(0.2, 0.5),\n    kneeMaxOut: varyRelative(legLength * 0.6, 0.4),\n    stepDuration: varyRelative(legLength * 0.01, 0.4),\n    stepRestDuration: varyRelative(legLength * 0.0083, 0.4),\n    stepThreshold: varyRelative(legLength * 0.01, 0.4),\n    fullStepDistance: varyRelative(legLength * 0.7, 0.4),\n    legWidth: varyRelative(radius * 0.3, 0.4),\n    legPairs: randomInt(1, 4),\n  };\n};\n","import Color from 'color';\n\n// https://coolors.co/f8ffe5-06d6a0-1b9aaa-ef476f-ffc43d\nexport const LIGHT_BG = new Color('#F8FFE5');\nexport const TEAL = new Color('#06D6A0');\nexport const BLUE = new Color('#1B9AAA');\nexport const RED = new Color('#EF476F');\nexport const YELLOW = new Color('#FFC43D');\n"],"names":["$27b42f6817130e22$export$af6a0ce085ef7632","Component","entity","position","call","this","speed","heading","headingVelocity","key","getHeadingVec","scale","$39Hjj","default","fromPolar","$3Nswo","$27b42f6817130e22$export$7f91c1b5fe2069f9","target","data","addComponent","newTarget","dtMilliseconds","dtSeconds","angleToTarget","angleTo","distance","distanceTo","accelerate","angleDelta","$8qLe2","normalizeAngle","lastHeading","amt","lastSpeed","constrain","avgSpeed","add","$27b42f6817130e22$export$ca0888e697597df4","lastPosition","$14b3c2a1d01ea7a9$var$HALF_PI","Math","PI","$14b3c2a1d01ea7a9$export$2e2bcd8739ae039","config","animationController","bobAmount","controlData","getComponent","$1js6q","PalControlData","legs","shuffle","flatten","times","legPairs","n","progress","$i3155","_this","$8TSCy","assertThisInitialized","lerp","update1","update","$8OvEy","assert","length","forEach","leg","i","bob","bodBob","$eJCSX","create","x","y","bodHeight","radius","$64c1a0155cd064ba$var$getLegRadius","param","hipHeight","legWidth","sqrt","$64c1a0155cd064ba$export$2e2bcd8739ae039","palData","palGeom","angleOffset","liftAmount","hipRadius","kneeRadius","kneeScale","floorRadius","footXY","getIdealFootRestingXY","footOrigin","footProjectionOrigin","getHipZ","legMaxLift","kneeMaxOut","getFootZ","getHipOrigin","getFootOrigin","bod","getBod","center","$565b68aaa9b1f32d$var$HALF_PI","$565b68aaa9b1f32d$export$2e2bcd8739ae039","geom","$7oj37","ctx","setLineDash","beginPath","ellipse","fillStyle","fill","filter","l","drawLeg","_this1","drawBod","angle","colorDarkenAmount","abs","legColor","color","darken","hip","projectZ","getHipXY","knee","getKneeXY","getKneeZ","getKneeOrigin","foot","getFootXY","moveTo","quadraticCurveTo","lineCap","strokeStyle","toString","lineWidth","stroke","save","$6IKqx","circle","clip","faceX","eyeX","eyeY","eyeRadius","mouthWidth","mouthY","mouthSmile","mouthThickness","makeButtLine","buttThickness","restore","buttX","buttTop","buttBottom","xy","z","origin","$6dfbd3e608b14c78$export$e1d786d2f707b414","arc","$6dfbd3e608b14c78$export$bb654e07daaf8c3a","path","segments","getStart","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","segment","value","$6SQqk","lineTo","getEnd","$7Tktm","Error","concat","startAngle","endAngle","isAnticlockwise","err","return","$338f5ed02b39930b$export$2e2bcd8739ae039","start","end","line","$eYUEV","delta","getDelta","Object","freeze","magnitude","constrainedPosition","getLength","withMagnitude","$e02ffcf469d66930$export$2e2bcd8739ae039","pointOnCircumference","atan2","sin","cos","proportion","angleDifference","circumference","mapRange","$9dd30e9fc6708b04$var$isStepping","stepProgress","$9dd30e9fc6708b04$export$2e2bcd8739ae039","legStates","Map","pal","updateLegState","legUpdates","map","getLegUpdate","reduce","sum","leg1","includes","enoughLegsOnFloor","getLegState","floor","log","anyStepsJustStarted","some","state","restTimer","stepRestDuration","stepDuration","lastFootOnFloorXY","lastFootOnFloorPalPosition","footLeanDistance","stepThreshold","canLiftLeg","currentStepMaxLift","fullStepDistance","get","initialState","getInitialLegState","set","getLegLiftAmount","getPredictedIdealFootXYAtEndOfOfStep","timeRemaining","predictedPosition","getVelocity","predictedHeading","$13ef68c0b32f0aae$export$8f4ea176c3dd079d","$5MVTg","BLUE","lighten","varyRelative","legLength","varyAbsolute","random","saturate","rotate","randomInt","$fbababb791a60609$export$738c3b9a44c87ecc","$parcel$interopDefault","$9AT65"],"version":3,"file":"index.891ebae7.js.map"}