{"mappings":"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","sources":["src/lib/DebugDraw.ts"],"sourcesContent":["import AABB from './geom/AABB';\nimport Vector2 from './geom/Vector2';\n\nconst DEFAULT_DEBUG_COLOR = 'magenta';\nconst LABEL_OFFSET = new Vector2(5, 0);\nconst DEBUG_POINT_SIZE = 3;\nconst HAIRLINE = 0.5;\nconst DEBUG_ARROW_ANGLE = Math.PI * 0.75;\nconst DEBUG_ARROW_SIZE = 5;\n\nexport type StrokeOptions = {\n  strokeWidth?: number;\n  stroke?: string;\n  strokeCap?: 'butt' | 'round' | 'square';\n  strokeDash?: number[];\n  strokeDashOffset?: number;\n  strokeJoin?: 'bevel' | 'round' | 'miter';\n};\n\nexport type FillOptions = {\n  fill?: string;\n};\n\nexport type DebugOptions = {\n  color?: string;\n  label?: string;\n};\n\nexport type StrokeAndFillOptions = StrokeOptions & FillOptions;\n\nexport class DebugDraw {\n  constructor(private readonly ctx: CanvasRenderingContext2D) {}\n\n  public clear(fill?: string) {\n    if (!fill) {\n      this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n      return;\n    }\n\n    this.applyFillOptions({ fill });\n    this.ctx.fillRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n  }\n\n  public beginPath() {\n    this.ctx.beginPath();\n  }\n\n  public moveTo({ x, y }: Vector2) {\n    this.ctx.moveTo(x, y);\n  }\n\n  public lineTo({ x, y }: Vector2) {\n    this.ctx.lineTo(x, y);\n  }\n\n  public arc(\n    { x, y }: Vector2,\n    radius: number,\n    startAngle: number,\n    endAngle: number,\n    anticlockwise?: boolean,\n  ) {\n    this.ctx.arc(x, y, radius, startAngle, endAngle, anticlockwise);\n  }\n\n  public arcTo(p1: Vector2, p2: Vector2, radius: number) {\n    this.ctx.arcTo(p1.x, p1.y, p2.x, p2.y, radius);\n  }\n\n  public applyStrokeOptions({\n    strokeWidth = 1,\n    stroke = undefined,\n    strokeCap = 'butt',\n    strokeDash = [],\n    strokeDashOffset = 0,\n    strokeJoin = 'round',\n  }: StrokeOptions) {\n    if (stroke) {\n      this.ctx.lineWidth = strokeWidth;\n      this.ctx.strokeStyle = stroke;\n      this.ctx.lineCap = strokeCap;\n      this.ctx.setLineDash(strokeDash);\n      this.ctx.lineDashOffset = strokeDashOffset;\n      this.ctx.lineJoin = strokeJoin;\n    }\n  }\n\n  public stroke(options: StrokeOptions) {\n    if (options.stroke) {\n      this.applyStrokeOptions(options);\n      this.ctx.stroke();\n    }\n  }\n\n  public applyFillOptions({ fill = undefined }: FillOptions) {\n    if (fill) {\n      this.ctx.fillStyle = fill;\n    }\n  }\n\n  public fill(options: FillOptions) {\n    if (options.fill) {\n      this.applyFillOptions(options);\n      this.ctx.fill();\n    }\n  }\n\n  public applyStrokeAndFillOptions(options: StrokeAndFillOptions) {\n    this.applyFillOptions(options);\n    this.applyStrokeOptions(options);\n  }\n\n  public strokeAndFill(options: StrokeAndFillOptions) {\n    this.fill(options);\n    this.stroke(options);\n  }\n\n  public getDebugStrokeOptions(\n    color: string = DEFAULT_DEBUG_COLOR,\n  ): StrokeOptions {\n    return { stroke: color, strokeWidth: HAIRLINE };\n  }\n\n  public debugStroke(color: string = DEFAULT_DEBUG_COLOR) {\n    this.stroke(this.getDebugStrokeOptions(color));\n  }\n\n  public fillText(text: string, position: Vector2, options: FillOptions = {}) {\n    this.applyFillOptions(options);\n    this.ctx.fillText(text, position.x, position.y);\n  }\n\n  public circle(\n    center: Vector2,\n    radius: number,\n    options: StrokeAndFillOptions,\n  ) {\n    this.beginPath();\n    this.arc(center, radius, 0, 2 * Math.PI);\n    this.strokeAndFill(options);\n  }\n\n  public ellipse(\n    center: Vector2,\n    radiusX: number,\n    radiusY: number,\n    options: StrokeAndFillOptions,\n  ) {\n    this.beginPath();\n    this.ctx.ellipse(center.x, center.y, radiusX, radiusY, 0, 0, Math.PI * 2);\n    this.strokeAndFill(options);\n  }\n\n  public debugLabel(\n    label: string | undefined,\n    position: Vector2,\n    color: string,\n  ) {\n    if (label) {\n      this.applyFillOptions({ fill: color });\n      this.fillText(label, position.add(LABEL_OFFSET));\n    }\n  }\n\n  public debugPointX(\n    position: Vector2,\n    { color = DEFAULT_DEBUG_COLOR, label = undefined }: DebugOptions = {},\n  ) {\n    this.debugLabel(label, position, color);\n\n    this.beginPath();\n    this.ctx.moveTo(\n      position.x - DEBUG_POINT_SIZE,\n      position.y - DEBUG_POINT_SIZE,\n    );\n    this.ctx.lineTo(\n      position.x + DEBUG_POINT_SIZE,\n      position.y + DEBUG_POINT_SIZE,\n    );\n    this.ctx.moveTo(\n      position.x + DEBUG_POINT_SIZE,\n      position.y - DEBUG_POINT_SIZE,\n    );\n    this.ctx.lineTo(\n      position.x - DEBUG_POINT_SIZE,\n      position.y + DEBUG_POINT_SIZE,\n    );\n    this.stroke({ strokeWidth: HAIRLINE, stroke: color });\n  }\n\n  public debugPointO(\n    position: Vector2,\n    { color = DEFAULT_DEBUG_COLOR, label = undefined }: DebugOptions = {},\n  ) {\n    this.debugLabel(label, position, color);\n\n    this.circle(position, DEBUG_POINT_SIZE, {\n      strokeWidth: HAIRLINE,\n      stroke: color,\n    });\n  }\n\n  public debugArrow(\n    start: Vector2,\n    end: Vector2,\n    { color = DEFAULT_DEBUG_COLOR, label = undefined }: DebugOptions = {},\n  ) {\n    this.debugLabel(label, Vector2.average([start, end]), color);\n\n    this.ctx.beginPath();\n    this.moveTo(start);\n    this.lineTo(end);\n\n    const vector = end.sub(start);\n    const arrowLeftPoint = vector\n      .rotate(-DEBUG_ARROW_ANGLE)\n      .withMagnitude(DEBUG_ARROW_SIZE)\n      .add(end);\n    const arrowRightPoint = vector\n      .rotate(+DEBUG_ARROW_ANGLE)\n      .withMagnitude(DEBUG_ARROW_SIZE)\n      .add(end);\n\n    this.moveTo(arrowLeftPoint);\n    this.lineTo(end);\n    this.lineTo(arrowRightPoint);\n    this.stroke({ strokeWidth: HAIRLINE, stroke: color });\n  }\n\n  public debugVectorAtPoint(\n    vector: Vector2,\n    base: Vector2,\n    options?: DebugOptions,\n  ) {\n    this.debugArrow(base, base.add(vector), options);\n  }\n\n  public polygon(\n    polygon: ReadonlyArray<Vector2>,\n    options: StrokeAndFillOptions = {},\n  ) {\n    this.beginPath();\n    this.moveTo(polygon[polygon.length - 1]);\n    for (const point of polygon) {\n      this.lineTo(point);\n    }\n    this.strokeAndFill(options);\n  }\n\n  public polyLine(points: ReadonlyArray<Vector2>, options: StrokeOptions = {}) {\n    this.beginPath();\n    this.moveTo(points[0]);\n    for (let i = 1; i < points.length; i++) {\n      this.lineTo(points[i]);\n    }\n    this.stroke(options);\n  }\n\n  public debugPolygon(\n    polygon: ReadonlyArray<Vector2>,\n    { color = DEFAULT_DEBUG_COLOR, label = undefined }: DebugOptions = {},\n  ) {\n    this.debugLabel(label, polygon[0], color);\n    this.polygon(polygon, this.getDebugStrokeOptions(color));\n  }\n\n  public debugPolyLine(\n    polyLine: ReadonlyArray<Vector2>,\n    { color = DEFAULT_DEBUG_COLOR, label = undefined }: DebugOptions = {},\n  ) {\n    this.debugLabel(label, polyLine[0], color);\n    this.polyLine(polyLine, this.getDebugStrokeOptions(color));\n  }\n\n  public aabb(\n    aabb: AABB,\n    opts: StrokeAndFillOptions & { debug?: DebugOptions },\n  ) {\n    if (opts.debug) {\n      this.debugLabel(\n        opts.debug.label,\n        aabb.origin,\n        opts.debug.color || DEFAULT_DEBUG_COLOR,\n      );\n    }\n    this.ctx.beginPath();\n    this.ctx.rect(aabb.left, aabb.top, aabb.width, aabb.height);\n    this.strokeAndFill(opts);\n  }\n}\n"],"names":["$c3738fd0f859c4b7$var$DEFAULT_DEBUG_COLOR","$c3738fd0f859c4b7$var$LABEL_OFFSET","$39Hjj","default","$c3738fd0f859c4b7$var$HAIRLINE","$c3738fd0f859c4b7$var$DEBUG_ARROW_ANGLE","Math","PI","$c3738fd0f859c4b7$export$8c1f62922c980a1a","ctx","key","fill","this","applyFillOptions","fillRect","canvas","width","height","clearRect","beginPath","param","x","y","moveTo","lineTo","radius","startAngle","endAngle","anticlockwise","arc","p1","p2","arcTo","strokeWidth","_strokeWidth","stroke","_strokeCap","strokeCap","_strokeDash","strokeDash","_strokeDashOffset","strokeDashOffset","_strokeJoin","strokeJoin","lineWidth","strokeStyle","lineCap","setLineDash","lineDashOffset","lineJoin","options","applyStrokeOptions","fillStyle","color","getDebugStrokeOptions","text","position","fillText","center","strokeAndFill","radiusX","radiusY","ellipse","label","add","_color","ref","debugLabel","circle","start","end","average","vector","sub","arrowLeftPoint","rotate","withMagnitude","arrowRightPoint","base","debugArrow","polygon","length","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","point","value","err","return","points","i","polyLine","aabb","opts","debug","origin","rect","left","top"],"version":3,"file":"index.57ad5440.js.map"}