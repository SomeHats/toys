import{o as nt,k as I,b as z,V as O,U as C}from"./chunk_assert.30730bef.js";/* empty css                       */import{a as D,F as B,j as A}from"./chunk_ResizeObserver.de1ce7b6.js";import{r as ot,R as st}from"./chunk_index.0b9c6f54.js";import{c as at}from"./chunk_client.3824c486.js";import{S as J,V as g,R as Q}from"./chunk_Vector2.5365c98f.js";import{B as it,u as V}from"./chunk_useGestureDetector.1b4f3306.js";import{c as ct,d as lt}from"./chunk_storage.39edd6db.js";import{S as q}from"./chunk_svgPathBuilder.bb208ee1.js";import{I as ut}from"./chunk_Ids.d4daa001.js";import{a as U,c as ht,r as pt,b as X}from"./chunk_track.9f330cb0.js";import{L as W}from"./chunk_Line2.96db62cd.js";import"./chunk__commonjsHelpers.725317a4.js";import"./chunk_theme.cdbd8d37.js";import"./chunk_EventEmitter.daf2b5cf.js";import"./chunk_index.2e4736b8.js";function Y(e,t){return function(r){ft(t,"addInitializer"),M(r,"An initializer"),e.push(r)}}function x(e,t){if(!e(t))throw new TypeError("Attempted to access private element on non-instance")}function H(e,t,r,o,n,l,s,c,f){var u;switch(n){case 1:u="accessor";break;case 2:u="method";break;case 3:u="getter";break;case 4:u="setter";break;default:u="field"}var i,a,p={kind:u,name:s?"#"+t:t,static:l,private:s},m={v:!1};if(n!==0&&(p.addInitializer=Y(o,m)),s||n!==0&&n!==2)if(n===2)i=function(h){return x(f,h),r.value};else{var v=n===0||n===1;(v||n===3)&&(i=s?function(h){return x(f,h),r.get.call(h)}:function(h){return r.get.call(h)}),(v||n===4)&&(a=s?function(h,d){x(f,h),r.set.call(h,d)}:function(h,d){r.set.call(h,d)})}else i=function(h){return h[t]},n===0&&(a=function(h,d){h[t]=d});var y=s?f.bind():function(h){return t in h};p.access=i&&a?{get:i,set:a,has:y}:i?{get:i,has:y}:{set:a,has:y};try{return e(c,p)}finally{m.v=!0}}function ft(e,t){if(e.v)throw new Error("attempted to call "+t+" after decoration was finished")}function M(e,t){if(typeof e!="function")throw new TypeError(t+" must be a function")}function N(e,t){var r=typeof t;if(e===1){if(r!=="object"||t===null)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");t.get!==void 0&&M(t.get,"accessor.get"),t.set!==void 0&&M(t.set,"accessor.set"),t.init!==void 0&&M(t.init,"accessor.init")}else if(r!=="function"){var o;throw o=e===0?"field":e===10?"class":"method",new TypeError(o+" decorators must return a function or void 0")}}function mt(e){return function(){return e(this)}}function dt(e){return function(t){e(this,t)}}function gt(e,t,r,o,n,l,s,c,f){var u,i,a,p,m,v,y=r[0];if(s?u=n===0||n===1?{get:mt(r[3]),set:dt(r[4])}:n===3?{get:r[3]}:n===4?{set:r[3]}:{value:r[3]}:n!==0&&(u=Object.getOwnPropertyDescriptor(t,o)),n===1?a={get:u.get,set:u.set}:n===2?a=u.value:n===3?a=u.get:n===4&&(a=u.set),typeof y=="function")(p=H(y,o,u,c,n,l,s,a,f))!==void 0&&(N(n,p),n===0?i=p:n===1?(i=p.init,m=p.get||a.get,v=p.set||a.set,a={get:m,set:v}):a=p);else for(var h=y.length-1;h>=0;h--){var d;(p=H(y[h],o,u,c,n,l,s,a,f))!==void 0&&(N(n,p),n===0?d=p:n===1?(d=p.init,m=p.get||a.get,v=p.set||a.set,a={get:m,set:v}):a=p,d!==void 0&&(i===void 0?i=d:typeof i=="function"?i=[i,d]:i.push(d)))}if(n===0||n===1){if(i===void 0)i=function(b,w){return w};else if(typeof i!="function"){var P=i;i=function(b,w){for(var _=w,j=0;j<P.length;j++)_=P[j].call(b,_);return _}}else{var T=i;i=function(b,w){return T.call(b,w)}}e.push(i)}n!==0&&(n===1?(u.get=a.get,u.set=a.set):n===2?u.value=a:n===3?u.get=a:n===4&&(u.set=a),s?n===1?(e.push(function(b,w){return a.get.call(b,w)}),e.push(function(b,w){return a.set.call(b,w)})):n===2?e.push(a):e.push(function(b,w){return a.call(b,w)}):Object.defineProperty(t,o,u))}function vt(e,t,r){for(var o,n,l,s=[],c=new Map,f=new Map,u=0;u<t.length;u++){var i=t[u];if(Array.isArray(i)){var a,p,m=i[1],v=i[2],y=i.length>3,h=m>=5,d=r;if(h?(a=e,(m-=5)!==0&&(p=n=n||[]),y&&!l&&(l=function(b){return wt(b)===e}),d=l):(a=e.prototype,m!==0&&(p=o=o||[])),m!==0&&!y){var P=h?f:c,T=P.get(v)||0;if(T===!0||T===3&&m!==4||T===4&&m!==3)throw new Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+v);!T&&m>2?P.set(v,m):P.set(v,!0)}gt(s,a,i,v,m,h,y,p,d)}}return F(s,o),F(s,n),s}function F(e,t){t&&e.push(function(r){for(var o=0;o<t.length;o++)t[o].call(r);return r})}function yt(e,t){if(t.length>0){for(var r=[],o=e,n=e.name,l=t.length-1;l>=0;l--){var s={v:!1};try{var c=t[l](o,{kind:"class",name:n,addInitializer:Y(r,s)})}finally{s.v=!0}c!==void 0&&(N(10,c),o=c)}return[o,function(){for(var f=0;f<r.length;f++)r[f].call(o)}]}}function bt(e,t,r,o){return{e:vt(e,t,o),get c(){return yt(e,r)}}}function wt(e){if(Object(e)!==e)throw TypeError("right-hand side of 'in' should be an object, got "+(e!==null?typeof e:"null"));return e}function At(e,t){const r=new WeakMap;return t.addInitializer(function(){console.log("createComputed",{this:this,compute:e,context:t}),r.set(this,ht(String(t.name),()=>e.call(this)))}),function(){return z(r.get(this),"Assertion Error: computeds.get((this as This))").value}}function K(e){var t;const o=class{constructor(l){t(this);const s={};for(const[c,f]of nt(l))s[c]=U(c,f);this.atoms=s}get serialized(){const l={};for(const s of I(e)){const c=this.atoms[s].value;if(c.serialized){l[s]=c.serialized();continue}l[s]=c}return l}};let r=o;(()=>{[t]=bt(o,[[At,3,"serialized"]],[]).e})();for(const n of I(e))Object.defineProperty(r.prototype,n,{get(){return this.atoms[n].value},set(l){this.atoms[n].set(l)}});return r.modelSchema=J.object(e),r}class Et{constructor(){this.pointer=U("Inputs.pointer",g.ZERO),this.events={onPointerMove:t=>{t.isPrimary&&this.pointer.set(g.fromEvent(t))},onPointerDown:t=>{t.isPrimary&&this.pointer.set(g.fromEvent(t))},onPointerUp:t=>{t.isPrimary&&this.pointer.set(g.fromEvent(t))}}}}class k{constructor(t,r){this.parent=t,this.app=r,this._child=U("State.child",null)}clear(){this._child.set(null)}enter(t,...r){const o=new t(this,...r);return this._child.set(o),o}get state(){return this._child.value}get path(){return this.state?`${this.name}.${this.state.path}`:this.name}onPointerDown(t){var r;(r=this.state)==null||r.onPointerDown(t)}onPointerMove(t){var r;(r=this.state)==null||r.onPointerMove(t)}onPointerUp(t){var r;(r=this.state)==null||r.onPointerUp(t)}onPointerCancel(t){var r;(r=this.state)==null||r.onPointerCancel(t)}}class tt extends k{constructor(t){super(t,t.app)}transitionTo(t,...r){return this.parent.enter(t,...r)}exit(){this.parent.clear()}}class Pt extends k{constructor(t){super(null,t),this.name="root",this.enter($)}clear(){this.enter($)}}class $ extends tt{constructor(){super(...arguments),this.name="idle"}onPointerDown(t){const r=this.app.createWire(g.fromEvent(t));this.transitionTo(Tt,"end",r)}}class Tt extends tt{constructor(t,r,o){super(t),this.handle=r,this.wire=o,this.name="DraggingHandle"}onPointerMove(t){this.wire.end=g.fromEvent(t)}onPointerUp(t){this.exit()}}var St=Object.getPrototypeOf,Wt=Reflect.get,et=(e,t,r)=>Wt(St(e),r,t);const Z=C(60),rt=new ut("wire"),R=class extends K({id:rt.schema,start:g.schema,end:g.schema}){get startAngle(){const e=this.start.angleTo(this.end);return Math.round(e/Z)*Z}get segments(){const e=this.start.lerp(this.end,.5),t=this.start.angleTo(e)-this.startAngle;console.log({angle:O(this.start.angleTo(this.end)),angleToCenter:O(t),startAngle:O(this.startAngle)});const r=W.fromAngleAndPoint(this.startAngle,this.start),o=W.fromAngleAndPoint(this.startAngle+C(60),e),n=W.fromAngleAndPoint(this.startAngle-C(60),e),l=o.pointAtIntersectionWith(r),s=n.pointAtIntersectionWith(r),c=this.start.distanceTo(l)<this.start.distanceTo(s)?o:n,f=W.fromAngleAndPoint(this.startAngle,this.end);return[this.start,r.pointAtIntersectionWith(c),c.pointAtIntersectionWith(f),this.end]}};let G=R;G.schema=et(R,R,"modelSchema").transform(e=>Q.ok(new R(e)),e=>e.serialized);const S=class extends K({wires:J.arrayOf(G.schema)}){constructor(){super(...arguments),this.inputs=new Et,this.state=new Pt(this),this.events={onPointerDown:e=>{this.inputs.events.onPointerDown(e),this.state.onPointerDown(e)},onPointerMove:e=>{this.inputs.events.onPointerMove(e),this.state.onPointerMove(e)},onPointerUp:e=>{this.inputs.events.onPointerUp(e),this.state.onPointerUp(e)},onPointerCancel:e=>{this.state.onPointerCancel(e)}}}static createEmpty(){return new S({wires:[]})}reset(){this.wires=[]}createWire(e){const t=new G({id:rt.generate(),start:e,end:e});return this.wires=[...this.wires,t],t}removeWire(e){this.wires=this.wires.filter(t=>t!==e)}};let L=S;L.schema=et(S,S,"modelSchema").transform(e=>Q.ok(new S(e)),e=>e.serialized);const Dt="action-gradient",E=ct("wiresApp",L.schema,L.createEmpty);pt("save",()=>{lt("wiresApp",L.schema,E)},{scheduleEffect(e){window.requestIdleCallback?window.requestIdleCallback(()=>{console.log("idle"),e()}):window.requestAnimationFrame(e)}});const Mt=X(function(){return ot.useEffect(()=>{window.app=E,window.reset=()=>{E.wires=[]}}),D(B,{children:[D("svg",{className:"absolute inset-0 isolate h-full w-full bg-white",...E.events,children:[A("radialGradient",{id:Dt}),E.wires.map(t=>A(Rt,{wire:t},t.id))]}),A("div",{className:"pointer-events-none absolute inset-0 bg-stone-50 mix-blend-darken"}),D("div",{className:"pointer-events-none absolute inset-0 p-3",children:[A(it,{onClick:()=>E.reset(),className:"pointer-events-auto",children:"reset"}),A("div",{children:E.state.path})]})]})}),Rt=X(function({wire:t}){const r=V({onDragStart:n=>{n.stopPropagation();const l=t.start,s=g.fromEvent(n).sub(t.start);return{couldBeTap:!1,pointerCapture:!0,onMove:c=>{t.start=g.fromEvent(c).sub(s)},onEnd:c=>{t.start=g.fromEvent(c).sub(s)},onCancel:()=>{t.start=l}}}}),o=V({onDragStart:n=>{n.stopPropagation();const l=t.end,s=g.fromEvent(n).sub(t.end);return{couldBeTap:!1,pointerCapture:!0,onMove:c=>{t.end=g.fromEvent(c).sub(s)},onEnd:c=>{t.end=g.fromEvent(c).sub(s)},onCancel:()=>{t.end=l}}}});return D(B,{children:[A("path",{d:q.straightThroughPoints(t.segments).toString(),className:"fill-none stroke-slate-800 opacity-30 mix-blend-color-burn",strokeWidth:20,strokeLinecap:"round",strokeLinejoin:"round"}),A("path",{d:q.straightThroughPoints(t.segments).toString(),className:"fill-none stroke-fuchsia-400",strokeWidth:8,strokeLinecap:"round",strokeLinejoin:"round"}),A("circle",{...r.events,cx:t.start.x,cy:t.start.y,r:8,className:"fill-transparent stroke-transparent stroke-1 hover:stroke-blue-500"}),A("circle",{...o.events,cx:t.end.x,cy:t.end.y,r:8,className:"fill-transparent stroke-transparent stroke-1 hover:stroke-blue-500"})]})}),Lt=z(document.getElementById("root"),'Assertion Error: document.getElementById("root")');at(Lt).render(A(st.StrictMode,{children:A(Mt,{})}));
