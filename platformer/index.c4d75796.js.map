{"mappings":"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","sources":["src/lib/KeyCode.tsx","src/lib/ButtonMapping.tsx","src/lib/scene/SceneSystem.ts","src/platformer/platformer-main.tsx"],"sourcesContent":["export enum KeyCode {\n  THAT_KEY_HAS_NO_KEYCODE = 0,\n  BREAK = 3,\n  BACKSPACE_DELETE = 8,\n  TAB = 9,\n  CLEAR = 12,\n  ENTER = 13,\n  SHIFT = 16,\n  CTRL = 17,\n  ALT = 18,\n  PAUSE_BREAK = 19,\n  CAPS_LOCK = 20,\n  ESCAPE = 27,\n  SPACE = 32,\n  PAGE_UP = 33,\n  PAGE_DOWN = 34,\n  END = 35,\n  HOME = 36,\n  LEFT_ARROW = 37,\n  UP_ARROW = 38,\n  RIGHT_ARROW = 39,\n  DOWN_ARROW = 40,\n  SELECT = 41,\n  PRINT = 42,\n  EXECUTE = 43,\n  PRINT_SCREEN = 44,\n  INSERT = 45,\n  DELETE = 46,\n  HELP = 47,\n  DIGIT_0 = 48,\n  DIGIT_1 = 49,\n  DIGIT_2 = 50,\n  DIGIT_3 = 51,\n  DIGIT_4 = 52,\n  DIGIT_5 = 53,\n  DIGIT_6 = 54,\n  DIGIT_7 = 55,\n  DIGIT_8 = 56,\n  DIGIT_9 = 57,\n  COLON = 58,\n  LESS_THAN = 60,\n  A = 65,\n  B = 66,\n  C = 67,\n  D = 68,\n  E = 69,\n  F = 70,\n  G = 71,\n  H = 72,\n  I = 73,\n  J = 74,\n  K = 75,\n  L = 76,\n  M = 77,\n  N = 78,\n  O = 79,\n  P = 80,\n  Q = 81,\n  R = 82,\n  S = 83,\n  T = 84,\n  U = 85,\n  V = 86,\n  W = 87,\n  X = 88,\n  Y = 89,\n  Z = 90,\n  NUMPAD_0 = 96,\n  NUMPAD_1 = 97,\n  NUMPAD_2 = 98,\n  NUMPAD_3 = 99,\n  NUMPAD_4 = 100,\n  NUMPAD_5 = 101,\n  NUMPAD_6 = 102,\n  NUMPAD_7 = 103,\n  NUMPAD_8 = 104,\n  NUMPAD_9 = 105,\n  NUMPAD_MULTIPLY = 106,\n  NUMPAD_ADD = 107,\n  NUMPAD_PERIOD = 108,\n  NUMPAD_SUBTRACT = 109,\n  F1 = 112,\n  F2 = 113,\n  F3 = 114,\n  F4 = 115,\n  F5 = 116,\n  F6 = 117,\n  F7 = 118,\n  F8 = 119,\n  F9 = 120,\n  F10 = 121,\n  F11 = 122,\n  F12 = 123,\n  F13 = 124,\n  F14 = 125,\n  F15 = 126,\n  F16 = 127,\n  F17 = 128,\n  F18 = 129,\n  F19 = 130,\n  F20 = 131,\n  F21 = 132,\n  F22 = 133,\n  F23 = 134,\n  F24 = 135,\n  F25 = 136,\n  F26 = 137,\n  F27 = 138,\n  F28 = 139,\n  F29 = 140,\n  F30 = 141,\n  F31 = 142,\n  F32 = 143,\n  NUM_LOCK = 144,\n  SCROLL_LOCK = 145,\n  AIRPLANE_MODE = 151,\n  PAGE_BACKWARD = 166,\n  PAGE_FORWARD = 167,\n  HOME_KEY = 172,\n  SEMI_COLON = 186,\n  EQUAL_SIGN = 187,\n  COMMA = 188,\n  DASH = 189,\n  PERIOD = 190,\n  FORWARD_SLASH = 191,\n  GRAVE_ACCENT = 192,\n  OPEN_BRACKET = 219,\n  BACK_SLASH = 220,\n  CLOSE_BRACKET = 221,\n  SINGLE_QUOTE = 222,\n}\n","import { Key } from 'readline';\nimport { AnimationActionLoopStyles } from 'three';\nimport { assert } from './assert';\nimport EventEmitter, { Unsubscribe } from './EventEmitter';\nimport { KeyCode } from './KeyCode';\nimport { entries } from './utils';\n\ntype ActionInfo = {\n  downEvent: EventEmitter<void>;\n  upEvent: EventEmitter<void>;\n  isDown: boolean;\n};\n\nexport class ButtonMapping<Actions extends string> {\n  private readonly keyCodeToAction: ReadonlyMap<KeyCode, Actions>;\n  private readonly actionInfo: ReadonlyMap<Actions, ActionInfo>;\n\n  constructor(actionMappings: Record<Actions, Array<KeyCode>>) {\n    const keyCodeToAction = new Map<KeyCode, Actions>();\n    const actionInfo = new Map<Actions, ActionInfo>();\n\n    for (const [action, keyCodes] of entries(actionMappings)) {\n      for (const keyCode of keyCodes) {\n        keyCodeToAction.set(keyCode, action);\n      }\n      actionInfo.set(action, {\n        downEvent: new EventEmitter(),\n        upEvent: new EventEmitter(),\n        isDown: false,\n      });\n    }\n\n    this.keyCodeToAction = keyCodeToAction;\n    this.actionInfo = actionInfo;\n\n    document.addEventListener('keydown', (event) => {\n      const actionInfo = this.getActionInfoForKeyCodeIfExists(event.keyCode);\n      if (!actionInfo) {\n        return;\n      }\n\n      actionInfo.isDown = true;\n      actionInfo.downEvent.emit();\n    });\n    document.addEventListener('keyup', (event) => {\n      const actionInfo = this.getActionInfoForKeyCodeIfExists(event.keyCode);\n      if (!actionInfo) {\n        return;\n      }\n\n      actionInfo.isDown = false;\n      actionInfo.upEvent.emit();\n    });\n  }\n\n  isDown(action: Actions): boolean {\n    return this.getActionInfo(action).isDown;\n  }\n\n  onDown(action: Actions, cb: () => void): Unsubscribe {\n    return this.getActionInfo(action).downEvent.listen(cb);\n  }\n\n  onUp(action: Actions, cb: () => void): Unsubscribe {\n    return this.getActionInfo(action).upEvent.listen(cb);\n  }\n\n  private getActionInfoForKeyCodeIfExists(keyCode: number): ActionInfo | null {\n    const action = this.keyCodeToAction.get(keyCode);\n    if (!action) {\n      return null;\n    }\n    return this.getActionInfo(action);\n  }\n\n  private getActionInfo(action: Actions): ActionInfo {\n    const actionInfo = this.actionInfo.get(action);\n    assert(actionInfo);\n    return actionInfo;\n  }\n}\n","// @flow\nimport { assert } from '../assert';\nimport Scene from './Scene';\n\nconst DEFAULT_NAME = '$$AbstractSceneSystem$$';\n\nexport default abstract class SceneSystem {\n  static systemName = DEFAULT_NAME;\n  private scene: Scene | null = null;\n\n  constructor() {\n    assert(\n      this.constructor !== SceneSystem,\n      'SceneSystem is an abstract class that must be extended',\n    );\n    assert(\n      (this.constructor as any).systemName !== DEFAULT_NAME,\n      'classes extending SceneSystem must override SceneSystem.systemName',\n    );\n  }\n\n  getScene(): Scene {\n    assert(this.scene, 'scene is required');\n    return this.scene;\n  }\n\n  afterAddToScene(scene: Scene) {\n    this.scene = scene;\n  }\n\n  // eslint-disable-next-line no-unused-vars\n  beforeRemoveFromScene(scene: Scene) {\n    this.scene = null;\n  }\n\n  // eslint-disable-next-line no-unused-vars\n  beforeUpdate(delta: number) {}\n\n  // eslint-disable-next-line no-unused-vars\n  afterUpdate(delta: number) {}\n\n  // eslint-disable-next-line no-unused-vars\n  beforeDraw(ctx: CanvasRenderingContext2D, time: number) {}\n\n  // eslint-disable-next-line no-unused-vars\n  afterDraw(ctx: CanvasRenderingContext2D, time: number) {}\n}\n","import { ButtonMapping } from '../lib/ButtonMapping';\nimport { DebugDraw, StrokeAndFillOptions } from '../lib/DebugDraw';\nimport AABB from '../lib/geom/AABB';\nimport Vector2 from '../lib/geom/Vector2';\nimport { KeyCode } from '../lib/KeyCode';\nimport Component from '../lib/scene/Component';\nimport Entity from '../lib/scene/Entity';\nimport Scene from '../lib/scene/Scene';\nimport SceneSystem from '../lib/scene/SceneSystem';\n\nclass DebugDrawSystem extends SceneSystem {\n  static systemName = 'DebugDragSystem';\n\n  debugDraw!: DebugDraw;\n\n  afterAddToScene(scene: Scene) {\n    super.afterAddToScene(scene);\n    this.debugDraw = new DebugDraw(scene.ctx);\n  }\n}\n\nclass AABBDrawSystem extends SceneSystem {\n  static systemName = 'AABBDebugDrawSystem';\n\n  debugDraw!: DebugDraw;\n\n  afterAddToScene(scene: Scene) {\n    super.afterAddToScene(scene);\n    this.debugDraw = new DebugDraw(scene.ctx);\n  }\n\n  afterDraw() {}\n}\n\nclass AABBComponent extends Component {\n  public value: AABB;\n\n  constructor(entity: Entity, value: AABB) {\n    super(entity);\n    this.value = value;\n  }\n\n  setOrigin(origin: Vector2) {\n    this.value = new AABB(origin, this.value.size);\n  }\n\n  beforeDraw(ctx: CanvasRenderingContext2D, time: number) {\n    ctx.save();\n    ctx.translate(this.value.left, this.value.top);\n  }\n  afterDraw(ctx: CanvasRenderingContext2D, time: number) {\n    ctx.restore();\n  }\n}\n\nclass AABBRenderer extends Component {\n  constructor(entity: Entity, public opts: StrokeAndFillOptions) {\n    super(entity);\n  }\n\n  getAABB(): AABB {\n    return this.entity.getComponent(AABBComponent).value;\n  }\n\n  draw(ctx: CanvasRenderingContext2D) {\n    this.getScene()\n      .getSystem(DebugDrawSystem)\n      .debugDraw.aabb(new AABB(Vector2.ZERO, this.getAABB().size), this.opts);\n  }\n}\n\nclass PlayerController extends Component {\n  constructor(\n    entity: Entity,\n    public readonly moveSpeed: number,\n    public readonly controls: ButtonMapping<'left' | 'right' | 'jump' | 'down'>,\n  ) {\n    super(entity);\n  }\n\n  update(delta: number) {\n    const aabbComponent = this.entity.getComponent(AABBComponent);\n    let origin = aabbComponent.value.origin;\n    if (this.controls.isDown('left')) {\n      origin = origin.sub(new Vector2(this.moveSpeed * delta, 0));\n    }\n    if (this.controls.isDown('right')) {\n      origin = origin.add(new Vector2(this.moveSpeed * delta, 0));\n    }\n\n    if (this.controls.isDown('jump')) {\n      origin = origin.sub(new Vector2(0, this.moveSpeed * delta));\n    }\n    if (this.controls.isDown('down')) {\n      origin = origin.add(new Vector2(0, this.moveSpeed * delta));\n    }\n    aabbComponent.setOrigin(origin);\n  }\n}\n\nconst scene = new Scene(800, 600, window.devicePixelRatio);\nscene.addSystem(new DebugDrawSystem());\n\nconst player = new Entity();\nplayer.addComponent(\n  AABBComponent,\n  new AABB(new Vector2(200, 200), new Vector2(20, 30)),\n);\nplayer.addComponent(AABBRenderer, {\n  fill: 'lime',\n  stroke: 'black',\n  strokeWidth: 1,\n});\nplayer.addComponent(\n  PlayerController,\n  0.4,\n  new ButtonMapping({\n    left: [KeyCode.A, KeyCode.LEFT_ARROW],\n    right: [KeyCode.D, KeyCode.RIGHT_ARROW],\n    jump: [KeyCode.W, KeyCode.UP_ARROW, KeyCode.SPACE],\n    down: [KeyCode.S],\n  }),\n);\nscene.addChild(player);\n\nscene.appendTo(document.getElementById('root')!);\nscene.start();\n\nconsole.log(scene);\n"],"names":["KeyCode","$3a65f7aa1454f808$export$605c45b92857f065","actionMappings","keyCodeToAction","Map","actionInfo","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","$8pNpe","entries","Symbol","iterator","next","done","_value","$eUMMJ","slicedToArray","value","action","keyCodes","_iteratorNormalCompletion1","_didIteratorError1","_iteratorError1","_step1","_iterator1","keyCode","set","err","return","downEvent","$6gLF9","default","upEvent","isDown","document","addEventListener","event","actionInfo1","this","getActionInfoForKeyCodeIfExists","emit","bind","key","getActionInfo","cb","listen","get","$diH60","assert","$49ccdc71b6345931$export$8e47cb5eebeb6e59","$f1394be5d7c387ca$var$DEFAULT_NAME","$f1394be5d7c387ca$export$9099ad97b570f7c","scene","constructor","systemName","delta","ctx","time","$3983b615276720c6$var$DebugDrawSystem","SceneSystem","apply","arguments","prototype","call","debugDraw","$bK7pi","DebugDraw","$3983b615276720c6$var$AABBDrawSystem","$3983b615276720c6$var$AABBComponent","Component","entity","origin","$7B1qO","size","save","translate","left","top","restore","$eCbAo","$3983b615276720c6$var$AABBRenderer","opts","getComponent","getScene","getSystem","aabb","$54lVR","ZERO","getAABB","$3983b615276720c6$var$PlayerController","moveSpeed","controls","aabbComponent","sub","add","setOrigin","$3983b615276720c6$var$scene","$i9QUB","window","devicePixelRatio","addSystem","$3983b615276720c6$var$player","$ej7qu","addComponent","fill","stroke","strokeWidth","A","LEFT_ARROW","right","D","RIGHT_ARROW","jump","W","UP_ARROW","SPACE","down","S","addChild","appendTo","getElementById","start","console","log"],"version":3,"file":"index.c4d75796.js.map"}